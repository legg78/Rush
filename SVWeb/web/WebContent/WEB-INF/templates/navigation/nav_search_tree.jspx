<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	  xmlns:f="http://java.sun.com/jsf/core"
	  xmlns:h="http://java.sun.com/jsf/html"
	  xmlns:ui="http://java.sun.com/jsf/facelets"
	  xmlns:a4j="http://richfaces.org/a4j"
	  xmlns:bre="http://www.bpc.ru/jsf/richfaces-ext"
	  xmlns:rich="http://richfaces.org/rich">
<ui:composition>
	<h:form id="quickSearchForm" onkeypress="handleNavSearchTreeEnter(event)">
		<h:panelGroup style="width: 100% ;height: 2px; background-color: white" layout="block"/>
		<script type="text/javascript">//<!--
		var expand;
		function showHideBorder(elem) {
			// this function seems to be attached to <tr> element
			// so to get <table> we take parentNode 1 or 2 times.
			elem = elem.parentNode;
			if (elem.tagName.toLowerCase() == "tbody") {
				elem = elem.parentNode;
			}
			if (elem.style.borderBottomWidth == "1px") {
				elem.style.borderBottomWidth = "0px";
			} else {
				elem.style.borderBottomWidth = "1px";
			}
		}
		function handleNavSearchTreeEnter(event) {
			if (event.keyCode == 13) {
				document.getElementById('quickSearchForm:searchLink').click();
				event.cancelBubble = true;
				event.returnValue = false;
				return false;
			}
			return false;
		}


		//-->
		</script>
		<a4j:queue name="queue" requestDelay="500" ignoreDupResponses="true"
				   size="1" sizeExceededBehavior="dropNew"/>

		<!-- rich:panelBarItem label="# {group.name}" rendered="# {not empty group}" -->
		<h:panelGroup layout="block">
			<h:inputText name="searchTerm" value="#{menu.searchTerm}" maxlength="200"
						 style="border: 1px solid #999999; margin: 2px 8px; padding: 1px 2px; width: 70%"
					>
				<a4j:support event="onchange"/>
			</h:inputText>


			<bre:taggedCommandButton id="searchBtn"
									 reRender="searchTree"
									 value="#{lblForm.search}" limitToList="true"
									 action="#{menu.search}"
									 oncomplete="colorIt('quickSearchForm','searchTree');" style="display: none;"
									 eventsQueue="queue"/>
			<a4j:commandLink value=""
							 id="searchLink"
							 action="#{menu.search}"
							 reRender="searchTree"
							 limitToList="true"
							 oncomplete="colorIt('quickSearchForm','searchTree');">
				<h:graphicImage url="/_img/icon_search.png"/>
			</a4j:commandLink>
		</h:panelGroup>
		<rich:tree id="searchTree" switchType="client" componentState="#{usession.userLogged ? menu.searchTreeState : null}"
				   value="#{group.branch}"
				   var="menuItem" focus=""
				   nodeFace="#{menuItem.type}"
				   adviseNodeOpened="#{menu.autoExpandSearch}"
				   immediate="true" nodeSelectListener="#{menu.processSelectionSearch}"
				   showConnectingLines="false" ajaxSingle="true" limitToList="true"
				   toggleOnClick="true"
				   icon="" rowKeyVar="#{menu.currentRowKeySearch}"
				   iconLeaf="" style="overflow-y:auto;width:100%;">

			<rich:treeNode selectedClass="selected_first" type="folder_i"
						   icon="#{facesContext.externalContext.requestContextPath}/#{menuItem.icon}">
				<h:outputText value="#{menuItem.name}"/>
			</rich:treeNode>

			<rich:treeNode selectedClass="selected_folder" type="folder" onclick="showHideBorder(this)" oncollapse=""
						   onexpand="">
				<h:panelGroup styleClass="treeFolderClass" rendered="#{!menuItem.last}">
					<h:outputText value="#{menuItem.name}"/>
				</h:panelGroup>
				<h:panelGroup styleClass="treeLastFolderClass" rendered="#{menuItem.last}">
					<h:outputText value="#{menuItem.name}"/>
				</h:panelGroup>
			</rich:treeNode>

			<rich:treeNode type="page_i" iconLeaf="#{facesContext.externalContext.requestContextPath}/#{menuItem.icon}">
				<h:commandLink value="#{menuItem.name}" action="#{menuItem.action}"> </h:commandLink>
			</rich:treeNode>

			<rich:treeNode type="page" id="menuItem" nodeClass="#{menuItem.selected ? 'selectedMenuItem' : ''}">
				<h:panelGroup styleClass="#{menuItem.last ? 'treeLastPageClass' : 'treePageClass'}"
							  style="#{menuItem.selected ? 'font-weight:bold' : ''};white-space:normal;display:block;padding-top:0;padding-bottom:0;">
					<h:commandLink value="#{menuItem.name}" action="#{menuItem.action}">
						<a4j:actionparam name="stateKeeper" value="#{menu.falseKeepState}"
										 assignTo="#{menu.keepState}"/>
						<a4j:actionparam name="stateKeeper1" value="#{null}" assignTo="#{menu.currentRoute}"/>
						<f:param name="sectionId" value="#{menuItem.id}"/>
						<a4j:actionparam name="appType"
						                 value="#{menuItem.id == 1023 ? 'acquiring' : (
										      menuItem.id == 1014 ? 'issuing' : (
										      menuItem.id == 2307 ? 'pmo' : (
										      menuItem.id == 2382 ? 'acm' : (
										      menuItem.id == 2427 ? 'institution' : (
										      menuItem.id == 2444 ? 'iss_product' : (
										      menuItem.id == 2446 ? 'acq_product' : (
										      menuItem.id == 2464 ? 'questionary' : (
										      menuItem.id == 2471 ? 'campaign' : '' ))))))))}"/>
						<a4j:actionparam name="productType"
										 value="#{menuItem.id == 1024 ? 'acquiring' : (
										          menuItem.id == 1016 ? 'issuing' : (
										          menuItem.id == 2263 ? 'institution' : ''))}"/>
						<a4j:actionparam name="module"
										 value="#{menuItem.id == 1022 ? 'ACQ' : (
										          menuItem.id == 1011 ? 'ISS' : (
										          menuItem.id == 2471 ? 'CPN' : '' ))}"/>
						<a4j:actionparam name="operType"
										 value="#{menuItem.id == 1018 ? 'ACQ' : (
										          menuItem.id == 1008 ? 'ISS' : (
									          	  menuItem.id == 2448 ? 'H2H' : '' ))}"/>
					</h:commandLink>
				</h:panelGroup>
			</rich:treeNode>

			<rich:treeNode>
				<h:outputText value="Unknown node type: #{menuItem.type}"/>
			</rich:treeNode>

		</rich:tree>
	</h:form>
	<!-- /rich:panelBarItem -->
</ui:composition>
</html>

