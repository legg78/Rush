<?xml version="1.0" encoding="UTF-8"?>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:bpct="http://www.bpc.ru/jsf/tiles"
      xmlns:bre="http://www.bpc.ru/jsf/richfaces-ext"
      xmlns:bm="http://www.bpc.ru/jsf/misc"
      xmlns:rich="http://richfaces.org/rich"
      xmlns:a4j="http://richfaces.org/a4j"
      xmlns:bpc="http://www.bpc.ru/jsf/misc">
    <ui:composition template="../accDetailsTemplate.jspx">
        <ui:define name="stepContent">
            <!--@elvariable id="stepBean" type="ru.bpc.sv2.ui.common.wizard.callcenter.account.MbBalanceTransferFromPrepaidCardDS"-->
            <f:loadBundle var="lblCommon" basename="ru.bpc.sv2.ui.bundles.Common" />
            <f:loadBundle var="lblAcc" basename="ru.bpc.sv2.ui.bundles.Acc" />
            <f:loadBundle var="lblOpr" basename="ru.bpc.sv2.ui.bundles.Opr" />

            <bpct:cardSearchModalPanels id="cardSearchPanels"/>

            <h:form id="balanceTransferFromPrepaidCardDSform" style="padding:10px;">
                <ui:include src="/pages/common/wizard/commonWizardActions.jspx">
                    <ui:param name="bean" value="#{bean}" />
                    <ui:param name="action" value="#{action}" />
                </ui:include>

                <h:panelGroup layout="block" styleClass="cardholderdata-wrapper">
                    <h:panelGroup styleClass="cardholderdata" style="width: 100%">
                        <h:outputLabel value="* #{lblOpr.source_card}:" title="#{lblOpr.source_card}"
                                       style="padding-bottom: 5px; text-align: left;"/>
                        <h:panelGrid id="card" cellpadding="0" cellspacing="0" columns="1" width="100%">
                            <bm:selectCard id="cardMask"
                                           valueCardMask="#{stepBean.sourceCard.mask}"
                                           valueCardId="#{stepBean.sourceCard.id}"
                                           valueCardNumber="#{stepBean.sourceCard.cardNumber}"
                                           valueExpirDate="#{stepBean.sourceCard.expDate}"
                                           disabled="false"
                                           readonly="false"
                                           beanName="stepBean"
                                           formName="balanceTransferFromPrepaidCardDSform"
                                           methodName="selectCard"
                                           rendered="true"
                                           viewIdColon="cardMaskVw"
                                           modalPanel="cardSearchModalPanel"
                                           renderList="balanceTransferFromPrepaidCardDSform:cardMaskVwcardMask,
                                                       balanceTransferFromPrepaidCardDSform:accounts,
                                                       balanceTransferFromPrepaidCardDSform:amount"
                                           style="max-width:100% !important; margin-left:0px;">
                                <a4j:support event="onchange" ajaxSingle="true" limitToList="true"
                                             reRender="balanceTransferFromPrepaidCardDSform:cardMask, cardMask
                                                       balanceTransferFromPrepaidCardDSform:cardMaskVwcardMask, cardMaskVwcardMask,
                                                       balanceTransferFromPrepaidCardDSform:accounts, accounts
                                                       balanceTransferFromPrepaidCardDSform:amount, amount"/>
                            </bm:selectCard>
                        </h:panelGrid>

                        <h:outputLabel value="* #{lblOpr.source_card_account}: " title="#{lblOpr.source_card_account}"
                                       style="padding-bottom: 5px; text-align: left;"/>
                        <h:panelGrid id="accountsGrid" cellpadding="0" cellspacing="0" columns="1" width="100%">
                            <rich:extendedDataTable id="accounts"
                                                    styleClass="res-table"
                                                    headerClass="res-table-header"
                                                    rowClasses=",odd"
                                                    selectedClass="res-table-selected"
                                                    var="item"
                                                    value="#{stepBean.accounts}"
                                                    selection="#{stepBean.itemSelection}"
                                                    rows="#{stepBean.rowsNum}"
                                                    selectionMode="single"
                                                    width="100%"
                                                    noDataLabel="#{lblCommon['no_records_found']}}"
                                                    height="180px">
                                <a4j:support event="onselectionchange" ajaxSingle="true" limitToList="true"
                                             reRender="balanceTransferFromPrepaidCardDSform:accounts,
                                                       balanceTransferFromPrepaidCardDSform:amountGrid,
                                                       balanceTransferFromPrepaidCardDSform:amount"/>

                                <rich:column id="account_number"
                                             label="#{lblAcc.account_number}" title="#{lblAcc.account_number}"
                                             width="65%">
                                    <f:facet name="header">
                                        <a4j:outputPanel layout="none">
                                            <h:outputText value="#{lblAcc.account_number}" title="#{lblAcc.account_number}" />
                                        </a4j:outputPanel>
                                    </f:facet>
                                    <h:outputText value="#{item.accountNumber}" title="#{item.accountNumber}" />
                                </rich:column>

                                <rich:column id="available_balance"
                                             label="#{lblAcc.available_balance}" title="#{lblAcc.available_balance}"
                                             style="text-align: right;" width="25%">
                                    <f:facet name="header">
                                        <h:outputText value="#{lblAcc.available_balance}" title="#{lblAcc.available_balance}" />
                                    </f:facet>
                                    <h:outputText value="#{fmt:formatMoney(item.balance, CurrencyUtils.currencyObjectsMap[item.currency].exponent)}"
                                                  title="#{fmt:formatMoney(item.balance, CurrencyUtils.currencyObjectsMap[item.currency].exponent)}" />
                                </rich:column>

                                <rich:column id="available_balance_currency"  style="text-align: right" width="5%">
                                    <f:facet name="header">
                                        <h:outputText value="" title="" />
                                    </f:facet>
                                    <div class="#{CurrencyUtils.flagMap[item.currency]}"/>
                                </rich:column>
                            </rich:extendedDataTable>
                        </h:panelGrid>

                        <h:outputLabel value="* #{lblAcc.transfer_amount}: " title="#{lblAcc.transfer_amount}"
                                       style="padding-bottom: 5px; text-align: left;"/>
                        <h:panelGrid id="amountGrid" cellpadding="0" cellspacing="0" columns="1" width="100%">
                            <h:inputText id="amount"
                                         value="#{stepBean.amount}"
                                         style="max-width: 99%"
                                         onblur="hideErrorField(this)"
                                         onkeypress="if (!numbersOnly(this, event, true)) return false;">
                                <bpc:numericMaskConverter numericType="double" />
                                <f:attribute name="decDigits"
                                             value="#{CurrencyUtils.currencyObjectsMap[stepBean.sourceAccount.currency].exponent}" />
                                <a4j:support event="onkeypress" ajaxSingle="true" limitToList="true"
                                             reRender="amount, balanceTransferFromPrepaidCardDSform:amount"/>
                            </h:inputText>
                            <bpc:jsMask for="amount"
                                        decDigits="#{CurrencyUtils.currencyObjectsMap[stepBean.sourceAccount.currency].exponent}" />
                        </h:panelGrid>

                        <h:outputLabel value="#{lblOpr.oper_reason}:" title="#{lblOpr.oper_reason}"
                                       style="padding-bottom: 5px; text-align: left;"/>
                        <h:panelGrid id="reasonGrid" cellpadding="0" cellspacing="0" columns="1" style="width: 100%">
                            <h:selectOneMenu id="reason" label="#{lblOpr.oper_reason}"
                                             value="#{stepBean.reason}"
                                             style="max-width: 100%">
                                <f:selectItem itemValue="%" itemLabel="% - #{lblCommon.any}" />
                                <f:selectItems value="#{stepBean.reasons}" />
                            </h:selectOneMenu>
                        </h:panelGrid>
                    </h:panelGroup>
                </h:panelGroup>
            </h:form>
        </ui:define>
    </ui:composition>
</html>
