<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap
        PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
        "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="vis">

    <!--
        Common sql configuration not included in SqlMapConfig
     -->
    <sql id="limitationOpen">
        SELECT *
        FROM (
    </sql>

    <sql id="limitationOpenCount">
        SELECT count(*)
        FROM (
    </sql>

    <sql id="limitationClose">
        ) q
        <isNotNull property="limitation" prepend=" WHERE ">$limitation$</isNotNull>
    </sql>

    <sql id="paginatedOpen">
        SELECT *
        FROM(
        SELECT a.*, rownum r
        FROM(
        <include refid="limitationOpen"/>
    </sql>

    <sql id="paginatedClose">
        <include refid="limitationClose"/>
        ) a
        WHERE rownum <![CDATA[<]]>= (#range.end# + 1)
        )
        WHERE r >= (#range.start# + 1)
    </sql>

    <resultMap  id="mapping-visa-fin-message"
            class="ru.bpc.sv2.ps.visa.VisaFinMessage"  >
            
        <result property="sessionId"    column="session_id" />
        <result property="sessionFileId"    column="session_file_id" />
        <result property="fileName"     column="file_name" />
        <result property="fileDate"     column="file_date" />
        
	    <result property="id" column="id" />
	    <result property="status" column="status" />
	    <result property="statusDesc" column="status_desc" />
	    <result property="fileId" column="file_id" />
	    <result property="batchId" column="batch_id" />
	    <result property="recordNumber" column="record_number" />
	    <result property="isReversal" column="is_reversal" />
	    <result property="isIncoming" column="is_incoming" />
	    <result property="isReturned" column="is_returned" />
	    <result property="isInvalid" column="is_invalid" />
	    <result property="disputeId" column="dispute_id" />
	    <result property="rrn" column="rrn" />
	    <result property="instId" column="inst_id" />
	    <result property="instName" column="inst_name" />
	    <result property="networkId" column="network_id" />
	    <result property="networkName" column="network_name" />
	    <result property="transCode" column="trans_code" />
	    <result property="transCodeQualifier" column="trans_code_qualifier" />
	    <result property="cardId" column="card_id" />
	    <result property="cardMask" column="card_mask" />
	    <result property="cardHash" column="card_hash" />
	    <result property="operAmount" column="oper_amount" />
	    <result property="operCurrency" column="oper_currency" />
	    <result property="operDate" column="oper_date" />
	    <result property="sttlAmount" column="sttl_amount" />
	    <result property="sttlCurrency" column="sttl_currency" />
	    <result property="networkAmount" column="network_amount" />
	    <result property="networkCurrency" column="network_currency" />
	    <result property="floorLimitInd" column="floor_limit_ind" />
	    <result property="exeptFileInd" column="exept_file_ind" />
	    <result property="pcasInd" column="pcas_ind" />
	    <result property="arn" column="arn" />
	    <result property="acquirerBin" column="acquirer_bin" />
	    <result property="acqBusinessId" column="acq_business_id" />
	    <result property="merchantName" column="merchant_name" />
	    <result property="merchantCity" column="merchant_city" />
	    <result property="merchantCountry" column="merchant_country" />
	    <result property="merchantPostalCode" column="merchant_postal_code" />
	    <result property="merchantRegion" column="merchant_region" />
	    <result property="merchantStreet" column="merchant_street" />
	    <result property="mcc" column="mcc" />
	    <result property="reqPayService" column="req_pay_service" />
	    <result property="usageCode" column="usage_code" />
	    <result property="reasonCode" column="reason_code" />
	    <result property="settlementFlag" column="settlement_flag" />
	    <result property="authCharInd" column="auth_char_ind" />
	    <result property="authCode" column="auth_code" />
	    <result property="posTerminalCap" column="pos_terminal_cap" />
	    <result property="interFeeInd" column="inter_fee_ind" />
	    <result property="crdhIdMethod" column="crdh_id_method" />
	    <result property="collectOnlyFlag" column="collect_only_flag" />
	    <result property="posEntryMode" column="pos_entry_mode" />
	    <result property="centralProcDate" column="central_proc_date" />
	    <result property="reimburstAttr" column="reimburst_attr" />
	    <result property="issWorkstBin" column="iss_workst_bin" />
	    <result property="acqWorkstBin" column="acq_workst_bin" />
	    <result property="chargebackRefNum" column="chargeback_ref_num" />
	    <result property="documInd" column="docum_ind" />
	    <result property="memberMsgText" column="member_msg_text" />
	    <result property="specCondInd" column="spec_cond_ind" />
	    <result property="feeProgramInd" column="fee_program_ind" />
	    <result property="issuerCharge" column="issuer_charge" />
	    <result property="merchantNumber" column="merchant_number" />
	    <result property="terminalNumber" column="terminal_number" />
	    <result property="nationalReimbFee" column="national_reimb_fee" />
	    <result property="electrCommInd" column="electr_comm_ind" />
	    <result property="specChargebackInd" column="spec_chargeback_ind" />
	    <result property="interfaceTraceNum" column="interface_trace_num" />
	    <result property="unattAcceptTermInd" column="unatt_accept_term_ind" />
	    <result property="prepaidCardInd" column="prepaid_card_ind" />
	    <result property="serviceDevelopment" column="service_development" />
	    <result property="avsRespCode" column="avs_resp_code" />
	    <result property="authSourceCode" column="auth_source_code" />
	    <result property="purchIdFormat" column="purch_id_format" />
	    <result property="accountSelection" column="account_selection" />
	    <result property="installmentPayCount" column="installment_pay_count" />
	    <result property="purchId" column="purch_id" />
	    <result property="cashback" column="cashback" />
	    <result property="chipCondCode" column="chip_cond_code" />
	    <result property="posEnvironment" column="pos_environment" />
	    <result property="transactionType" column="transaction_type" />
	    <result property="cardSeqNumber" column="card_seq_number" />
	    <result property="terminalProfile" column="terminal_profile" />
	    <result property="unpredictNumber" column="unpredict_number" />
	    <result property="applTransCounter" column="appl_trans_counter" />
	    <result property="applInterchProfile" column="appl_interch_profile" />
	    <result property="cryptogram" column="cryptogram" />
	    <result property="cardVerifResult" column="card_verif_result" />
	    <result property="issuerApplData" column="issuer_appl_data" />
	    <result property="issuerScriptResult" column="issuer_script_result" />
	    <result property="cardExpirDate" column="card_expir_date" />
	    <result property="cryptogramVersion" column="cryptogram_version" />
	    <result property="cvv2ResultCode" column="cvv2_result_code" />
	    <result property="authRespCode" column="auth_resp_code" />
	    <result property="cryptogramInfoData" column="cryptogram_info_data" />
	    <result property="transactionId" column="transaction_id" />
	    <result property="merchantVerifValue" column="merchant_verif_value" />
	    <result property="hostInstId" column="host_inst_id" />
	    <result property="procBin" column="proc_bin" />
	    <result property="chargebackReasonCode" column="chargeback_reason_code" />
	    <result property="destinationChannel" column="destination_channel" />
	    <result property="sourceChannel" column="source_channel" />
	    <result property="acqInstBin" column="acq_inst_bin" />
	    <result property="spendQualifiedInd" column="spend_qualified_ind" />
	    <result property="lang" column="lang" />
		<result property="recipientName" column="recipient_name" />
	</resultMap>
    
    <select id="get-visa-fin-messages"
			parameterClass="qparams" resultMap="mapping-visa-fin-message">
		<include refid="paginatedOpen" />
			SELECT
				fm.id
				,fm.status
				,fm.status_desc
				,fm.file_id
				,fm.batch_id
				,fm.record_number
				,fm.is_reversal
				,fm.is_incoming
				,fm.is_returned
				,fm.is_invalid
				,fm.dispute_id
				,fm.rrn
				,fm.inst_id
				,fm.inst_name
				,fm.network_id
				,fm.network_name
				,fm.trans_code
				,fm.trans_code_qualifier
				,fm.card_id
				,fm.card_mask
				,fm.card_hash
				,fm.oper_amount
				,fm.oper_currency
				,fm.oper_date
				,fm.sttl_amount
				,fm.sttl_currency
				,fm.network_amount
				,fm.network_currency
				,fm.floor_limit_ind
				,fm.exept_file_ind
				,fm.pcas_ind
				,fm.arn
				,fm.acquirer_bin
				,fm.acq_business_id
				,fm.merchant_name
				,fm.merchant_city
				,fm.merchant_country
				,fm.merchant_postal_code
				,fm.merchant_region
				,fm.merchant_street
				,fm.mcc
				,fm.req_pay_service
				,fm.usage_code
				,fm.reason_code
				,fm.settlement_flag
				,fm.auth_char_ind
				,fm.auth_code
				,fm.pos_terminal_cap
				,fm.inter_fee_ind
				,fm.crdh_id_method
				,fm.collect_only_flag
				,fm.pos_entry_mode
				,fm.central_proc_date
				,fm.reimburst_attr
				,fm.iss_workst_bin
				,fm.acq_workst_bin
				,fm.chargeback_ref_num
				,fm.docum_ind
				,fm.member_msg_text
				,fm.spec_cond_ind
				,fm.fee_program_ind
				,fm.issuer_charge
				,fm.merchant_number
				,fm.terminal_number
				,fm.national_reimb_fee
				,fm.electr_comm_ind
				,fm.spec_chargeback_ind
				,fm.interface_trace_num
				,fm.unatt_accept_term_ind
				,fm.prepaid_card_ind
				,fm.service_development
				,fm.avs_resp_code
				,fm.auth_source_code
				,fm.purch_id_format
				,fm.account_selection
				,fm.installment_pay_count
				,fm.purch_id
				,fm.cashback
				,fm.chip_cond_code
				,fm.pos_environment
				,fm.transaction_type
				,fm.card_seq_number
				,fm.terminal_profile
				,fm.unpredict_number
				,fm.appl_trans_counter
				,fm.appl_interch_profile
				,fm.cryptogram
				,fm.card_verif_result
				,fm.issuer_appl_data
				,fm.issuer_script_result
				,fm.card_expir_date
				,fm.cryptogram_version
				,fm.cvv2_result_code
				,fm.auth_resp_code
				,fm.cryptogram_info_data
				,fm.transaction_id
				,fm.merchant_verif_value
				,fm.host_inst_id
				,fm.proc_bin
				,fm.chargeback_reason_code
				,fm.destination_channel
				,fm.source_channel
				,fm.acq_inst_bin
				,fm.spend_qualified_ind
				,fm.lang
				,fm.recipient_name
				, sf.session_id
				, sf.id session_file_id
		        , sf.file_name
		        , sf.file_date
			FROM
				vis_ui_fin_vw fm, prc_ui_session_file_vw sf, (select id, session_file_id from vis_file union all select id, session_file_id from way_file) f, vis_card c
	        WHERE
	          	fm.file_id = f.id(+)
	        	and f.session_file_id = sf.id(+)
	        	and fm.id = c.id(+)
        <iterate prepend="AND" conjunction="AND" property="filters">
            <isEqual property="filters[].element" compareValue="lang">fm.lang = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="sessionId">sf.session_id = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="fileName">upper(sf.file_name) like upper(#filters[].value#)</isEqual>
            <isEqual property="filters[].element" compareValue="dateFrom">sf.file_date >= trunc(#filters[].value#)</isEqual>
            <isEqual property="filters[].element" compareValue="dateTo">sf.file_date <![CDATA[<=]]> trunc(#filters[].value#)</isEqual>
			<isEqual property="filters[].element" compareValue="operDateFrom">fm.oper_date >= trunc(#filters[].value#)</isEqual>
            <isEqual property="filters[].element" compareValue="operDateTo">fm.oper_date <![CDATA[<=]]> trunc(#filters[].value#)</isEqual>
			<isEqual property="filters[].element" compareValue="cardNumber">reverse(c.card_number) like reverse(#filters[].value#)</isEqual>
			
			<isEqual property="filters[].element" compareValue="id">fm.id = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="status">fm.status = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="statusDesc">fm.status_desc = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="fileId">fm.file_id = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="batchId">fm.batch_id = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="recordNumber">fm.record_number = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="isReversal">fm.is_reversal = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="isIncoming">fm.is_incoming = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="isReturned">fm.is_returned = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="isInvalid">fm.is_invalid = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="disputeId">fm.dispute_id = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="rrn">fm.rrn = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="instId">fm.inst_id = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="instName">fm.inst_name = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="networkId">fm.network_id = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="networkName">fm.network_name = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="transCode">fm.trans_code = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="transCodeQualifier">fm.trans_code_qualifier = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="cardId">fm.card_id = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="cardMask">reverse(fm.card_mask) like reverse(#filters[].value#)</isEqual>
			<isEqual property="filters[].element" compareValue="cardHash">fm.card_hash = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="operAmount">fm.oper_amount = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="operCurrency">fm.oper_currency = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="operDate">fm.oper_date = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="sttlAmount">fm.sttl_amount = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="sttlCurrency">fm.sttl_currency = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="networkAmount">fm.network_amount = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="networkCurrency">fm.network_currency = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="floorLimitInd">fm.floor_limit_ind = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="exeptFileInd">fm.exept_file_ind = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="pcasInd">fm.pcas_ind = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="arn">fm.arn = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="acquirerBin">fm.acquirer_bin = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="acqBusinessId">fm.acq_business_id = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="merchantName">fm.merchant_name = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="merchantCity">fm.merchant_city = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="merchantCountry">fm.merchant_country = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="merchantPostalCode">fm.merchant_postal_code = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="merchantRegion">fm.merchant_region = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="merchantStreet">fm.merchant_street = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="mcc">fm.mcc = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="reqPayService">fm.req_pay_service = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="usageCode">fm.usage_code = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="reasonCode">fm.reason_code = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="settlementFlag">fm.settlement_flag = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="authCharInd">fm.auth_char_ind = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="authCode">fm.auth_code = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="posTerminalCap">fm.pos_terminal_cap = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="interFeeInd">fm.inter_fee_ind = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="crdhIdMethod">fm.crdh_id_method = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="collectOnlyFlag">fm.collect_only_flag = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="posEntryMode">fm.pos_entry_mode = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="centralProcDate">fm.central_proc_date = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="reimburstAttr">fm.reimburst_attr = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="issWorkstBin">fm.iss_workst_bin = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="acqWorkstBin">fm.acq_workst_bin = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="chargebackRefNum">fm.chargeback_ref_num = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="documInd">fm.docum_ind = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="memberMsgText">fm.member_msg_text = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="specCondInd">fm.spec_cond_ind = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="feeProgramInd">fm.fee_program_ind = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="issuerCharge">fm.issuer_charge = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="merchantNumber">fm.merchant_number = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="terminalNumber">upper(fm.terminal_number) = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="nationalReimbFee">fm.national_reimb_fee = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="electrCommInd">fm.electr_comm_ind = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="specChargebackInd">fm.spec_chargeback_ind = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="interfaceTraceNum">fm.interface_trace_num = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="unattAcceptTermInd">fm.unatt_accept_term_ind = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="prepaidCardInd">fm.prepaid_card_ind = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="serviceDevelopment">fm.service_development = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="avsRespCode">fm.avs_resp_code = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="authSourceCode">fm.auth_source_code = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="purchIdFormat">fm.purch_id_format = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="accountSelection">fm.account_selection = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="installmentPayCount">fm.installment_pay_count = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="purchId">fm.purch_id = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="cashback">fm.cashback = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="chipCondCode">fm.chip_cond_code = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="posEnvironment">fm.pos_environment = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="transactionType">fm.transaction_type = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="cardSeqNumber">fm.card_seq_number = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="terminalProfile">fm.terminal_profile = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="unpredictNumber">fm.unpredict_number = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="applTransCounter">fm.appl_trans_counter = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="applInterchProfile">fm.appl_interch_profile = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="cryptogram">fm.cryptogram = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="cardVerifResult">fm.card_verif_result = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="issuerApplData">fm.issuer_appl_data = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="issuerScriptResult">fm.issuer_script_result = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="cardExpirDate">fm.card_expir_date = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="cryptogramVersion">fm.cryptogram_version = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="cvv2ResultCode">fm.cvv2_result_code = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="authRespCode">fm.auth_resp_code = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="cryptogramInfoData">fm.cryptogram_info_data = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="transactionId">fm.transaction_id = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="merchantVerifValue">fm.merchant_verif_value = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="hostInstId">fm.host_inst_id = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="procBin">fm.proc_bin = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="chargebackReasonCode">fm.chargeback_reason_code = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="destinationChannel">fm.destination_channel = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="sourceChannel">fm.source_channel = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="acqInstBin">fm.acq_inst_bin = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="spendQualifiedInd">fm.spend_qualified_ind = #filters[].value#</isEqual>			
		</iterate>
		<iterate prepend="ORDER BY" conjunction=", " property="sorting">
			<isNotEqual property="sorting[].direction" compareValue="AUTO">
				<isEqual property="sorting[].property" compareValue="id">fm.id $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="status">fm.status $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="statusDesc">fm.status_desc $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="fileId">fm.file_id $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="batchId">fm.batch_id $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="recordNumber">fm.record_number $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="isReversal">fm.is_reversal $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="isIncoming">fm.is_incoming $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="isReturned">fm.is_returned $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="isInvalid">fm.is_invalid $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="disputeId">fm.dispute_id $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="rrn">fm.rrn $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="instId">fm.inst_id $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="instName">fm.inst_name $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="networkId">fm.network_id $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="networkName">fm.network_name $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="transCode">fm.trans_code $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="transCodeQualifier">fm.trans_code_qualifier $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="cardId">fm.card_id $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="cardMask">fm.card_mask $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="cardHash">fm.card_hash $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="operAmount">fm.oper_amount $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="operCurrency">fm.oper_currency $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="operDate">fm.oper_date $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="sttlAmount">fm.sttl_amount $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="sttlCurrency">fm.sttl_currency $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="networkAmount">fm.network_amount $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="networkCurrency">fm.network_currency $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="floorLimitInd">fm.floor_limit_ind $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="exeptFileInd">fm.exept_file_ind $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="pcasInd">fm.pcas_ind $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="arn">fm.arn $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="acquirerBin">fm.acquirer_bin $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="acqBusinessId">fm.acq_business_id $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="merchantName">fm.merchant_name $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="merchantCity">fm.merchant_city $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="merchantCountry">fm.merchant_country $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="merchantPostalCode">fm.merchant_postal_code $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="merchantRegion">fm.merchant_region $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="merchantStreet">fm.merchant_street $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="mcc">fm.mcc $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="reqPayService">fm.req_pay_service $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="usageCode">fm.usage_code $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="reasonCode">fm.reason_code $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="settlementFlag">fm.settlement_flag $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="authCharInd">fm.auth_char_ind $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="authCode">fm.auth_code $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="posTerminalCap">fm.pos_terminal_cap $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="interFeeInd">fm.inter_fee_ind $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="crdhIdMethod">fm.crdh_id_method $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="collectOnlyFlag">fm.collect_only_flag $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="posEntryMode">fm.pos_entry_mode $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="centralProcDate">fm.central_proc_date $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="reimburstAttr">fm.reimburst_attr $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="issWorkstBin">fm.iss_workst_bin $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="acqWorkstBin">fm.acq_workst_bin $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="chargebackRefNum">fm.chargeback_ref_num $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="documInd">fm.docum_ind $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="memberMsgText">fm.member_msg_text $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="specCondInd">fm.spec_cond_ind $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="feeProgramInd">fm.fee_program_ind $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="issuerCharge">fm.issuer_charge $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="merchantNumber">fm.merchant_number $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="terminalNumber">fm.terminal_number $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="nationalReimbFee">fm.national_reimb_fee $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="electrCommInd">fm.electr_comm_ind $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="specChargebackInd">fm.spec_chargeback_ind $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="interfaceTraceNum">fm.interface_trace_num $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="unattAcceptTermInd">fm.unatt_accept_term_ind $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="prepaidCardInd">fm.prepaid_card_ind $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="serviceDevelopment">fm.service_development $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="avsRespCode">fm.avs_resp_code $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="authSourceCode">fm.auth_source_code $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="purchIdFormat">fm.purch_id_format $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="accountSelection">fm.account_selection $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="installmentPayCount">fm.installment_pay_count $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="purchId">fm.purch_id $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="cashback">fm.cashback $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="chipCondCode">fm.chip_cond_code $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="posEnvironment">fm.pos_environment $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="transactionType">fm.transaction_type $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="cardSeqNumber">fm.card_seq_number $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="terminalProfile">fm.terminal_profile $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="unpredictNumber">fm.unpredict_number $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="applTransCounter">fm.appl_trans_counter $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="applInterchProfile">fm.appl_interch_profile $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="cryptogram">fm.cryptogram $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="cardVerifResult">fm.card_verif_result $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="issuerApplData">fm.issuer_appl_data $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="issuerScriptResult">fm.issuer_script_result $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="cardExpirDate">fm.card_expir_date $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="cryptogramVersion">fm.cryptogram_version $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="cvv2ResultCode">fm.cvv2_result_code $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="authRespCode">fm.auth_resp_code $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="cryptogramInfoData">fm.cryptogram_info_data $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="transactionId">fm.transaction_id $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="merchantVerifValue">fm.merchant_verif_value $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="hostInstId">fm.host_inst_id $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="procBin">fm.proc_bin $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="chargebackReasonCode">fm.chargeback_reason_code $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="destinationChannel">fm.destination_channel $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="sourceChannel">fm.source_channel $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="acqInstBin">fm.acq_inst_bin $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="spendQualifiedInd">fm.spend_qualified_ind $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="lang">fm.lang $sorting[].direction$</isEqual>		
			</isNotEqual>
		</iterate>
		<include refid="paginatedClose" />
	</select>
	
	<select id="get-visa-fin-messages-count"
			parameterClass="qparams"
			resultClass="int">
		SELECT
			count(fm.id)
		FROM
			vis_ui_fin_vw fm, prc_ui_session_file_vw sf, (select id, session_file_id from vis_file union all select id, session_file_id from way_file) f, vis_card c
        WHERE
          	fm.file_id = f.id(+)
        	and f.session_file_id = sf.id(+)
        	and fm.id = c.id(+)
        <iterate prepend="AND" conjunction="AND" property="filters">
            <isEqual property="filters[].element" compareValue="lang">fm.lang = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="sessionId">sf.session_id = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="fileName">upper(sf.file_name) like upper(#filters[].value#)</isEqual>
            <isEqual property="filters[].element" compareValue="dateFrom">sf.file_date >= trunc(#filters[].value#)</isEqual>
            <isEqual property="filters[].element" compareValue="dateTo">sf.file_date <![CDATA[<=]]> trunc(#filters[].value#)</isEqual>
			<isEqual property="filters[].element" compareValue="operDateFrom">fm.oper_date >= trunc(#filters[].value#)</isEqual>
            <isEqual property="filters[].element" compareValue="operDateTo">fm.oper_date <![CDATA[<=]]> trunc(#filters[].value#)</isEqual>
            <isEqual property="filters[].element" compareValue="cardNumber">reverse(c.card_number) like reverse(#filters[].value#)</isEqual>
            
			<isEqual property="filters[].element" compareValue="id">fm.id = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="status">fm.status = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="statusDesc">fm.status_desc = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="fileId">fm.file_id = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="batchId">fm.batch_id = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="recordNumber">fm.record_number = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="isReversal">fm.is_reversal = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="isIncoming">fm.is_incoming = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="isReturned">fm.is_returned = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="isInvalid">fm.is_invalid = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="disputeId">fm.dispute_id = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="rrn">fm.rrn = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="instId">fm.inst_id = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="instName">fm.inst_name = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="networkId">fm.network_id = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="networkName">fm.network_name = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="transCode">fm.trans_code = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="transCodeQualifier">fm.trans_code_qualifier = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="cardId">fm.card_id = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="cardMask">reverse(fm.card_mask) like reverse(#filters[].value#)</isEqual>
			<isEqual property="filters[].element" compareValue="cardHash">fm.card_hash = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="operAmount">fm.oper_amount = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="operCurrency">fm.oper_currency = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="operDate">fm.oper_date = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="sttlAmount">fm.sttl_amount = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="sttlCurrency">fm.sttl_currency = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="networkAmount">fm.network_amount = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="networkCurrency">fm.network_currency = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="floorLimitInd">fm.floor_limit_ind = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="exeptFileInd">fm.exept_file_ind = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="pcasInd">fm.pcas_ind = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="arn">fm.arn = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="acquirerBin">fm.acquirer_bin = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="acqBusinessId">fm.acq_business_id = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="merchantName">fm.merchant_name = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="merchantCity">fm.merchant_city = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="merchantCountry">fm.merchant_country = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="merchantPostalCode">fm.merchant_postal_code = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="merchantRegion">fm.merchant_region = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="merchantStreet">fm.merchant_street = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="mcc">fm.mcc = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="reqPayService">fm.req_pay_service = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="usageCode">fm.usage_code = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="reasonCode">fm.reason_code = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="settlementFlag">fm.settlement_flag = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="authCharInd">fm.auth_char_ind = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="authCode">fm.auth_code = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="posTerminalCap">fm.pos_terminal_cap = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="interFeeInd">fm.inter_fee_ind = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="crdhIdMethod">fm.crdh_id_method = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="collectOnlyFlag">fm.collect_only_flag = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="posEntryMode">fm.pos_entry_mode = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="centralProcDate">fm.central_proc_date = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="reimburstAttr">fm.reimburst_attr = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="issWorkstBin">fm.iss_workst_bin = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="acqWorkstBin">fm.acq_workst_bin = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="chargebackRefNum">fm.chargeback_ref_num = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="documInd">fm.docum_ind = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="memberMsgText">fm.member_msg_text = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="specCondInd">fm.spec_cond_ind = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="feeProgramInd">fm.fee_program_ind = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="issuerCharge">fm.issuer_charge = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="merchantNumber">fm.merchant_number = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="terminalNumber">upper(fm.terminal_number) = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="nationalReimbFee">fm.national_reimb_fee = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="electrCommInd">fm.electr_comm_ind = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="specChargebackInd">fm.spec_chargeback_ind = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="interfaceTraceNum">fm.interface_trace_num = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="unattAcceptTermInd">fm.unatt_accept_term_ind = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="prepaidCardInd">fm.prepaid_card_ind = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="serviceDevelopment">fm.service_development = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="avsRespCode">fm.avs_resp_code = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="authSourceCode">fm.auth_source_code = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="purchIdFormat">fm.purch_id_format = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="accountSelection">fm.account_selection = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="installmentPayCount">fm.installment_pay_count = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="purchId">fm.purch_id = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="cashback">fm.cashback = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="chipCondCode">fm.chip_cond_code = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="posEnvironment">fm.pos_environment = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="transactionType">fm.transaction_type = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="cardSeqNumber">fm.card_seq_number = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="terminalProfile">fm.terminal_profile = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="unpredictNumber">fm.unpredict_number = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="applTransCounter">fm.appl_trans_counter = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="applInterchProfile">fm.appl_interch_profile = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="cryptogram">fm.cryptogram = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="cardVerifResult">fm.card_verif_result = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="issuerApplData">fm.issuer_appl_data = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="issuerScriptResult">fm.issuer_script_result = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="cardExpirDate">fm.card_expir_date = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="cryptogramVersion">fm.cryptogram_version = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="cvv2ResultCode">fm.cvv2_result_code = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="authRespCode">fm.auth_resp_code = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="cryptogramInfoData">fm.cryptogram_info_data = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="transactionId">fm.transaction_id = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="merchantVerifValue">fm.merchant_verif_value = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="hostInstId">fm.host_inst_id = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="procBin">fm.proc_bin = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="chargebackReasonCode">fm.chargeback_reason_code = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="destinationChannel">fm.destination_channel = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="sourceChannel">fm.source_channel = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="acqInstBin">fm.acq_inst_bin = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="spendQualifiedInd">fm.spend_qualified_ind = #filters[].value#</isEqual>
		</iterate>
	</select>
	
	<resultMap  id="mapping-visa-fee"
            class="ru.bpc.sv2.ps.visa.VisaFee"  >
	    <result property="id" column="id" />
	    <result property="fileId" column="file_id" />
	    <result property="payFee" column="pay_fee" />
	    <result property="dstBin" column="dst_bin" />
	    <result property="srcBin" column="src_bin" />
	    <result property="reasonCode" column="reason_code" />
	    <result property="countryCode" column="country_code" />
	    <result property="eventDate" column="event_date" />
	    <result property="payAmount" column="pay_amount" />
	    <result property="payCurrency" column="pay_currency" />
	    <result property="srcAmount" column="src_amount" />
	    <result property="srcCurrency" column="src_currency" />
	    <result property="messageText" column="message_text" />
	    <result property="transId" column="trans_id" />
	    <result property="reimbAttr" column="reimb_attr" />
	    <result property="dstInstId" column="dst_inst_id" />
	    <result property="srcInstId" column="src_inst_id" />
	    <result property="fundingSource" column="funding_source" />
	</resultMap>
	
	<select id="get-visa-fees"
			parameterClass="qparams" resultMap="mapping-visa-fee">
		<include refid="paginatedOpen" />
			SELECT
				vf.id
				,vf.file_id
				,vf.pay_fee
				,vf.dst_bin
				,vf.src_bin
				,vf.reason_code
				,vf.country_code
				,vf.event_date
				,vf.pay_amount
				,vf.pay_currency
				,vf.src_amount
				,vf.src_currency
				,vf.message_text
				,vf.trans_id
				,vf.reimb_attr
				,vf.dst_inst_id
				,vf.src_inst_id
				,vf.funding_source
			FROM
				vis_fee vf
		<iterate prepend="WHERE" conjunction="AND" property="filters">
			<isEqual property="filters[].element" compareValue="id">vf.id = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="fileId">vf.file_id = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="payFee">vf.pay_fee = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="dstBin">vf.dst_bin = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="srcBin">vf.src_bin = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="reasonCode">vf.reason_code = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="countryCode">vf.country_code = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="eventDate">vf.event_date = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="payAmount">vf.pay_amount = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="payCurrency">vf.pay_currency = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="srcAmount">vf.src_amount = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="srcCurrency">vf.src_currency = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="messageText">vf.message_text = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="transId">vf.trans_id = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="reimbAttr">vf.reimb_attr = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="dstInstId">vf.dst_inst_id = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="srcInstId">vf.src_inst_id = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="fundingSource">vf.funding_source = #filters[].value#</isEqual>
		</iterate>
		<iterate prepend="ORDER BY" conjunction=", " property="sorting">
			<isNotEqual property="sorting[].direction" compareValue="AUTO">
				<isEqual property="sorting[].property" compareValue="id">vf.id $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="fileId">vf.file_id $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="payFee">vf.pay_fee $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="dstBin">vf.dst_bin $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="srcBin">vf.src_bin $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="reasonCode">vf.reason_code $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="countryCode">vf.country_code $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="eventDate">vf.event_date $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="payAmount">vf.pay_amount $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="payCurrency">vf.pay_currency $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="srcAmount">vf.src_amount $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="srcCurrency">vf.src_currency $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="messageText">vf.message_text $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="transId">vf.trans_id $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="reimbAttr">vf.reimb_attr $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="dstInstId">vf.dst_inst_id $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="srcInstId">vf.src_inst_id $sorting[].direction$</isEqual>		
				<isEqual property="sorting[].property" compareValue="fundingSource">vf.funding_source $sorting[].direction$</isEqual>		
			</isNotEqual>
		</iterate>
		<include refid="paginatedClose" />
	</select>
	
	<select id="get-visa-fees-count"
			parameterClass="qparams"
			resultClass="int">
		SELECT
			count(vf.id)
		FROM
			vis_fee vf
		<iterate prepend="WHERE" conjunction="AND" property="filters">
			<isEqual property="filters[].element" compareValue="id">vf.id = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="fileId">vf.file_id = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="payFee">vf.pay_fee = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="dstBin">vf.dst_bin = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="srcBin">vf.src_bin = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="reasonCode">vf.reason_code = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="countryCode">vf.country_code = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="eventDate">vf.event_date = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="payAmount">vf.pay_amount = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="payCurrency">vf.pay_currency = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="srcAmount">vf.src_amount = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="srcCurrency">vf.src_currency = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="messageText">vf.message_text = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="transId">vf.trans_id = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="reimbAttr">vf.reimb_attr = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="dstInstId">vf.dst_inst_id = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="srcInstId">vf.src_inst_id = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="fundingSource">vf.funding_source = #filters[].value#</isEqual>
		</iterate>
	</select>
	

	<resultMap  id="mapping-visa-addendum"
            class="ru.bpc.sv2.ps.visa.VisaAddendum"  >
	    <result property="id" column="id" />
	    <result property="finMessageId" column="fin_msg_id" />
	    <result property="tcr" column="tcr" />
	    <result property="rawData" column="raw_data" />
	</resultMap>
	
	<select id="get-visa-addendums"
			parameterClass="qparams" resultMap="mapping-visa-addendum">
		<include refid="paginatedOpen" />
			SELECT
				va.id
				,va.fin_msg_id
				,va.tcr
				,va.raw_data
			FROM
				vis_fin_addendum va
		<iterate prepend="WHERE" conjunction="AND" property="filters">
			<isEqual property="filters[].element" compareValue="id">va.id = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="tcr">va.tcr = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="finMessageId">va.fin_msg_id = #filters[].value#</isEqual>
		</iterate >
			    
		<iterate prepend="ORDER BY" conjunction=", "  property="sorting">
			<isNotEqual property="sorting[].direction" compareValue="AUTO">
                <isEqual property="sorting[].property" compareValue="id">va.id $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="tcr">va.tcr $sorting[].direction$</isEqual>
            </isNotEqual>    
		</iterate>
		
		<include refid="paginatedClose" />
	</select>
	
	<select id="get-visa-addendums-count"
			parameterClass="qparams"
			resultClass="int">
		SELECT
			count(va.id)
		FROM
			vis_fin_addendum va
		<iterate prepend="WHERE" conjunction="AND" property="filters">
			<isEqual property="filters[].element" compareValue="id">va.id = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="tcr">va.tcr = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="finMessageId">va.fin_msg_id = #filters[].value#</isEqual>
		</iterate>
	</select>


    <resultMap  id="mapping-visa-file" class="ru.bpc.sv2.ps.visa.VisaFile">
        <result property="sessionId"        column="SESSION_ID" />
        <result property="fileName"         column="FILE_NAME" />
        <result property="fileDate"         column="FILE_DATE" />

        <result property="returned"         column="IS_RETURNED" />
        <result property="networkId"        column="NETWORK_ID" />
        <result property="procBin"          column="PROC_BIN" />
        <result property="procDate"         column="PROC_DATE" />
        <result property="sttlDate"         column="STTL_DATE" />
        <result property="releaseNumber"    column="RELEASE_NUMBER" />
        <result property="testOption"       column="TEST_OPTION" />
        <result property="securityCode"     column="SECURITY_CODE" />
        <result property="visaFileId"       column="VISA_FILE_ID" />
        <result property="batchTotal"       column="BATCH_TOTAL" />
        <result property="monetaryTotal"    column="MONETARY_TOTAL" />
        <result property="tcrTotal"         column="TCR_TOTAL" />
        <result property="transTotal"       column="TRANS_TOTAL" />
        <result property="srcAmount"        column="SRC_AMOUNT" />
        <result property="dstAmount"        column="DST_AMOUNT" />
        <result property="instId"           column="INST_ID" />
        <result property="sessionFileId"    column="SESSION_FILE_ID" />


        <result property="id"         column="ID" />
        <result property="incoming"   column="IS_INCOMING" />


        <result property="instName"         column="INST_NAME" />
    </resultMap>



    <select id="get-visa-files"
            parameterClass="qparams"
            resultMap="mapping-visa-file">
        <include refid="paginatedOpen"/>

        SELECT
        sf.SESSION_ID
        ,sf.FILE_NAME
        ,sf.FILE_DATE

        ,f.ID
        ,f.IS_INCOMING
        ,f.IS_RETURNED
        ,f.NETWORK_ID
        ,f.PROC_BIN
        ,f.PROC_DATE
        ,f.STTL_DATE
        ,f.RELEASE_NUMBER
        ,f.TEST_OPTION
        ,f.SECURITY_CODE
        ,f.VISA_FILE_ID
        ,f.BATCH_TOTAL
        ,f.MONETARY_TOTAL
        ,f.TCR_TOTAL
        ,f.TRANS_TOTAL
        ,f.SRC_AMOUNT
        ,f.DST_AMOUNT
        ,f.INST_ID
        ,f.SESSION_FILE_ID

        ,i.NAME INST_NAME
        FROM VIS_FILE f, PRC_SESSION_FILE sf , OST_UI_INSTITUTION_SYS_VW i
        WHERE f.SESSION_FILE_ID = sf.ID(+)
        AND f.INST_ID = i.ID(+)
        <iterate prepend="AND" conjunction="AND" property="filters">
            <isEqual property="filters[].element" compareValue="lang">
                i.lang(+) = #filters[].value#
            </isEqual>
            <isEqual property="filters[].element" compareValue="sessionId">sf.session_id = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="fileName">sf.file_name like #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="dateFrom">sf.file_date >= TO_DATE(#filters[].value#, 'DD.MM.YYYY')</isEqual>
            <isEqual property="filters[].element" compareValue="dateTo">sf.file_date <![CDATA[<=]]> TO_DATE(#filters[].value#, 'DD.MM.YYYY')</isEqual>
        </iterate>
        <iterate prepend="ORDER BY" conjunction=", " property="sorting">
            <isNotEqual property="sorting[].direction" compareValue="AUTO">
                <isEqual property="sorting[].property" compareValue="sessionId">sf.session_id $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="fileName">sf.file_name $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="fileDate">sf.file_date $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="id">f.id $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="incoming">f.is_incoming $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="returned">f.is_returned $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="networkId">f.network_id $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="procBin">f.proc_bin $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="procDate">f.proc_date $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="sttlDate">f.sttl_date $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="releaseNumber">f.release_number $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="testOption">f.test_option $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="securityCode">f.security_code $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="visaFileId">f.visa_file_id $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="batchTotal">f.batch_total $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="monetaryTotal">f.monetary_total $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="tcrTotal">f.tcr_total $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="transTotal">f.trans_total $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="srcAmount">f.src_amount $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="dstAmount">f.dst_amount $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="instId">f.inst_id $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="sessionFileId">f.session_file_id $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="instName">inst_name $sorting[].direction$</isEqual>

            </isNotEqual>
        </iterate>


        <include refid="paginatedClose"/>
    </select>

    <select id="get-visa-files-count"
            parameterClass="qparams"
            resultClass="int">
        <include refid="limitationOpenCount"/>
        SELECT f.ID
        FROM VIS_FILE f, PRC_SESSION_FILE sf , OST_UI_INSTITUTION_SYS_VW i
        WHERE f.SESSION_FILE_ID = sf.ID(+)
        AND f.INST_ID = i.ID(+)
        <iterate prepend="AND" conjunction="AND" property="filters">
            <isEqual property="filters[].element" compareValue="lang">
                i.lang(+) = #filters[].value#
            </isEqual>
            <isEqual property="filters[].element" compareValue="sessionId">sf.session_id = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="fileName">sf.file_name like #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="dateFrom">sf.file_date >= TO_DATE(#filters[].value#, 'DD.MM.YYYY')</isEqual>
            <isEqual property="filters[].element" compareValue="dateTo">sf.file_date <![CDATA[<=]]> TO_DATE(#filters[].value#, 'DD.MM.YYYY')</isEqual>
        </iterate>
        <include refid="limitationClose"/>
    </select>

    <resultMap  id="mapping-visa-return"
                class="ru.bpc.sv2.ps.visa.VisaReturn"  >
        <result property="id" column="ID" />
        <result property="dstBin" column="DST_BIN" />
        <result property="srcBin" column="SRC_BIN" />
        <result property="originalTc" column="ORIGINAL_TC" />
        <result property="originalTcq" column="ORIGINAL_TCQ" />
        <result property="originalTcr" column="ORIGINAL_TCR" />
        <result property="srcBatchDate" column="SRC_BATCH_DATE" />
        <result property="srcBatchNumber" column="SRC_BATCH_NUMBER" />
        <result property="itemSeqNumber" column="ITEM_SEQ_NUMBER" />
        <result property="originalAmount" column="ORIGINAL_AMOUNT" />
        <result property="originalCurrency" column="ORIGINAL_CURRENCY" />
        <result property="originalSttlFlag" column="ORIGINAL_STTL_FLAG" />
        <result property="crsReturnFlag" column="CRS_RETURN_FLAG" />
        <result property="reasonCode1" column="REASON_CODE1" />
        <result property="reasonCode2" column="REASON_CODE2" />
        <result property="reasonCode3" column="REASON_CODE3" />
        <result property="reasonCode4" column="REASON_CODE4" />
        <result property="reasonCode5" column="REASON_CODE5" />
        <result property="originalId" column="ORIGINAL_ID" />
        <result property="fileId" column="FILE_ID" />
        <result property="batchId" column="BATCH_ID" />
        <result property="recordNumber" column="RECORD_NUMBER" />
        <result property="fileName" column="FILE_NAME" />
    </resultMap>

    <select id="get-visa-returns"
            parameterClass="qparams" resultMap="mapping-visa-return">
        <include refid="paginatedOpen" />
        SELECT
        r.ID
        ,r.DST_BIN
        ,r.SRC_BIN
        ,r.ORIGINAL_TC
        ,r.ORIGINAL_TCQ
        ,r.ORIGINAL_TCR
        ,r.SRC_BATCH_DATE
        ,r.SRC_BATCH_NUMBER
        ,r.ITEM_SEQ_NUMBER
        ,r.ORIGINAL_AMOUNT
        ,r.ORIGINAL_CURRENCY
        ,r.ORIGINAL_STTL_FLAG
        ,r.CRS_RETURN_FLAG
        ,r.REASON_CODE1
        ,r.REASON_CODE2
        ,r.REASON_CODE3
        ,r.REASON_CODE4
        ,r.REASON_CODE5
        ,r.ORIGINAL_ID
        ,r.FILE_ID
        ,r.BATCH_ID
        ,r.RECORD_NUMBER
        ,sf.file_name
        FROM
        vis_returned r
        , prc_session_file sf
        , vis_file f
        WHERE
        r.file_id = f.id
        and f.session_file_id = sf.id(+)

        <iterate prepend="AND" conjunction="AND" property="filters">
            <isEqual property="filters[].element" compareValue="id">r.ID = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="fileId">r.FILE_ID = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="sessionId">sf.SESSION_ID = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="fileName">sf.FILE_NAME = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="dateFrom">sf.FILE_DATE >= TO_DATE(#filters[].value#, 'DD.MM.YYYY')</isEqual>
            <isEqual property="filters[].element" compareValue="dateTo">sf.FILE_DATE <![CDATA[<=]]> TO_DATE(#filters[].value#, 'DD.MM.YYYY')</isEqual>
        </iterate>
        <iterate prepend="ORDER BY" conjunction=", " property="sorting">
            <isNotEqual property="sorting[].direction" compareValue="AUTO">
                <isEqual property="sorting[].property" compareValue="id">r.ID $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="dstBin">r.DST_BIN $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="srcBin">r.SRC_BIN $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="originalTc">r.ORIGINAL_TC $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="originalTcq">r.ORIGINAL_TCQ $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="originalTcr">r.ORIGINAL_TCR $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="srcBatchDate">r.SRC_BATCH_DATE $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="scrBatchNumber">r.SRC_BATCH_NUMBER $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="itemSeqNumber">r.ITEM_SEQ_NUMBER $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="originalAmount">r.ORIGINAL_AMOUNT $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="originalCurrency">r.ORIGINAL_CURRENCY $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="originalSttlFlag">r.ORIGINAL_STTL_FLAG $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="crsReturnFlag">r.CRS_RETURN_FLAG $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="reasonCode1">r.REASON_CODE1 $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="reasonCode2">r.REASON_CODE2 $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="reasonCode3">r.REASON_CODE3 $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="reasonCode4">r.REASON_CODE4 $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="reasonCode5">r.REASON_CODE5 $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="originalId">r.ORIGINAL_ID $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="fileId">r.FILE_ID $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="batchId">r.BATCH_ID $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="recordNumber">r.RECORD_NUMBER $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="fileName">sf.FILE_NAME $sorting[].direction$</isEqual>

            </isNotEqual>
        </iterate>
        <include refid="paginatedClose" />
    </select>

    <select id="get-visa-returns-count"
            parameterClass="qparams"
            resultClass="int">
        <include refid="limitationOpenCount"/>
        SELECT
        r.id
        FROM
        vis_returned r
        , prc_session_file sf
        , vis_file f
        WHERE
        r.file_id = f.id
        and f.session_file_id = sf.id(+)
        <iterate prepend="AND" conjunction="AND" property="filters">
            <isEqual property="filters[].element" compareValue="id">r.ID = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="fileId">r.FILE_ID = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="sessionId">sf.SESSION_ID = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="fileName">sf.FILE_NAME = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="dateFrom">sf.FILE_DATE >= TO_DATE(#filters[].value#, 'DD.MM.YYYY')</isEqual>
            <isEqual property="filters[].element" compareValue="dateTo">sf.FILE_DATE <![CDATA[<=]]> TO_DATE(#filters[].value#, 'DD.MM.YYYY')</isEqual>
        </iterate>
        <include refid="limitationClose"/>
    </select>

    <resultMap  id="mapping-visa-vss-report" class="ru.bpc.sv2.ps.visa.VisaVssReport"  >
        <result property="id" column="ID" />
        <result property="reportCode" column="REPORT_CODE" />
        <result property="reportIdNum" column="REP_ID_NUM" />
        <result property="reportIdSfx" column="REP_ID_SFX" />
        <result property="dstBin" column="DST_BIN" />
        <result property="sreId" column="SRE_ID" />
        <result property="sreName" column="SRE_NAME" />
        <result property="upSreId" column="UP_SRE_ID" />
        <result property="upSreName" column="UP_SRE_NAME" />
        <result property="fundsSreId" column="FUNDS_SRE_ID" />
        <result property="fundsSreName" column="FUNDS_SRE_NAME" />
        <result property="settlementCurrency" column="STTL_CURRENCY" />
        <result property="clearingCurrency" column="CLEAR_CURRENCY" />
        <result property="dateFrom" column="DATE_FROM" />
        <result property="dateTo" column="DATE_TO" />
        <result property="settlementDate" column="STTL_DATE" />
        <result property="reportDate" column="REPORT_DATE" />
        <result property="changeDate" column="REPORT_DATE" />
    </resultMap>

	<sql id="get-visa-vss-reports-from-where">
		from (
			select
				min(id) as id,
				rep_id_num,
				rep_id_sfx,
				min(dst_bin) dst_bin,
				sre_id,
				min(up_sre_id) up_sre_id,
				min(funds_id) funds_sre_id,
				min(sttl_currency) sttl_currency,
				null clear_currency,
				min(date_from) date_from,
				max(date_to) date_to,
				min(sttl_date) sttl_date,
				min(report_date) report_date
			from VIS_UI_VSS2_VW
			group by file_id, rep_id_num, rep_id_sfx, sre_id, report_date
		union
			select
				min(id) as id,
				rep_id_num,
				rep_id_sfx,
				min(dst_bin) dst_bin,
				sre_id,
				min(up_sre_id) up_sre_id,
				min(funds_id) funds_sre_id,
				min(sttl_currency) sttl_currency,
				min(clear_currency) clear_currency,
				min(date_from) date_from,
				max(date_to) date_to,
				min(sttl_date) sttl_date,
				min(report_date) report_date
			from VIS_UI_VSS4_VW
			group by file_id, rep_id_num, rep_id_sfx, sre_id, report_date
		union
			select
				min(id) as id,
				rep_id_num,
				rep_id_sfx,
				min(dst_bin) dst_bin,
				sre_id,
				null up_sre_id,
				null funds_sre_id,
				null sttl_currency,
				min(clear_currency) clear_currency,
				null date_from,
				null date_to,
				min(sttl_date) sttl_date,
				min(report_date) report_date
			from VIS_UI_VSS6_VW
			group by file_id, rep_id_num, rep_id_sfx, sre_id, report_date
		) rep) r
		WHERE rep_id_num in ('110', '120', '130', '140', '900')
		<iterate prepend="AND" conjunction="AND" property="filters">
			<isEqual property="filters[].element" compareValue="id">r.ID = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="reportIdNum">r.rep_id_num = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="sreName">upper(r.sre_name) like #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="dstBin">upper(r.dst_bin) like #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="frequency">(#filters[].value# <![CDATA[<>]]> 'D' or #filters[].value# = 'D' and r.rep_id_sfx is null) and (#filters[].value# <![CDATA[<>]]> 'M' or #filters[].value# = 'M' and r.rep_id_sfx in ('M', 'PM', 'SM', 'XM'))</isEqual>
			<isEqual property="filters[].element" compareValue="reportDate">r.report_date = TO_DATE(#filters[].value#, 'DD.MM.YYYY')</isEqual>
			<isEqual property="filters[].element" compareValue="changeDate">r.report_date = TO_DATE(#filters[].value#, 'DD.MM.YYYY')</isEqual>
			<isEqual property="filters[].element" compareValue="settlementDate">r.sttl_date = TO_DATE(#filters[].value#, 'DD.MM.YYYY')</isEqual>
		</iterate>
	</sql>

	<select id="get-visa-vss-reports" parameterClass="qparams" resultMap="mapping-visa-vss-report">
        <include refid="paginatedOpen" />
		select * from (select
			id,
			'VSS-'||rep_id_num||nvl2(rep_id_sfx, '-'||rep_id_sfx, null) as report_code,
			rep_id_num,
			rep_id_sfx,
			dst_bin,
			sre_id,
			nvl2(rep.sre_id, (select distinct sub_sre_name from VIS_UI_VSS1_VW where sub_sre_id=rep.sre_id), null) sre_name,
			up_sre_id,
			nvl2(rep.up_sre_id, (select distinct sub_sre_name from VIS_UI_VSS1_VW where sub_sre_id=rep.up_sre_id), null) up_sre_name,
			funds_sre_id,
			nvl2(rep.funds_sre_id, (select distinct sub_sre_name from VIS_UI_VSS1_VW where sub_sre_id=rep.funds_sre_id), null) funds_sre_name,
			sttl_currency,
			clear_currency,
			date_from,
			date_to,
			sttl_date,
			report_date

		<include refid="get-visa-vss-reports-from-where" />

		<iterate prepend="ORDER BY" conjunction=", " property="sorting">
            <isNotEqual property="sorting[].direction" compareValue="AUTO">
                <isEqual property="sorting[].property" compareValue="id">r.ID $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="reportCode">r.rep_id_num $sorting[].direction$, rep_id_sfx</isEqual>
                <isEqual property="sorting[].property" compareValue="sreName">r.sre_name $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="upSreName">r.up_sre_name $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="fundsSreName">r.funds_sre_name $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="settlementCurrency">r.sttl_currency $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="clearingCurrency">r.clear_currency $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="dateFrom">r.date_from $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="dateTo">r.date_to $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="settlementDate">r.sttl_date $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="reportDate">r.report_date $sorting[].direction$</isEqual>
            </isNotEqual>
        </iterate>
        <include refid="paginatedClose" />
    </select>

    <select id="get-visa-vss-reports-count"
            parameterClass="qparams"
            resultClass="int">
        <include refid="limitationOpenCount"/>
		select * from (select
			id,
			'VSS-'||rep_id_num||nvl2(rep_id_sfx, '-'||rep_id_sfx, null) as report_code,
			rep_id_num,
			rep_id_sfx,
			dst_bin,
			sre_id,
			nvl2(rep.sre_id, (select distinct sub_sre_name from VIS_UI_VSS1_VW where sub_sre_id=rep.sre_id), null) sre_name,
			sttl_currency,
			clear_currency,
			date_from,
			date_to,
			sttl_date,
			report_date

		<include refid="get-visa-vss-reports-from-where" />

		<include refid="limitationClose"/>
    </select>

	<resultMap  id="mapping-visa-vss-report-v2" class="ru.bpc.sv2.ps.visa.VisaVssReportDetailV2">
		<result property="id" column="ID" />
		<result property="businessMode" column="bus_mode" />
		<result property="amountType" column="amount_type" />
		<result property="transCount" column="trans_count" />
		<result property="creditAmount" column="credit_amount" />
		<result property="debitAmount" column="debit_amount" />
		<result property="netAmount" column="net_amount" />
	</resultMap>

	<select id="get-visa-vss-reports-v2" parameterClass="Long" resultMap="mapping-visa-vss-report-v2">
		select
			rep.id,
			rep.amount_type,
			rep.bus_mode,
			rep.trans_count,
			rep.credit_amount,
			rep.debit_amount,
			rep.net_amount
		from VIS_UI_VSS2_VW rep,
			VIS_UI_VSS2_VW rep_id
		where
			rep_id.id=#value# and
			rep.file_id=rep_id.file_id and rep.rep_id_num=rep_id.rep_id_num and nvl(rep.rep_id_sfx,'-')=nvl(rep_id.rep_id_sfx,'-') and rep.sre_id=rep_id.sre_id and rep.report_date=rep_id.report_date
		order by rep.record_number
	</select>

	<resultMap  id="mapping-visa-vss-report-v4" class="ru.bpc.sv2.ps.visa.VisaVssReportDetailV4">
		<result property="id" column="ID" />
		<result property="chargeType" column="charge_type" />
		<result property="businessMode" column="bus_mode" />
		<result property="summaryLevel" column="summary_level" />
		<result property="businessTransType" column="bus_tr_type" />
		<result property="businessTransCycle" column="bus_tr_cycle" />
		<result property="jurisdiction" column="jurisdict" />
		<result property="routing" column="routing" />
		<result property="srcCountry" column="src_country" />
		<result property="dstCountry" column="dst_country" />
		<result property="srcRegion" column="src_region" />
		<result property="dstRegion" column="dst_region" />
		<result property="feeLevel" column="fee_level" />
		<result property="firstCount" column="first_count" />
		<result property="firstAmount" column="first_amount" />
		<result property="secondAmount" column="second_amount" />
		<result property="thirdAmount" column="third_amount" />
		<result property="currencyTableDate" column="currency_table_date" />
	</resultMap>

	<select id="get-visa-vss-reports-v4" parameterClass="Long" resultMap="mapping-visa-vss-report-v4">
		select
			rep.id,
			rep.charge_type,
			rep.bus_mode,
			rep.summary_level,
			rep.bus_tr_type,
			rep.bus_tr_cycle,
			rep.jurisdict,
			rep.routing,
			rep.src_country,
			rep.dst_country,
			rep.src_region,
			rep.dst_region,
			rep.fee_level,
			rep.first_count,
			rep.first_amount,
			rep.second_amount,
			rep.third_amount,
			rep.currency_table_date
		from VIS_UI_VSS4_VW rep,
			VIS_UI_VSS4_VW rep_id
		where
			rep_id.id=#value# and
			rep.file_id=rep_id.file_id and rep.rep_id_num=rep_id.rep_id_num and nvl(rep.rep_id_sfx,'-')=nvl(rep_id.rep_id_sfx,'-') and rep.sre_id=rep_id.sre_id and rep.report_date=rep_id.report_date
		order by rep.record_number
	</select>

	<resultMap  id="mapping-visa-vss-report-v6" class="ru.bpc.sv2.ps.visa.VisaVssReportDetailV6">
		<result property="id" column="ID" />
		<result property="summaryLevel" column="summary_level" />
		<result property="businessMode" column="bus_mode" />
		<result property="businessTransType" column="bus_tr_type" />
		<result property="businessTransCycle" column="bus_tr_cycle" />
		<result property="transDisposition" column="trans_dispos" />
		<result property="transCount" column="trans_count" />
		<result property="amount" column="amount" />
		<result property="crsDate" column="crs_date" />
	</resultMap>

	<select id="get-visa-vss-reports-v6" parameterClass="Long" resultMap="mapping-visa-vss-report-v6">
		select
			min(rep.id) id,
			min(rep.record_number) record_number,
			rep.summary_level,
			rep.bus_mode,
			rep.bus_tr_type,
			rep.bus_tr_cycle,
			rep.trans_dispos,
			sum(rep.trans_count) trans_count,
			sum(rep.amount) amount,
			min(rep.crs_date) crs_date
		from VIS_UI_VSS6_VW rep,
			VIS_UI_VSS6_VW rep_id
		where
			rep_id.id=#value# and
			rep.file_id=rep_id.file_id and rep.rep_id_num=rep_id.rep_id_num and nvl(rep.rep_id_sfx,'-')=nvl(rep_id.rep_id_sfx,'-') and rep.sre_id=rep_id.sre_id and rep.report_date=rep_id.report_date
			and rep.summary_level <![CDATA[<>]]> '0'
		group by rep.summary_level, rep.bus_mode, rep.bus_tr_type, rep.bus_tr_cycle, rep.trans_dispos
		order by rep.bus_mode, rep.trans_dispos, min(rep.record_number)
	</select>

	<select id="is-visa-operation" parameterClass="Long" resultClass="java.lang.Integer">
		select 1 from vis_fin_message_vw where id=#value#
	</select>

	<resultMap id="map-fin-status-advices" class="ru.bpc.sv2.ps.visa.VisaFinStatusAdvice">
		<result property="sessionId" column="session_id"/>
		<result property="fileName" column="file_name"/>
		<result property="fileDate" column="file_date" jdbcType="DATE" javaType="java.util.Date"/>
		<result property="id" column="id"/>
		<result property="cardMask" column="card_mask"/>
		<result property="cardNumber" column="card_number"/>
		<result property="transactionCode" column="trans_code"/>
		<result property="transCodeQualifier" column="trans_code_qualifier"/>
		<result property="transComponentSeq" column="trans_component_seq"/>
		<result property="destBin" column="dest_bin"/>
		<result property="sourceBin" column="source_bin"/>
		<result property="vcrRecordId" column="vcr_record_id"/>
		<result property="networkId" column="network_id"/>
		<result property="disputeCondition" column="dispute_condition"/>
		<result property="disputeStatus" column="dispute_status"/>
		<result property="posCondCode" column="pos_cond_code"/>
		<result property="posEntryMode" column="pos_entry_mode"/>
		<result property="vrolFinId" column="vrol_fin_id"/>
		<result property="vrolCaseNumber" column="vrol_case_number"/>
		<result property="vrolBundleCaseNumber" column="vrol_bundle_case_number"/>
		<result property="clientCaseNumber" column="client_case_number"/>
		<result property="clearingSeqNumber" column="clearing_seq_number"/>
		<result property="clearingSeqCount" column="clearing_seq_count"/>
		<result property="recipientIndicator" column="orig_recipient_ind"/>
		<result property="productId" column="product_id"/>
		<result property="spendQualifiedIndicator" column="spend_qualified_indicator"/>
		<result property="processCode" column="process_code"/>
		<result property="sttlFlag" column="sttl_flag"/>
		<result property="usageCode" column="usage_code"/>
		<result property="transId" column="trans_id"/>
		<result property="acqBusinessId" column="acq_business_id"/>
		<result property="acqRefnum" column="acq_ref_number"/>
		<result property="acqInstCode" column="acq_inst_code"/>
		<result property="cardAcceptorId" column="card_acceptor_id"/>
		<result property="origTransAmount" column="orig_trans_amount"/>
		<result property="origTransCurrency" column="orig_trans_currency"/>
		<result property="sourceAmount" column="source_amount"/>
		<result property="sourceCurrency" column="source_curr_code"/>
		<result property="chargebackIndicator" column="chargeback_indicator"/>
		<result property="reasonCode" column="reason_code"/>
		<result property="accountNumberExt" column="card_number_ext"/>
		<result property="rrn" column="rrn"/>
		<result property="purchaseDate" column="purchase_date" jdbcType="VARCHAR" javaType="java.util.Date" typeHandler="ru.bpc.sv2.utils.MMDDtoDateTypeHandler"/>
		<result property="processDate" column="process_date" jdbcType="VARCHAR" javaType="java.util.Date" typeHandler="ru.bpc.sv2.utils.JulianDateTypeHandler"/>
		<result property="mcc" column="mcc"/>
		<result property="merchantName" column="merchant_name"/>
		<result property="merchantCity" column="merchant_city"/>
		<result property="merchantRegion" column="merchant_region_code"/>
		<result property="merchantCountry" column="merchant_country"/>
		<result property="merchantPostcode" column="merchant_postal_code"/>
		<result property="paymentService" column="req_payment_service"/>
		<result property="authCode" column="auth_code"/>
		<result property="reimbursement" column="reimbursement"/>
		<result property="disputeReasonCode" column="dsp_fin_reason_code"/>
		<result property="disputeTransCode" column="dispute_trans_code"/>
		<result property="disputeQualifier" column="dispute_tc_qualifier"/>
		<result property="lang" column="lang"/>
	</resultMap>

	<select id="get-fin-status-advices" parameterClass="qparams" resultMap="map-fin-status-advices">
		<include refid="paginatedOpen"/>
		select s.session_id
		     , s.file_name
		     , s.file_date
		     , v.id
		     , v.card_number
		     , v.card_mask
		     , v.trans_code
		     , v.trans_code_qualifier
		     , v.trans_component_seq
		     , v.dest_bin
		     , v.source_bin
		     , v.vcr_record_id
		     , v.network_code         as network_id
		     , v.dispute_condition
		     , v.dispute_status
		     , v.pos_condition_code   as pos_cond_code
		     , v.pos_entry_mode
		     , v.vrol_fin_id
		     , v.vrol_case_number
		     , v.vrol_bundle_case_num as vrol_bundle_case_number
		     , v.client_case_number
		     , v.clearing_seq_number
		     , v.clearing_seq_count
		     , v.orig_recipient_ind
		     , v.product_id
		     , v.spend_qualified_ind  as spend_qualified_indicator
		     , v.processing_code      as process_code
		     , v.settlement_flag      as sttl_flag
		     , v.usage_code
		     , v.trans_identifier     as trans_id
		     , v.acq_business_id
		     , v.acq_ref_number
		     , v.acq_inst_code
		     , v.card_acceptor_id
		     , v.orig_trans_amount
		     , v.orig_trans_curr_code as orig_trans_currency
		     , v.source_amount
		     , v.source_curr_code
		     , v.spec_chargeback_ind  as chargeback_indicator
		     , v.message_reason_code  as reason_code
		     , v.card_number_ext
		     , v.rrn
		     , v.purchase_date
		     , v.central_proc_date    as process_date
		     , v.mcc
		     , v.merchant_name
		     , v.merchant_city
		     , v.merchant_region_code
		     , v.merchant_country
		     , v.merchant_postal_code
		     , v.req_payment_service
		     , v.auth_code
		     , v.reimbursement
		     , v.dsp_fin_reason_code
		     , v.dispute_trans_code
		     , v.dispute_tc_qualifier
		     , v.lang
		  from vis_ui_vcr_advice_vw v
		     , prc_session_file s
		     , vis_file f
		 where v.file_id = f.id(+)
		   and f.session_file_id = s.id(+)
		<iterate prepend="and" conjunction="and" property="filters">
			<isEqual property="filters[].element" compareValue="id">v.id = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="session_id">s.session_id = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="file_name">s.file_name like #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="date_from">to_date(v.purchase_date, 'MMDD') >= to_date(#filters[].value#, 'DD.MM.YYYY')</isEqual>
			<isEqual property="filters[].element" compareValue="date_to">to_date(v.purchase_date, 'MMDD') <![CDATA[<=]]> to_date(#filters[].value#, 'DD.MM.YYYY')</isEqual>
			<isEqual property="filters[].element" compareValue="card_number">v.card_number like #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="case_number">v.vrol_case_number = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="auth_code">v.auth_code like #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="lang">v.lang = #filters[].value#</isEqual>
		</iterate>
		<iterate prepend="order by" conjunction=", " property="sorting">
			<isNotEqual property="sorting[].direction" compareValue="auto">
				<isEqual property="sorting[].property" compareValue="id">v.id $sorting[].direction$</isEqual>
				<isEqual property="sorting[].property" compareValue="card_number">v.account_number $sorting[].direction$</isEqual>
				<isEqual property="sorting[].property" compareValue="dispute_status">v.dispute_status $sorting[].direction$</isEqual>
				<isEqual property="sorting[].property" compareValue="purchase_date">to_date(v.purchase_date, 'MMDD') $sorting[].direction$</isEqual>
				<isEqual property="sorting[].property" compareValue="reason_code">v.reason_code $sorting[].direction$</isEqual>
			</isNotEqual>
		</iterate>
		<include refid="paginatedClose"/>
	</select>

	<select id="get-fin-status-advices-count" parameterClass="qparams" resultClass="int">
		<include refid="limitationOpenCount"/>
		select v.id
		  from vis_ui_vcr_advice_vw v
		     , prc_session_file s
		     , vis_file f
		 where v.file_id = f.id(+)
		   and f.session_file_id = s.id(+)
		<iterate prepend="and" conjunction="and" property="filters">
			<isEqual property="filters[].element" compareValue="id">v.id = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="session_id">s.session_id = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="file_name">s.file_name like #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="date_from">to_date(v.purchase_date, 'MMDD') >= to_date(#filters[].value#, 'DD.MM.YYYY')</isEqual>
			<isEqual property="filters[].element" compareValue="date_to">to_date(v.purchase_date, 'MMDD') <![CDATA[<=]]> to_date(#filters[].value#, 'DD.MM.YYYY')</isEqual>
			<isEqual property="filters[].element" compareValue="card_number">v.card_number like #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="case_number">v.vrol_case_number = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="auth_code">v.auth_code like #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="lang">v.lang = #filters[].value#</isEqual>
		</iterate>
		<include refid="limitationClose"/>
	</select>

	<resultMap id="map-get-sms-reports" class="ru.bpc.sv2.ps.visa.VisaSmsReport">
		<result column="id"                  property="id"                jdbcType="NUMERIC" javaType="java.lang.Long"/>
		<result column="file_id"             property="fileId"            jdbcType="NUMERIC" javaType="java.lang.Long"/>
		<result column="record_number"       property="recordNumber"      jdbcType="NUMERIC" javaType="java.lang.Long"/>
		<result column="status"              property="status"            jdbcType="VARCHAR" javaType="java.lang.String"/>
		<result column="status_desc"         property="statusDesc"        jdbcType="VARCHAR" javaType="java.lang.String"/>
		<result column="record_type"         property="recordType"        jdbcType="VARCHAR" javaType="java.lang.String"/>
		<result column="iss_acq"             property="issAcq"            jdbcType="VARCHAR" javaType="java.lang.String"/>
		<result column="isa_ind"             property="isaInd"            jdbcType="VARCHAR" javaType="java.lang.String"/>
		<result column="giv_flag"            property="givFlag"           jdbcType="VARCHAR" javaType="java.lang.String"/>
		<result column="affiliate_bin"       property="affiliateBin"      jdbcType="VARCHAR" javaType="java.lang.String"/>
		<result column="sttl_date"           property="sttlDate"          jdbcType="DATE"    javaType="java.util.Date"/>
		<result column="val_code"            property="valCode"           jdbcType="VARCHAR" javaType="java.lang.String"/>
		<result column="refnum"              property="refnum"            jdbcType="VARCHAR" javaType="java.lang.String"/>
		<result column="trace_num"           property="traceNum"          jdbcType="VARCHAR" javaType="java.lang.String"/>
		<result column="req_msg_type"        property="reqMsgType"        jdbcType="VARCHAR" javaType="java.lang.String"/>
		<result column="resp_code"           property="respCode"          jdbcType="VARCHAR" javaType="java.lang.String"/>
		<result column="proc_code"           property="procCode"          jdbcType="VARCHAR" javaType="java.lang.String"/>
		<result column="msg_reason_code"     property="msgReasonCode"     jdbcType="VARCHAR" javaType="java.lang.String"/>
		<result column="card_number"         property="cardNumber"        jdbcType="VARCHAR" javaType="java.lang.String"/>
		<result column="trxn_ind"            property="trxnInd"           jdbcType="VARCHAR" javaType="java.lang.String"/>
		<result column="sttl_curr_code"      property="sttlCurrCode"      jdbcType="VARCHAR" javaType="java.lang.String"/>
		<result column="sttl_amount"         property="sttlAmount"        jdbcType="NUMERIC" javaType="java.math.BigDecimal"/>
		<result column="sttl_sign"           property="sttlSign"          jdbcType="VARCHAR" javaType="java.lang.String"/>
		<result column="reserved"            property="reserved"          jdbcType="VARCHAR" javaType="java.lang.String"/>
		<result column="spend_qualified_ind" property="spendQualifiedInd" jdbcType="VARCHAR" javaType="java.lang.String"/>
		<result column="surcharge_amount"    property="surchargeAmount"   jdbcType="NUMERIC" javaType="java.math.BigDecimal"/>
		<result column="surcharge_sign"      property="surchargeSign"     jdbcType="VARCHAR" javaType="java.lang.String"/>
		<result column="inst_id"             property="instId"            jdbcType="NUMERIC" javaType="java.lang.Integer"/>
		<result column="inst_name"           property="instName"          jdbcType="VARCHAR" javaType="java.lang.String"/>
		<result column="lang"                property="lang"              jdbcType="VARCHAR" javaType="java.lang.String"/>
	</resultMap>

	<select id="get-sms-reports" parameterClass="qparams" resultMap="map-get-sms-reports">
		<include refid="paginatedOpen"/>
			select id
			     , file_id
			     , record_number
			     , status
			     , status_desc
			     , record_type
			     , iss_acq
			     , isa_ind
			     , giv_flag
			     , affiliate_bin
			     , sttl_date
			     , val_code
			     , refnum
			     , trace_num
			     , req_msg_type
			     , resp_code
			     , proc_code
			     , msg_reason_code
			     , card_number
			     , trxn_ind
			     , sttl_curr_code
			     , sttl_amount
			     , sttl_sign
			     , reserved
			     , spend_qualified_ind
			     , surcharge_amount
			     , surcharge_sign
			     , inst_id
			     , inst_name
			     , lang
			  from vis_ui_sms1_vw
		<iterate prepend=" where " conjunction=" and " property="filters">
			<isEqual property="filters[].element" compareValue="id">id = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="lang">lang = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="status">status = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="recordType">record_type = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="sttlDate">sttl_date = to_date(#filters[].value#, 'DD.MM.YYYY')</isEqual>
			<isEqual property="filters[].element" compareValue="instId">inst_id = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="cardNumber">card_number like #filters[].value#</isEqual>
		</iterate>
		<iterate prepend=" order by " conjunction=", " property="sorting">
			<isNotEqual property="sorting[].direction" compareValue="auto">
				<isEqual property="sorting[].property" compareValue="id">id $sorting[].direction$</isEqual>
				<isEqual property="sorting[].property" compareValue="status">status $sorting[].direction$</isEqual>
				<isEqual property="sorting[].property" compareValue="recordType">record_type $sorting[].direction$</isEqual>
				<isEqual property="sorting[].property" compareValue="sttlDate">sttl_date $sorting[].direction$</isEqual>
				<isEqual property="sorting[].property" compareValue="instId">inst_id $sorting[].direction$</isEqual>
			</isNotEqual>
		</iterate>
		<include refid="paginatedClose"/>
	</select>

	<select id="get-sms-reports-count" parameterClass="qparams" resultClass="int">
		<include refid="limitationOpenCount"/>
			select id
			  from vis_ui_sms1_vw
		<iterate prepend=" where " conjunction=" and " property="filters">
			<isEqual property="filters[].element" compareValue="id">id = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="lang">lang = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="status">status = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="recordType">record_type = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="sttlDate">sttl_date = to_date(#filters[].value#, 'DD.MM.YYYY')</isEqual>
			<isEqual property="filters[].element" compareValue="instId">inst_id = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="cardNumber">card_number like #filters[].value#</isEqual>
		</iterate>
		<include refid="limitationClose"/>
	</select>
</sqlMap>