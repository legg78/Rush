<?xml version="1.0" encoding="UTF-8"?>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:a4j="http://richfaces.org/a4j"
      xmlns:rich="http://richfaces.org/rich"
      xmlns:bm="http://www.bpc.ru/jsf/misc"
      xmlns:bre="http://www.bpc.ru/jsf/richfaces-ext"
      xmlns:fmt="http://www.bpc.ru/el/formatter">
    <ui:composition>
        <f:loadBundle var="lblCrd" basename="ru.bpc.sv2.ui.bundles.Crd"/>
        <f:loadBundle var="lblRej" basename="ru.bpc.sv2.ui.bundles.Reject"/>

        <a4j:loadScript src="/js/stretch.js" />
        <a4j:loadScript src="/js/calendarUtils.js"/>

        <h:form id="tokensBtmForm">
            <h:panelGroup id="tokensTableWrapper" layout="block" style="padding:0px;margin:0px;">
                <rich:extendedDataTable id="tokensTable"
                                        rowClasses=",odd"
                                        var="token"
                                        value="#{(tokensBean==null ? MbTokensSearch : tokensBean).tokens}"
                                        selection="#{(tokensBean==null ? MbTokensSearch : tokensBean).itemSelection}"
                                        selectionMode="single"
                                        enableContextMenu="true"
                                        tableState="#{(tokensBean==null ? MbTokensSearch : tokensBean).tableState}"
                                        rows="0"
                                        headerClass="res-table-header table-header-ext"
                                        height="220px"
                                        selectedClass="res-table-selected"
                                        styleClass="res-table"
                                        noDataLabel="#{lblCommon['no_records_found']}">
                    <a4j:support event="onselectionchange" reRender="btnPanel"/>

                    <rich:column id="token" label="#{lblCrd.token}" title="#{lblCrd.token}" sortBy="#{'token'}" width="25%">
                        <f:facet name="header">
                            <a4j:outputPanel layout="none">
                                <script>updateHeight();</script>
                                <h:outputText value="#{lblCrd.token}" title="#{lblCrd.token}"/>
                            </a4j:outputPanel>
                        </f:facet>
                        <f:facet name="filter">
                            <h:inputText value="#{(tokensBean==null ? MbTokensSearch : tokensBean).filter.token}" style="width: 100%;">
                                <a4j:support event="onkeyup" requestDelay="1000" reRender="tokensTable"
                                             action="#{(tokensBean==null ? MbTokensSearch : tokensBean).search}"/>
                            </h:inputText>
                        </f:facet>
                        <h:outputText value="#{token.token}" title="#{token.token}"/>
                    </rich:column>

                    <rich:column id="expirationDate" label="#{lblCommon.exp_date}" title="#{lblCommon.exp_date}" sortBy="#{'expirationDate'}" width="15%">
                        <f:facet name="header">
                            <a4j:outputPanel layout="none">
                                <script>updateHeight();</script>
                                <h:outputText value="#{lblCommon.exp_date}" title="#{lblCommon.exp_date}"/>
                            </a4j:outputPanel>
                        </f:facet>
                        <f:facet name="filter">
                            <h:panelGroup>
                                <rich:calendar id="filterCalendar" buttonIcon="/images/calendar.gif"
                                               value="#{(tokensBean==null ? MbTokensSearch : tokensBean).filter.expirationDate}"
                                               direction="top-left" datePattern="#{usession.fullExpDatePattern}"
                                               timeZone="#{CommonUtils.timeZone}"
                                               inputStyle="width:80%" defaultTime="00:00:00.000" zindex="1000"
                                               reRender="tokensTable">
                                    <a4j:support event="onchanged" ajaxSingle="true" reRender="tokensTable"
                                                 action="#{(tokensBean==null ? MbTokensSearch : tokensBean).search}" />
                                </rich:calendar>
                            </h:panelGroup>
                        </f:facet>
                        <bm:entityDisplay value="#{fmt:formatDate(token.expirationDate, usession.fullExpDatePattern, CommonUtils.timeZoneId)}"
                                          description="#{fmt:formatDate(token.expirationDate, usession.fullExpDatePattern, CommonUtils.timeZoneId)}"/>
                    </rich:column>

                    <rich:column id="status" label="#{lblCommon.status}" title="#{lblCommon.status}" sortBy="#{'status'}" width="15%">
                        <f:facet name="header">
                            <a4j:outputPanel layout="none">
                                <script>updateHeight();</script>
                                <h:outputText value="#{lblCommon.status}" title="#{lblCommon.status}"/>
                            </a4j:outputPanel>
                        </f:facet>
                        <f:facet name="filter">
                            <h:selectOneMenu value="#{(tokensBean==null ? MbTokensSearch : tokensBean).filter.status}" style="width: 100%;" styleClass="wide">
                                <f:selectItem itemValue="" />
                                <f:selectItems value="#{(tokensBean==null ? MbTokensSearch : tokensBean).statuses}" />
                                <a4j:support event="onchange" reRender="tokensTable"
                                             action="#{(tokensBean==null ? MbTokensSearch : tokensBean).search}" />
                            </h:selectOneMenu>
                        </f:facet>
                        <bm:entityDisplay value="#{DictUtils.articles[token.status]}"
                                          description="#{DictUtils.articles[token.status]}"/>
                    </rich:column>

                    <rich:column id="initOperId" label="#{lblCrd.init_oper_id}" title="#{lblCrd.init_oper_id}" width="20%">
                        <f:facet name="header">
                            <a4j:outputPanel layout="none">
                                <script>updateHeight();</script>
                                <h:outputText value="#{lblCrd.init_oper_id}" title="#{lblCrd.init_oper_id}"/>
                            </a4j:outputPanel>
                        </f:facet>
                        <f:facet name="filter">
                            <h:inputText value="#{(tokensBean==null ? MbTokensSearch : tokensBean).filter.initOperId}" style="width: 100%;">
                                <a4j:support event="onkeyup" requestDelay="1000" reRender="tokensTable"
                                             action="#{(tokensBean==null ? MbTokensSearch : tokensBean).search}"/>
                            </h:inputText>
                        </f:facet>
                        <h:outputText value="#{token.initOperId}" title="#{token.initOperId}"/>
                    </rich:column>

                    <rich:column id="walletProvider" label="#{lblCrd.wallet_provider}" title="#{lblCrd.wallet_provider}" width="15%">
                        <f:facet name="header">
                            <a4j:outputPanel layout="none">
                                <script>updateHeight();</script>
                                <h:outputText value="#{lblCrd.wallet_provider}" title="#{lblCrd.wallet_provider}"/>
                            </a4j:outputPanel>
                        </f:facet>
                        <f:facet name="filter">
                            <h:inputText value="#{(tokensBean==null ? MbTokensSearch : tokensBean).filter.walletProvider}" style="width: 100%;">
                                <a4j:support event="onkeyup" requestDelay="1000" reRender="tokensTable"
                                             action="#{(tokensBean==null ? MbTokensSearch : tokensBean).search}"/>
                            </h:inputText>
                        </f:facet>
                        <h:outputText value="#{DictUtils.articles[token.walletProvider]}" title="#{DictUtils.articles[token.walletProvider]}"/>
                    </rich:column>

                </rich:extendedDataTable>
            </h:panelGroup>
            <script>setDetailsState("tokensBtmForm:tokensTable");</script>
        </h:form>
    </ui:composition>
</html>
