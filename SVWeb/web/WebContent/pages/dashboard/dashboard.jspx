<?xml version="1.0" encoding="UTF-8"?>
<html xmlns="http://www.w3.org/1999/xhtml"
	  xmlns:ui="http://java.sun.com/jsf/facelets"
	  xmlns:h="http://java.sun.com/jsf/html"
	  xmlns:f="http://java.sun.com/jsf/core"
	  xmlns:a4j="http://richfaces.org/a4j"
	  xmlns:rich="http://richfaces.org/rich"
	  xmlns:c="http://java.sun.com/jstl/core"
	  xmlns:bre="http://www.bpc.ru/jsf/richfaces-ext"
	  xmlns:bpct="http://www.bpc.ru/jsf/tiles">
<ui:composition template="/WEB-INF/templates/navigatable.jspx">
	<ui:define name="navigatableContent">
		<a4j:queue />
		<!-- navigation bar -->

		<h1>
			<span class="ico settings"></span>
			<h:outputText value="#{MbDashboard.currentDashboard.item.name}"/>
		</h1>

		<a4j:outputPanel id="refreshPanel" styleClass="widgets" layout="block">
			<table style="width: 100%">
				<c:forEach items="#{MbDashboard.currentDashboard.widgetTable}" var="row">
					<tr>
						<c:forEach items="#{row.availableColumnItems}" var="column">
							<c:if test="#{column.widget.id == null}">
								<td colspan="#{column.width}">
									<div id="divNoWidget#{column.columnNumber}#{row.rowNumber}" style="height: #{MbDashboard.currentDashboard.itemHeight}px; overflow: auto"/>
									<script>
										var oneQuater = (window.screen.width - 300) / 4;
										document.getElementById('divNoWidget#{column.columnNumber}#{row.rowNumber}').style.width = oneQuater + 'px';
									</script>
								</td>
							</c:if>
							<c:if test="#{column.widget.id != null and column.dashboardWidget.rowPos == row.rowNumber}">
								<c:set var="width" value="#{346*column.widget.width}"/>
								<c:set var="height" value="#{253*column.widget.height}"/>
								<td colspan="#{column.width}" rowspan="#{column.widget.height}">
									<div id="div#{column.dashboardWidget.id}" style="overflow: auto; border: 1px solid #DDDDDD; border-radius: 7px 7px 7px 7px; padding:0px 1px;">
										<h:panelGroup style="height: #{height}px; overflow: auto;" layout="block">
											<ui:include src="#{column.widget.path}">
												<ui:param name="widgetItem" value="#{column.widget}"/>
												<ui:param name="dashboardWidget" value="#{column.dashboardWidget}"/>
												<ui:param name="pollForm" value="pollForm#{column.widget.id}_#{column.dashboardWidget.id}"></ui:param>
											</ui:include>
										</h:panelGroup>
									</div>
									<script>
										var widgetWidth = (window.screen.width - 300) / 4 * #{column.widget.width};
										document.getElementById('div#{column.dashboardWidget.id}').style.width = widgetWidth + 'px';
									</script>
								</td>
							</c:if>
						</c:forEach>
					</tr>
				</c:forEach>
			</table>
		</a4j:outputPanel>

		<ui:include src="/pages/widgets/addWidgetParamPanel.jspx"/>

	</ui:define>
</ui:composition>
</html>