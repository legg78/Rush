begin merge into crd_debt_balance b using (select b.id, b.debt_id, b.balance_type, nvl(max(e.posting_order),0) entry_posting_order from crd_debt_balance b, crd_debt d, acc_entry e where b.debt_id = d.id and d.status  = 'DBTSACTV' and e.macros_id = b.debt_id and e.account_id = d.account_id and e.balance_type = b.balance_type group by b.id, b.debt_id, b.balance_type) p on (b.id = p.id) when matched then update set b.posting_order = p.entry_posting_order; end;