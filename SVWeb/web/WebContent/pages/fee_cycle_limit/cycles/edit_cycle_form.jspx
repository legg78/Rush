<?xml version="1.0" encoding="UTF-8"?>
<html   xmlns="http://www.w3.org/1999/xhtml"
		xmlns:f="http://java.sun.com/jsf/core"
		xmlns:h="http://java.sun.com/jsf/html"
		xmlns:ui="http://java.sun.com/jsf/facelets"
		xmlns:a4j="http://richfaces.org/a4j"
		xmlns:rich="http://richfaces.org/rich"
		xmlns:bre="http://www.bpc.ru/jsf/richfaces-ext">
<!-- 
	For inclusion only! When included into some page 2 modal panels 
are needed: 'common_article_modal_panel' for adding new cycle type
and 'fcl_cycle_shift_modal_panel' for adding cycle shifts. 
	Also needs outer form and controls. 
-->
<ui:composition>
	<f:loadBundle var="lblFcl" basename="ru.bpc.sv2.ui.bundles.Fcl"/>
	
	<h:panelGroup layout="block" styleClass="cardholderdata-wrapper">
 		<h:panelGrid columns="2" styleClass="cardholderdata" id="detailsData" columnClasses="firstColModal, width250">        			  		 			

			<h:outputLabel for="cycleType" value="* #{lblFcl.cycle_type}: " title="#{lblFcl.cycle_type}"/>
			<h:panelGrid cellpadding="0" cellspacing="0">
				<h:selectOneMenu id="cycleType" 
						disabled="#{!MbCyclesSearch.newMode}" 
						value="#{MbCyclesSearch.newCycle.cycleType}"
						label="#{lblFcl.cycle_type}"
						onblur="hideErrorField(this)">
					<f:selectItems value="#{MbCyclesSearch.cycleTypes}"/>
				</h:selectOneMenu>
				<h:outputFormat value="#{lblMsg.value_request}" styleClass="errorMarker"
					id="cycleTypeError" style="display:none;">
					<f:param name="fieldName" value="#{lblFcl.cycle_type}"/>
				</h:outputFormat>
				<a4j:commandLink value="#{lblFcl.add_cycle_type}"
						oncomplete="#{rich:component('articlesView:articleModalPanel')}.show()"
						reRender="articlesView:articleModalDiv"
						rendered="#{usession.inRole['ADD_DICTIONARY_ARTICLE']}">
					<f:setPropertyActionListener
							value="#{MbCyclesSearch.dictCycleType}"
							target="#{MbDictionary.newArticleExt}"/>
				</a4j:commandLink>
			</h:panelGrid>
			
			<h:outputLabel for="lengthType" value="* #{lblFcl.length_type}: " title="#{lblFcl.length_type}"/>
			<h:panelGrid cellpadding="0" cellspacing="0">
				<h:selectOneMenu id="lengthType" 
						value="#{MbCyclesSearch.newCycle.lengthType}"
						label="#{lblFcl.length_type}"
						onblur="hideErrorField(this)">
					<f:selectItem itemValue=""/>
					<f:selectItems value="#{MbCyclesSearch.lengthTypes}"/>
				</h:selectOneMenu>
				<h:outputFormat value="#{lblMsg.value_request}" styleClass="errorMarker"
					id="lengthTypeError" style="display:none;">
					<f:param name="fieldName" value="#{lblFcl.length_type}"/>
				</h:outputFormat>
			</h:panelGrid>
			
			<h:outputLabel for="truncType" value="* #{lblFcl.trunc_type}: " title="#{lblFcl.trunc_type}"/>
			<h:panelGrid cellpadding="0" cellspacing="0">
				<h:selectOneMenu id="truncType" 
						value="#{MbCyclesSearch.newCycle.truncType}"
						label="#{lblFcl.trunc_type}"
						onblur="hideErrorField(this)">
					<f:selectItem itemValue=""/>
					<f:selectItems value="#{MbCyclesSearch.truncTypes}"/>
				</h:selectOneMenu>
				<h:outputFormat value="#{lblMsg.value_request}" styleClass="errorMarker"
					id="truncTypeError" style="display:none;">
					<f:param name="fieldName" value="#{lblFcl.trunc_type}"/>
				</h:outputFormat>
			</h:panelGrid>
			
			<h:outputLabel for="cycleLength" value="* #{lblFcl.cycle_length}: " title="#{lblFcl.cycle_length}"/>
			<h:panelGrid cellpadding="0" cellspacing="0">
				<h:inputText id="cycleLength" 
						value="#{MbCyclesSearch.newCycle.cycleLength}"
						label="#{lblFcl.cycle_length}"
						onblur="hideErrorField(this)">
				</h:inputText>
				<h:outputFormat value="#{lblMsg.value_request}" styleClass="errorMarker"
					id="cycleLengthError" style="display:none;">
					<f:param name="fieldName" value="#{lblFcl.cycle_length}"/>
				</h:outputFormat>
			</h:panelGrid>
			
			<h:outputLabel for="instId" value="#{lblCommon.institution}: " title="#{lblCommon.institution}"
					rendered="${empty(showInstitution) or showInstitution}"/>
			<h:selectOneMenu id="instId" 
					disabled="#{MbCyclesSearch.editMode}" 
					value="#{MbCyclesSearch.newCycle.instId}"
					rendered="${empty(showInstitution) or showInstitution}"
					>
				<f:selectItem itemValue=""/>
				<f:selectItems value="#{MbCyclesSearch.institutions}"/>
			</h:selectOneMenu>
		</h:panelGrid>
	</h:panelGroup>

	<rich:extendedDataTable
			id="shitfsTable"
			var="shift"
			value="#{MbCycleShiftsSearch.cycleShifts}"
			selection="#{MbCycleShiftsSearch.itemSelection}"
			rows="0"
			height="150px"
			selectionMode="single"
			rowClasses=",odd"
			headerClass="res-table-header"
			selectedClass="res-table-selected" 
			styleClass="res-table"
			enableContextMenu="false"
			noDataLabel="#{lblCommon['no_records_found']}">

		<a4j:support event="onselectionchange" requestDelay="500"
                 	reRender="btns_shift" />

		<rich:column title="Shift type" width="25%" sortBy="#{'shiftType'}">
			<f:facet name="header">
				<h:outputText value="#{lblFcl.shift_type}" title="#{lblFcl.shift_type}" />
			</f:facet>
			<h:outputText value="#{DictUtils.articles[shift.shiftType]}"  title="#{DictUtils.articles[shift.shiftType]}"/>
		</rich:column>
		
		<rich:column title="Priority" width="14%" sortBy="#{'priority'}">
			<f:facet name="header">
				<h:outputText value="#{lblFcl.priority}" title="#{lblFcl.priority}" />
			</f:facet>
			<h:outputText value="#{shift.priority}" />
		</rich:column>
		
		<rich:column title="Shift sign" width="14%">
			<f:facet name="header">
				<h:outputText value="#{lblFcl.shift_sign}" title="#{lblFcl.shift_sign}" />
			</f:facet>
			<h:outputText value="#{shift.shiftLiteralSign}" />
		</rich:column>
		
		<rich:column title="Length type" width="20%" sortBy="#{'lengthType'}">
			<f:facet name="header">
				<h:outputText value="#{lblFcl.length_type}" title="#{lblFcl.length_type}" />
			</f:facet>
			<h:outputText value="#{DictUtils.articles[shift.lengthType]}"  title="#{DictUtils.articles[shift.lengthType]}"/>
		</rich:column>

		<rich:column title="Shift length" width="14%" styleClass="tab_res_last">
			<f:facet name="header">
                   <h:outputText value="#{lblFcl.shift_length}" title="#{lblFcl.shift_length}" />
			</f:facet>
			<h:outputText value="#{shift.shiftLength}" />
		</rich:column>

    </rich:extendedDataTable>
	    
    <h:panelGroup layout="block" styleClass="bottom_search_result_block_buttons">
		<h:panelGroup layout="block" styleClass="bottom_search_result_left_buttons">
	        <h:panelGrid columns="3" id="btns_shift" style="vertical-align: top;" cellpadding="0" cellspacing="0">
		        <h:panelGroup styleClass="stdButton" rendered="${renderBtns}">
	                <bre:taggedCommandButton id="btn_add_cycle_shift"
	                        image="/images/create_doc.gif" value="#{lblForm.add}"
	                        action="#{MbCycleShiftsSearch.add}"
	                       	disabled="#{MbCycleShiftsSearch.cycleId == null or MbCycleShiftsSearch.disableAll}"
	                       	immediate="true" limitToList="true"
                   			reRender="fcl_cycle_shift_modal_div, fcl_cycle_shift_modal_header"
                   			oncomplete="#{rich:component('fcl_cycle_shift_modal_panel')}.show()"
	                		>											
	            	</bre:taggedCommandButton>
                </h:panelGroup>
               	<h:panelGroup styleClass="midButton" rendered="${renderBtns}">    
                    <bre:taggedCommandButton id="btn_edit_cycle_shift"
                       		image="/images/edit.gif" value="#{lblForm.edit}"
                       		action="#{MbCycleShiftsSearch.edit}"
                       		disabled="#{MbCycleShiftsSearch.activeCycleShift == null or MbCycleShiftsSearch.disableAll}"
                       		immediate="true" limitToList="true"
                   			reRender="fcl_cycle_shift_modal_div, fcl_cycle_shift_modal_header"
                   			oncomplete="#{rich:component('fcl_cycle_shift_modal_panel')}.show()"
                       		>											
                	</bre:taggedCommandButton>
           		</h:panelGroup>
           		<h:panelGroup styleClass="stdButton" rendered="${renderBtns}">
                    <bre:taggedCommandButton id="btn_delete_cycle_shift"
                       		image="/images/delete.gif" value="#{lblForm.delete}"
                       		action="#{MbCycleShiftsSearch.delete}"
                       		disabled="#{MbCycleShiftsSearch.activeCycleShift == null or MbCycleShiftsSearch.disableAll}"
                       		immediate="true" limitToList="true"
                       		onclick="if (!confirm('#{lblMsg.confirm_delete}')) return false;"
                   			reRender="shitfsTable, btns_shift"				                    			
                       		>											
                	</bre:taggedCommandButton>
           		</h:panelGroup>
	    	</h:panelGrid>
		</h:panelGroup>
	</h:panelGroup>

</ui:composition>
</html>
