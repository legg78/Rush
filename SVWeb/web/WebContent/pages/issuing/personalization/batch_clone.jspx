<?xml version="1.0" encoding="UTF-8"?>
<html	xmlns="http://www.w3.org/1999/xhtml"
         xmlns:f="http://java.sun.com/jsf/core"
         xmlns:h="http://java.sun.com/jsf/html"
         xmlns:ui="http://java.sun.com/jsf/facelets"
         xmlns:a4j="http://richfaces.org/a4j"
         xmlns:rich="http://richfaces.org/rich"
         xmlns:bm="http://www.bpc.ru/jsf/misc"
         xmlns:bre="http://www.bpc.ru/jsf/richfaces-ext">
<ui:composition>
<rich:modalPanel id="prsBatchCloneModalPanel" autosized="true" minWidth="600" minHeight="280">

<f:facet name="header">
    <h:panelGroup id="prsBatchCloneModalHeader">
        <h:outputText value="#{lblForm.clone}" />
    </h:panelGroup>
</f:facet>
<f:facet name="controls">

</f:facet>


<h:form id="prsBatchCloneForm">

    <rich:panel style="margin:10px;border: 0px;">

        <h:panelGrid columns="2" styleClass="cardholderdata" width="100%" columnClasses="firstColModal,">
            <h:outputLabel value="* #{lblCommon.name}: " title="#{lblCommon.name}"/>
            <h:inputText id="name" value="#{MbPersoBatchesSearch.clonedBatchName}"
                         label="#{lblCommon.name}"
                         maxlength="200">
                <a4j:support event="onkeyup" reRender="cloneBtns" limitToList="true" />
                <a4j:support event="onchange" reRender="cloneBtns" limitToList="true" />
            </h:inputText>

            <h:outputLabel for="cloningOptionsSelect" value="#{lblPrs.select_cloning_options}: " title="#{lblCommon.select_cloning_options}"/>
            <h:selectOneMenu id="cloningOptionsSelect" value="#{MbPersoBatchesSearch.cloningOption}"
                             valueChangeListener="#{MbPersoBatchesSearch.changeCloningOption}">
                <a4j:support event="onchange" reRender="persoCardsTable, cloneBtns"
                             actionListener="#{MbPersoBatchesSearch.changeCloningOption}"/>
                <f:selectItems value="#{MbPersoBatchesSearch.cloningOptions}"/>
            </h:selectOneMenu>
            
            <h:outputLabel value="* #{lblPrs.pin_request}:" title="#{lblPrs.pin_request}"/>
            <h:selectOneMenu value="#{MbPersoBatchesSearch.pinRequest}"  style="width: 100%;">
            	<a4j:support event="onchange" reRender="cloneBtns" limitToList="true" />
				<f:selectItems value="#{MbPersoBatchesSearch.pinRequests}" />							
			</h:selectOneMenu>
			
			<h:outputLabel value="* #{lblPrs.pin_mailer_request}:" title="#{lblPrs.pin_mailer_request}"/>
			<h:selectOneMenu value="#{MbPersoBatchesSearch.pinMailerRequest}"  style="width: 100%;">
				<a4j:support event="onchange" reRender="cloneBtns" limitToList="true" />
				<f:selectItems value="#{MbPersoBatchesSearch.pinMailerRequests}" />							
			</h:selectOneMenu>
			
			<h:outputLabel value="* #{lblPrs.embossing_request}:" title="#{lblPrs.embossing_request}"/>
			<h:selectOneMenu value="#{MbPersoBatchesSearch.embossingRequest}"  style="width: 100%;">
				<a4j:support event="onchange" reRender="cloneBtns" limitToList="true" />
				<f:selectItems value="#{MbPersoBatchesSearch.embossingRequests}" />							
			</h:selectOneMenu>
            
        </h:panelGrid>

    </rich:panel>

    <rich:panel style="margin:10px;">
        <rich:extendedDataTable
            id="persoCardsTable"
            var="item"
            value="#{MbPersoBatchesSearch.batchCloneCandidateCards}"
            rows="0"
            height="190px"
            selectionMode="none"
            rowClasses=",odd"
            headerClass="res-table-header"
            selectedClass="res-table-selected"
            styleClass="res-table"
            enableContextMenu="false"
            noDataLabel="#{lblCommon['no_records_found']}">

            <rich:column title="" styleClass="tab_res_first" width="10%" >
                <f:facet name="header">
                    <h:outputText value="" title="" />
                </f:facet>
                <h:selectBooleanCheckbox disabled="false"
                                         rendered="#{ (MbPersoBatchesSearch.cloningOption == 3 and MbPersoBatchesSearch.checkedCardCount == 2  and item.checked)
                                                    or (MbPersoBatchesSearch.cloningOption == 3 and MbPersoBatchesSearch.checkedCardCount lt 2)
                                                    or (MbPersoBatchesSearch.cloningOption == 4 and MbPersoBatchesSearch.checkedCardCount == 1  and item.checked)
                                                    or (MbPersoBatchesSearch.cloningOption == 4 and MbPersoBatchesSearch.checkedCardCount lt 1)
                                                    or (MbPersoBatchesSearch.cloningOption == 2)}"
                                         value="#{item.checked}">
                    <a4j:support event="onchange" reRender="prsBatchCloneForm"
                                 actionListener="#{MbPersoBatchesSearch.checkCardAction}"/>
                </h:selectBooleanCheckbox>
            </rich:column>

            <rich:column title="mask" width="25%">
                <f:facet name="header">
                    <h:outputText value="#{lblPrs.mask}" title="#{lblPrs.mask}" />
                </f:facet>
                <h:outputText value="#{item.cardMask}" title="#{item.cardMask}"/>
            </rich:column>

            <rich:column title="cardholder" width="65%">
                <f:facet name="header">
                    <h:outputText value="#{lblPrs.cardholder}" title="#{lblPrs.cardholder}" />
                </f:facet>                <h:outputText value="#{item.cardholderName}" title="#{item.cardholderName}"/>
            </rich:column>

        </rich:extendedDataTable>
    </rich:panel>

    <h:panelGroup layout="block" styleClass="bottom_search_result_block_buttons">
        <h:panelGroup layout="block" styleClass="bottom_search_result_left_buttons">
            <h:panelGrid columns="3" id="cloneBtns" columnClasses="width99P,,paddingR12">
                <h:outputText/>
                <bre:taggedCommandButton value="#{lblForm.clone}"
                                         action="#{MbPersoBatchesSearch.cloneBatch}"
                                         disabled="#{(MbPersoBatchesSearch.activeBatch == null) or (MbPersoBatchesSearch.clonedBatchNameLength lt 3)
                                                    or (MbPersoBatchesSearch.cloningOption == 3 and MbPersoBatchesSearch.checkedCardCount != 2)
                                                    or (MbPersoBatchesSearch.cloningOption == 4 and MbPersoBatchesSearch.checkedCardCount != 1)
                                                    or (MbPersoBatchesSearch.cloningOption == 2 and MbPersoBatchesSearch.checkedCardCount == 0)
                                                    or (MbPersoBatchesSearch.pinRequest == null) or (MbPersoBatchesSearch.pinMailerRequest == null)
                                                    or (MbPersoBatchesSearch.embossingRequest == null)}"
                                         reRender="#{rerenderList}"
                                         onclick="disableModalPanelBtns(this);"
                                         oncomplete="if (#{usession.noErrorResponse}) #{rich:component('prsBatchCloneModalPanel')}.hide();enableModalPanelBtns(this)"
                                         eventsQueue="queue"/>
                <bre:taggedCommandButton
                        value="#{lblForm.cancel}" action="#{MbPersoBatchesSearch.cancel}"
                        immediate="true" limitToList="true"
                        oncomplete="#{rich:component('prsBatchCloneModalPanel')}.hide()" />
            </h:panelGrid>
        </h:panelGroup>
    </h:panelGroup>
</h:form>

</rich:modalPanel>
</ui:composition>
</html>