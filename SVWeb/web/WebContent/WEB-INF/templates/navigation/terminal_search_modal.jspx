<?xml version="1.0" encoding="UTF-8"?>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://java.sun.com/jsf/core"
	xmlns:a4j="http://richfaces.org/a4j" xmlns:rich="http://richfaces.org/rich"
	xmlns:bm="http://www.bpc.ru/jsf/misc" xmlns:bre="http://www.bpc.ru/jsf/richfaces-ext">

<ui:composition>
	<script type="text/javascript">
	//<![CDATA[
	
	function checkFieldsTerminal() {
		var instIdEl = document.getElementById("customerForm:instId");
		if (instIdEl.value == null || instIdEl.value == "") {
			instIdEl.style.backgroundColor = "#FF9999";
			instIdEl.focus();
			return false;
		} else {
			instIdEl.style.backgroundColor = "#FFFFFF";
		}
		return true;
	}
	
	function checkFieldsMerchant() {
		var instIdEl = document.getElementById("merchantForm:instId");
		if (instIdEl.value == null || instIdEl.value == "") {
			instIdEl.style.backgroundColor = "#FF9999";
			instIdEl.focus();
			return false;
		} else {
			instIdEl.style.backgroundColor = "#FFFFFF";
		}
		return true;
	}

	function checkFieldsTerminal() {
		var instIdEl = document.getElementById("terminalsSearchModalFilterForm:instId");
		if (instIdEl.value == null || instIdEl.value == "") {
			instIdEl.style.backgroundColor = "#FF9999";
			instIdEl.focus();
			return false;
		} else {
			instIdEl.style.backgroundColor = "#FFFFFF";
		}
		return true;
	}
	
	function checkFieldsAddress() {			
		var instIdEl = document.getElementById("addressForm:instId");
		if (instIdEl.value == null || instIdEl.value == "") {
			instIdEl.style.backgroundColor = "#FF9999";
			instIdEl.focus();
			return false;
		} else {
			instIdEl.style.backgroundColor = "#FFFFFF";
		}
		
		return true;
	}
	
	function setCustomerNumber() {
		var value = document.getElementById('${customerHiddenField}').value;
		document.getElementById('${customerField}').value = value;
	}
	
	// clear text when alrady loaded customer infos
	function clearTextTerminal(formName) {
		var custInfo = document.getElementById(formName + ":terminalInfo").value;
		var custNumHidden = document.getElementById(formName + ":terminalNumberHidden").value;
		var custIdHidden = document.getElementById(formName + ":terminalIdHidden");
		if (custInfo != custNumHidden) {
			document.getElementById(formName + ":terminalInfo").value = "";
			document.getElementById(formName + ":terminalNumberHidden").value = "";
			if (custIdHidden != null) {
				custIdHidden.value = "";
			}
		}
	}	
	// check customer number before searching in case onblur function have not worked yet!
	function checkTerminalNumber(formName) {
		var custInfo = document.getElementById(formName + ":terminalInfo").value;
		var custNumHidden = document.getElementById(formName + ":terminalNumberHidden").value;
		var custNumId = document.getElementById(formName + ":terminalIdHidden").value;
		if (custInfo != "" && custNumHidden == "") {
			document.getElementById(formName + ":terminalNumberHidden").value = custInfo;
			document.getElementById(formName + ":terminalIdHidden").value = "";
		}
	}
	//]]>
	</script>

	<f:loadBundle var="lblApp" basename="ru.bpc.sv2.ui.bundles.App" />
	<f:loadBundle var="lblAcq" basename="ru.bpc.sv2.ui.bundles.Acq" />

	<rich:modalPanel id="terminalSearchModalPanel" autosized="true" minWidth="900" minHeight="200">
		<f:facet name="header">
			<h:outputText value="#{lblAcq.terminals}" />
		</f:facet>
		<f:facet name="controls">
		</f:facet>

		<!-- search panel -->
		<h:panelGroup layout="block" styleClass="search_block">
			<h:panelGroup layout="block" styleClass="search_block_tab">
				<h:panelGroup layout="block" styleClass="search_block_inner search_block_inner-hidden">

					<a4j:form id="terminalsSearchModalFilterForm">
						<h:panelGrid styleClass="fw" columns="2" columnClasses="top ,link-cont">
							<a4j:outputPanel id="terminalPanel">
								<h:panelGrid styleClass="filter-table field-cont twoColumnTable" columns="4"
									columnClasses="firstCol,secondCol,firstCol,secondCol">
									<h:outputLabel for="instId" value="#{lblCommon.institution}: "
										title="#{lblCommon.institution}" />
									<h:selectOneMenu id="instId" value="#{MbTerminalSearchModal.filter.instId}">
										<f:selectItem itemValue="" />
										<f:selectItems value="#{MbTerminalSearchModal.institutions}" />
									</h:selectOneMenu>
									
									<h:outputLabel for="merchantNumberFilter" value="#{lblAcq.merchant_number}: "
										title="#{lblAcq.merchant_number}" />
									<h:inputText id="merchantNumberFilter"
										value="#{MbTerminalSearchModal.filter.merchantNumber}" />

									<h:outputLabel for="numberFilter" value="#{lblAcq.terminal_number}: "
										title="#{lblAcq.terminal_number}" />
									<h:inputText id="numberFilter" value="#{MbTerminalSearchModal.filter.terminalNumber}" />
										
									<h:outputLabel for="merchantNameFilter" value="#{lblAcq.merchant_name}: "
										title="#{lblAcq.merchant_name}" />
									<h:inputText id="merchantNameFilter"
										value="#{MbTerminalSearchModal.filter.merchantName}" />

								</h:panelGrid>
							</a4j:outputPanel>
							<h:panelGrid columns="1">
								<bre:taggedCommandButton eventsQueue="queue"
									action="#{MbTerminalSearchModal.searchByTerminal}"
									onclick="if (!checkFieldsTerminal()) {return false;} disableModalPanelBtns(this);"
									oncomplete="enableModalPanelBtns(this);"
									reRender="terminalSearchModalForm"
									image="/_img/icon_search.png" type="submit" value="#{lblForm.search}" style="width:85px;">
								</bre:taggedCommandButton>
								<h:panelGrid columns="1">
									<h:panelGroup styleClass="link-clear" layout="block">
										<h:graphicImage url="/_img/icon_clear.png" />
										<a4j:commandLink value="#{lblForm.clear_all}"
											action="#{MbTerminalSearchModal.clearFilter}"
											reRender="terminalsSearchModalFilterForm, terminalSearchModalForm">
										</a4j:commandLink>
									</h:panelGroup>
								</h:panelGrid>
							</h:panelGrid>
						</h:panelGrid>

					</a4j:form>
				</h:panelGroup>
			</h:panelGroup>
		</h:panelGroup>

		<h:form id="terminalSearchModalForm">

			<rich:extendedDataTable id="terminalsTable" tableState="#{MbTerminalSearchModal.tableState}"
				styleClass="res-table" headerClass="res-table-header" rowClasses=",odd"
				selectedClass="res-table-selected" var="item" value="#{MbTerminalSearchModal.terminals}"
				selection="#{MbTerminalSearchModal.itemSelection}" rows="#{MbTerminalSearchModal.rowsNum}"
				height="255px" selectionMode="single" width="100%" enableContextMenu="true"
				noDataLabel="#{MbTerminalSearchModal.searching?lblCommon['no_records_found'] : lblCommon['enter_search_criteria_above']}">

				<rich:column id="terminal_number" label="#{lblAcq.terminal_number}" title="Terminal number"
					sortBy="#{'terminalNumber'}" width="15%">
					<f:facet name="header">
						<h:outputText value="#{lblAcq.terminal_number}" title="#{lblAcq.terminal_number}" />
					</f:facet>
					<h:outputText value="#{item.terminalNumber}" title="#{item.terminalNumber}" />
				</rich:column>
				
				<rich:column id="terminal_name" label="#{lblAcq.terminal}" title="Terminal name"
					sortBy="#{'terminalNumber'}" width="40%">
					<f:facet name="header">
						<h:outputText value="#{lblAcq.terminal}" title="#{lblAcq.terminal_number}" />
					</f:facet>
					<h:outputText value="#{item.terminalName}" title="#{item.terminalName}" />
				</rich:column>

				<rich:column id="terminal_type" label="#{lblAcq.terminal_type}" title="Terminal type"
					width="15%">
					<f:facet name="header">
						<h:outputText value="#{lblAcq.terminal_type}" title="#{lblAcq.terminal_type}" />
					</f:facet>
					<h:outputText value="#{DictUtils.articles[item.terminalType]}"
						title="#{DictUtils.articles[item.terminalType]}" />
				</rich:column>

				<rich:column id="merchant" label="#{lblAcq.merchant}" title="Merchant" width="25%"
					>
					<f:facet name="header">
						<h:outputText value="#{lblAcq.merchant}" title="#{lblAcq.merchant}" />
					</f:facet>
					
					<h:outputText value="#{item.merchantName}" title="#{item.merchantName}" />
				</rich:column>

			</rich:extendedDataTable>

			<h:panelGroup layout="block" styleClass="bottom_search_result_block_buttons">
				<h:panelGroup layout="block" styleClass="bottom_search_result_left_buttons">
					<h:panelGrid columns="3" columnClasses="width99P,,paddingR12">
						<h:outputText />
						<bre:taggedCommandButton id="selectBtn" value="#{lblApp.select}"
							action="#{viewScope[MbTerminalSearchModal.beanName][MbTerminalSearchModal.methodName]}"
							reRender="${MbTerminalSearchModal.rerenderList}"
							oncomplete="if (#{usession.noErrorResponse}) Richfaces.hideModalPanel('terminalSearchModalPanel');" />
						<bre:taggedCommandButton value="#{lblForm.cancel}" immediate="true" limitToList="true"
							oncomplete="Richfaces.hideModalPanel('terminalSearchModalPanel')" />
					</h:panelGrid>
				</h:panelGroup>
			</h:panelGroup>


		</h:form>
	</rich:modalPanel>

</ui:composition>
</html>
