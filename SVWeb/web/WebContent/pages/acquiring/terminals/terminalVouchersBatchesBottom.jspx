<?xml version="1.0" encoding="UTF-8"?>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:bm="http://www.bpc.ru/jsf/misc"
	xmlns:bre="http://www.bpc.ru/jsf/richfaces-ext">
<ui:composition>
	<f:loadBundle var="lblVch" basename="ru.bpc.sv2.ui.bundles.Vch" />

	<h:form id="voucherBatchesForm">
		<h:panelGroup id="voucherBatchesTableWrapper" layout="block"
			style="padding:0px;margin:0px;">
			<rich:extendedDataTable id="VouchersBatchTable"
				styleClass="res-table" headerClass="res-table-header table-header-ext"
				rowClasses=",odd" selectedClass="res-table-selected" var="item"
				value="#{(voucherBean==null ? MbVouchersBatches : voucherBean).dataModel}"
				selection="#{(voucherBean==null ? MbVouchersBatches : voucherBean).itemSelection}"
				rows="#{(voucherBean==null ? MbVouchersBatches : voucherBean).rowsNum}" 
				selectionMode="single" enableContextMenu="true"
				tableState="#{(voucherBean==null ? MbVouchersBatches : voucherBean).tableState}"
				noDataLabel="#{lblCommon.no_records_found}">

				<a4j:support event="onselectionchange" requestDelay="500"
					reRender="btnPanel" />

				<rich:column id="status" label="#{lblCommon.status}" title="Status" sortBy="#{'status'}" width="20%">
					<f:facet name="header">
						<h:panelGroup>
						<script>
							updateHeight();
						</script>
						<h:outputText value="#{lblCommon.status}" title="#{lblCommon.status}" />
						</h:panelGroup>
					</f:facet>
					<h:outputText value="#{DictUtils.articles[item.status]}" title="#{DictUtils.articles[item.status]}" />
				</rich:column>

				<rich:column id="total_amount" label="#{lblVch.total_amount}" title="Total Amount" sortBy="#{'totalAmount'}"
					width="14%">
					<f:facet name="header">
						<h:outputText value="#{lblVch.total_amount}"
							title="#{lblVch.total_amount}" />
					</f:facet>
					<h:outputText value="#{item.totalAmount}"
						title="#{item.totalAmount}" readonly="true"
						converter="bpc.CurrencyConverter">
						<f:attribute name="exponent"
							value="#{CurrencyUtils.currencyObjectsMap[item.currency].exponent}" />
					</h:outputText>
				</rich:column>

				<rich:column id="currency" label="#{lblCommon.currency}" title="Currency" sortBy="#{'currency'}" width="14%">
					<f:facet name="header">
						<h:outputText value="#{lblCommon.currency}"
							title="#{lblCommon.currency}" />
					</f:facet>
					<div class="#{EntityIcons.objectsMapS['ENTT0046'][item.currency]}"/>
					<h:outputText value="#{CurrencyUtils.currencyMap[item.currency]}"
						title="#{CurrencyUtils.currencyMap[item.currency]}" />
				</rich:column>

				<rich:column id="total_count" label="#{lblVch.total_count}" title="Total Count" sortBy="#{'totalCount'}"
					width="14%">
					<f:facet name="header">
						<h:outputText value="#{lblVch.total_count}"
							title="#{lblVch.total_count}" />
					</f:facet>
					<h:outputText value="#{item.totalCount}" title="#{item.totalCount}" />
				</rich:column>

				<rich:column id="reg_date" label="#{lblVch.reg_date}" title="Reg Date" sortBy="#{'regDate'}" width="14%">
					<f:facet name="header">
						<h:outputText value="#{lblVch.reg_date}"
							title="#{lblVch.reg_date}" />
					</f:facet>
					<h:outputText value="#{item.regDate}" title="#{item.regDate}">
						<f:convertDateTime pattern="#{usession.datePattern}"
							timeZone="#{CommonUtils.timeZone}" />
					</h:outputText>
				</rich:column>

				<rich:column id="user_name" label="#{lblVch.user_name}" title="User Name" sortBy="#{'userName'}" width="14%">
					<f:facet name="header">
						<h:outputText value="#{lblVch.user_name}" title="#{lblVch.user_name}" />
					</f:facet>
					<h:outputText value="#{item.userName}" title="#{item.userName}" />
				</rich:column>

			</rich:extendedDataTable>
		</h:panelGroup>

		<h:panelGroup layout="block"
			styleClass="bottom_search_result_block_buttons">
			<h:panelGroup layout="block"
				styleClass="bottom_search_result_left_buttons" rendered="#{voucherBean==null}">
				<h:panelGrid id="btnPanel" styleClass="fw buttons_block" columns="2" columnClasses=", table_tools_state">
					<h:panelGroup>
					<bre:taggedCommandButton id="addBtn"
						reRender="vouchersBatchEditModalPanel"
						value="#{lblForm.add}"
						oncomplete="#{rich:component('vouchersBatchEditModalPanel')}.show()"
						action="#{MbVouchersBatches.createNewVouchersBatch}"
						disabled="#{MbVouchersBatches.filter.terminalId == null}"
						image="/images/create_doc.gif" />
					<bre:taggedCommandButton id="editBtn"
						reRender="vouchersBatchEditModalPanel"
						action="#{MbVouchersBatches.editActiveVouchersBatch}" value="#{lblForm.edit}"
						oncomplete="#{rich:component('vouchersBatchEditModalPanel')}.show()"
						disabled="#{MbVouchersBatches.activeItem == null}"
						image="/images/edit.gif" />
					<bre:taggedCommandButton id="deleteBtn"
						value="#{lblForm.delete}"
						disabled="#{MbVouchersBatches.activeItem == null}"
						image="/images/delete.gif"
						oncomplete="#{rich:component('deleteVoucherView:confirmPanel')}.show()"/>
					</h:panelGroup>
					
					<h:panelGroup>
						<h:graphicImage url="/images/green-tick.png" title="#{lblCommon.save_table_state}" styleClass="action_icon"
							onclick="saveVoucherTableState();"/>
						<h:graphicImage url="/images/red-cross.png" title="#{lblCommon.delete_table_state}" styleClass="action_icon"
							onclick="deleteVoucherTableState();"/>
						<a4j:queue name="tablestatequeue"/>
						<a4j:jsFunction name="saveVoucherTableState" action="#{MbVouchersBatches.saveTableStateDB}" eventsQueue="tablestatequeue"/>
						<a4j:jsFunction name="deleteVoucherTableState" action="#{MbVouchersBatches.deleteTableStateDB}" eventsQueue="tablestatequeue"/>
					</h:panelGroup>
				</h:panelGrid>
			</h:panelGroup>
		</h:panelGroup>
	</h:form>	

	<ui:include src="/pages/vch/vouchersBatchEditModalPanel.jspx">
		<ui:param name="reRender" value="voucherBatchesForm"></ui:param>
	</ui:include>	
	
	<ui:include src="/pages/utils/confirmPanel.jspx">
		<ui:param name="backingBean" value="#{MbVouchersBatches}"/>
		<ui:param name="yesAction" value="deleteActiveVouchersBatch"/>
		<ui:param name="warningMsg" value="#{lblMsg.confirm_delete}"/> 
		<ui:param name="rerenderList" value="voucherBatchesForm"/>
		<ui:param name="confirmQuestion" value=" "/> 
		<ui:param name="subviewId" value="deleteVoucherView"/>
		<ui:param name="yes" value="#{lblForm.ok}"/>
		<ui:param name="no" value="#{lblForm.cancel}"/>
	</ui:include>
</ui:composition>
</html>
