<?xml version="1.0" encoding="UTF-8"?>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:bm="http://www.bpc.ru/jsf/misc"
	xmlns:bre="http://www.bpc.ru/jsf/richfaces-ext">
<ui:composition>

	<h:form id="prodAccountTypesForm">
		<h:panelGroup id="accountTypeTableWrapper" layout="block"
			style="padding:0px;margin:0px;">
			<rich:extendedDataTable headerClass="res-table-header table-header-ext"
				selectedClass="res-table-selected" styleClass="res-table"
				rowClasses=",odd" id="mainTable" var="item"
				value="#{(accountTypesBean==null ? MbProductAccountType : accountTypesBean).dataModel}"
				selection="#{(accountTypesBean==null ? MbProductAccountType : accountTypesBean).itemSelection}" rows="0"
				height="220px" selectionMode="single" enableContextMenu="true"
				tableState="#{(accountTypesBean==null ? MbProductAccountType : accountTypesBean).tableState}"
				noDataLabel="#{lblCommon['no_records_found']}">
				<a4j:support event="onchange" requestDelay="500"
								reRender="btnsBlockAccount" />
				
				<rich:column id="id" label="#{lblCommon.id}" title="Id" sortBy="#{'id'}" width="8%">
					<f:facet name="header">
						
						<a4j:outputPanel layout="none">
								<script>if(window['updateHeight'])updateHeight();</script>
								<h:outputText value="#{lblCommon.id}" title="#{lblCommon.id}" />
															
						</a4j:outputPanel>
						
					</f:facet>
					<bm:entityDisplay value="#{item.id}" />
				</rich:column>
				
				<rich:column id="product_id" label="#{lblAcq.product_id}" title="Product id" sortBy="#{'productId'}" width="15%">
					<f:facet name="header">
						<h:outputText value="#{lblAcq.product_id}"
							title="#{lblAcq.product_id}" />
					</f:facet>
					<bm:entityDisplay entityId="#{item.productId}" 
							value="#{(accountTypesBean==null ? MbProductAccountType : accountTypesBean).prodName}"/>
				</rich:column>

				<rich:column id="account_type" label="#{lblAcq.account_type}" title="Account Type" sortBy="#{'accountType'}" width="20%" >
					<f:facet name="header">
						<h:outputText value="#{lblAcq.account_type}" title="#{lblAcq.account_type}"/>
					</f:facet>
					<bm:entityDisplay value="#{DictUtils.articles[item.accountType]}"/>
					
				</rich:column>
								
				<rich:column id="service" label="#{lblPrd.service}" title="Service" sortBy="#{'serviceId'}" width="20%">
					<f:facet name="header">
						<h:outputText value="#{lblPrd.service}" title="#{lblPrd.service}" />
					</f:facet>
					<bm:entityDisplay value="#{item.serviceId}-#{item.serviceName}" />
				</rich:column>

				<rich:column id="currency" label="#{lblAcc.currency}" title="currency" sortBy="#{'currency'}" width="17%">
					<f:facet name="header">
						<h:outputText value="#{lblAcc.currency}" title="#{lblAcc.currency}" />
					</f:facet>
					<bm:entityDisplay entityId="#{item.currency}" value="#{CurrencyUtils.currencyMap[item.currency]}"
			         	description="#{CurrencyUtils.currencyMap[item.currency]}" 
			         	entityName="ENTT0046" showIcon="true" displayOrders="LVAPNAME"/>
			         	
					<ui:remove><div class="#{EntityIcons.objectsMapS['ENTT0046'][item.currency]}"/>
					<h:outputText value="#{CurrencyUtils.currencyMap[item.currency]}"
						title="#{item.currency}" /></ui:remove>
				</rich:column>
				
				<rich:column id="algorithm" label="#{lblCommon.algorithm}" title="Aval algorithm" width="20%" >
					<f:facet name="header">
						<h:outputText value="#{lblCommon.algorithm}" title="#{lblAcc.aval_algorithm}"/>
					</f:facet>
					<bm:entityDisplay value="#{DictUtils.articles[item.avalAlgorithm]}" />
					
				</rich:column>
			</rich:extendedDataTable>	
			
		</h:panelGroup>
		
		<h:panelGroup layout="block" styleClass="bottom_search_result_block_buttons">
			<h:panelGroup layout="block" rendered="#{accountTypesBean==null}"
				styleClass="bottom_search_result_left_buttons">
				<h:panelGrid id="btnsBlockAccount" styleClass="fw buttons_block" columns="2" columnClasses=", table_tools_state">
					<h:panelGroup>
					<bre:taggedCommandButton id="addBtn"
						oncomplete="#{rich:component('productAccountTypeModalPanel')}.show()"
						disabled="#{MbProducts.node.id == null}"
						action="#{MbProductAccountType.add}"
						reRender="productAccountTypeModalHeader, productAccountTypeModalDiv"
						value="#{lblForm.add}"
						image="/images/create_doc.gif" 
						/>
					<bre:taggedCommandButton id="editBtn"
						oncomplete="#{rich:component('productAccountTypeModalPanel')}.show()"
						reRender="productAccountTypeModalHeader, productAccountTypeModalDiv"
						action="#{MbProductAccountType.edit}"
						value="#{lblForm.edit}"
						disabled="#{MbProductAccountType.activeItem == null}"
						image="/images/edit.gif" 
						/>
					<bre:taggedCommandButton id="deleteBtn"
						value="#{lblForm.delete}"
						disabled="#{MbProductAccountType.activeItem == null}"
						image="/images/delete.gif" 
						oncomplete="#{rich:component('deleteAccTypeView:confirmPanel')}.show()"/>
					</h:panelGroup>
					<h:panelGroup>
						<h:graphicImage url="/images/green-tick.png" title="#{lblCommon.save_table_state}" styleClass="action_icon"
							onclick="saveAccTypeTableState();"/>
						<h:graphicImage url="/images/red-cross.png" title="#{lblCommon.delete_table_state}" styleClass="action_icon"
							onclick="deleteAccTypeTableState();"/>
						<a4j:queue name="tablestatequeue"/>
						<a4j:jsFunction name="saveAccTypeTableState" action="#{MbProductAccountType.saveTableStateDB}" eventsQueue="tablestatequeue"/>
						<a4j:jsFunction name="deleteAccTypeTableState" action="#{MbProductAccountType.deleteTableStateDB}" eventsQueue="tablestatequeue"/>
					</h:panelGroup>
				</h:panelGrid>
			</h:panelGroup>
		</h:panelGroup>
	</h:form>
	
	<ui:include src="/pages/products/product_account_type_edit.jspx"/>
	
	<ui:include src="/pages/utils/confirmPanel.jspx">
		<ui:param name="backingBean" value="#{MbProductAccountType}"/>
		<ui:param name="yesAction" value="delete"/>
		<ui:param name="warningMsg" value="#{lblMsg.confirm_delete}"/> 
		<ui:param name="rerenderList" value="prodAccountTypesForm"/>
		<ui:param name="confirmQuestion" value=" "/> 
		<ui:param name="subviewId" value="deleteAccTypeView"/>
		<ui:param name="yes" value="#{lblForm.ok}"/>
		<ui:param name="no" value="#{lblForm.cancel}"/>
	</ui:include>

</ui:composition>
</html>
