<?xml version="1.0" encoding="UTF-8"?>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:bre="http://www.bpc.ru/jsf/richfaces-ext"
	xmlns:c="http://java.sun.com/jstl/core"
	xmlns:bm="http://www.bpc.ru/jsf/misc">
<ui:composition>

	<h:form id="serviceObjectsForm">
		<h:panelGroup id="serviceObjectsTableWrapper" layout="block"
			style="padding:0px;margin:0px;">
			<rich:extendedDataTable id="serviceObjectsTable" var="item"
				value="#{(servicesBean==null ? MbServiceObjects : servicesBean).serviceObjects}"
				selection="#{(servicesBean==null ? MbServiceObjects : servicesBean).itemSelection}"
				rows="#{(servicesBean==null ? MbServiceObjects : servicesBean).rowsNum}" height="220px"
				selectionMode="single" rowClasses=",odd"
				headerClass="res-table-header table-header-ext" selectedClass="res-table-selected"
				styleClass="res-table" enableContextMenu="true"
				tableState="#{(servicesBean==null ? MbServiceObjects : servicesBean).tableState}"
				noDataLabel="#{lblCommon['no_records_found']}"
				onRowMouseDown="handleMouseClick(event)">

				<a4j:support event="onselectionchange" requestDelay="500"
					limitToList="true" />


				<rich:column id="service" label="#{lblPrd.service}" sortBy="#{'serviceName'}" width="40%">
					<f:facet name="header">
						<h:panelGroup>
							<script>
								updateHeight();
							</script>
							<h:outputText value="#{lblPrd.service}" title="#{lblPrd.service}" />
						</h:panelGroup>
					</f:facet>
					<bm:entityDisplay link="true" contextType="ENTTSRVC" bean="#{(servicesBean==null ? MbServiceObjects : servicesBean).class.name}" entityId="#{item.serviceId}" value= "#{item.serviceName}" />
				</rich:column>

				<rich:column id="start_date" label="#{lblCommon.start_date}" sortBy="#{'startDate'}" width="15%">
					<f:facet name="header">
						<h:outputText value="#{lblCommon.start_date}"
							title="#{lblCommon.start_date}" />
					</f:facet>
					<h:outputText value="#{item.startDate}" title="#{item.startDate}">
						<f:convertDateTime pattern="#{usession.datePattern}"
							timeZone="#{CommonUtils.timeZone}" />
					</h:outputText>
				</rich:column>

				<rich:column id="end_date" label="#{lblCommon.end_date}" sortBy="#{'endDate'}" width="15%">
					<f:facet name="header">
						<h:outputText value="#{lblCommon.end_date}"
							title="#{lblCommon.end_date}" />
					</f:facet>
					<h:outputText value="#{item.endDate}" title="#{item.endDate}">
						<f:convertDateTime pattern="#{usession.datePattern}"
							timeZone="#{CommonUtils.timeZone}" />
					</h:outputText>
				</rich:column>

				<rich:column id="status" label="#{lblCommon.status}" sortBy="#{'serviceStatus'}" width="15%">
					<f:facet name="header">
						<h:outputText value="#{lblCommon.status}"
							title="#{lblCommon.status}" />
					</f:facet>
					<bm:entityDisplay contextType="ENTTSRVC" bean="#{(servicesBean==null ? MbServiceObjects : servicesBean).class.name}" value="#{(item.serviceStatus == null) ? '' : DictUtils.articles[item.serviceStatus]}" />
				</rich:column>

				<rich:column id="description" label="#{lblCommon.description}" sortBy="#{'description'}" width="15%">
					<f:facet name="header">
						<h:outputText value="#{lblCommon.description}"
							title="#{lblCommon.description}" />
					</f:facet>
	                <bm:entityDisplay contextType="ENTTSRVC" bean="#{(servicesBean==null ? MbServiceObjects : servicesBean).class.name}" value="#{item.description != null ? item.description : '...'}" description="#{item.description != null ? item.description : lblCommon.details}"/>
				</rich:column>
			</rich:extendedDataTable>
		</h:panelGroup>

		<h:panelGroup layout="block"
			styleClass="bottom_search_result_block_buttons"
			style="position: absolute; left: 0; width: 100%; bottom: 0;">
			<h:panelGroup layout="block" rendered="#{servicesBean==null}"
				styleClass="bottom_search_result_left_buttons">
				<h:panelGrid id="btnPanel" styleClass="fw buttons_block" columns="2" columnClasses=", table_tools_state">
					<h:panelGroup></h:panelGroup>
					<h:panelGroup>
						<h:graphicImage url="/images/green-tick.png" title="#{lblCommon.save_table_state}" styleClass="action_icon"
							onclick="saveObjectTableState();"/>
						<h:graphicImage url="/images/red-cross.png" title="#{lblCommon.delete_table_state}" styleClass="action_icon"
							onclick="deleteObjectTableState();"/>
						<a4j:queue name="tablestatequeue"/>
						<a4j:jsFunction name="saveObjectTableState" action="#{MbServiceObjects.saveTableStateDB}" eventsQueue="tablestatequeue"/>
						<a4j:jsFunction name="deleteObjectTableState" action="#{MbServiceObjects.deleteTableStateDB}" eventsQueue="tablestatequeue"/>
					</h:panelGroup>
				</h:panelGrid>
			</h:panelGroup>
		</h:panelGroup>
	</h:form>
</ui:composition>
</html>
