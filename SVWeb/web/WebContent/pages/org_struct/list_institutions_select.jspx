<?xml version="1.0" encoding="UTF-8"?>
<html xmlns="http://www.w3.org/1999/xhtml"
	  xmlns:f="http://java.sun.com/jsf/core"
	  xmlns:h="http://java.sun.com/jsf/html"
	  xmlns:ui="http://java.sun.com/jsf/facelets"
	  xmlns:a4j="http://richfaces.org/a4j"
	  xmlns:rich="http://richfaces.org/rich"
	  xmlns:bm="http://www.bpc.ru/jsf/misc"
	  xmlns:bre="http://www.bpc.ru/jsf/richfaces-ext"
	  xmlns:my="http://mycompany.org/inputDate"
	  xmlns:o="http://openfaces.org/"
	  xmlns:bpct="http://www.bpc.ru/jsf/tiles">
<ui:composition>
	<h:panelGroup layout="block" styleClass="cardholderdata-wrapper">
		<o:treeTable id="instTreeTable"
					 var="inst"
					 headerHorizSeparator="1px solid #D7DAC2"
					 headerVertSeparator="1px solid #D7DAC2"
					 headerSectionClass="res-tree-table-header"
					 commonHeaderRowClass="res-tree-table-header"
					 sortableHeaderClass="res-tree-table-header"
					 sortedColumnHeaderClass="res-tree-table-header"
					 sortableHeaderRolloverClass="res-tree-table-header"
					 styleClass="res-tree-table kinda-green-border"
					 bodyOddRowClass="res-tree-table-row odd-tree-table"
					 bodyRowClass="res-tree-table-row"
					 verticalGridLines="1px solid #D7DAC2"
					 cellpadding="0"
					 cellspacing="0"
					 preloadedNodes="all"
					 style="height: 410px">
			<o:scrolling/>
			<f:facet name="noDataMessage">
				<h:outputText value="#{lblCommon['no_records_found']}"/>
			</f:facet>

			<o:dynamicTreeStructure nodeChildren="#{(userInstitutions==null ? MbUserInstitutions : userInstitutions).nodeChildren}"
									nodeHasChildren="#{(userInstitutions==null ? MbUserInstitutions : userInstitutions).nodeHasChildren}"
									nodeKey="#{inst.id}"/>

			<o:singleNodeSelection nodePath="#{(userInstitutions==null ? MbUserInstitutions : userInstitutions).nodePath}"
								   nodeData="#{(userInstitutions==null ? MbUserInstitutions : userInstitutions).node}"
								   keyboardSupport="false"
								   styleClass="treetable_selection"/>

			<o:treeColumn id="instName" width="55%">
				<f:facet name="header">
					<h:outputText value="#{lblOst.institution}"/>
				</f:facet>

				<h:outputText value="#{inst.name}" title="#{inst.name}" styleClass="treeTableText"/>
			</o:treeColumn>
			
			<o:column id="instId"  width="8%">
				<f:facet name="header">
					<h:outputText value="#{lblCommon.id}"/>
				</f:facet>

				<h:outputText value="#{inst.id}" title="#{inst.id}"/>
			</o:column>

			<o:column id="isGranted" width="10%">
				<f:facet name="header">
					<h:outputText value="#{lblAcm.access_granted}" style="white-space: normal"/>
				</f:facet>

				<h:selectBooleanCheckbox id="grantedBox"
										 value="#{inst.assignedToUser}"
										 styleClass="treeTableText grantedClass_#{inst.id}_#{inst.parentId}"
										 disabled="#{inst.grantFromRole
										             or not
										             ((usession.inRole['ADD_INST_TO_USER'] and !inst.assignedToUser) or
										              (usession.inRole['REMOVE_INST_FROM_USER'] and inst.assignedToUser))
										             and
										             (!(usession.inRole['ADD_INST_TO_USER'] and !inst.assignedToUser) or
										              !(usession.inRole['REMOVE_INST_FROM_USER'] and inst.assignedToUser))}">
					<a4j:support event="onclick"
								 action="#{(userInstitutions==null ? MbUserInstitutions : userInstitutions).assignInstitutionToUser}"/>
				</h:selectBooleanCheckbox>
			</o:column>

			<o:column id="isEntirely" width="12%">
				<f:facet name="header">
					<h:outputText value="#{lblOst.entirely}" />
				</f:facet>

				<h:selectBooleanCheckbox id="entirelyBox"
										 value="#{inst.entirelyForUser}"
										 styleClass="treeTableText">
					<a4j:support event="onclick"
								 action="#{(userInstitutions==null ? MbUserInstitutions : userInstitutions).assignInstitutionToUser}"/>
				</h:selectBooleanCheckbox>
			</o:column>

			<o:column id="isDefault" width="15%">
				<f:facet name="header">
					<h:outputText value="#{lblCommon.default}" />
				</f:facet>

				<h:selectBooleanCheckbox id="instDef"
										 value="#{inst.defaultForUser}"
										 disabled="true"
										 styleClass="treeTableText">
				</h:selectBooleanCheckbox>
			</o:column>
		</o:treeTable>
	</h:panelGroup>
</ui:composition>
</html>
