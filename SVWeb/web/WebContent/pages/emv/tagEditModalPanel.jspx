<?xml version="1.0" encoding="UTF-8"?>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:bm="http://www.bpc.ru/jsf/misc"
	xmlns:bre="http://www.bpc.ru/jsf/richfaces-ext">
<ui:composition>

	<script type="text/javascript">//<![CDATA[ 
	function checkTagFields() {
		var checked = true;
		
		if (document.getElementById('tagEditModalPanelForm:tag').value == "") {
			document.getElementById('tagEditModalPanelForm:tagError').style.display = "inline";
			checked = false;
		}
		
		var maxValue = document.getElementById('tagEditModalPanelForm:maxLength').value; 
		var minValue = document.getElementById('tagEditModalPanelForm:minLength').value;
		
		if (minValue == "") {
			document.getElementById('tagEditModalPanelForm:minLengthError').style.display = "inline";
			checked = false;
		}
		if (minValue <= 0) {
			document.getElementById('tagEditModalPanelForm:minValueError').style.display = "inline";
			checked = false;
		}	
		if (maxValue == "") {
			document.getElementById('tagEditModalPanelForm:maxLengthError').style.display = "inline";
			checked = false;
		}
		if (maxValue <= 0) {
			document.getElementById('tagEditModalPanelForm:maxValueError').style.display = "inline";
			checked = false;
		}	
		
		if (parseInt(maxValue) < parseInt(minValue)) {
			document.getElementById("tagEditModalPanelForm:minLengthJsErr").style.display = "inline";
			document.getElementById("tagEditModalPanelForm:maxLengthJsErr").style.display = "inline";
			checked = false;
		}
		
		if (document.getElementById('tagEditModalPanelForm:dataType').value == "") {
			document.getElementById('tagEditModalPanelForm:dataTypeError').style.display = "inline";
			checked = false;
		}
		if (document.getElementById('tagEditModalPanelForm:tagType').value == "") {
			document.getElementById('tagEditModalPanelForm:tagTypeError').style.display = "inline";
			checked = false;
		}

		return checked;
	}//]]>
	</script>

	<rich:modalPanel id="tagEditModalPanel" autosized="true" minWidth="300"
		minHeight="100">
		<f:facet name="header">
			<h:panelGroup id="tagEditModalPanelHeader">
				<h:outputText value="#{lblRpt.edit_tag}"
					rendered="#{MbEmvTag.editMode}" />
				<h:outputText value="#{lblEmv.new_tag}"
					rendered="#{MbEmvTag.newMode}" />
			</h:panelGroup>
		</f:facet>
		<f:facet name="controls">
		</f:facet>
		<h:form id="tagEditModalPanelForm">
			<script type="text/javascript">
//<!--
				oldValue["tagEditModalPanelForm"] = "#{MbEmvTag.editingItem.lang}";
				//-->
			</script>
			<h:panelGroup layout="block" styleClass="cardholderdata-wrapper">
				<h:panelGrid columns="2" styleClass="cardholderdata"
					columnClasses="firstColModal, width250">

					<h:outputLabel value="#{lblCommon.language}: " title="#{lblCommon.language}" />
					<h:panelGrid columns="1" ellpadding="0" cellspacing="0">
						<h:selectOneMenu
							value="#{MbEmvTag.editingItem.lang}"
							rendered="#{MbEmvTag.newMode}">
							<f:selectItems value="#{MbEmvTag.languages}" />
						</h:selectOneMenu>
						<h:selectOneMenu id="editLang"
							value="#{MbEmvTag.editingItem.lang}"
							rendered="#{MbEmvTag.editMode}"
							onchange="document.getElementById('emvTag:confirmPanelForm:newValue').value = this.value;
											#{rich:component('emvTag:confirmPanel')}.show()">
							<f:selectItems value="#{MbEmvTag.languages}" />
						</h:selectOneMenu>
					</h:panelGrid>

					<h:outputLabel for="tag" value="* #{lblEmv.tag}:" title="#{lblEmv.tag}" />
					<h:panelGrid columns="1" cellpadding="0" cellspacing="0">
						<h:inputText id="tag" label="#{lblEmv.tag}"
							value="#{MbEmvTag.editingItem.tag}" maxlength="6"
							onblur="hideErrorField(this)">
						</h:inputText>
						<h:outputFormat value="#{lblMsg.value_request}" styleClass="errorMarker"
							id="tagError" style="display:none;">
							<f:param name="fieldName" value="#{lblEmv.tag}"/>
						</h:outputFormat>
					</h:panelGrid>

					<h:outputLabel for="minLength" value="* #{lblEmv.min_length}:" title="#{lblEmv.min_length}" />
					<h:panelGrid columns="1" cellpadding="0" cellspacing="0">
						<h:inputText id="minLength"
							label="#{lblEmv.min_length}" 
							value="#{MbEmvTag.editingItem.minLength}"
							onkeypress="if (!numbersOnly(this, event)) return false;"
							onblur="hideErrorField(this)">
						</h:inputText>
						<h:outputFormat value="#{lblMsg.value_request}" styleClass="errorMarker"
							id="minLengthError" style="display:none;">
							<f:param name="fieldName" value="#{lblEmv.min_length}"/>
						</h:outputFormat>
						<h:outputFormat value="#{lblMsg.low_value_greater}"
							styleClass="errorMarker" id="minLengthJsErr" style="display:none;" />
						<h:outputFormat value="#{lblMsg.min_value_field}" styleClass="errorMarker"
								id="minValueError" style="display:none;">
								<f:param name="fieldName" value="0"/>
						</h:outputFormat>
					</h:panelGrid>

					<h:outputLabel for="maxLength" value="* #{lblEmv.max_length}:" title="#{lblEmv.max_length}" />
					<h:panelGrid columns="1" cellpadding="0" cellspacing="0">
						<h:inputText id="maxLength"
							label="#{lblEmv.max_length}"
							value="#{MbEmvTag.editingItem.maxLength}"
							onkeypress="if (!numbersOnly(this, event)) return false;"
							onblur="hideErrorField(this)">
						</h:inputText>
						<h:outputFormat value="#{lblMsg.value_request}" styleClass="errorMarker"
							id="maxLengthError" style="display:none;">
							<f:param name="fieldName" value="#{lblEmv.max_length}"/>
						</h:outputFormat>
						<h:outputFormat value="#{lblMsg.low_value_greater}"
							styleClass="errorMarker" id="maxLengthJsErr" style="display:none;" />
						<h:outputFormat value="#{lblMsg.min_value_field}" styleClass="errorMarker"
								id="maxValueError" style="display:none;">
								<f:param name="fieldName" value="0"/>
						</h:outputFormat>
					</h:panelGrid>

					<h:outputLabel for="dataType" value="* #{lblEmv.data_type}:" title="#{lblEmv.data_type}" />
					<h:panelGrid columns="1" cellpadding="0" cellspacing="0">
						<h:selectOneMenu id="dataType"
							label="#{lblEmv.data_type}"
							value="#{MbEmvTag.editingItem.dataType}"
							onblur="hideErrorField(this)">
							<f:selectItem itemValue="" />
							<f:selectItems value="#{MbEmvTag.dataTypes}" />
						</h:selectOneMenu>
						<h:outputFormat value="#{lblMsg.value_request}" styleClass="errorMarker"
							id="dataTypeError" style="display:none;">
							<f:param name="fieldName" value="#{lblEmv.data_type}"/>
						</h:outputFormat>
					</h:panelGrid>

					<h:outputLabel for="dataFormat" value="#{lblEmv.data_format}:" title="#{lblEmv.data_format}" />
					<h:panelGrid columns="1" cellpadding="0" cellspacing="0">
						<h:inputText id="dataFormat"
							label="#{lblEmv.data_format}"
							value="#{MbEmvTag.editingItem.dataFormat}" maxlength="200">
						</h:inputText>

					</h:panelGrid>

					<h:outputLabel for="defaultValue"
						value="#{lblEmv.default_value}:" />
					<h:panelGrid columns="1" cellpadding="0" cellspacing="0">
						<h:inputText id="defaultValue"
							label="#{lblEmv.default_value}"
							value="#{MbEmvTag.editingItem.defaultValue}" maxlength="200">
						</h:inputText>
					</h:panelGrid>

					<h:outputLabel for="tagType" value="* #{lblEmv.tag_type}:" title="#{lblEmv.tag_type}" />
					<h:panelGrid columns="1" cellpadding="0" cellspacing="0">
						<h:selectOneMenu id="tagType"
							label="#{lblEmv.tag_type}"
							value="#{MbEmvTag.editingItem.tagType}"
							onblur="hideErrorField(this)">
							<f:selectItem itemValue="" />
							<f:selectItems value="#{MbEmvTag.tagTypes}" />
						</h:selectOneMenu>
						<h:outputFormat value="#{lblMsg.value_request}" styleClass="errorMarker"
							id="tagTypeError" style="display:none;">
							<f:param name="fieldName" value="#{lblEmv.tag_type}"/>
						</h:outputFormat>
					</h:panelGrid>

					<h:outputLabel for="description" value="#{lblEmv.description}:" title="#{lblEmv.description}" />
					<h:panelGrid columns="1" cellpadding="0" cellspacing="0">
						<h:inputTextarea id="description"
							rows="3"
							label="#{lblEmv.description}"
							value="#{MbEmvTag.editingItem.description}">
						</h:inputTextarea>
					</h:panelGrid>

				</h:panelGrid>
			</h:panelGroup>

			<h:panelGroup layout="block"
				styleClass="bottom_search_result_block_buttons" id="editBtnPanel">
				<h:panelGroup layout="block"
					styleClass="bottom_search_result_left_buttons">
					<h:panelGrid columns="3" columnClasses="width99P,,paddingR12">
						<h:outputText />
						<bre:taggedCommandButton value="#{lblForm.save}" type="submit"
							action="#{MbEmvTag.saveEditingTag}"
							onclick="if (!checkTagFields()) return false; disableModalPanelBtns(this);"
							oncomplete="enableModalPanelBtns(this); if (#{usession.noErrorResponse}) 
			                   			#{rich:component('tagEditModalPanel')}.hide()"
							reRender="EmvTagTable, EmvTagDataScroller, pagesNum, btnPanel, detailsTab" />
						<bre:taggedCommandButton value="#{lblForm.cancel}"
							action="#{MbEmvTag.resetEditingTag}" immediate="true"
							limitToList="true"
							oncomplete="#{rich:component('tagEditModalPanel')}.hide()"
							reRender="EmvTagTable, EmvTagDataScroller, pagesNum, btnPanel">
							<f:actionListener type="ru.bpc.jsf.A4JFormReset" />
						</bre:taggedCommandButton>
					</h:panelGrid>
				</h:panelGroup>
			</h:panelGroup>
		</h:form>
	</rich:modalPanel>
	
	<ui:include src="/pages/utils/langConfirmPanel.jspx">
		<ui:param name="backingBean" value="#{MbEmvTag}" />
		<ui:param name="rerenderList"
			value="tagEditModalPanelForm" />
		<ui:param name="editElem"
			value="tagEditModalPanelForm:editLang" />
		<ui:param name="newValue"
			value="#{MbEmvTag.editingItem.lang}" />
		<ui:param name="subviewId" value="emvTag" />
		<ui:param name="formName" value="tagEditModalPanelForm" />
	</ui:include>
</ui:composition>
</html>