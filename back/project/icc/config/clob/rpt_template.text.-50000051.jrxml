<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="report_audit_trailer" pageWidth="595" pageHeight="842" columnWidth="555" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20">
    <property name="ireport.zoom" value="1.5"/>
    <property name="ireport.x" value="0"/>
    <property name="ireport.y" value="0"/>
    <style name="table">
        <box>
            <pen lineWidth="1.0" lineColor="#000000"/>
        </box>
    </style>
    <style name="table_TH" mode="Opaque" backcolor="#F0F8FF">
        <box>
            <pen lineWidth="0.5" lineColor="#000000"/>
        </box>
    </style>
    <style name="table_CH" mode="Opaque" backcolor="#BFE1FF">
        <box>
            <pen lineWidth="0.5" lineColor="#000000"/>
        </box>
    </style>
    <style name="table_TD" mode="Opaque" backcolor="#FFFFFF">
        <box>
            <pen lineWidth="0.5" lineColor="#000000"/>
        </box>
    </style>
    <style name="table 1">
        <box>
            <pen lineWidth="1.0" lineColor="#000000"/>
        </box>
    </style>
    <style name="table 1_TH" mode="Opaque" backcolor="#F0F8FF">
        <box>
            <pen lineWidth="0.5" lineColor="#000000"/>
        </box>
    </style>
    <style name="table 1_CH" mode="Opaque" backcolor="#BFE1FF">
        <box>
            <pen lineWidth="0.5" lineColor="#000000"/>
        </box>
    </style>
    <style name="table 1_TD" mode="Opaque" backcolor="#FFFFFF">
        <box>
            <pen lineWidth="0.5" lineColor="#000000"/>
        </box>
    </style>
    <style name="table 2">
        <box>
            <pen lineWidth="1.0" lineColor="#000000"/>
        </box>
    </style>
    <style name="table 2_TH" mode="Opaque" backcolor="#F0F8FF">
        <box>
            <pen lineWidth="0.5" lineColor="#000000"/>
        </box>
    </style>
    <style name="table 2_CH" mode="Opaque" backcolor="#BFE1FF">
        <box>
            <pen lineWidth="0.5" lineColor="#000000"/>
        </box>
    </style>
    <style name="table 2_TD" mode="Opaque" backcolor="#FFFFFF">
        <box>
            <pen lineWidth="0.5" lineColor="#000000"/>
        </box>
    </style>
    <style name="table 3">
        <box>
            <pen lineWidth="1.0" lineColor="#000000"/>
        </box>
    </style>
    <style name="table 3_TH" mode="Opaque" backcolor="#F0F8FF">
        <box>
            <pen lineWidth="0.5" lineColor="#000000"/>
        </box>
    </style>
    <style name="table 3_CH" mode="Opaque" backcolor="#BFE1FF">
        <box>
            <pen lineWidth="0.5" lineColor="#000000"/>
        </box>
    </style>
    <style name="table 3_TD" mode="Opaque" backcolor="#FFFFFF">
        <box>
            <pen lineWidth="0.5" lineColor="#000000"/>
        </box>
    </style>
    <style name="table 4">
        <box>
            <pen lineWidth="1.0" lineColor="#000000"/>
        </box>
    </style>
    <style name="table 4_TH" mode="Opaque" backcolor="#F0F8FF">
        <box>
            <pen lineWidth="0.5" lineColor="#000000"/>
        </box>
    </style>
    <style name="table 4_CH" mode="Opaque" backcolor="#BFE1FF">
        <box>
            <pen lineWidth="0.5" lineColor="#000000"/>
        </box>
    </style>
    <style name="table 4_TD" mode="Opaque" backcolor="#FFFFFF">
        <box>
            <pen lineWidth="0.5" lineColor="#000000"/>
        </box>
    </style>
    <style name="table 5">
        <box>
            <pen lineWidth="1.0" lineColor="#000000"/>
        </box>
    </style>
    <style name="table 5_TH" mode="Opaque" backcolor="#F0F8FF">
        <box>
            <pen lineWidth="0.5" lineColor="#000000"/>
        </box>
    </style>
    <style name="table 5_CH" mode="Opaque" backcolor="#BFE1FF">
        <box>
            <pen lineWidth="0.5" lineColor="#000000"/>
        </box>
    </style>
    <style name="table 5_TD" mode="Opaque" backcolor="#FFFFFF">
        <box>
            <pen lineWidth="0.5" lineColor="#000000"/>
        </box>
    </style>
    <subDataset name="Totals">
        <queryString language="xPath">
            <![CDATA[/audit_trailer_data/totals/total]]>
        </queryString>
        <field name="trans_currency" class="java.lang.String">
            <fieldDescription><![CDATA[trans_currency]]></fieldDescription>
        </field>
        <field name="total_trans_count" class="java.lang.String">
            <fieldDescription><![CDATA[total_trans_count]]></fieldDescription>
        </field>
        <field name="trans_curr_name" class="java.lang.String">
            <fieldDescription><![CDATA[trans_curr_name]]></fieldDescription>
        </field>
        <field name="trans_amount_format" class="java.lang.String">
            <fieldDescription><![CDATA[trans_amount_format]]></fieldDescription>
        </field>
        <field name="trans_curr_exp" class="java.lang.Double">
            <fieldDescription><![CDATA[trans_curr_exp]]></fieldDescription>
        </field>
        <field name="total_trans_amount" class="java.lang.Double">
            <fieldDescription><![CDATA[total_trans_amount]]></fieldDescription>
        </field>
    </subDataset>
    <queryString language="xPath">
        <![CDATA[/audit_trailer_data/group_data/group_file/group_currencies/group_currency/details/detail]]>
    </queryString>
    <field name="inst_name" class="java.lang.String">
        <fieldDescription><![CDATA[/audit_trailer_data/inst_name]]></fieldDescription>
    </field>
    <field name="eff_date" class="java.lang.String">
        <fieldDescription><![CDATA[/audit_trailer_data/eff_date]]></fieldDescription>
    </field>
    <field name="start_date" class="java.lang.String">
        <fieldDescription><![CDATA[/audit_trailer_data/start_date]]></fieldDescription>
    </field>
    <field name="end_date" class="java.lang.String">
        <fieldDescription><![CDATA[/audit_trailer_data/end_date]]></fieldDescription>
    </field>
    <field name="input_audit_file_id" class="java.lang.String">
        <fieldDescription><![CDATA[/audit_trailer_data/input_audit_file_id]]></fieldDescription>
    </field>
    <field name="input_file_name" class="java.lang.String">
        <fieldDescription><![CDATA[/audit_trailer_data/group_data/group_file[1]/file_name]]></fieldDescription>
    </field>
    <field name="input_file_date" class="java.lang.String">
        <fieldDescription><![CDATA[/audit_trailer_data/group_data/group_file[1]/file_date]]></fieldDescription>
    </field>
    <field name="rrn" class="java.lang.String">
        <fieldDescription><![CDATA[rrn]]></fieldDescription>
    </field>
    <field name="sttl_amount" class="java.lang.Double">
        <fieldDescription><![CDATA[sttl_amount]]></fieldDescription>
    </field>
    <field name="sttl_curr_name" class="java.lang.String">
        <fieldDescription><![CDATA[sttl_curr_name]]></fieldDescription>
    </field>
    <field name="sttl_amount_format" class="java.lang.String">
        <fieldDescription><![CDATA[sttl_amount_format]]></fieldDescription>
    </field>
    <field name="sttl_curr_exp" class="java.lang.Double">
        <fieldDescription><![CDATA[sttl_curr_exp]]></fieldDescription>
    </field>
    <field name="trans_amount_format" class="java.lang.String">
        <fieldDescription><![CDATA[trans_amount_format]]></fieldDescription>
    </field>
    <field name="trans_curr_exp" class="java.lang.Double">
        <fieldDescription><![CDATA[trans_curr_exp]]></fieldDescription>
    </field>
    <field name="trans_amount" class="java.lang.Double">
        <fieldDescription><![CDATA[trans_amount]]></fieldDescription>
    </field>
    <field name="card_mask" class="java.lang.String">
        <fieldDescription><![CDATA[card_mask]]></fieldDescription>
    </field>
    <field name="trans_currency" class="java.lang.String">
        <fieldDescription><![CDATA[ancestor::node()[2]/trans_currency]]></fieldDescription>
    </field>
    <field name="trans_curr_name" class="java.lang.String">
        <fieldDescription><![CDATA[ancestor::node()[2]/trans_curr_name]]></fieldDescription>
    </field>
    <field name="sub_total_amount" class="java.lang.Double">
        <fieldDescription><![CDATA[ancestor::node()[2]/sub_total_amount]]></fieldDescription>
    </field>
    <field name="sub_total_count" class="java.lang.String">
        <fieldDescription><![CDATA[ancestor::node()[2]/sub_total_count]]></fieldDescription>
    </field>
    <field name="trans_amount_format2" class="java.lang.String">
        <fieldDescription><![CDATA[ancestor::node()[2]/trans_amount_format]]></fieldDescription>
    </field>
    <field name="trans_curr_exp2" class="java.lang.Double">
        <fieldDescription><![CDATA[ancestor::node()[2]/trans_curr_exp]]></fieldDescription>
    </field>
    <field name="file_id" class="java.lang.String">
        <fieldDescription><![CDATA[ancestor::node()[4]/file_id]]></fieldDescription>
    </field>
    <field name="file_name" class="java.lang.String">
        <fieldDescription><![CDATA[ancestor::node()[4]/file_name]]></fieldDescription>
    </field>
    <field name="file_date" class="java.lang.String">
        <fieldDescription><![CDATA[ancestor::node()[4]/file_date]]></fieldDescription>
    </field>
    <group name="Files" isStartNewPage="true">
        <groupExpression><![CDATA[$F{file_id}]]></groupExpression>
        <groupHeader>
            <band height="21">
                <printWhenExpression><![CDATA[$F{input_audit_file_id} == null]]></printWhenExpression>
                <staticText>
                    <reportElement x="0" y="0" width="34" height="20"/>
                    <textElement textAlignment="Left" verticalAlignment="Middle"/>
                    <text><![CDATA[File:]]></text>
                </staticText>
                <textField>
                    <reportElement x="34" y="1" width="153" height="20"/>
                    <textElement verticalAlignment="Middle"/>
                    <textFieldExpression><![CDATA[$F{file_name}]]></textFieldExpression>
                </textField>
                <staticText>
                    <reportElement x="187" y="1" width="69" height="20"/>
                    <textElement verticalAlignment="Middle"/>
                    <text><![CDATA[File input date:]]></text>
                </staticText>
                <textField isBlankWhenNull="true">
                    <reportElement x="256" y="1" width="78" height="20"/>
                    <textElement textAlignment="Right" verticalAlignment="Middle"/>
                    <textFieldExpression><![CDATA[$F{file_date}]]></textFieldExpression>
                </textField>
            </band>
        </groupHeader>
        <groupFooter>
            <band height="1"/>
        </groupFooter>
    </group>
    <group name="Transaction currency" isStartNewPage="true">
        <groupExpression><![CDATA[$F{trans_curr_name}]]></groupExpression>
        <groupHeader>
            <band height="21">
                <staticText>
                    <reportElement x="213" y="1" width="121" height="20"/>
                    <textElement textAlignment="Right" verticalAlignment="Middle"/>
                    <text><![CDATA[Transaction currency:]]></text>
                </staticText>
                <textField isBlankWhenNull="true">
                    <reportElement x="353" y="1" width="25" height="20"/>
                    <textElement textAlignment="Right" verticalAlignment="Middle"/>
                    <textFieldExpression><![CDATA[$F{trans_curr_name}]]></textFieldExpression>
                </textField>
            </band>
        </groupHeader>
        <groupFooter>
            <band height="40">
                <textField isBlankWhenNull="true">
                    <reportElement x="278" y="0" width="100" height="20"/>
                    <textElement textAlignment="Right" verticalAlignment="Middle"/>
                    <textFieldExpression><![CDATA[$F{sub_total_count}]]></textFieldExpression>
                </textField>
                <textField isBlankWhenNull="true">
                    <reportElement x="278" y="20" width="100" height="20"/>
                    <textElement textAlignment="Right" verticalAlignment="Middle"/>
                    <textFieldExpression><![CDATA[$F{sub_total_amount}/$F{trans_curr_exp2}]]></textFieldExpression>
                    <patternExpression><![CDATA[$F{trans_amount_format2}]]></patternExpression>
                </textField>
                <staticText>
                    <reportElement x="25" y="0" width="100" height="20"/>
                    <text><![CDATA[Total_count:]]></text>
                </staticText>
                <staticText>
                    <reportElement x="25" y="20" width="100" height="20"/>
                    <text><![CDATA[Total_amount:]]></text>
                </staticText>
            </band>
        </groupFooter>
    </group>
    <background>
        <band splitType="Stretch"/>
    </background>
    <title>
        <band height="77" splitType="Stretch">
            <textField isBlankWhenNull="true">
                <reportElement x="431" y="36" width="124" height="20" isPrintWhenDetailOverflows="true"/>
                <textElement>
                    <font size="12"/>
                </textElement>
                <textFieldExpression><![CDATA[$F{eff_date}]]></textFieldExpression>
            </textField>
            <textField isBlankWhenNull="true">
                <reportElement x="0" y="0" width="232" height="56" isPrintWhenDetailOverflows="true"/>
                <textElement>
                    <font size="20"/>
                </textElement>
                <textFieldExpression><![CDATA[$F{inst_name}]]></textFieldExpression>
            </textField>
            <staticText>
                <reportElement x="150" y="56" width="184" height="20"/>
                <textElement>
                    <font size="14"/>
                </textElement>
                <text><![CDATA[ICC UPI audit trail file report]]></text>
            </staticText>
        </band>
    </title>
    <pageHeader>
        <band height="41" splitType="Stretch">
            <staticText>
                <reportElement isPrintRepeatedValues="false" x="0" y="20" width="100" height="20">
                    <printWhenExpression><![CDATA[$F{input_audit_file_id} != null && $V{PAGE_NUMBER} == 1]]></printWhenExpression>
                </reportElement>
                <textElement verticalAlignment="Middle"/>
                <text><![CDATA[Input audit trailer file:]]></text>
            </staticText>
            <staticText>
                <reportElement isPrintRepeatedValues="false" x="100" y="0" width="132" height="20">
                    <printWhenExpression><![CDATA[$F{input_audit_file_id} != null && $V{PAGE_NUMBER} == 1]]></printWhenExpression>
                </reportElement>
                <textElement textAlignment="Center" verticalAlignment="Middle"/>
                <text><![CDATA[File name]]></text>
            </staticText>
            <textField isBlankWhenNull="true">
                <reportElement isPrintRepeatedValues="false" x="100" y="20" width="132" height="20">
                    <printWhenExpression><![CDATA[$F{input_audit_file_id} != null && $V{PAGE_NUMBER} == 1]]></printWhenExpression>
                </reportElement>
                <textElement textAlignment="Center" verticalAlignment="Middle"/>
                <textFieldExpression><![CDATA[$F{input_file_name}]]></textFieldExpression>
            </textField>
            <staticText>
                <reportElement isPrintRepeatedValues="false" x="232" y="0" width="102" height="20">
                    <printWhenExpression><![CDATA[$F{input_audit_file_id} != null && $V{PAGE_NUMBER} == 1]]></printWhenExpression>
                </reportElement>
                <textElement textAlignment="Center" verticalAlignment="Middle"/>
                <text><![CDATA[File input date]]></text>
            </staticText>
            <textField isBlankWhenNull="true">
                <reportElement isPrintRepeatedValues="false" x="232" y="20" width="102" height="20">
                    <printWhenExpression><![CDATA[$F{input_audit_file_id} != null && $V{PAGE_NUMBER} == 1]]></printWhenExpression>
                </reportElement>
                <textElement textAlignment="Center" verticalAlignment="Middle"/>
                <textFieldExpression><![CDATA[$F{input_file_date}]]></textFieldExpression>
            </textField>
            <textField isBlankWhenNull="true">
                <reportElement isPrintRepeatedValues="false" x="150" y="10" width="184" height="20">
                    <printWhenExpression><![CDATA[$F{input_audit_file_id} == null && $V{PAGE_NUMBER} == 1]]></printWhenExpression>
                </reportElement>
                <textElement textAlignment="Center" verticalAlignment="Middle"/>
                <textFieldExpression><![CDATA[$F{start_date} + " - " + $F{end_date}]]></textFieldExpression>
            </textField>
            <staticText>
                <reportElement isPrintRepeatedValues="false" x="55" y="10" width="95" height="20">
                    <printWhenExpression><![CDATA[$F{input_audit_file_id} == null  && $V{PAGE_NUMBER} == 1]]></printWhenExpression>
                </reportElement>
                <textElement textAlignment="Right" verticalAlignment="Middle"/>
                <text><![CDATA[Period of audit:]]></text>
            </staticText>
        </band>
    </pageHeader>
    <columnHeader>
        <band height="38" splitType="Stretch">
            <staticText>
                <reportElement x="0" y="0" width="125" height="38"/>
                <textElement textAlignment="Center" verticalAlignment="Middle"/>
                <text><![CDATA[Retrieval Reference
Number]]></text>
            </staticText>
            <staticText>
                <reportElement x="125" y="0" width="100" height="38"/>
                <textElement textAlignment="Right" verticalAlignment="Middle"/>
                <text><![CDATA[Amount, settlement]]></text>
            </staticText>
            <staticText>
                <reportElement x="225" y="0" width="53" height="38"/>
                <textElement textAlignment="Center" verticalAlignment="Middle"/>
                <text><![CDATA[Settlement
currency]]></text>
            </staticText>
            <staticText>
                <reportElement x="278" y="0" width="100" height="38"/>
                <textElement textAlignment="Right" verticalAlignment="Middle"/>
                <text><![CDATA[Amount, transaction]]></text>
            </staticText>
            <staticText>
                <reportElement x="378" y="0" width="177" height="38"/>
                <textElement textAlignment="Center" verticalAlignment="Middle"/>
                <text><![CDATA[PAN]]></text>
            </staticText>
        </band>
    </columnHeader>
    <detail>
        <band height="21" splitType="Stretch">
            <textField isBlankWhenNull="true">
                <reportElement x="0" y="0" width="125" height="20"/>
                <textElement textAlignment="Center" verticalAlignment="Middle"/>
                <textFieldExpression><![CDATA[$F{rrn}]]></textFieldExpression>
            </textField>
            <textField pattern="" isBlankWhenNull="true">
                <reportElement x="125" y="1" width="100" height="20"/>
                <textElement textAlignment="Right" verticalAlignment="Middle"/>
                <textFieldExpression><![CDATA[$F{sttl_amount}/$F{sttl_curr_exp}]]></textFieldExpression>
                <patternExpression><![CDATA[$F{sttl_amount_format}]]></patternExpression>
            </textField>
            <textField isBlankWhenNull="true">
                <reportElement x="225" y="1" width="53" height="20"/>
                <textElement verticalAlignment="Middle"/>
                <textFieldExpression><![CDATA[$F{sttl_curr_name}]]></textFieldExpression>
            </textField>
            <textField isBlankWhenNull="true">
                <reportElement x="278" y="1" width="100" height="20"/>
                <textElement textAlignment="Right" verticalAlignment="Middle"/>
                <textFieldExpression><![CDATA[$F{trans_amount}/$F{trans_curr_exp}]]></textFieldExpression>
                <patternExpression><![CDATA[$F{trans_amount_format}]]></patternExpression>
            </textField>
            <textField isBlankWhenNull="true">
                <reportElement x="378" y="1" width="177" height="20"/>
                <textElement textAlignment="Center" verticalAlignment="Middle"/>
                <textFieldExpression><![CDATA[$F{card_mask}]]></textFieldExpression>
            </textField>
        </band>
    </detail>
    <columnFooter>
        <band height="2" splitType="Stretch"/>
    </columnFooter>
    <pageFooter>
        <band splitType="Stretch"/>
    </pageFooter>
    <summary>
        <band height="71" splitType="Stretch">
            <componentElement>
                <reportElement key="table 5" style="table 5" x="169" y="51" width="239" height="20"/>
                <jr:table xmlns:jr="http://jasperreports.sourceforge.net/jasperreports/components" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports/components http://jasperreports.sourceforge.net/xsd/components.xsd">
                    <datasetRun subDataset="Totals">
                        <dataSourceExpression><![CDATA[((net.sf.jasperreports.engine.data.JRXmlDataSource)$P{REPORT_DATA_SOURCE}).dataSource("/audit_trailer_data/totals/total")]]></dataSourceExpression>
                    </datasetRun>
                    <jr:column width="90">
                        <jr:columnHeader style="table 5_TH" height="30" rowSpan="1">
                            <staticText>
                                <reportElement x="0" y="0" width="90" height="30"/>
                                <textElement textAlignment="Center" verticalAlignment="Middle"/>
                                <text><![CDATA[All transactions count]]></text>
                            </staticText>
                        </jr:columnHeader>
                        <jr:detailCell style="table 5_TD" height="20" rowSpan="1">
                            <textField isBlankWhenNull="true">
                                <reportElement x="0" y="0" width="90" height="20"/>
                                <textElement textAlignment="Center" verticalAlignment="Middle"/>
                                <textFieldExpression><![CDATA[$F{total_trans_count}]]></textFieldExpression>
                            </textField>
                        </jr:detailCell>
                    </jr:column>
                    <jr:column width="90">
                        <jr:columnHeader style="table 5_TH" height="30" rowSpan="1">
                            <staticText>
                                <reportElement x="0" y="0" width="90" height="30"/>
                                <textElement textAlignment="Center" verticalAlignment="Middle"/>
                                <text><![CDATA[All transactions amount]]></text>
                            </staticText>
                        </jr:columnHeader>
                        <jr:detailCell style="table 5_TD" height="20" rowSpan="1">
                            <textField isBlankWhenNull="true">
                                <reportElement x="0" y="0" width="80" height="20"/>
                                <textElement textAlignment="Right" verticalAlignment="Middle"/>
                                <textFieldExpression><![CDATA[$F{total_trans_amount}/$F{trans_curr_exp}]]></textFieldExpression>
                                <patternExpression><![CDATA[$F{trans_amount_format}]]></patternExpression>
                            </textField>
                        </jr:detailCell>
                    </jr:column>
                    <jr:column width="62">
                        <jr:columnHeader style="table 5_TH" height="30" rowSpan="1">
                            <staticText>
                                <reportElement x="0" y="0" width="62" height="30"/>
                                <textElement textAlignment="Center" verticalAlignment="Middle"/>
                                <text><![CDATA[Transactions currency]]></text>
                            </staticText>
                        </jr:columnHeader>
                        <jr:detailCell style="table 5_TD" height="20" rowSpan="1">
                            <textField isBlankWhenNull="true">
                                <reportElement x="0" y="0" width="25" height="20"/>
                                <textElement textAlignment="Right" verticalAlignment="Middle"/>
                                <textFieldExpression><![CDATA[$F{trans_curr_name}]]></textFieldExpression>
                            </textField>
                        </jr:detailCell>
                    </jr:column>
                </jr:table>
            </componentElement>
            <staticText>
                <reportElement x="169" y="31" width="100" height="20"/>
                <text><![CDATA[Totals:]]></text>
            </staticText>
        </band>
    </summary>
</jasperReport>
