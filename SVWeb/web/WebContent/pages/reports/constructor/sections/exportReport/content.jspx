<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich"
		xmlns:bm="http://www.bpc.ru/jsf/misc"
	xmlns:bre="http://www.bpc.ru/jsf/richfaces-ext"
	xmlns:bpct="http://www.bpc.ru/jsf/tiles"
	>
	
	 <style type="text/css">
	 	.rich-panel {
	 		border-style: none;
	 	}
	 </style>
	
	<h:form id="exportForm">
		<rich:extendedDataTable id="dataTable" style="display: none;"
			value="#{exportReport.dataModel}" rows="#{exportReport.rowsNum}" />
		<rich:panel id="htmlReport" style="height: 600px; overflow: auto;">
			<script type="text/javascript">
				jQuery(function($) {
					$(#{rich:element('htmlReport')}).find('table tr td[colspan]:last').css('height', '0px');
				});
			</script>
			<h:outputText value="#{exportReport.dataModel.rowCount == 0 ? lblCommon.no_records_found : exportReport.html}" escape="false" />
		</rich:panel>
          
                 <h:panelGroup layout="block" styleClass="bottom_search_result_block">
                <h:panelGroup layout="block" styleClass="bottom_search_result_left">
                    <h:panelGroup layout="block" styleClass="table_tools">
                        <h:panelGrid styleClass="fw field-cont" columns="4"
                                     columnClasses="per-page-lbl,per-page-sel,nav-cont,pagecount">
                            <h:outputLabel for="rows_num" value="#{lblCommon.rows_per_page}"
                                           title="#{lblCommon.rows_per_page}" />
                            <h:selectOneMenu id="rows_num" value="#{exportReport.rowsNum}"
                                             style="width:40px">
                                <a4j:support event="onchange" limitToList="true"
                                             reRender="htmlReport, pagesNum, btnPanel, dataTable, err_ajax"/>
                                <f:selectItems value="#{CommonUtils.rowNumsList}" />
                            </h:selectOneMenu>

                            <rich:datascroller action="#{exportReport.changePage}"
                            maxPages="10" fastControls="hide"
                                               pagesVar="pages" styleClass="res-datascroller"
                                               id="dsreports" for="dataTable"
                                               reRender="htmlReport">
                                <f:facet name="first">
                                    <h:outputText value="&lt;&lt;" styleClass="prev-next" />
                                </f:facet>
                                <f:facet name="first_disabled">
                                    <h:outputText value="&lt;&lt;" styleClass="prev-next-dis" />
                                </f:facet>
                                <f:facet name="last">
                                    <h:outputText value="&gt;&gt;" styleClass="prev-next" />
                                </f:facet>
                                <f:facet name="last_disabled">
                                    <h:outputText value="&gt;&gt;" styleClass="prev-next-dis" />
                                </f:facet>
                                <f:facet name="previous">
                                    <h:outputText value="#{lblCommon.prev}" styleClass="prev-next" />
                                </f:facet>
                                <f:facet name="previous_disabled">
                                    <h:outputText value="#{lblCommon.prev}"
                                                  styleClass="prev-next-dis" />
                                </f:facet>
                                <f:facet name="next">
                                    <h:outputText value="#{lblCommon.next}" styleClass="prev-next" />
                                </f:facet>
                                <f:facet name="next_disabled">
                                    <h:outputText value="#{lblCommon.next}"
                                                  styleClass="prev-next-dis" />
                                </f:facet>
                                <f:facet name="pages">
                                </f:facet>
                            </rich:datascroller>

                            <h:panelGroup id="pagesNum">
                                <h:outputText styleClass="strongClass" value="#{pages} " />
                                <h:outputText value=" #{lblCommon.pages}" />
                                <h:outputText value="" style="padding-left: 20px; padding-right: 20px;" />
                                <h:outputText styleClass="strongClass" value="#{exportReport.dataModel.rowCount}"/>
                                <h:outputText value=" #{lblCommon.records}"/>
                                <h:outputText value="" style="padding-left: 20px; padding-right: 20px;" />
                            </h:panelGroup>
                        </h:panelGrid>
                    </h:panelGroup>

                    <h:panelGrid id="btnPanel" columns="4" styleClass="buttons_block">
				        <bre:taggedCommandButton id="savePdf" value="#{lblRptc.save_as_pdf}"
							onclick="document.getElementById('exportForm:savePdfCommand').click();" />
						<bre:taggedCommandButton id="saveXls" value="#{lblRptc.save_as_xls}"
							onclick="document.getElementById('exportForm:saveXlsCommand').click();" />
						<bre:taggedCommandButton id="backToReports" value="#{lblForm.back}"
							action="#{exportReport.back}" />
                    </h:panelGrid>
                </h:panelGroup>
            </h:panelGroup>
          
 	 <h:commandButton id="savePdfCommand" value="#{lblRptc.save_as_pdf}"
							action="#{exportReport.savePdf}"
							onclick="if(!checkCount()) return false;" style="display:none" />
	
	<h:commandButton id="saveXlsCommand" value="#{lblRptc.save_as_xls}"
							action="#{exportReport.saveXls}"
							onclick="if(!checkCount()) return false;" style="display:none" />
							
	</h:form>
	<script type="text/javascript">
	function checkCount() {
		var result = (#{exportReport.rowCount} &lt;= #{exportReport.maxCount});
		if (!result) {
			result = confirm('<h:outputFormat value="#{lblRptc.confirm_export_message}">
				<f:param value="#{exportReport.rowCount}" />
				<f:param value="#{exportReport.maxCount}" />
			</h:outputFormat>');
		}
		return result;
	}
	</script>
</ui:composition>







     
