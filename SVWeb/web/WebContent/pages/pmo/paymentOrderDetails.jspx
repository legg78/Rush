<?xml version="1.0" encoding="UTF-8"?>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://java.sun.com/jsf/core"
	xmlns:a4j="http://richfaces.org/a4j" xmlns:rich="http://richfaces.org/rich"
	xmlns:bre="http://www.bpc.ru/jsf/richfaces-ext" xmlns:c="http://java.sun.com/jstl/core">
	<ui:composition>
		<h:form id="pmoDetailsForm">
			<a4j:jsFunction name="rerenderContextMenuPMO" reRender="pmoCtxForm:pmoCtxMenu"
				oncomplete="#{rich:component('pmoCtxForm:pmoCtxMenu')}.doShow(paymentOrderDetails.clickIdEvent, {});">
			</a4j:jsFunction>

			<script>
				paymentOrderDetails = new Object();
				paymentOrderDetails.defaultAction = function(){
					if (#{(ordersContextBean==null ? ordersBean : ordersContextBean).defaultAction.modalItem}) {
						defaultOpenModal();
					} else {
						defaultOpenForm();
					}
				}
			</script>

			<a4j:jsFunction name="defaultOpenModal" action="#{(ordersContextBean==null ? ordersBean : ordersContextBean).initCtxParams}"
				reRender="contextMenuModalPanel"
				oncomplete="Richfaces.showModalPanel('contextMenuModalPanel:#{MbContextMenu.actionParams[(ordersContextBean==null ? ordersBean : ordersContextBean).defaultAction.action]['panelName']}');">
			</a4j:jsFunction>

			<a4j:jsFunction name="defaultOpenForm" action="#{(ordersContextBean==null ? ordersBean : ordersContextBean).ctxPageForward}">
			</a4j:jsFunction>

			<h:panelGroup id="pmoDetailsWrapper" layout="block"
				styleClass="carddata-wrapper"
				style="height: 100%; overflow-y: auto;overflow-x: hidden;position:relative;">
				<rich:dataTable id="pmoDetailsTable" value="#{(ordersContextBean==null ? ordersBean : ordersContextBean).orderParams}"
					var="field" rowKeyVar="index" styleClass="res-table noHeader"
					width="100%" columnClasses="firstCol alignLeft width20, width80 width250 noPadding">
					<rich:columnGroup rendered="#{index == 0}"
						columnClasses="firstCol alignLeft width20, width80 width250 noPadding">
						<rich:column styleClass="detailsCategory expandedBranch">
							<h:graphicImage url="/images/minus.gif" onclick="showHideDetails(this)" />
							<h:outputLabel value="#{lblPrd.general_data}:" />
						</rich:column>
						<rich:column>
						</rich:column>

						<rich:column breakBefore="true">
							<h:outputLabel value="#{lblCommon.id}: " title="#{lblCommon.id}" />
						</rich:column>
						<rich:column>
							<span class="ctxSummoner" onmousedown="handleMouseClick(event)"
								onmouseup="if (rightButton) {paymentOrderDetails.clickIdEvent = event; rerenderContextMenuPMO();} else {paymentOrderDetails.defaultAction();}">
								<h:outputText value="#{(ordersContextBean==null ? ordersBean : ordersContextBean).activePaymentOrder.id}"
									title="#{(ordersContextBean==null ? ordersBean : ordersContextBean).activePaymentOrder.id}" />
							</span>
						</rich:column>

						<rich:column breakBefore="true">
							<h:outputLabel value="#{lblPmo.purpose}: " title="#{lblPmo.purpose}" />
						</rich:column>
						<rich:column>
							<h:outputLabel
								value="#{(ordersContextBean==null ? ordersBean : ordersContextBean).activePaymentOrder.purposeId} - #{(ordersContextBean==null ? ordersBean : ordersContextBean).activePaymentOrder.purposeName}"
								title="#{(ordersContextBean==null ? ordersBean : ordersContextBean).activePaymentOrder.purposeId} - #{(ordersContextBean==null ? ordersBean : ordersContextBean).activePaymentOrder.purposeName}"
								rendered="#{(ordersContextBean==null ? ordersBean : ordersContextBean).activePaymentOrder != null}" />
							<h:outputLabel value=""
								rendered="#{(ordersContextBean==null ? ordersBean : ordersContextBean).activePaymentOrder == null}" />
						</rich:column>

						<rich:column breakBefore="true">
							<h:outputLabel value="#{lblPmo.amount}: " title="#{lblPmo.amount}" />
						</rich:column>
						<rich:column>
							<h:outputLabel id="amount"
								value="#{fmt:formatMoney((ordersContextBean==null ? ordersBean : ordersContextBean).activePaymentOrder.amount, CurrencyUtils.currencyObjectsMap[(ordersContextBean==null ? ordersBean : ordersContextBean).activePaymentOrder.currency].exponent)}"
								title="#{fmt:formatMoney((ordersContextBean==null ? ordersBean : ordersContextBean).activePaymentOrder.amount, CurrencyUtils.currencyObjectsMap[(ordersContextBean==null ? ordersBean : ordersContextBean).activePaymentOrder.currency].exponent)}"
								rendered="#{(ordersContextBean==null ? ordersBean : ordersContextBean).activePaymentOrder != null}" />
							<h:outputLabel value=""
								rendered="#{(ordersContextBean==null ? ordersBean : ordersContextBean).activePaymentOrder == null}" />
						</rich:column>

						<rich:column breakBefore="true">
							<h:outputLabel value="#{lblPmo.currency}: " title="#{lblPmo.currency}" />
						</rich:column>
						<rich:column>
							<div
								class="#{EntityIcons.objectsMapS['ENTT0046'][(ordersContextBean==null ? ordersBean : ordersContextBean).activePaymentOrder.currency]}" />
							<h:outputLabel id="currency"
								value="#{CurrencyUtils.currencyMap[(ordersContextBean==null ? ordersBean : ordersContextBean).activePaymentOrder.currency]}"
								title="#{CurrencyUtils.currencyMap[(ordersContextBean==null ? ordersBean : ordersContextBean).activePaymentOrder.currency]}" />
						</rich:column>

						<rich:column breakBefore="true">
							<h:outputLabel value="#{lblPmo.event_date}: "
								title="#{lblPmo.event_date}" />
						</rich:column>
						<rich:column>
							<h:outputLabel id="eventDate"
								value="#{fmt:formatDate((ordersContextBean==null ? ordersBean : ordersContextBean).activePaymentOrder.eventDate, usession.datePattern, CommonUtils.timeZoneId)}"
								title="#{fmt:formatDate((ordersContextBean==null ? ordersBean : ordersContextBean).activePaymentOrder.eventDate, usession.datePattern, CommonUtils.timeZoneId)}" />
						</rich:column>

						<rich:column breakBefore="true">
							<h:outputLabel value="#{lblPmo.status}: " title="#{lblPmo.status}" />
						</rich:column>
						<rich:column>
							<h:outputLabel id="status"
								value="#{DictUtils.articles[(ordersContextBean==null ? ordersBean : ordersContextBean).activePaymentOrder.status]}"
								title="#{DictUtils.articles[(ordersContextBean==null ? ordersBean : ordersContextBean).activePaymentOrder.status]}" />
						</rich:column>

						<rich:column breakBefore="true">
							<h:outputLabel value="#{lblPmo.object}: " title="#{lblPmo.object}" />
						</rich:column>
						<rich:column>
							<h:outputLabel
								value="#{DictUtils.articles[(ordersContextBean==null ? ordersBean : ordersContextBean).activePaymentOrder.entityType]} - #{(ordersContextBean==null ? ordersBean : ordersContextBean).activePaymentOrder.objectId}"
								title="#{DictUtils.articles[(ordersContextBean==null ? ordersBean : ordersContextBean).activePaymentOrder.entityType]} - #{(ordersContextBean==null ? ordersBean : ordersContextBean).activePaymentOrder.objectId}"
								rendered="#{(ordersContextBean==null ? ordersBean : ordersContextBean).activePaymentOrder != null}" />
							<h:outputLabel value=""
								rendered="#{(ordersContextBean==null ? ordersBean : ordersContextBean).activePaymentOrder == null}" />
						</rich:column>

						<rich:column breakBefore="true">
							<h:outputLabel value="#{lblCommon.institution}: "
								title="#{lblCommon.institution}" />
						</rich:column>
						<rich:column>
							<h:outputLabel
								value="#{(ordersContextBean==null ? ordersBean : ordersContextBean).activePaymentOrder.instId} - #{(ordersContextBean==null ? ordersBean : ordersContextBean).activePaymentOrder.instName}"
								title="#{(ordersContextBean==null ? ordersBean : ordersContextBean).activePaymentOrder.instId} - #{(ordersContextBean==null ? ordersBean : ordersContextBean).activePaymentOrder.instName}" />
						</rich:column>

						<rich:column breakBefore="true">
							<h:outputLabel value="#{lblPmo.attempt_count}: "
								title="#{lblPmo.attempt_count}" />
						</rich:column>
						<rich:column>
							<h:outputLabel value="#{(ordersContextBean==null ? ordersBean : ordersContextBean).activePaymentOrder.attemptCount}"
								title="#{(ordersContextBean==null ? ordersBean : ordersContextBean).activePaymentOrder.attemptCount}" />
						</rich:column>
					</rich:columnGroup>

					<rich:column rendered="#{field.id != null}">
						<h:outputLabel value="#{field.name}: " title="#{field.name}"
							rendered="#{field.name != null and not field.fixed}" />
						<h:outputLabel value="#{field.name} *: " title="#{field.name}"
							rendered="#{field.name != null and field.fixed}" />
						<h:outputLabel value="#{field.systemName}: " title="#{field.systemName}"
							rendered="#{field.name == null and field.systemName != null and not field.fixed}" />
						<h:outputLabel value="#{field.systemName} *: "
							title="#{field.systemName}"
							rendered="#{field.name == null and field.systemName != null and field.fixed}" />
					</rich:column>

					<rich:column rendered="#{field.id != null}">
						<h:outputLabel value="#{field.paramValue}" title="#{field.paramValue}" />
					</rich:column>
				</rich:dataTable>
				<script>setDetailsState("pmoDetailsForm:pmoDetailsTable");makeZebraStyle("pmoDetailsForm:pmoDetailsTable");
				</script>
			</h:panelGroup>
		</h:form>

		<h:form id="pmoCtxForm">
			<rich:contextMenu id="pmoCtxMenu" attached="false"
				submitMode="ajax" disableDefaultMenu="true" selectItemClass="selected-menu-item">
				<c:forEach
					items="#{MbContextMenu.menuItems[(ordersContextBean==null ? ordersBean : ordersContextBean).activePaymentOrder.entityType]}"
					var="ctxItem">
					<rich:menuItem value="#{ctxItem.label}" action="#{(ordersContextBean==null ? ordersBean : ordersContextBean).ctxPageForward}"
						rendered="#{ctxItem.actionItem}">
						<f:setPropertyActionListener value="#{ctxItem}"
							target="#{(ordersContextBean==null ? ordersBean : ordersContextBean).selectedCtxItem}" />
					</rich:menuItem>
					<rich:menuItem value="#{ctxItem.label}" action="#{(ordersContextBean==null ? ordersBean : ordersContextBean).initCtxParams}"
						oncomplete="Richfaces.showModalPanel('contextMenuModalPanel:#{MbContextMenu.actionParams[ctxItem.action]['panelName']}');"
						rendered="#{ctxItem.modalItem}" reRender="contextMenuModalPanel">
						<f:setPropertyActionListener value="#{ctxItem}"
							target="#{(ordersContextBean==null ? ordersBean : ordersContextBean).selectedCtxItem}" />
					</rich:menuItem>
					<rich:menuGroup value="#{ctxItem.label}" rendered="#{ctxItem.group}">
						<c:forEach items="#{ctxItem.children}" var="innerItem">
							<rich:menuItem value="#{ctxItem.label}" action="#{(ordersContextBean==null ? ordersBean : ordersContextBean).ctxPageForward}"
								rendered="#{ctxItem.actionItem}">
								<f:setPropertyActionListener value="#{ctxItem}"
									target="#{(ordersContextBean==null ? ordersBean : ordersContextBean).selectedCtxItem}" />
							</rich:menuItem>
							<rich:menuItem value="#{ctxItem.label}" action="#{(ordersContextBean==null ? ordersBean : ordersContextBean).initCtxParams}"
								oncomplete="Richfaces.showModalPanel('contextMenuModalPanel:#{MbContextMenu.actionParams[ctxItem.action]['panelName']}');"
								rendered="#{ctxItem.modalItem}" reRender="contextMenuModalPanel">
								<f:setPropertyActionListener value="#{ctxItem}"
									target="#{(ordersContextBean==null ? ordersBean : ordersContextBean).selectedCtxItem}" />
							</rich:menuItem>
						</c:forEach>
					</rich:menuGroup>
				</c:forEach>
			</rich:contextMenu>
		</h:form>
	</ui:composition>
</html>
