<?xml version="1.0" encoding="UTF-8"?>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:bm="http://www.bpc.ru/jsf/misc"
	xmlns:bre="http://www.bpc.ru/jsf/richfaces-ext">
<ui:composition>
	<h:form id="tasksBottomForm">
		<h:panelGroup layout="block" styleClass="cardholderdata-wrapper">
			<h:panelGrid columns="2" styleClass="cardholderdata oneColumnTable"
				id="detailsData" columnClasses="firstCol,secondCol">
				<h:outputLabel value="#{lblCommon.lang_selector}: "
					title="#{lblCommon.lang_selector}" />
				<h:selectOneMenu
					disabled="#{MbContainersAllSearch.activeProcess == null}"
					value="#{MbContainerTasksSearch.curLang}"
					valueChangeListener="#{MbContainerTasksSearch.changeLanguage}">
					<a4j:support event="onchange" reRender="tasksTableBottom"
						limitToList="true" />
					<f:selectItems value="#{MbContainerTasksSearch.languages}" />
				</h:selectOneMenu>
			</h:panelGrid>
		</h:panelGroup>
		<h:panelGroup id="tasksTableBottomWrapper" layout="block"
			style="padding:0px;margin:0px;">
			<rich:extendedDataTable id="tasksTableBottom"
									enableContextMenu="true"
									tableState="#{MbContainerTasksSearch.tableState}"
									styleClass="res-table"
									headerClass="res-table-header table-header-ext"
									rowClasses=",odd"
									selectedClass="res-table-selected"
									var="item"
									value="#{MbContainerTasksSearch.tasks}"
									selection="#{MbContainerTasksSearch.itemSelection}"
									rows="0"
									selectionMode="multi"
									noDataLabel="#{lblCommon['no_records_found']}">
				<a4j:support event="onselectionchange" requestDelay="500"
					reRender="tasksBtns" />

				<rich:column id="cron_string" label="Cron string" title="Cron string" width="15%">
					<f:facet name="header">
						<a4j:outputPanel layout="none">
							<script>
								updateHeight();
							</script>
							<h:outputText value="#{lblPrc.cron_string}"
								title="#{lblPrc.cron_string}" />
						</a4j:outputPanel>
					</f:facet>
					<h:outputText value="#{item.cronString}" />
				</rich:column>

				<rich:column id="description" label="Description" title="Description" width="35%"
					sortBy="#{'description'}">
					<f:facet name="header">
						<h:outputText value="#{lblCommon.description}"
							title="#{lblCommon.description}" />
					</f:facet>
					<h:outputText value="#{item.shortDesc}" title="#{item.shortDesc}" />
				</rich:column>

				<rich:column id="error_active_time" label="Active err. time" title="Active err. time" width="15%">
					<f:facet name="header">
						<h:outputText value="#{lblPrc.error_active_time}"
							title="#{lblPrc.error_active_time}" />
					</f:facet>
					<h:outputText value="#{item.timeActive}" />
				</rich:column>

				<rich:column id="period_error_time" label="Period err. time" title="Period err. time" width="15%">
					<f:facet name="header">
						<h:outputText value="#{lblPrc.period_error_time}"
							title="#{lblPrc.period_error_time}" />
					</f:facet>
					<h:outputText value="#{item.timePeriod}" />
				</rich:column>

				<rich:column id="is_stop_on_fatal" label="isStopOnFatal" title="isStopOnFatal" width="10%">
					<f:facet name="header">
						<h:outputText value="#{lblPrc.stop_on_fatal}" title="#{lblPrc.stop_on_fatal}" />
					</f:facet>
					<h:selectBooleanCheckbox value="#{item.stopOnFatal}" title="#{item.stopOnFatal}" disabled="true" />
				</rich:column>

				<rich:column id="is_active" label="isActive" title="isActive" sortBy="#{'isActive'}" width="10%">
					<f:facet name="header">
						<h:outputText value="#{lblPrc.is_active}" title="#{lblPrc.is_active}" />
					</f:facet>
					<h:selectBooleanCheckbox value="#{item.active}" title="#{item.active}" disabled="true" />
				</rich:column>
			</rich:extendedDataTable>
		</h:panelGroup>
		<h:panelGroup id="tasksBtns" layout="block" styleClass="bottom_search_result_block_buttons">
			<h:panelGroup layout="block" styleClass="bottom_search_result_left_buttons" style="padding-right:9px">
               	<h:panelGrid styleClass="fw buttons_block" columns="2" columnClasses=", table_tools_state">
					<h:panelGroup>
						<bre:taggedCommandButton id="prc_view_prc_task_btn"
							value="#{lblForm.view}" reRender="taskViewForm"
							action="#{MbContainerTasksSearch.view}"
							disabled="#{MbContainerTasksSearch.activeTask == null}"
							rendered="#{usession.inRole['VIEW_TASK']}"
							oncomplete="#{rich:component('taskViewModalPanel')}.show()" />
						<bre:taggedCommandButton id="prc_add_prc_task_btn"
							value="#{lblForm.add}" reRender="taskModalHeader, taskEditForm"
							action="#{MbContainerTasksSearch.add}"
							disabled="#{MbContainersAllSearch.activeProcess == null}"
							rendered="#{usession.inRole['ADD_TASK']}"
							oncomplete="#{rich:component('taskModalPanel')}.show()"
							image="/images/create_doc.gif" />
						<bre:taggedCommandButton id="prc_edit_prc_task_btn"
							value="#{lblForm.edit}" reRender="taskModalHeader, taskEditForm"
							action="#{MbContainerTasksSearch.edit}"
							disabled="#{MbContainerTasksSearch.activeTask == null}"
							rendered="#{usession.inRole['MODIFY_TASK']}"
							oncomplete="#{rich:component('taskModalPanel')}.show()"
							image="/images/edit.gif" />
						<bre:taggedCommandButton value="#{lblForm.delete}"
							id="prc_delete_prc_task_btn"
							oncomplete="#{rich:component('deleteTaskViewId:confirmPanel')}.show()"
							disabled="#{MbContainerTasksSearch.activeTask == null}"
							rendered="#{usession.inRole['REMOVE_TASK']}"
							image="/images/delete.gif" />
						<bre:taggedCommandButton id="activateTaskBtn"
							value="#{lblForm.activate}" reRender="tasksBottomForm"
							action="#{MbContainerTasksSearch.activateTask}"
							disabled="#{MbContainerTasksSearch.activeTask == null or MbContainerTasksSearch.activeTask.active}"
							rendered="#{usession.inRole['MODIFY_TASK']}" />
						<bre:taggedCommandButton id="deactivateTaskBtn"
							value="#{lblForm.deactivate}" reRender="tasksBottomForm"
							action="#{MbContainerTasksSearch.deactivateTask}"
							disabled="#{MbContainerTasksSearch.activeTask == null or not MbContainerTasksSearch.activeTask.active}"
							rendered="#{usession.inRole['MODIFY_TASK']}" />
					</h:panelGroup>
					<h:panelGroup>
						<h:graphicImage url="/images/green-tick.png" title="#{lblCommon.save_table_state}" styleClass="action_icon"
							onclick="saveTableState();"/>
						<h:graphicImage url="/images/red-cross.png" title="#{lblCommon.delete_table_state}" styleClass="action_icon"
							onclick="deleteTableState();"/>
						<a4j:queue name="tablestatequeue"/>
						<a4j:jsFunction name="saveTableState" action="#{MbContainerTasksSearch.saveTableStateDB}" eventsQueue="tablestatequeue"/>
						<a4j:jsFunction name="deleteTableState" action="#{MbContainerTasksSearch.deleteTableStateDB}" eventsQueue="tablestatequeue"/>
					</h:panelGroup>
				</h:panelGrid>
			</h:panelGroup>
		</h:panelGroup>
	</h:form>

	<ui:include src="/pages/schedule/schedule_edit.jspx">
		<ui:param name="rerenderList" value="tasksBottomForm" />
	</ui:include>

	<ui:include src="/pages/schedule/schedule_details.jspx" />

	<ui:include src="/pages/utils/confirmPanel.jspx">
		<ui:param name="backingBean" value="#{MbContainerTasksSearch}"/>
		<ui:param name="yesAction" value="delete"/>
		<ui:param name="warningMsg" value="#{lblMsg.confirm_delete}"/> 
		<ui:param name="rerenderList" value="tasksTab"/>
		<ui:param name="confirmQuestion" value=" "/> 
		<ui:param name="subviewId" value="deleteTaskViewId"/>
		<ui:param name="yes" value="#{lblForm.ok}"/>
		<ui:param name="no" value="#{lblForm.cancel}"/>
	</ui:include>

</ui:composition>
</html>