<?xml version="1.0" encoding="UTF-8"?>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:bm="http://www.bpc.ru/jsf/misc"
	xmlns:bre="http://www.bpc.ru/jsf/richfaces-ext"
	>
<ui:composition>
    <script type="text/javascript">
    //<![CDATA[
               var colorOk = "#FFFFFF";
               var colorMandatory = "#FF5555";
               function checkFieldsModal(){
                   var res = false;
                   var institution = document.getElementById("modalAppPageSubView:deliveryForm:instId").value;
                   var agent = document.getElementById("modalAppPageSubView:deliveryForm:agentId").value;
                   var cardType = document.getElementById("modalAppPageSubView:deliveryForm:cardTypeId").value;
                   if (institution == ""){
                       document.getElementById("modalAppPageSubView:deliveryForm:instId").style.backgroundColor = colorMandatory;
                       res = true;
                   }
                   if (agent == ""){
                       document.getElementById("modalAppPageSubView:deliveryForm:agentId").style.backgroundColor = colorMandatory;
                       res = true;
                   }
                   if (cardType == ""){
                       document.getElementById("modalAppPageSubView:deliveryForm:cardTypeId").style.backgroundColor = colorMandatory;
                       res = true;
                   }
                   if (res != true) {
                       allOkModal();
                   }
                   else {
                       alert('#{lblMsg.MANDATORY_FIELDS_NOT_FILED}');
                   }
                   return res;
               }
               function allOkModal(){
                   document.getElementById("modalAppPageSubView:deliveryForm:instId").style.backgroundColor = colorOk;
                   document.getElementById("modalAppPageSubView:deliveryForm:agentId").style.backgroundColor = colorOk;
                   document.getElementById("modalAppPageSubView:deliveryForm:cardTypeId").style.backgroundColor = colorOk;
               }

    //]]>
    </script>

	<rich:modalPanel id="#{viewIdColon}deliverySearchModalPanel" autosized="true" minWidth="900" minHeight="200">
		<f:facet name="header">
			<h:outputText value="#{lblPrd.customers}" />
		</f:facet>
		<f:facet name="controls">
		</f:facet>
		<!-- search panel -->
		<h:panelGroup layout="block" styleClass="search_block_tabs">
			<h:panelGroup layout="block" styleClass="search-block-tabs-head" >
				<h:panelGroup layout="block" styleClass="search-block-tabs-head-inner1" />
			</h:panelGroup>
			<h:panelGroup layout="block" styleClass="search_block_tabs_inner1">
				<h:panelGroup layout="block" styleClass="search_block_tab">
					<h:panelGroup layout="block" styleClass="search_block_inner search_block_inner-hidden" >
						<a4j:form id="#{viewIdColon}deliveryForm">
								<h:panelGroup styleClass="search_block" layout="block">
									<h:panelGroup layout="block" styleClass="search_block_inner1">
									<h:panelGroup layout="block" styleClass="search_block_inner2">
						                <h:panelGroup styleClass="search_block_left" layout="block">
						                	<h:panelGrid styleClass="fw" columns="2" columnClasses="top ,link-cont">
							                	<h:panelGrid styleClass="filter-table field-cont twoColumnTable" columns="4" columnClasses="firstCol,secondCol,firstCol,secondCol">

						                			<h:outputLabel for="instId" value="#{lblCommon.institution}:" title="#{lblCommon.institution}" />
                                                    <h:selectOneMenu id="instId"
                                                        value="#{MbDeliveryRefNumModal.filter.instId}">
                                                        <a4j:support event="onchange" reRender="agentId"
                                                            oncomplete="document.getElementById(form + 'instId').focus();"
                                                            limitToList="true" ajaxSingle="true" />
                                                        <f:selectItems value="#{MbDeliveryRefNumModal.institutions}" />
                                                    </h:selectOneMenu>

                                                    <h:outputLabel for="agentId"
                                                        value="#{lblCommon.agent}: " title="#{lblCommon.agent}" />
                                                    <h:selectOneMenu id="agentId"
                                                        value="#{MbDeliveryRefNumModal.filter.agentId}">
                                                        <f:selectItem itemValue="" />
                                                        <f:selectItems value="#{MbDeliveryRefNumModal.agents}" />
                                                    </h:selectOneMenu>

						                			<h:outputText value="#{lblIss.card_type}:" title="#{lblIss.card_type}" />
						                			<h:selectOneMenu id="cardTypeId"
						                							value="#{MbDeliveryRefNumModal.filter.cardTypeId}">
						                				<f:selectItems value="#{MbDeliveryRefNumModal.cardTypes}"/>
						                			</h:selectOneMenu>

							                	</h:panelGrid>
							                	<h:panelGrid columns="1" >
							                		<bre:taggedCommandButton value="#{lblForm.search}" style="width:85px;"
															 reRender="#{extraIdColon}#{viewIdColon}deliverySearchModalForm"
															 id="searchBtn"
							                				 action="#{MbDeliveryRefNumModal.search}"
							                				 image="/_img/icon_search.png" type="submit"
							                				 onclick="if (checkFieldsModal()){return false;}disableModalPanelBtns(this);"
							                				 oncomplete="enableModalPanelBtns(this);"
							                				 eventsQueue="queue"/>
							                		<h:panelGroup styleClass="link-clear" layout="block"  >
							                			<h:graphicImage url="/_img/icon_clear.png"/>
							                			<a4j:commandLink value="#{lblForm.clear_all}"
							                					action="#{MbDeliveryRefNumModal.clearFilter}"
							                					reRender="deliveriesSearchForm, mainTable, deliveriesForm, deliveriesFormBtnForm">
							                			</a4j:commandLink>
							                		</h:panelGroup>
							                	</h:panelGrid>
						                	</h:panelGrid>
						                </h:panelGroup>
						            </h:panelGroup>
									</h:panelGroup>
					            </h:panelGroup>
							</a4j:form>
						</h:panelGroup>
					</h:panelGroup>
		    </h:panelGroup>
		    <a4j:outputPanel ajaxRendered="true">
				<h:panelGroup id="show_more_panel" styleClass="show-more-vert show-more-vert-tab" layout="block"/>
				<h:graphicImage url="/_img/hd_searchblock.gif"  styleClass="hd-searchblock"/>
               	<h:panelGroup styleClass="collapse-vert collapse-vert-tab" layout="block"/>
			</a4j:outputPanel>
		</h:panelGroup>

		<h:form id="#{viewIdColon}deliverySearchModalForm">

			<rich:extendedDataTable enableContextMenu="true"
				           id="mainTable"
				           tableState="#{MbDeliveryRefNumModal.tableState}"
				           styleClass="res-table"
				           headerClass="res-table-header"
				           rowClasses=",odd"
				           selectedClass="res-table-selected"
				           var="item"
				           value="#{MbDeliveryRefNumModal.deliveries}"
				           selection="#{MbDeliveryRefNumModal.itemSelection}"
				           rows="#{MbDeliveryRefNumModal.rowsNum}"
				           height="255px"
				           selectionMode="single"
				           noDataLabel="#{MbDeliveryRefNumModal.searching ? lblCommon['no_records_found'] : lblCommon['enter_search_criteria_above']}"
				           reRender="selectBtn"
				           onRowMouseDown="handleMouseClick(event)">

		                <rich:column title="#{lblIss.DELIV_REF_NUM}" id="deliveryRefNum" label="#{lblIss.DELIV_REF_NUM}" sortBy="#{'deliveryRefNum'}"  width="25%">
	                        <f:facet name="header">
	                            <a4j:outputPanel layout="none">
									<script>updateHeight();</script>
									<h:outputText value="#{lblIss.DELIV_REF_NUM}" title="#{lblIss.DELIV_REF_NUM}"/>
								</a4j:outputPanel>
	                        </f:facet>
	                        <bm:entityDisplay value="#{item.deliveryRefNum}"/>
	                    </rich:column>

	                    <rich:column id="person" label="#{lblCommon.person}" title="Person" width="50%" sortBy="#{'surname'}">
				           <f:facet name="header">
			                    <h:outputText value="#{lblCommon.person}" title="#{lblCommon.person}"/>
			                </f:facet>
			                 <bm:entityDisplay value="#{item.cardholderName}" />
				        </rich:column>

				        <rich:column title="Status" sortExpression="asc" sortBy="#{'status'}" id="mainTableStatus" label="#{lblCommon.status}" width="25%">
				           <f:facet name="header">
			                    <h:outputText value="#{lblCommon.status}" title="#{lblCommon.status}"/>
			                </f:facet>
			                 <bm:entityDisplay value="#{DictUtils.articles[item.status]}" />
				        </rich:column>

			</rich:extendedDataTable>

			<h:panelGroup layout="block"
				styleClass="bottom_search_result_block_buttons">
				<h:panelGroup layout="block"
					styleClass="bottom_search_result_left_buttons">
					<h:panelGrid columns="4" columnClasses="width99P,,,paddingR12">
						<h:outputText />

						<bre:taggedCommandButton id="selectBtn"
												 value="#{lblForm.select}"
												 action="#{viewScope[MbDeliveryRefNumModal.beanName][MbDeliveryRefNumModal.methodName]}"
												 reRender="${MbDeliveryRefNumModal.rerenderList}"
												 disabled="#{!MbDeliveryRefNumModal.selected}"
												 oncomplete="if (#{usession.noErrorResponse}) Richfaces.hideModalPanel('#{extraIdColon}#{viewIdColon}deliverySearchModalPanel');" />

						<bre:taggedCommandButton value="#{lblForm.cancel}"
												 immediate="true"
												 limitToList="true"
												 oncomplete="Richfaces.hideModalPanel('#{extraIdColon}#{viewIdColon}deliverySearchModalPanel')" />
					</h:panelGrid>
				</h:panelGroup>
			</h:panelGroup>


		</h:form>
	</rich:modalPanel>

</ui:composition>
</html>