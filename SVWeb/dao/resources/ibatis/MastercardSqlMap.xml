<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap
        PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
        "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="mastercard">

    <!--
        Common sql configuration not included in SqlMapConfig
     -->
    <sql id="limitationOpen">
        SELECT *
        FROM (
    </sql>

    <sql id="limitationOpenCount">
        SELECT count(*)
        FROM (
    </sql>

    <sql id="limitationClose">
        ) q
        <isNotNull property="limitation" prepend=" WHERE ">$limitation$</isNotNull>
    </sql>

    <sql id="paginatedOpen">
        SELECT *
        FROM(
        SELECT a.*, rownum r
        FROM(
        <include refid="limitationOpen"/>
    </sql>

    <sql id="paginatedClose">
        <include refid="limitationClose"/>
        ) a
        WHERE rownum <![CDATA[<]]>= (#range.end# + 1)
        )
        WHERE r >= (#range.start# + 1)
    </sql>

    <resultMap  id="mapping-master-fin-message" class="ru.bpc.sv2.ps.mastercard.MasterFinMessage">
        <result property="id"           column="id"/>
        <result property="status"       column="status" />
        <result property="fileId"       column="file_id" />
        <result property="incoming"     column="is_incoming" />
        <result property="reversal"     column="is_reversal" />
        <result property="rejected"     column="is_rejected" />
        <result property="rejectId"     column="reject_id" />
        <result property="fpdMatched"   column="is_fpd_matched" />
        <result property="disputeId"    column="dispute_id" />
        <result property="impact"       column="impact" />
        <result property="sessionId"    column="session_id" />
        <result property="sessionFileId"    column="session_file_id" />
        <result property="fileName"     column="file_name" />
        <result property="fileDate"     column="file_date" />

        <result property="localMessage" column="local_message" />
        <result property="lang"         column="lang" />
        <result property="instId"       column="INST_ID" />
        <result property="instName"     column="INST_NAME" />
        <result property="fsumMatched"  column="IS_FSUM_MATCHED" />
        <result property="mti"          column="MTI" />
        <result property="networkId"    column="NETWORK_ID" />
        <result property="networkName"  column="NETWORK_NAME" />
        <result property="splitHash"    column="SPLIT_HASH" />
        
        <result property="de002"        column="DE002" />
        <result property="de002_mask"   column="DE002_MASK" />
        <result property="de003_1"      column="DE003_1" />
        <result property="de003_2"      column="DE003_2" />
        <result property="de003_3"      column="DE003_3" />
        <result property="de004"        column="DE004" />
        <result property="de005"        column="DE005" />
        <result property="de006"        column="DE006" />
        <result property="de009"        column="DE009" />
        <result property="de010"        column="DE010" />
        <result property="de012"        column="DE012" />
        <result property="de014"        column="DE014" />
        <result property="de022_1"      column="DE022_1" />
        <result property="de022_2"      column="DE022_2" />
        <result property="de022_3"      column="DE022_3" />
        <result property="de022_4"      column="DE022_4" />
        <result property="de022_5"      column="DE022_5" />
        <result property="de022_6"      column="DE022_6" />
        <result property="de022_7"      column="DE022_7" />
        <result property="de022_8"      column="DE022_8" />
        <result property="de022_9"      column="DE022_9" />
        <result property="de022_10"     column="DE022_10" />
        <result property="de022_11"     column="DE022_11" />
        <result property="de022_12"     column="DE022_12" />
        <result property="de023"        column="DE023" />
        <result property="de024"        column="DE024" />
        <result property="de025"        column="DE025" />
        <result property="de026"        column="DE026" />
        <result property="de030_1"      column="DE030_1" />
        <result property="de030_2"      column="DE030_2" />
        <result property="de031"        column="DE031" />
        <result property="de032"        column="DE032" />
        <result property="de033"        column="DE033" />
        <result property="de037"        column="DE037" />
        <result property="de038"        column="DE038" />
        <result property="de040"        column="DE040" />
        <result property="de041"        column="DE041" />
        <result property="de042"        column="DE042" />
        <result property="de043_1"      column="DE043_1" />
        <result property="de043_2"      column="DE043_2" />
        <result property="de043_3"      column="DE043_3" />
        <result property="de043_4"      column="DE043_4" />
        <result property="de043_5"      column="DE043_5" />
        <result property="de043_6"      column="DE043_6" />
        <result property="de049"        column="DE049" />
        <result property="de050"        column="DE050" />
        <result property="de051"        column="DE051" />
        <result property="de054"        column="DE054" />
        <result property="de055"        column="DE055" />
        <result property="de063"        column="DE063" />
        <result property="de071"        column="DE071" />
        <result property="de072"        column="DE072" />
        <result property="de073"        column="DE073" />
        <result property="de093"        column="DE093" />
        <result property="de094"        column="DE094" />
        <result property="de095"        column="DE095" />
        <result property="de100"        column="DE100" />
        <result property="de111"        column="DE111" />
        <result property="disputeRn"    column="DISPUTE_RN" />
        
        <result property="emv_5F2A"     column="EMV_5F2A" />
        <result property="emv_82"       column="EMV_82" />
        <result property="emv_84"       column="EMV_84" />
        <result property="emv_9A"       column="EMV_9A" />
        <result property="emv_9C"       column="EMV_9C" />
        <result property="emv_9F02"     column="EMV_9F02" />
        <result property="emv_9F03"     column="EMV_9F03" />
        <result property="emv_9F09"     column="EMV_9F09" />
        <result property="emv_9F1A"     column="EMV_9F1A" />
        <result property="emv_9F1E"     column="EMV_9F1E" />
        <result property="emv_9F10"     column="EMV_9F10" />
        <result property="emv_9F26"     column="EMV_9F26" />
        <result property="emv_9F27"     column="EMV_9F27" />
        <result property="emv_9F33"     column="EMV_9F33" />
        <result property="emv_9F34"     column="EMV_9F34" />
        <result property="emv_9F35"     column="EMV_9F35" />
        <result property="emv_9F36"     column="EMV_9F36" />
        <result property="emv_9F37"     column="EMV_9F37" />
        <result property="emv_9F41"     column="EMV_9F41" />
        <result property="emv_9F53"     column="EMV_9F53" />
        <result property="emv_95"       column="EMV_95" />

        <result property="p0002"        column="P0002" />
        <result property="p0014"        column="P0014" />
        <result property="p0014_mask"   column="P0014_MASK" />
        <result property="p0023"        column="P0023" />
        <result property="p0025_1"      column="P0025_1" />
        <result property="p0025_2"      column="P0025_2" />
        <result property="p0042"        column="P0042" />
        <result property="p0043"        column="P0043" />
        <result property="p0052"        column="P0052" />
        <result property="p0137"        column="P0137" />
        <result property="p0146"        column="P0146" />
        <result property="p0146_NET"    column="P0146_NET" />
        <result property="p0148"        column="P0148" />
        <result property="p0149_1"      column="P0149_1" />
        <result property="p0149_2"      column="P0149_2" />
        <result property="p0158_1"      column="P0158_1" />
        <result property="p0158_10"     column="P0158_10" />
        <result property="p0158_11"     column="P0158_11" />
        <result property="p0158_12"     column="P0158_12" />
        <result property="p0158_13"     column="P0158_13" />
        <result property="p0158_14"     column="P0158_14" />
        <result property="p0158_2"      column="P0158_2" />
        <result property="p0158_3"      column="P0158_3" />
        <result property="p0158_4"      column="P0158_4" />
        <result property="p0158_5"      column="P0158_5" />
        <result property="p0158_6"      column="P0158_6" />
        <result property="p0158_7"      column="P0158_7" />
        <result property="p0158_8"      column="P0158_8" />
        <result property="p0158_9"      column="P0158_9" />
        <result property="p0159_1"      column="P0159_1" />
        <result property="p0159_2"      column="P0159_2" />
        <result property="p0159_3"      column="P0159_3" />
        <result property="p0159_4"      column="P0159_4" />
        <result property="p0159_5"      column="P0159_5" />
        <result property="p0159_6"      column="P0159_6" />
        <result property="p0159_7"      column="P0159_7" />
        <result property="P0159_8"      column="P0159_8" />
        <result property="p0159_9"      column="P0159_9" />
        <result property="p0165"        column="P0165" />
        <result property="p0176"        column="P0176" />
        <result property="p0198"        column="P0198" />
        <result property="p0200_1"      column="P0200_1" />
        <result property="p0200_2"      column="P0200_2" />
        <result property="p0208_1"      column="P0208_1" />
        <result property="p0208_2"      column="P0208_2" />
        <result property="p0209"        column="P0209" />
        <result property="p0210_1"      column="P0210_1" />
        <result property="p0210_2"      column="P0210_2" />
        <result property="p0228"        column="P0228" />
        <result property="p0230"        column="P0230" />
        <result property="p0241"        column="P0241" />
        <result property="p0243"        column="P0243" />
        <result property="p0244"        column="P0244" />
        <result property="p0260"        column="P0260" />
        <result property="p0261"        column="P0261" />
        <result property="p0262"        column="P0262" />
        <result property="p0264"        column="P0264" />
        <result property="p0265"        column="P0265" />
        <result property="p0266"        column="P0266" />
        <result property="p0267"        column="P0267" />
        <result property="p0268_1"      column="P0268_1" />
        <result property="p0268_2"      column="P0268_2" />
        <result property="p0375"        column="P0375" />

    </resultMap>

    <select id="get-mastercard-fin-messages"
            parameterClass="qparams"
            resultMap="mapping-master-fin-message">
        <include refid="paginatedOpen"/>

        SELECT
        fm.id
        , fm.status
        , fm.file_id
        , fm.is_incoming
        , fm.is_reversal
        , fm.is_rejected
        , fm.reject_id
        , fm.is_fpd_matched
        , fm.dispute_id
        , fm.impact
        , fm.local_message
        , sf.session_id
        , sf.id session_file_id
        , sf.file_name
        , sf.file_date

        , fm.lang
        , fm.inst_id
        , fm.inst_name
        , fm.IS_FSUM_MATCHED
        , fm.MTI
        , fm.network_id
        , fm.network_name
        , fm.split_hash

        , fm.DE002
        , fm.DE002_MASK
        , fm.DE003_1
        , fm.DE003_2
        , fm.DE003_3
        , fm.DE004
        , fm.DE005
        , fm.DE006
        , fm.DE009
        , fm.DE010
        , fm.DE012
        , fm.DE014
        , fm.DE022_1
        , fm.DE022_2
        , fm.DE022_3
        , fm.DE022_4
        , fm.DE022_5
        , fm.DE022_6
        , fm.DE022_7
        , fm.DE022_8
        , fm.DE022_9
        , fm.DE022_10
        , fm.DE022_11
        , fm.DE022_12
        , fm.DE023
        , fm.DE024
        , fm.DE025
        , fm.DE026
        , fm.DE030_1
        , fm.DE030_2
        , fm.DE031
        , fm.DE032
        , fm.DE033
        , fm.DE037
        , fm.DE038
        , fm.DE040
        , fm.DE041
        , fm.DE042
        , fm.DE043_1
        , fm.DE043_2
        , fm.DE043_3
        , fm.DE043_4
        , fm.DE043_5
        , fm.DE043_6
        , fm.DE049
        , fm.DE050
        , fm.DE051
        , fm.DE054
        , RAWTOHEX(fm.DE055) DE055
        , fm.DE063
        , fm.DE071
        , fm.DE072
        , fm.DE073
        , fm.DE093
        , fm.DE094
        , fm.DE095
        , fm.DE100
        , fm.DE111
        , fm.DISPUTE_RN

        , fm.EMV_5F2A
        , fm.EMV_82	
        , fm.EMV_84
        , fm.EMV_9A
        , fm.EMV_9C
        , fm.EMV_9F02
        , fm.EMV_9F03
        , fm.EMV_9F09
        , fm.EMV_9F1A
        , fm.EMV_9F1E
        , fm.EMV_9F10
        , fm.EMV_9F26
        , fm.EMV_9F27
        , fm.EMV_9F33
        , fm.EMV_9F34
        , fm.EMV_9F35
        , fm.EMV_9F36
        , fm.EMV_9F37
        , fm.EMV_9F41
        , fm.EMV_9F53
        , fm.EMV_95

        , fm.P0002
        , fm.P0014
        , fm.P0014_MASK
        , fm.P0023
        , fm.P0025_1
        , fm.P0025_2
        , fm.P0042
        , fm.P0043
        , fm.P0052
        , fm.P0137
        , fm.P0146
        , fm.P0146_NET
        , fm.P0148
        , fm.P0149_1
        , fm.P0149_2
        , fm.P0158_1
        , fm.P0158_10
        , fm.P0158_11
        , fm.P0158_12
        , fm.P0158_13
        , fm.P0158_14
        , fm.P0158_2
        , fm.P0158_3
        , fm.P0158_4
        , fm.P0158_5
        , fm.P0158_6
        , fm.P0158_7
        , fm.P0158_8
        , fm.P0158_9
        , fm.P0159_1
        , fm.P0159_2
        , fm.P0159_3
        , fm.P0159_4
        , fm.P0159_5
        , fm.P0159_6
        , fm.P0159_7
        , fm.P0159_8
        , fm.P0159_9
        , fm.P0165
        , fm.P0176
        , fm.P0198
        , fm.P0200_1
        , fm.P0200_2
        , fm.P0208_1
        , fm.P0208_2
        , fm.P0209
        , fm.P0210_1
        , fm.P0210_2
        , fm.P0228
        , fm.P0230
        , fm.P0241
        , fm.P0243
        , fm.P0244
        , fm.P0260
        , fm.P0261
        , fm.P0262
        , fm.P0264
        , fm.P0265
        , fm.P0266
        , fm.P0267
        , fm.P0268_1
        , fm.P0268_2
        , fm.P0375
        , fm.P0207
        , fm.P0001_1
        , fm.P0001_2
        , fm.P0058
        , fm.P0059
        FROM MCW_UI_FIN_VW fm, PRC_SESSION_FILE sf, MCW_FILE f
        WHERE
          fm.file_id = f.id(+)
        AND f.session_file_id = sf.id(+)
        <iterate prepend="AND" conjunction="AND" property="filters">
        	<isEqual property="filters[].element" compareValue="id">fm.id = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="lang">fm.lang = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="sessionId">sf.session_id = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="fileName">sf.file_name = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="dateFrom">sf.file_date >= TO_DATE(#filters[].value#, 'DD.MM.YYYY')</isEqual>
            <isEqual property="filters[].element" compareValue="dateTo">sf.file_date <![CDATA[<=]]> TO_DATE(#filters[].value#, 'DD.MM.YYYY')</isEqual>
			<isEqual property="filters[].element" compareValue="isRejected">fm.is_rejected = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="fileId">fm.file_id = #filters[].value#</isEqual>
        </iterate>
        <include refid="paginatedClose"/>
    </select>

    <select id="get-mastercard-fin-messages-count"
            parameterClass="qparams"
            resultClass="int">
        <include refid="limitationOpenCount"/>
        SELECT *
        FROM MCW_UI_FIN_VW  fm, PRC_SESSION_FILE sf, MCW_FILE f
        WHERE
        fm.file_id = f.id(+)
        AND f.session_file_id = sf.id(+)
        <iterate prepend="AND" conjunction="AND" property="filters">
        	<isEqual property="filters[].element" compareValue="id">fm.id = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="lang">fm.lang = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="sessionId">sf.session_id = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="fileName">sf.file_name = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="dateFrom">sf.file_date >= TO_DATE(#filters[].value#, 'DD.MM.YYYY')</isEqual>
            <isEqual property="filters[].element" compareValue="dateTo">sf.file_date <![CDATA[<=]]> TO_DATE(#filters[].value#, 'DD.MM.YYYY')</isEqual>
            <isEqual property="filters[].element" compareValue="isRejected">fm.is_rejected = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="fileId">fm.file_id = #filters[].value#</isEqual>
        </iterate>
        <include refid="limitationClose"/>
    </select>

    <resultMap  id="mapping-master-fin-message-addendum" class="ru.bpc.sv2.ps.mastercard.MasterFinMessageAddendum">
        <result property="id"       column="id"/>
        <result property="finId"    column="FIN_ID"/>
        <result property="fileId"   column="FILE_ID"/>
        <result property="incoming" column="IS_INCOMING"/>
        <result property="mti"      column="MTI"/>
        <result property="de024"    column="DE024"/>
        <result property="de071"    column="DE071"/>
        <result property="de032"    column="DE032"/>
        <result property="de024"    column="DE024"/>
        <result property="de033"    column="DE033"/>
        <result property="de063"    column="DE063"/>
        <result property="de093"    column="DE093"/>
        <result property="de094"    column="DE094"/>
        <result property="de100"    column="DE100"/>
        <result property="p0501_1"  column="P0501_1"/>
        <result property="p0501_2"  column="P0501_2"/>
        <result property="p0501_3"  column="P0501_3"/>
        <result property="p0501_4"  column="P0501_4"/>
    </resultMap>


    <select id="get-mastercard-fin-messages-addendum"
            parameterClass="qparams"
            resultMap="mapping-master-fin-message-addendum">
      <include refid="paginatedOpen"/>
        SELECT
          ad.ID
          , ad.FIN_ID
          , ad.FILE_ID
          , ad.IS_INCOMING
          , ad.MTI
          , ad.DE024
          , ad.DE071
          , ad.DE032
          , ad.DE033
          , ad.DE063
          , ad.DE093
          , ad.DE094
          , ad.DE100
          , ad.P0501_1
          , ad.P0501_2
          , ad.P0501_3
          , ad.P0501_4
        FROM MCW_ADD  ad
        <iterate prepend="WHERE" conjunction="AND" property="filters">
            <isEqual property="filters[].element" compareValue="finId">fin_id = #filters[].value#</isEqual>
        </iterate>
      <include refid="paginatedClose"/>
    </select>

    <select id="get-mastercard-fin-messages-addendum-count"
            parameterClass="qparams"
            resultClass="int">
        <include refid="limitationOpenCount"/>
        SELECT *
        FROM MCW_ADD
        <iterate prepend="WHERE" conjunction="AND" property="filters">
            <isEqual property="filters[].element" compareValue="finId">fin_id = #filters[].value#</isEqual>
        </iterate>
        <include refid="limitationClose"/>
    </select>

	<resultMap  id="mapping-mcw-reject"
	            class="ru.bpc.sv2.ps.mastercard.McwReject"  >
	    <result property="id" column="id" />
	    <result property="networkId" column="network_id" />
	    <result property="networkName" column="network_name" />
	    <result property="instId" column="inst_id" />
	    <result property="instName" column="inst_name" />
	    <result property="fileId" column="file_id" />
	    <result property="rejectedFinId" column="rejected_fin_id" />
	    <result property="rejectedFileId" column="rejected_file_id" />
	    <result property="mti" column="mti" />
	    <result property="de024" column="de024" />
	    <result property="de071" column="de071" />
	    <result property="de072" column="de072" />
	    <result property="de093" column="de093" />
	    <result property="de094" column="de094" />
	    <result property="de100" column="de100" />
	    <result property="p0005" column="p0005" />
	    <result property="p0006" column="p0006" />
	    <result property="p0025" column="p0025" />
	    <result property="p0026" column="p0026" />
	    <result property="p0138" column="p0138" />
	    <result property="p0165" column="p0165" />
	    <result property="p0280" column="p0280" />
	</resultMap>
	
		<select id="get-mcw-rejects"
			parameterClass="qparams" resultMap="mapping-mcw-reject">
		<include refid="paginatedOpen" />
			SELECT
				r.id
				,r.network_id
				,r.inst_id
				,r.file_id
				,r.rejected_fin_id
				,r.rejected_file_id
				,r.mti
				,r.de024
				,r.de071
				,r.de072
				,r.de093
				,r.de094
				,r.de100
				,r.p0005
				,r.p0006
				,r.p0025
				,r.p0026
				,r.p0138
				,r.p0165
				,r.p0280
				,n.name network_name
				,i.name inst_name
				,sf.file_name
			FROM
				mcw_reject r
				, net_ui_network_vw n
				, ost_ui_institution_vw i
				, prc_session_file sf
				, mcw_file f
				, prc_session_file rsf
				, mcw_file rf
			WHERE 
				r.file_id = f.id(+)
				and f.session_file_id = sf.id(+)
				and r.rejected_file_id = rf.id(+)
				and rf.session_file_id = rsf.id(+)
				and r.network_id = n.id
				and r.inst_id = i.id
			<iterate prepend="AND" conjunction="AND" property="filters">
				<isEqual property="filters[].element" compareValue="id">r.id = #filters[].value#</isEqual>
				<isEqual property="filters[].element" compareValue="lang">
					n.lang = #filters[].value#
					and i.lang = #filters[].value#
				</isEqual>
				<isEqual property="filters[].element" compareValue="sessionId">sf.session_id = #filters[].value#</isEqual>
	            <isEqual property="filters[].element" compareValue="fileName">sf.file_name = #filters[].value#</isEqual>
	            <isEqual property="filters[].element" compareValue="dateFrom">sf.file_date >= TO_DATE(#filters[].value#, 'DD.MM.YYYY')</isEqual>
	            <isEqual property="filters[].element" compareValue="dateTo">sf.file_date <![CDATA[<=]]> TO_DATE(#filters[].value#, 'DD.MM.YYYY')</isEqual>
	            
				<isEqual property="filters[].element" compareValue="networkId">r.network_id = #filters[].value#</isEqual>
				<isEqual property="filters[].element" compareValue="instId">r.inst_id = #filters[].value#</isEqual>
				<isEqual property="filters[].element" compareValue="fileId">r.file_id = #filters[].value#</isEqual>
				<isEqual property="filters[].element" compareValue="rejectedFinId">r.rejected_fin_id = #filters[].value#</isEqual>
				<isEqual property="filters[].element" compareValue="rejectedFileId">r.rejected_file_id = #filters[].value#</isEqual>
				<isEqual property="filters[].element" compareValue="mti">r.mti = #filters[].value#</isEqual>
				<isEqual property="filters[].element" compareValue="de024">r.de024 = #filters[].value#</isEqual>
				<isEqual property="filters[].element" compareValue="de071">r.de071 = #filters[].value#</isEqual>
				<isEqual property="filters[].element" compareValue="de072">r.de072 = #filters[].value#</isEqual>
				<isEqual property="filters[].element" compareValue="de093">r.de093 = #filters[].value#</isEqual>
				<isEqual property="filters[].element" compareValue="de094">r.de094 = #filters[].value#</isEqual>
				<isEqual property="filters[].element" compareValue="de100">r.de100 = #filters[].value#</isEqual>
				<isEqual property="filters[].element" compareValue="p0005">r.p0005 = #filters[].value#</isEqual>
				<isEqual property="filters[].element" compareValue="p0006">r.p0006 = #filters[].value#</isEqual>
				<isEqual property="filters[].element" compareValue="p0025">r.p0025 = #filters[].value#</isEqual>
				<isEqual property="filters[].element" compareValue="p0026">r.p0026 = #filters[].value#</isEqual>
				<isEqual property="filters[].element" compareValue="p0138">r.p0138 = #filters[].value#</isEqual>
				<isEqual property="filters[].element" compareValue="p0165">r.p0165 = #filters[].value#</isEqual>
				<isEqual property="filters[].element" compareValue="p0280">r.p0280 = #filters[].value#</isEqual>
			</iterate>
			<iterate prepend="ORDER BY" conjunction=", " property="sorting">
				<isNotEqual property="sorting[].direction" compareValue="AUTO">
					<isEqual property="sorting[].property" compareValue="id">r.id $sorting[].direction$</isEqual>		
					<isEqual property="sorting[].property" compareValue="networkId">r.network_id $sorting[].direction$</isEqual>		
					<isEqual property="sorting[].property" compareValue="instId">r.inst_id $sorting[].direction$</isEqual>		
					<isEqual property="sorting[].property" compareValue="fileId">r.file_id $sorting[].direction$</isEqual>		
					<isEqual property="sorting[].property" compareValue="rejectedFinId">r.rejected_fin_id $sorting[].direction$</isEqual>		
					<isEqual property="sorting[].property" compareValue="rejectedFileId">r.rejected_file_id $sorting[].direction$</isEqual>		
					<isEqual property="sorting[].property" compareValue="mti">r.mti $sorting[].direction$</isEqual>		
					<isEqual property="sorting[].property" compareValue="de024">r.de024 $sorting[].direction$</isEqual>		
					<isEqual property="sorting[].property" compareValue="de071">r.de071 $sorting[].direction$</isEqual>		
					<isEqual property="sorting[].property" compareValue="de072">r.de072 $sorting[].direction$</isEqual>		
					<isEqual property="sorting[].property" compareValue="de093">r.de093 $sorting[].direction$</isEqual>		
					<isEqual property="sorting[].property" compareValue="de094">r.de094 $sorting[].direction$</isEqual>		
					<isEqual property="sorting[].property" compareValue="de100">r.de100 $sorting[].direction$</isEqual>		
					<isEqual property="sorting[].property" compareValue="p0005">r.p0005 $sorting[].direction$</isEqual>		
					<isEqual property="sorting[].property" compareValue="p0006">r.p0006 $sorting[].direction$</isEqual>		
					<isEqual property="sorting[].property" compareValue="p0025">r.p0025 $sorting[].direction$</isEqual>		
					<isEqual property="sorting[].property" compareValue="p0026">r.p0026 $sorting[].direction$</isEqual>		
					<isEqual property="sorting[].property" compareValue="p0138">r.p0138 $sorting[].direction$</isEqual>		
					<isEqual property="sorting[].property" compareValue="p0165">r.p0165 $sorting[].direction$</isEqual>		
					<isEqual property="sorting[].property" compareValue="p0280">r.p0280 $sorting[].direction$</isEqual>		
				</isNotEqual>
			</iterate>
		<include refid="paginatedClose" />
	</select>
	
	<select id="get-mcw-rejects-count"
			parameterClass="qparams"
			resultClass="int">
		SELECT
			count(r.id)
		FROM
			mcw_reject r
			, net_ui_network_vw n
			, ost_ui_institution_vw i
		WHERE 
			r.network_id = n.id
			and r.inst_id = i.id
		<iterate prepend="AND" conjunction="AND" property="filters">
			<isEqual property="filters[].element" compareValue="id">r.id = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="lang">n.lang = #filters[].value#
				and i.lang = #filters[].value#
			</isEqual>
			<isEqual property="filters[].element" compareValue="networkId">r.network_id = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="instId">r.inst_id = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="fileId">r.file_id = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="rejectedFinId">r.rejected_fin_id = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="rejectedFileId">r.rejected_file_id = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="mti">r.mti = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="de024">r.de024 = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="de071">r.de071 = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="de072">r.de072 = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="de093">r.de093 = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="de094">r.de094 = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="de100">r.de100 = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="p0005">r.p0005 = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="p0006">r.p0006 = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="p0025">r.p0025 = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="p0026">r.p0026 = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="p0138">r.p0138 = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="p0165">r.p0165 = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="p0280">r.p0280 = #filters[].value#</isEqual>
		</iterate>
	</select>	

	<resultMap  id="mapping-mcw-reject-code"
	            class="ru.bpc.sv2.ps.mastercard.McwRejectCode"  >
	    <result property="rejectId" column="reject_id" />
	    <result property="deNumber" column="de_number" />
	    <result property="severityCode" column="severity_code" />
	    <result property="messageCode" column="message_code" />
	    <result property="subfieldId" column="subfield_id" />
	</resultMap>
	
		<select id="get-mcw-reject-codes"
			parameterClass="qparams" resultMap="mapping-mcw-reject-code">
		<include refid="paginatedOpen" />
			SELECT
				rc.reject_id
				,rc.de_number
				,rc.severity_code
				,rc.message_code
				,rc.subfield_id
			FROM
				mcw_reject_code rc
			<iterate prepend="WHERE" conjunction="AND" property="filters">
				<isEqual property="filters[].element" compareValue="rejectId">rc.reject_id = #filters[].value#</isEqual>
				<isEqual property="filters[].element" compareValue="deNumber">rc.de_number = #filters[].value#</isEqual>
				<isEqual property="filters[].element" compareValue="severityCode">rc.severity_code = #filters[].value#</isEqual>
				<isEqual property="filters[].element" compareValue="messageCode">rc.message_code = #filters[].value#</isEqual>
				<isEqual property="filters[].element" compareValue="subfieldId">rc.subfield_id = #filters[].value#</isEqual>
			</iterate>
			<iterate prepend="ORDER BY" conjunction=", " property="sorting">
				<isNotEqual property="sorting[].direction" compareValue="AUTO">
					<isEqual property="sorting[].property" compareValue="rejectId">rc.reject_id $sorting[].direction$</isEqual>		
					<isEqual property="sorting[].property" compareValue="deNumber">rc.de_number $sorting[].direction$</isEqual>		
					<isEqual property="sorting[].property" compareValue="severityCode">rc.severity_code $sorting[].direction$</isEqual>		
					<isEqual property="sorting[].property" compareValue="messageCode">rc.message_code $sorting[].direction$</isEqual>		
					<isEqual property="sorting[].property" compareValue="subfieldId">rc.subfield_id $sorting[].direction$</isEqual>		
				</isNotEqual>
			</iterate>
		<include refid="paginatedClose" />
	</select>
	
	<select id="get-mcw-reject-codes-count"
			parameterClass="qparams"
			resultClass="int">
		SELECT
			count(*)
		FROM
			mcw_reject_code rc
		<iterate prepend="WHERE" conjunction="AND" property="filters">
			<isEqual property="filters[].element" compareValue="rejectId">rc.reject_id = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="deNumber">rc.de_number = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="severityCode">rc.severity_code = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="messageCode">rc.message_code = #filters[].value#</isEqual>
			<isEqual property="filters[].element" compareValue="subfieldId">rc.subfield_id = #filters[].value#</isEqual>
		</iterate>
	</select>
	
	<procedure id="modify-fin-message" parameterClass="ru.bpc.sv2.ps.mastercard.MasterFinMessage">
		{call mcw_api_fin_pkg.modify_ird(i_id  => #id#
                             		   , i_ird => #p0158_4#)}
	</procedure>

    <resultMap  id="mapping-master-file" class="ru.bpc.sv2.ps.mastercard.MasterFile">
        <result property="sessionId"        column="SESSION_ID" />
        <result property="fileName"         column="FILE_NAME" />
        <result property="fileDate"         column="FILE_DATE" />

        <result property="id"               column="ID"/>
        <result property="instId"           column="INST_ID"/>
        <result property="networkId"        column="NETWORK_ID"/>
        <result property="incoming"         column="IS_INCOMING"/>
        <result property="procDate"         column="PROC_DATE"/>
        <result property="sessionFileId"    column="SESSION_FILE_ID"/>
        <result property="rejected"         column="IS_REJECTED"/>
        <result property="rejectId"         column="REJECT_ID"/>
        <result property="p0026"            column="P0026"/>
        <result property="p0105"            column="P0105"/>
        <result property="p0110"            column="P0110"/>
        <result property="p0122"            column="P0122"/>
        <result property="p0301"            column="P0301"/>
        <result property="p0306"            column="P0306"/>
        <result property="headerMti"        column="HEADER_MTI"/>
        <result property="headerDe024"      column="HEADER_DE024"/>
        <result property="headerDe071"      column="HEADER_DE071"/>
        <result property="trailerMti"       column="TRAILER_MTI"/>
        <result property="trailerDe024"     column="TRAILER_DE024"/>
        <result property="trailerDe071"     column="TRAILER_DE071"/>
        <result property="localFile"        column="LOCAL_FILE"/>
        <result property="instName"         column="INST_NAME" />
    </resultMap>

    <select id="get-mastercard-files"
            parameterClass="qparams"
            resultMap="mapping-master-file">
        <include refid="paginatedOpen"/>

        SELECT
         sf.SESSION_ID
        ,sf.FILE_NAME
        ,sf.FILE_DATE
        ,f.ID
        ,f.INST_ID
        ,f.NETWORK_ID
        ,f.IS_INCOMING
        ,f.PROC_DATE
        ,f.SESSION_FILE_ID
        ,f.IS_REJECTED
        ,f.REJECT_ID
        ,f.P0026
        ,f.P0105
        ,f.P0110
        ,f.P0122
        ,f.P0301
        ,f.P0306
        ,f.HEADER_MTI
        ,f.HEADER_DE024
        ,f.HEADER_DE071
        ,f.TRAILER_MTI
        ,f.TRAILER_DE024
        ,f.TRAILER_DE071
        ,f.LOCAL_FILE
        ,i.NAME INST_NAME
        FROM MCW_FILE f, PRC_SESSION_FILE sf , OST_UI_INSTITUTION_SYS_VW i
        WHERE f.SESSION_FILE_ID = sf.ID(+)
              AND f.INST_ID = i.ID(+)
        <iterate prepend="AND" conjunction="AND" property="filters">
            <isEqual property="filters[].element" compareValue="lang">
                i.lang(+) = #filters[].value#
            </isEqual>
            <isEqual property="filters[].element" compareValue="sessionId">sf.session_id = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="fileName">sf.file_name like #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="dateFrom">sf.file_date >= TO_DATE(#filters[].value#, 'DD.MM.YYYY')</isEqual>
            <isEqual property="filters[].element" compareValue="dateTo">sf.file_date <![CDATA[<=]]> TO_DATE(#filters[].value#, 'DD.MM.YYYY')</isEqual>
        </iterate>
        <iterate prepend="ORDER BY" conjunction=", " property="sorting">
          <isNotEqual property="sorting[].direction" compareValue="AUTO">
              <isEqual property="sorting[].property" compareValue="sessionId">sf.session_id $sorting[].direction$</isEqual>
              <isEqual property="sorting[].property" compareValue="fileName">sf.file_name $sorting[].direction$</isEqual>
              <isEqual property="sorting[].property" compareValue="fileDate">sf.file_date $sorting[].direction$</isEqual>
              <isEqual property="sorting[].property" compareValue="id">f.id $sorting[].direction$</isEqual>
              <isEqual property="sorting[].property" compareValue="instId">f.inst_id $sorting[].direction$</isEqual>
              <isEqual property="sorting[].property" compareValue="networkId">f.network_id $sorting[].direction$</isEqual>
              <isEqual property="sorting[].property" compareValue="incoming">f.is_incoming $sorting[].direction$</isEqual>
              <isEqual property="sorting[].property" compareValue="procDate">f.proc_date $sorting[].direction$</isEqual>
              <isEqual property="sorting[].property" compareValue="sessionFileId">f.session_file_id $sorting[].direction$</isEqual>
              <isEqual property="sorting[].property" compareValue="rejected">f.is_rejected $sorting[].direction$</isEqual>
              <isEqual property="sorting[].property" compareValue="rejectId">f.reject_id $sorting[].direction$</isEqual>
              <isEqual property="sorting[].property" compareValue="p0026">f.p0026 $sorting[].direction$</isEqual>
              <isEqual property="sorting[].property" compareValue="p0105">f.p0105 $sorting[].direction$</isEqual>
              <isEqual property="sorting[].property" compareValue="p0110">f.p0110 $sorting[].direction$</isEqual>
              <isEqual property="sorting[].property" compareValue="p0122">f.p0122 $sorting[].direction$</isEqual>
              <isEqual property="sorting[].property" compareValue="p0301">f.p0301 $sorting[].direction$</isEqual>
              <isEqual property="sorting[].property" compareValue="p0306">f.p0306 $sorting[].direction$</isEqual>
              <isEqual property="sorting[].property" compareValue="headerMti">f.header_mti $sorting[].direction$</isEqual>
              <isEqual property="sorting[].property" compareValue="headerDe024">f.header_de024 $sorting[].direction$</isEqual>
              <isEqual property="sorting[].property" compareValue="headerDe071">f.header_de071 $sorting[].direction$</isEqual>
              <isEqual property="sorting[].property" compareValue="trailerMti">f.trailer_mti $sorting[].direction$</isEqual>
              <isEqual property="sorting[].property" compareValue="trailerDe024">f.trailer_de024 $sorting[].direction$</isEqual>
              <isEqual property="sorting[].property" compareValue="trailerDe071">f.trailer_de071 $sorting[].direction$</isEqual>
              <isEqual property="sorting[].property" compareValue="localFile">f.localFile $sorting[].direction$</isEqual>
              <isEqual property="sorting[].property" compareValue="instName">inst_name $sorting[].direction$</isEqual>
          </isNotEqual>
        </iterate>
        <include refid="paginatedClose"/>
    </select>

    <select id="get-mastercard-files-count"
            parameterClass="qparams"
            resultClass="int">
        <include refid="limitationOpenCount"/>
        SELECT f.ID
        FROM MCW_FILE f, PRC_SESSION_FILE sf , OST_UI_INSTITUTION_SYS_VW i
        WHERE f.SESSION_FILE_ID = sf.ID(+)
        AND f.INST_ID = i.ID(+)
        <iterate prepend="AND" conjunction="AND" property="filters">
            <isEqual property="filters[].element" compareValue="lang">
                i.lang(+) = #filters[].value#
            </isEqual>
            <isEqual property="filters[].element" compareValue="sessionId">sf.session_id = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="fileName">sf.file_name like #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="dateFrom">sf.file_date >= TO_DATE(#filters[].value#, 'DD.MM.YYYY')</isEqual>
            <isEqual property="filters[].element" compareValue="dateTo">sf.file_date <![CDATA[<=]]> TO_DATE(#filters[].value#, 'DD.MM.YYYY')</isEqual>
        </iterate>
        <include refid="limitationClose"/>
    </select>

    <select id="get-mc-abu-files" parameterClass="qparams" resultClass="ru.bpc.sv2.ps.mastercard.AbuFile">
        <include refid="paginatedOpen"/>
        select f.id                  as id
             , f.session_id          as sessionId
             , f.file_name           as fileName
             , f.file_type           as fileType
             , f.inst_id             as instId
             , f.inst_name           as instName
             , f.network_id          as networkId
             , f.network_name        as networkName
             , f.proc_date           as procDate
             , f.is_incoming         as isIncoming
             , f.business_ica        as businessIca
             , f.reason_code         as reasonCode
             , f.original_file_date  as fileDate
             , f.total_msg_count     as totalMsgCount
             , f.total_add_count     as totalAddedCount
             , f.total_changed_count as totalChangedCount
             , f.total_error_count   as totalErrorCount
             , f.record_count        as recordCount
             , f.lang                as lang
          from mcw_ui_abu_file_vw f
        <iterate prepend=" where " conjunction=" and " property="filters">
            <isEqual property="filters[].element" compareValue="lang">f.lang(+) = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="sessionId">f.session_id = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="fileName">f.file_name like #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="dateFrom">f.proc_date >= to_date(#filters[].value#, 'DD.MM.YYYY')</isEqual>
            <isEqual property="filters[].element" compareValue="dateTo">f.proc_date <![CDATA[<=]]> to_date(#filters[].value#, 'DD.MM.YYYY')</isEqual>
            <isEqual property="filters[].element" compareValue="fileType">f.file_type = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="instId">f.inst_id = #filters[].value#</isEqual>
        </iterate>
        <iterate prepend=" order by " conjunction=", " property="sorting">
            <isNotEqual property="sorting[].direction" compareValue="auto">
                <isEqual property="sorting[].property" compareValue="id">f.id $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="fileName">f.file_name $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="fileType">f.file_type $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="sessionId">f.session_id $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="incoming">f.is_incoming $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="businessIca">f.business_ica $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="instId">f.inst_id $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="networkId">f.network_id $sorting[].direction$</isEqual>
            </isNotEqual>
        </iterate>
        <include refid="paginatedClose"/>
    </select>

    <select id="get-mc-abu-files-count" parameterClass="qparams" resultClass="int">
        <include refid="limitationOpenCount"/>
        select f.id
          from mcw_ui_abu_file_vw f
        <iterate prepend=" where " conjunction=" and " property="filters">
            <isEqual property="filters[].element" compareValue="lang">f.lang(+) = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="sessionId">f.session_id = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="fileName">f.file_name like #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="dateFrom">f.proc_date >= to_date(#filters[].value#, 'DD.MM.YYYY')</isEqual>
            <isEqual property="filters[].element" compareValue="dateTo">f.proc_date <![CDATA[<=]]> to_date(#filters[].value#, 'DD.MM.YYYY')</isEqual>
            <isEqual property="filters[].element" compareValue="fileType">f.file_type = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="instId">f.inst_id = #filters[].value#</isEqual>
        </iterate>
        <include refid="limitationClose"/>
    </select>

    <select id="get-mc-abu-file-messages" parameterClass="qparams" resultClass="ru.bpc.sv2.ps.mastercard.AbuFileMessage">
        <include refid="paginatedOpen"/>
        select * from (
            select id              as id
                 , status          as status
                 , inst_id         as instId
                 , inst_name       as instName
                 , network_id      as networkId
                 , network_name    as networkName
                 , proc_date       as messageDate
                 , file_id         as fileId
                 , event_object_id as eventObjectId
                 , confirm_file_id as confirmFileId
                 , issuer_ica      as ica
                 , error_code_1    as errorCode1
                 , error_code_2    as errorCode2
                 , error_code_3    as errorCode3
                 , error_code_4    as errorCode4
                 , error_code_5    as errorCode5
                 , null            as errorCode6
                 , null            as errorCode7
                 , null            as errorCode8
                 , lang            as lang
              from mcw_ui_abu_iss_msg_vw
             union
            select id              as id
                 , status          as status
                 , inst_id         as instId
                 , inst_name       as instName
                 , network_id      as networkId
                 , network_name    as networkName
                 , request_date    as messageDate
                 , file_id         as fileId
                 , event_object_id as eventObjectId
                 , confirm_file_id as confirmFileId
                 , acquirer_ica    as ica
                 , error_code_1    as errorCode1
                 , error_code_2    as errorCode2
                 , error_code_3    as errorCode3
                 , error_code_4    as errorCode4
                 , error_code_5    as errorCode5
                 , error_code_6    as errorCode6
                 , error_code_7    as errorCode7
                 , error_code_8    as errorCode8
                 , lang            as lang
              from mcw_ui_abu_acq_msg_vw)
        <iterate prepend=" where " conjunction=" and " property="filters">
            <isEqual property="filters[].element" compareValue="lang">lang(+) = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="fileId">fileId = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="instId">instId = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="networkId">networkId = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="status">status = #filters[].value#</isEqual>
        </iterate>
        <iterate prepend=" order by " conjunction=", " property="sorting">
            <isNotEqual property="sorting[].direction" compareValue="auto">
                <isEqual property="sorting[].property" compareValue="id">id $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="fileId">fileId $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="status">status $sorting[].direction$</isEqual>
            </isNotEqual>
        </iterate>
        <include refid="paginatedClose"/>
    </select>

    <select id="get-mc-abu-file-messages-count" parameterClass="qparams" resultClass="int">
        <include refid="limitationOpenCount"/>
        select * from (
            select id         as id
                 , inst_id    as instId
                 , network_id as networkId
                 , file_id    as fileId
                 , status     as status
                 , lang       as lang
              from mcw_ui_abu_iss_msg_vw
             union
            select id         as id
                 , inst_id    as instId
                 , network_id as networkId
                 , file_id    as fileId
                 , status     as status
                 , lang       as lang
              from mcw_ui_abu_acq_msg_vw)
        <iterate prepend=" where " conjunction=" and " property="filters">
            <isEqual property="filters[].element" compareValue="lang">lang(+) = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="fileId">fileId = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="instId">instId = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="networkId">networkId = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="status">status = #filters[].value#</isEqual>
        </iterate>
        <include refid="limitationClose"/>
    </select>

    <select id="get-mc-abu-iss-messages" parameterClass="qparams" resultClass="ru.bpc.sv2.ps.mastercard.AbuIssMessage">
        <include refid="paginatedOpen"/>
        select m.id                  as id
             , m.status              as status
             , m.session_id          as sessionId
             , m.inst_id             as instId
             , m.inst_name           as instName
             , m.network_id          as networkId
             , m.network_name        as networkName
             , m.proc_date           as messageDate
             , m.file_id             as fileId
             , m.file_name           as fileName
             , m.event_object_id     as eventObjectId
             , m.confirm_file_id     as confirmFileId
             , m.issuer_ica          as ica
             , m.old_card_number     as oldCardNumber
             , m.old_card_mask       as oldCardMask
             , m.old_expiration_date as oldExpirationDate
             , m.new_card_number     as newCardNumber
             , m.new_card_mask       as newCardMask
             , m.new_expiration_date as newExpirationDate
             , m.reason_code         as reasonCode
             , m.error_code_1        as errorCode1
             , m.error_code_2        as errorCode2
             , m.error_code_3        as errorCode3
             , m.error_code_4        as errorCode4
             , m.error_code_5        as errorCode5
             , m.lang                as lang
          from mcw_ui_abu_iss_msg_vw m
        <iterate prepend=" where " conjunction=" and " property="filters">
            <isEqual property="filters[].element" compareValue="lang">m.lang(+) = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="sessionId">m.session_id = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="status">m.status = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="dateFrom">m.proc_date >= to_date(#filters[].value#, 'DD.MM.YYYY HH24:MI:SS')</isEqual>
            <isEqual property="filters[].element" compareValue="dateTo">m.proc_date <![CDATA[<=]]> to_date(#filters[].value#, 'DD.MM.YYYY HH24:MI:SS')</isEqual>
            <isEqual property="filters[].element" compareValue="instId">m.inst_id = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="networkId">m.network_id = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="ica">m.issuer_ica = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="fileId">m.file_id = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="fileName">m.file_name like #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="oldCardNumber">m.old_card_number like #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="newCardNumber">m.new_card_number like #filters[].value#</isEqual>
        </iterate>
        <iterate prepend=" order by " conjunction=", " property="sorting">
            <isNotEqual property="sorting[].direction" compareValue="auto">
                <isEqual property="sorting[].property" compareValue="id">m.id $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="sessionId">s.session_id $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="ica">m.issuer_ica $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="instId">m.inst_id $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="networkId">m.network_id $sorting[].direction$</isEqual>
            </isNotEqual>
        </iterate>
        <include refid="paginatedClose"/>
    </select>

    <select id="get-mc-abu-iss-messages-count" parameterClass="qparams" resultClass="int">
        <include refid="limitationOpenCount"/>
        select m.id
          from mcw_ui_abu_iss_msg_vw m
        <iterate prepend=" where " conjunction=" and " property="filters">
            <isEqual property="filters[].element" compareValue="lang">m.lang(+) = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="sessionId">m.session_id = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="status">m.status = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="dateFrom">m.proc_date >= to_date(#filters[].value#, 'DD.MM.YYYY HH24:MI:SS')</isEqual>
            <isEqual property="filters[].element" compareValue="dateTo">m.proc_date <![CDATA[<=]]> to_date(#filters[].value#, 'DD.MM.YYYY HH24:MI:SS')</isEqual>
            <isEqual property="filters[].element" compareValue="instId">m.inst_id = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="networkId">m.network_id = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="ica">m.issuer_ica = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="fileId">m.file_id = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="fileName">m.file_name like #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="oldCardNumber">m.old_card_number like #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="newCardNumber">m.new_card_number like #filters[].value#</isEqual>
        </iterate>
        <include refid="limitationClose"/>
    </select>

    <select id="get-mc-abu-acq-messages" parameterClass="qparams" resultClass="ru.bpc.sv2.ps.mastercard.AbuAcqMessage">
        <include refid="paginatedOpen"/>
        select m.id                  as id
             , m.status              as status
             , m.session_id          as sessionId
             , m.inst_id             as instId
             , m.inst_name           as instName
             , m.network_id          as networkId
             , m.network_name        as networkName
             , m.request_date        as messageDate
             , m.file_id             as fileId
             , m.file_name           as fileName
             , m.event_object_id     as eventObjectId
             , m.confirm_file_id     as confirmFileId
             , m.acquirer_ica        as ica
             , m.request_type        as requestType
             , m.merchant_number     as merchantNumber
             , m.merchant_name       as merchantName
             , m.mcc                 as mcc
             , m.error_code_1        as errorCode1
             , m.error_code_2        as errorCode2
             , m.error_code_3        as errorCode3
             , m.error_code_4        as errorCode4
             , m.error_code_5        as errorCode5
             , m.error_code_6        as errorCode6
             , m.error_code_7        as errorCode7
             , m.error_code_8        as errorCode8
             , m.lang                as lang
          from mcw_ui_abu_acq_msg_vw m
        <iterate prepend=" where " conjunction=" and " property="filters">
            <isEqual property="filters[].element" compareValue="lang">m.lang(+) = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="sessionId">m.session_id = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="status">m.status = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="dateFrom">m.request_date >= to_date(#filters[].value#, 'DD.MM.YYYY HH24:MI:SS')</isEqual>
            <isEqual property="filters[].element" compareValue="dateTo">m.request_date <![CDATA[<=]]> to_date(#filters[].value#, 'DD.MM.YYYY HH24:MI:SS')</isEqual>
            <isEqual property="filters[].element" compareValue="instId">m.inst_id = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="networkId">m.network_id = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="ica">m.acquirer_ica = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="fileId">m.file_id = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="fileName">m.file_name like #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="merchantNumber">m.merchant_number like #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="merchantName">m.merchant_name like #filters[].value#</isEqual>
        </iterate>
        <iterate prepend=" order by " conjunction=", " property="sorting">
            <isNotEqual property="sorting[].direction" compareValue="auto">
                <isEqual property="sorting[].property" compareValue="id">m.id $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="fileName">m.file_name $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="fileType">m.file_type $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="sessionId">s.session_id $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="ica">m.issuer_ica $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="instId">m.inst_id $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="networkId">m.network_id $sorting[].direction$</isEqual>
            </isNotEqual>
        </iterate>
        <include refid="paginatedClose"/>
    </select>

    <select id="get-mc-abu-acq-messages-count" parameterClass="qparams" resultClass="int">
        <include refid="limitationOpenCount"/>
        select m.id
          from mcw_ui_abu_acq_msg_vw m
        <iterate prepend=" where " conjunction=" and " property="filters">
            <isEqual property="filters[].element" compareValue="lang">m.lang(+) = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="sessionId">m.session_id = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="status">m.status = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="dateFrom">m.request_date >= to_date(#filters[].value#, 'DD.MM.YYYY HH24:MI:SS')</isEqual>
            <isEqual property="filters[].element" compareValue="dateTo">m.request_date <![CDATA[<=]]> to_date(#filters[].value#, 'DD.MM.YYYY HH24:MI:SS')</isEqual>
            <isEqual property="filters[].element" compareValue="instId">m.inst_id = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="networkId">m.network_id = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="ica">m.acquirer_ica = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="fileId">m.file_id = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="fileName">m.file_name like #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="merchantNumber">m.merchant_number like #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="merchantName">m.merchant_name like #filters[].value#</isEqual>
        </iterate>
        <include refid="limitationClose"/>
    </select>
</sqlMap>