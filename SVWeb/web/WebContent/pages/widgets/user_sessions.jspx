<?xml version="1.0" encoding="UTF-8"?>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:a4j="http://richfaces.org/a4j"
      xmlns:rich="http://richfaces.org/rich"
	  xmlns:bre="http://www.bpc.ru/jsf/richfaces-ext">
<ui:composition>
	<f:loadBundle var="lblPrc" basename="ru.bpc.sv2.ui.bundles.Process"/>

	<ui:include src="/pages/widgets/widget_bar.jspx" >
		<ui:param name="widgetItem" value="#{widgetItem}"/>
		<ui:param name="dashboardWidget" value="#{dashboardWidget}"/>
		<ui:param name="widgetForm" value="userSessionsForm#{dashboardWidget.id}"/>
		<ui:param name="pollForm" value="#{pollForm}"/>
		<ui:param name="refreshWidgetFunction" value="refreshUserSessionsWidget#{dashboardWidget.id}"/>
		<ui:param name="widgetBean" value="#{MbUserLoginsWidget}"/>
	</ui:include>

	<h3> 
        <h:outputLabel value="#{lblPrc.user_sessions}" title="#{lblPrc.user_sessions}"/>
	</h3>
	
	<h:form id="userSessionsForm#{dashboardWidget.id}">
	
	<a4j:jsFunction name="refreshUserSessionsWidget#{dashboardWidget.id}"
			reRender="${pollForm}, userSessionsTable" limitToList="true" action="#{MbUserLoginsWidget.widgets[dashboardWidget.id].refreshHsms}"/>
	
		<h:dataTable value="#{MbUserLoginsWidget.widgets[dashboardWidget.id].sessionsList}" var="item" 
				style="table-layout:fixed;" id="userSessionsTable" styleClass="res-table" 
				headerClass="res-table-header rich-extdt-subheadercell extdt-subheadercell wgtdt-cell"
				rowClasses=",odd" columnClasses="wgtdt-cell rich-extdt-cell width40, wgtdt-cell rich-extdt-cell width20, wgtdt-cell rich-extdt-cell width20, wgtdt-cell rich-extdt-cell width20">
			<h:column>
				<f:facet name="header" >
					<h:outputText style="white-space: normal"
						value="#{lblCommon.user}" title="#{lblCommon.user}"/>
				</f:facet>
				<h:panelGroup layout="block" class="extdt-cell-div">
					<h:outputText value="#{item.userName}" title="#{item.userName}"/>
				</h:panelGroup>
			</h:column>
			
			<h:column>
				<f:facet name="header" >
					<h:outputText style="white-space: normal"
						value="#{lblCommon.ip_address}" title="#{lblCommon.ip_address}"/>
				</f:facet>
				<h:panelGroup layout="block" class="extdt-cell-div">
					<h:outputText value="#{item.ipAddress}" title="#{item.ipAddress}"/>
				</h:panelGroup>
			</h:column>
			
			<h:column>
				<f:facet name="header" >
					<h:outputText style="white-space: normal"
						value="#{lblPrc.start_date}" title="#{lblPrc.start_date}"/>
				</f:facet>
				<h:panelGroup layout="block" class="extdt-cell-div">
					<h:outputText value="#{item.startDate}">
	                        	<f:convertDateTime pattern="#{usession.datePattern} HH:mm:ss" timeZone="#{CommonUtils.timeZoneId}"/>
	                        </h:outputText>
				</h:panelGroup>
			</h:column>
			
			<h:column>
				<f:facet name="header" >
					<h:outputText style="white-space: normal"
						value="#{lblPrc.last_used}" title="#{lblPrc.last_used}"/>
				</f:facet>
				<h:panelGroup layout="block" class="extdt-cell-div">
					 <h:outputText value="#{item.lastUsed}">
	                        	<f:convertDateTime pattern="#{usession.datePattern} HH:mm:ss" timeZone="#{CommonUtils.timeZoneId}"/>
	                        </h:outputText>
				</h:panelGroup>
			</h:column>
				
		</h:dataTable>
	</h:form>

	<ui:include src="/pages/widgets/parameter_modal.jspx" >
		<ui:param name="MbReportWidgetBean" value="#{MbUserLoginsWidget}"/>
	</ui:include>
</ui:composition>
</html>
