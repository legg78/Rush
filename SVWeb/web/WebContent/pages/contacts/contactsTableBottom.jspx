<?xml version="1.0" encoding="UTF-8"?>
<html	xmlns="http://www.w3.org/1999/xhtml"
		xmlns:f="http://java.sun.com/jsf/core"
		xmlns:h="http://java.sun.com/jsf/html"
		xmlns:ui="http://java.sun.com/jsf/facelets"
		xmlns:a4j="http://richfaces.org/a4j"
		xmlns:rich="http://richfaces.org/rich"
		xmlns:bm="http://www.bpc.ru/jsf/misc"
		xmlns:bre="http://www.bpc.ru/jsf/richfaces-ext"
		xmlns:fmt="http://www.bpc.ru/el/formatter">
<ui:composition>
	<style type="text/css">
	.linkLike {
		color: #2486C8;
		text-decoration: underline;
		cursor: pointer;
	}
	.linkLike:hover {
		color: #272F36;
	}
	</style>
	<h:panelGrid width="100%" columns="2" cellpadding="0" cellspacing="0" columnClasses="width50 top, width50 top">
	<h:form>
		<h:panelGroup layout="block" styleClass="cardholderdata-wrapper">
	 		<h:panelGrid columns="2" styleClass="cardholderdata oneColumnTable" id="detailsData" columnClasses="firstCol,secondCol">
	 			<h:outputLabel value="#{lblCommon.lang_selector}: " title="#{lblCommon.lang_selector}"/>
	 			<h:selectOneMenu value="#{MbContactSearch.curLang}" valueChangeListener="#{MbContactSearch.changeLang}">
					<a4j:support event="onchange" reRender="bottomContactsTable" limitToList="true"/>
					<f:selectItems value="#{MbContactSearch.languages }"/>
				</h:selectOneMenu>
	 		</h:panelGrid>
	 	</h:panelGroup>
	</h:form> 
	<h:form>
		<h:panelGroup layout="block" styleClass="cardholderdata-wrapper">
	 		<h:panelGrid columns="2" styleClass="cardholderdata oneColumnTable" id="detailsData" columnClasses="firstCol,secondCol">
	 			<h:outputLabel value="#{lblCommon.show_only_active}: " title="#{lblCommon.show_only_active}" style="width: auto;"/>
	 			<h:selectBooleanCheckbox value="#{MbContactDataSearch.activeOnly}">
					<a4j:support event="onchange" action="#{MbContactDataSearch.search}" reRender="bottomContactDatasTable,contactDataListBtns" limitToList="true"/>
				</h:selectBooleanCheckbox>
	 		</h:panelGrid>
	 	</h:panelGroup>
	</h:form> 
	</h:panelGrid>
	<h:panelGrid width="100%" columns="2" cellpadding="0" cellspacing="0" columnClasses="width50 top, width50 top">
	<h:form id="contactsForm">		
	 	<h:panelGroup id="bottomContactsTableWrapper" layout="block" style="padding:0px;margin:0px;">
			<rich:extendedDataTable enableContextMenu="true"
		           	id="bottomContactsTable"
		           	styleClass="res-table"
		           	headerClass="res-table-header table-header-ext"
		           	selectedClass="res-table-selected"
		           	rowClasses=",odd"
		           	var="item"
		           	value="#{(contactsTableBean==null ? MbContactSearch : contactsTableBean).contacts}"
		           	selection="#{(contactsTableBean==null ? MbContactSearch : contactsTableBean).itemSelection}"
		           	rows="0"
		           	height="#{tableHeight == null ? '178px' : tableHeight}"
					selectionMode="single"
					tableState="#{(contactsTableBean==null ? MbContactSearch : contactsTableBean).tableState}"
					noDataLabel="#{lblCommon['no_records_found']}">
					
				<a4j:support event="onselectionchange" reRender="contactListBtns, bottomContactDatasTable, contactDataListBtns" />
				
			    <rich:column label="Contact type"
						title="Contact type" id="contactType" sortBy="#{'contactType'}"
			            width="30%">
					<f:facet name="header">
						<a4j:outputPanel layout="none">         
							<script>updateHeight();</script>
		                    <h:outputText value="#{lblCommon.contact_type}" title="#{lblCommon.contact_type}"/>
						</a4j:outputPanel>
	                </f:facet>
					<f:facet name="filter">
						<a4j:region>
							<h:selectOneMenu value="#{(contactsTableBean==null ? MbContactSearch : contactsTableBean).filter.contactType}" style="width: 100%;">
								<f:selectItem itemValue=""/>
								<f:selectItems value="#{(contactsTableBean==null ? MbContactSearch : contactsTableBean).contactTypes}" />
								<a4j:support event="onchange" reRender="bottomContactsTable, bottomContactDatasTable, contactListBtns" requestDelay="500" action="#{(contactsTableBean==null ? MbContactSearch : contactsTableBean).search}"/>
							</h:selectOneMenu>
						</a4j:region>
					</f:facet>
					<h:panelGroup layout="block" >
						<bm:entityDisplay 
		                		value="#{DictUtils.articles[item.contactType]}"
				                description="#{DictUtils.articles[item.contactType]}"/>
	                </h:panelGroup>
		        </rich:column>
		        
		        <rich:column id="position" title="#{lblCommon.position}" width="20%"
					label="#{lblCommon.position}">
					<f:facet name="filter">						
					</f:facet>
					<f:facet name="header">
						<h:outputText value="#{lblCommon.position}"
							title="#{lblCommon.position}">
	
						</h:outputText>
					</f:facet>
						<bm:entityDisplay 
		                		value="#{DictUtils.articles[item.jobTitle]}"
				                description="#{DictUtils.articles[item.jobTitle]}"/>
				</rich:column>
	
		        <rich:column id="person" label="Person" title="Person"  width="45%"
						>
		           <f:facet name="header">
	                    <h:outputText value="#{lblCommon.person}" title="#{lblCommon.person}" />
	                </f:facet>
	                <h:panelGroup>
	                	<bm:entityDisplay 
		                		value="#{item.person.fullName}"
				                description="#{item.person.fullName}"/>
	                	<h:outputText value=" 	&#160;" rendered="#{item.contactType == null}" escape="true"/>                	
	                </h:panelGroup>
		        </rich:column>
		    </rich:extendedDataTable>
		</h:panelGroup>

		<h:panelGroup layout="block" styleClass="bottom_search_result_block_buttons">
			<h:panelGroup layout="block" styleClass="bottom_search_result_left_buttons" rendered="#{contactsTableBean==null}">
				<h:panelGrid id="contactListBtns" styleClass="fw buttons_block" columns="2" columnClasses=", table_tools_state">
					<h:panelGroup>
						
						<bre:taggedCommandButton
								value="#{lblForm.view}"
								rendered="#{usession.inRole['VIEW_CONTACT']}"
								action="#{(contactsTableBean==null ? MbContactSearch : contactsTableBean).viewContact}"
	             				reRender="common_contact_modal_div,common_contact_modal_header" limitToList="true"
	             				oncomplete="#{rich:component('common_contact_modal_panel')}.show();"
	                      		disabled="#{(contactsTableBean==null ? MbContactSearch : contactsTableBean).activeContact == null}"/>
	                	<bre:taggedCommandButton
	            	           	value="#{lblForm.add}" id="com_contact_add_btn"
	            	           	action="#{(contactsTableBean==null ? MbContactSearch : contactsTableBean).addContact}"
								oncomplete="#{rich:component('common_contact_modal_panel')}.show()"
								reRender="common_contact_modal_div,common_contact_modal_header" limitToList="true"
	                      		disabled="#{(contactsTableBean==null ? MbContactSearch : contactsTableBean).objectId == null}"
	                      		rendered="#{(parentPriv == null or parentPriv) and usession.inRole['ADD_CONTACT'] and (contactsTableBean==null ? MbContactSearch : contactsTableBean).renderAdd}"
	                      		image="/images/create_doc.gif"/>
	                	<bre:taggedCommandButton
	                      		value="#{lblForm.edit}" id="com_contact_edit_btn"
	                      		action="#{(contactsTableBean==null ? MbContactSearch : contactsTableBean).editContact}"
	                      		oncomplete="#{rich:component('common_contact_modal_panel')}.show()"
	                      		reRender="common_contact_modal_div,common_contact_modal_header" limitToList="true"
	                      		disabled="#{(contactsTableBean==null ? MbContactSearch : contactsTableBean).activeContact == null}"
	                      		rendered="#{(parentPriv == null or parentPriv) and usession.inRole['MODIFY_CONTACT'] and (contactsTableBean==null ? MbContactSearch : contactsTableBean).renderEdit}"
	                      		image="/images/edit.gif"/>
						<bre:taggedCommandButton
	                    	   	value="#{lblForm.delete}" id="com_contact_delete_btn"
	                       		disabled="#{(contactsTableBean==null ? MbContactSearch : contactsTableBean).activeContact == null}"
	                       		rendered="#{(parentPriv == null or parentPriv) and usession.inRole['REMOVE_CONTACT'] and (contactsTableBean==null ? MbContactSearch : contactsTableBean).renderDelete}"
	                       		image="/images/delete.gif"
	                       		oncomplete="#{rich:component('deleteContactView:confirmPanel')}.show()"/>
	                    </h:panelGroup>
	                    <h:panelGroup>
							<h:graphicImage url="/images/green-tick.png" title="#{lblCommon.save_table_state}" styleClass="action_icon"
								onclick="saveContactTableState();"/>
							<h:graphicImage url="/images/red-cross.png" title="#{lblCommon.delete_table_state}" styleClass="action_icon"
								onclick="deleteContactTableState();"/>
							<a4j:queue name="tablestatequeue"/>
							<a4j:jsFunction name="saveContactTableState" action="#{(contactsTableBean==null ? MbContactSearch : contactsTableBean).saveTableStateDB}" eventsQueue="tablestatequeue"/>
							<a4j:jsFunction name="deleteContactTableState" action="#{(contactsTableBean==null ? MbContactSearch : contactsTableBean).deleteTableStateDB}" eventsQueue="tablestatequeue"/>
						</h:panelGroup>
				</h:panelGrid>
			</h:panelGroup>
		</h:panelGroup>
	</h:form>
	
	<h:form id="contactDatasForm">		
	 	<h:panelGroup id="bottomContactDatasTableWrapper" layout="block" style="padding:0px;margin:0px;">
			<rich:extendedDataTable enableContextMenu="true"
		           	id="bottomContactDatasTable"
		           	styleClass="res-table"
		           	headerClass="res-table-header table-header-ext"
		           	selectedClass="res-table-selected"
		           	rowClasses=",odd"
		           	var="item"
		           	value="#{(contactsDataBean==null ? MbContactDataSearch : contactsDataBean).contactDatas}"
		           	selection="#{(contactsDataBean==null ? MbContactDataSearch : contactsDataBean).itemSelection}"
		           	rows="0"
		           	height="#{tableHeight == null ? '178px' : tableHeight}"
					selectionMode="single"
					tableState="#{(contactsDataBean==null ? MbContactDataSearch : contactsDataBean).tableState}"
					noDataLabel="#{lblCommon['no_records_found']}">
					
				<a4j:support event="onselectionchange" reRender="contactDataListBtns" />
				
				<rich:column id="type" title="#{lblCommon.type}" width="20%" sortBy="#{'type'}" sortOrder="ASCENDING"
					label="#{lblCommon.type}">
					<f:facet name="filter">
						<a4j:region>
							<h:selectOneMenu value="#{(contactsDataBean==null ? MbContactDataSearch : contactsDataBean).filter.type}" style="width: 100%;">
								<f:selectItem itemValue=""/>
								<f:selectItems value="#{(contactsDataBean==null ? MbContactDataSearch : contactsDataBean).types}" />
								<a4j:support event="onchange" reRender="bottomContactDatasTable, contactDataListBtns" requestDelay="500" action="#{(contactsDataBean==null ? MbContactDataSearch : contactsDataBean).search}"/>
							</h:selectOneMenu>
						</a4j:region>
					</f:facet>
					<f:facet name="header">
						<a4j:outputPanel layout="none">         
							<script>updateHeight();</script>
							<h:outputText value="#{lblCommon.type}"
								title="#{lblCommon.type}">
							</h:outputText>
						</a4j:outputPanel>
					</f:facet>
					<bm:entityDisplay 
		                		value="#{DictUtils.articles[item.type]}"
				                description="#{DictUtils.articles[item.type]}"/>
				</rich:column>
				
				<rich:column id="value" title="#{lblCommon.value}" width="30%" sortBy="#{'address'}"
					label="#{lblCommon.value}">
					<f:facet name="filter">
						<a4j:region rendered="false">
							<h:inputText value="#{(contactsDataBean==null ? MbContactDataSearch : contactsDataBean).filter.address}"
									style="width:100%" onkeydown="if (ignoreEnter(event)) return false;">
								<a4j:support event="onkeyup" reRender="bottomContactsTable"
									requestDelay="500" action="#{(contactsDataBean==null ? MbContactDataSearch : contactsDataBean).search}" />
							</h:inputText>
						</a4j:region>
					</f:facet>
					<f:facet name="header">
						<h:outputText value="#{lblCommon.value}"
							title="#{lblCommon.value}">
	
						</h:outputText>
					</f:facet>
					<bm:entityDisplay 
		                		value="#{item.address}"
				                description="#{item.address}"/>
				</rich:column>
				<rich:column id="reg_date" title="#{lblCommon.reg_date}" width="25%" sortBy="#{'startDate'}"
					label="#{lblCommon.reg_date}">
					<f:facet name="header">
						<h:outputText value="#{lblCommon.reg_date}"
							title="#{lblCommon.reg_date}">	
						</h:outputText>
					</f:facet>
					<bm:entityDisplay value="#{fmt:formatDate(item.startDate, usession.fullDatePattern, CommonUtils.timeZoneId)}"
									  description="#{fmt:formatDate(item.startDate, usession.fullDatePattern, CommonUtils.timeZoneId)}"/>
				</rich:column>
				<rich:column id="deactivation_date" title="#{lblCommon.deactivation_date}" width="20%" sortBy="#{'endDate'}"
					label="#{lblCommon.deactivation_date}">
					<f:facet name="header">
						<h:outputText value="#{lblCommon.deactivation_date}"
							title="#{lblCommon.deactivation_date}">	
						</h:outputText>
					</f:facet>
					<bm:entityDisplay value="#{fmt:formatDate(item.endDate, usession.fullDatePattern, CommonUtils.timeZoneId)}"
									  description="#{fmt:formatDate(item.endDate, usession.fullDatePattern, CommonUtils.timeZoneId)}"/>
				</rich:column>
		    </rich:extendedDataTable>
		</h:panelGroup>

		<h:panelGroup layout="block" styleClass="bottom_search_result_block_buttons">
			<h:panelGroup layout="block" styleClass="bottom_search_result_left_buttons" rendered="#{contactsDataBean==null}">
				<h:panelGrid id="contactDataListBtns" styleClass="fw buttons_block" columns="2" columnClasses=", table_tools_state">
					<h:panelGroup>		
                	<bre:taggedCommandButton
            	           	value="#{lblForm.add}" id="com_contact_data_add_btn"
            	           	action="#{(contactsDataBean==null ? MbContactDataSearch : contactsDataBean).add}"
							oncomplete="#{rich:component('common_contact_data_modal_panel')}.show()"
							reRender="common_contact_data_modal_div,common_contact_data_modal_header" limitToList="true"
                      		disabled="#{(contactsDataBean==null ? MbContactDataSearch : contactsDataBean).contactId == null}"
                      		rendered="#{usession.inRole['MODIFY_CONTACT'] and (contactsTableBean==null ? MbContactSearch : contactsTableBean).renderAdd}"
                      		image="/images/create_doc.gif"/>
                	<bre:taggedCommandButton
                      		value="#{lblForm.edit}" id="com_contact_data_edit_btn"
                      		action="#{(contactsDataBean==null ? MbContactDataSearch : contactsDataBean).edit}"
                      		oncomplete="#{rich:component('common_contact_data_modal_panel')}.show()"
                      		reRender="common_contact_data_modal_div,common_contact_data_modal_header" limitToList="true"
                      		disabled="#{(contactsDataBean==null ? MbContactDataSearch : contactsDataBean).activeContactData == null}"
                      		rendered="#{usession.inRole['MODIFY_CONTACT'] and (contactsTableBean==null ? MbContactSearch : contactsTableBean).renderEdit}"
                      		image="/images/edit.gif"/>
					<bre:taggedCommandButton
                    	   	value="#{lblForm.delete}" id="com_contact_data_delete_btn"
                       		disabled="#{(contactsDataBean==null ? MbContactDataSearch : contactsDataBean).activeContactData == null}"
                       		rendered="#{usession.inRole['MODIFY_CONTACT'] and MbContactSearch.renderDelete}"
                       		image="/images/delete.gif"
                       		oncomplete="#{rich:component('deleteContactDataView:confirmPanel')}.show()"/>
                    </h:panelGroup>
                    <h:panelGroup>
						<h:graphicImage url="/images/green-tick.png" title="#{lblCommon.save_table_state}" styleClass="action_icon"
							onclick="saveContactDataTableState();"/>
						<h:graphicImage url="/images/red-cross.png" title="#{lblCommon.delete_table_state}" styleClass="action_icon"
							onclick="deleteContactDataTableState();"/>
						<a4j:queue name="tablestatequeue"/>
						<a4j:jsFunction name="saveContactDataTableState" action="#{(contactsDataBean==null ? MbContactDataSearch : contactsDataBean).saveTableStateDB}" eventsQueue="tablestatequeue"/>
						<a4j:jsFunction name="deleteContactDataTableState" action="#{(contactsDataBean==null ? MbContactDataSearch : contactsDataBean).deleteTableStateDB}" eventsQueue="tablestatequeue"/>
					</h:panelGroup>
				</h:panelGrid>
			</h:panelGroup>
		</h:panelGroup>
	</h:form>
</h:panelGrid>
	<rich:modalPanel id="common_contact_modal_panel" autosized="true" minWidth="300" minHeight="150" showWhenRendered="#{MbContactSearch.showModal}">
    	<f:facet name="header">
    		<h:panelGroup id="common_contact_modal_header">
    			<h:outputText value="#{lblCommon.contact}" rendered="#{MbContactSearch.viewMode}"/>
        		<h:outputText value="#{lblCommon.edit_contact}" rendered="#{MbContactSearch.editMode}"/>
        		<h:outputText value="#{lblCommon.new_contact}" rendered="#{MbContactSearch.newMode}"/>
        	</h:panelGroup>
		</f:facet>
		<f:facet name="controls">
		</f:facet>
		<h:panelGroup id="common_contact_modal_div">
		<h:form id="common_contact_modal_form" rendered="#{!MbContactSearch.viewMode}">
		    <h:panelGrid id="contactDiv">
		    	<ui:include src="/pages/contacts/contact_edit.jspx"/>
			</h:panelGrid>
			<h:panelGroup layout="block" styleClass="bottom_search_result_block_buttons">
				<h:panelGroup layout="block" styleClass="bottom_search_result_left_buttons">
	     	    	<h:panelGrid columns="3" columnClasses="width99P,,paddingR12">
						<h:outputText/>
						<bre:taggedCommandButton
			            		value="#{lblForm.save}" type="submit"
			                	reRender="bottomContactsTable, contactListBtns, bottomContactDatasTable, contactDataListBtns"
			                	action="#{MbContactSearch.save}"
								onclick="if (!checkContactFields()) return false; disableModalPanelBtns(this)"
								oncomplete="enableModalPanelBtns(this); if (#{usession.noErrorResponse}) #{rich:component('common_contact_modal_panel')}.hide()"
			                	/>
						<bre:taggedCommandButton
								value="#{lblForm.cancel}"
								action="#{MbContactSearch.close}" immediate="true"
								oncomplete="#{rich:component('common_contact_modal_panel')}.hide()"
								/>
					</h:panelGrid>
				</h:panelGroup>
			</h:panelGroup>
		</h:form>
		
		<h:form id="common_contact_view_modal_div" rendered="#{MbContactSearch.viewMode}">
		    <h:panelGrid>
		    	<ui:include src="/pages/contacts/contact_details.jspx"/>
			</h:panelGrid>
			<h:panelGroup layout="block" styleClass="bottom_search_result_block_buttons">
				<h:panelGroup layout="block" styleClass="bottom_search_result_left_buttons">
	     	    	<h:panelGrid columns="3" columnClasses="width99P,paddingR12">
						<h:outputText/>
						
						<bre:taggedCommandButton
								value="#{lblForm.cancel}"
								action="#{MbContactSearch.close}" immediate="true"
								oncomplete="#{rich:component('common_contact_modal_panel')}.hide()"
								/>
					</h:panelGrid>
				</h:panelGroup>
			</h:panelGroup>
		</h:form>
		</h:panelGroup>
	</rich:modalPanel>
	
	<rich:modalPanel id="common_contact_data_modal_panel" autosized="true" minWidth="300" minHeight="100">
    	<f:facet name="header">
    		<h:panelGroup id="common_contact_data_modal_header">
    			<h:outputText value="#{lblCommon.contact_data}" rendered="#{MbContactDataSearch.viewMode}"/>
        		<h:outputText value="#{lblCommon.edit_contact_data}" rendered="#{MbContactDataSearch.editMode}"/>
        		<h:outputText value="#{lblCommon.new_contact_data}" rendered="#{MbContactDataSearch.newMode}"/>
        	</h:panelGroup>
		</f:facet>
		<f:facet name="controls">
		</f:facet>
		<h:panelGroup id="common_contact_data_modal_div">
		<h:form id="common_contact_data_modal_form" rendered="#{!MbContactDataSearch.viewMode}">
		    <h:panelGrid id="contactDataDiv">
		    	<ui:include src="/pages/contacts/contact_data_edit.jspx"/>
			</h:panelGrid>
			<h:panelGroup layout="block" styleClass="bottom_search_result_block_buttons">
				<h:panelGroup layout="block" styleClass="bottom_search_result_left_buttons">
	     	    	<h:panelGrid columns="3" columnClasses="width99P,,paddingR12">
						<h:outputText/>
						<bre:taggedCommandButton
			            		value="#{lblForm.save}" type="submit"
			                	reRender="bottomContactDatasTable, contactDataListBtns"
			                	action="#{MbContactDataSearch.save}"
								onclick="if (!checkContactDataFields()) return false; disableModalPanelBtns(this)"
								oncomplete="enableModalPanelBtns(this); if (#{usession.noErrorResponse}) #{rich:component('common_contact_data_modal_panel')}.hide()"
			                	/>
						<bre:taggedCommandButton
								value="#{lblForm.cancel}"
								action="#{MbContactDataSearch.close}" immediate="true"
								oncomplete="#{rich:component('common_contact_data_modal_panel')}.hide()"
								/>
					</h:panelGrid>
				</h:panelGroup>
			</h:panelGroup>
		</h:form>
		
		</h:panelGroup>
	</rich:modalPanel>
	
	<ui:include src="/pages/utils/confirmPanel.jspx">
		<ui:param name="backingBean" value="#{MbContactSearch}"/>
		<ui:param name="yesAction" value="deleteContact"/>
		<ui:param name="warningMsg" value="#{lblMsg.confirm_delete}"/> 
		<ui:param name="rerenderList" value="bottomContactsTable, contactListBtns, bottomContactDatasTable, contactDataListBtns"/>
		<ui:param name="confirmQuestion" value=" "/> 
		<ui:param name="subviewId" value="deleteContactView"/>
		<ui:param name="yes" value="#{lblForm.ok}"/>
		<ui:param name="no" value="#{lblForm.cancel}"/>
	</ui:include>
	
	<ui:include src="/pages/utils/confirmPanel.jspx">
		<ui:param name="backingBean" value="#{MbContactDataSearch}"/>
		<ui:param name="yesAction" value="delete"/>
		<ui:param name="warningMsg" value="#{lblMsg.confirm_delete}"/> 
		<ui:param name="rerenderList" value="bottomContactDatasTable,contactDataListBtns"/>
		<ui:param name="confirmQuestion" value=" "/> 
		<ui:param name="subviewId" value="deleteContactDataView"/>
		<ui:param name="yes" value="#{lblForm.ok}"/>
		<ui:param name="no" value="#{lblForm.cancel}"/>
	</ui:include>

	
	
	
	
</ui:composition>
</html>
