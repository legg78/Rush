<?xml version="1.0" encoding="UTF-8"?>
<html   xmlns="http://www.w3.org/1999/xhtml"
		xmlns:f="http://java.sun.com/jsf/core"
		xmlns:h="http://java.sun.com/jsf/html"
		xmlns:ui="http://java.sun.com/jsf/facelets"
		xmlns:a4j="http://richfaces.org/a4j"
		xmlns:rich="http://richfaces.org/rich"
		xmlns:bre="http://www.bpc.ru/jsf/richfaces-ext">
<ui:composition>
	<style type="text/css">
	.noLeftPadding {
		padding-left:0;
		
	}
	</style>	

	<rich:modalPanel id="addressModalPanel" autosized="true" minWidth="200" minHeight="100">
      	<f:facet name="header">
        	<h:panelGroup id="addressModalHeader">
	        	<h:outputText value="#{lblCommon.new_address}" rendered="#{MbAddressesSearch.newMode}"/>
	        	<h:outputText value="#{lblCommon.edit_address}" rendered="#{MbAddressesSearch.editMode}"/>
	        </h:panelGroup>
        </f:facet>
  	    <f:facet name="controls">
      	</f:facet>
      	<h:panelGroup id="addressModalDiv">
      		<h:form id="editAddressForm">
				<script type="text/javascript">
//<!--
					
					 oldValue["editAddressForm"] = "#{MbAddressesSearch.newAddress.lang}";
					jQuery(document).ready(function() {
						jQuery("#editAddressForm\\:country").msDropdown();					
					});
					
					function checkAddressFields() {
						var checked = true;
						
						if (document.getElementById('editAddressForm:addrType').value == "") {
							document.getElementById('editAddressForm:addrTypeError').style.display = "inline";
							checked = false;
						}
						
						if (document.getElementById('editAddressForm:country').value == "") {
							document.getElementById('editAddressForm:countryError').style.display = "inline";
							checked = false;
						}
						
						if (document.getElementById('editAddressForm:region').value == "") {
							document.getElementById('editAddressForm:regionError').style.display = "inline";
							checked = false;
						}
						
						if (document.getElementById('editAddressForm:city').value == "") {
							document.getElementById('editAddressForm:cityError').style.display = "inline";
							checked = false;
						}
						if (document.getElementById('editAddressForm:street').value == "") {
							document.getElementById('editAddressForm:streetError').style.display = "inline";
							checked = false;
						}
						if (document.getElementById('editAddressForm:house').value == "") {
							document.getElementById('editAddressForm:houseError').style.display = "inline";
							checked = false;
						}
						
						checked = checkCoordinates() && checked;
						
						return checked;
					}
					
					function checkCoordinates() {
						if (document.getElementById('editAddressForm:longitude').value == ""
								&& document.getElementById('editAddressForm:latitude').value == "") {
							return true;
						}
						if (document.getElementById('editAddressForm:longitude').value == ""
								&& document.getElementById('editAddressForm:latitude').value != "") {
							document.getElementById('editAddressForm:longitudeReq').style.display = "inline";
							return false;
						}
						if (document.getElementById('editAddressForm:longitude').value != ""
								&& document.getElementById('editAddressForm:latitude').value == "") {
							document.getElementById('editAddressForm:latitudeReq').style.display = "inline";
							return false;
						}
					
						var checked = true; 
						if (document.getElementById('editAddressForm:latitude').value > 90 ||
								document.getElementById('editAddressForm:latitude').value < -90) {
							document.getElementById('editAddressForm:latitudeBounds').style.display = "inline";
							checked = false;
						}
						if (document.getElementById('editAddressForm:longitude').value > 180 ||
								document.getElementById('editAddressForm:longitude').value < -180) {
							document.getElementById('editAddressForm:longitudeBounds').style.display = "inline";
							checked = false;
						}
						return checked;
					}
					
					function hideCoordsErrorFields(elem) {
						document.getElementById(elem.id + "Req").style.display = "none";
						document.getElementById(elem.id + "Bounds").style.display = "none";
					}
				//-->
				</script>

				<h:panelGroup layout="block" styleClass="cardholderdata-wrapper">
					<h:panelGrid columns="2" styleClass="cardholderdata" id="detailsData" width="100%" columnClasses="firstColModal, width250">        			  		 			
			
						<h:outputLabel for="addrType" value="* #{lblCommon.address_type}: " title="#{lblCommon.address_type}"/>
						<h:panelGrid columns="1" cellspacing="0" cellpadding="0">
							<h:selectOneMenu id="addrType" value="#{MbAddressesSearch.newAddress.addressType}"
									disabled="#{!MbAddressesSearch.newMode}"
									label="#{lblCommon.address_type}"
									onblur="hideErrorField(this)">
								<f:selectItems value="#{MbAddressesSearch.addressTypes}"/>
							</h:selectOneMenu>
							<h:outputFormat value="#{lblMsg.value_request}" styleClass="errorMarker"
								id="addrTypeError" style="display:none;">
								<f:param name="fieldName" value="#{lblCommon.address_type}"/>
							</h:outputFormat>
						</h:panelGrid>
				
						<h:outputLabel for="lang" value="#{lblCommon.language}: " title="#{lblCommon.language}"/>
						<h:panelGrid cellpadding="0" cellspacing="0">
							<h:selectOneMenu id="newLang" value="#{MbAddressesSearch.newAddress.lang}"
									rendered="#{MbAddressesSearch.newMode}">
								<f:selectItems value="#{MbAddressesSearch.languages}"/>
							</h:selectOneMenu>
							<h:selectOneMenu id="editLang" value="#{MbAddressesSearch.newAddress.lang}"
									rendered="#{MbAddressesSearch.editMode}"
									onchange="document.getElementById('address:confirmPanelForm:newValue').value = this.value;
											#{rich:component('address:confirmPanel')}.show()">
								<f:selectItems value="#{MbAddressesSearch.languages}"/>
							</h:selectOneMenu>
						</h:panelGrid>

						<h:outputLabel for="country" value="* #{lblCommon.country}: " title="#{lblCommon.country}"/>
						<h:panelGrid columns="1" cellspacing="0" cellpadding="0" >
							<h:selectOneMenu id="country" value="#{MbAddressesSearch.newAddress.country}"
									disabled="#{MbAddressesSearch.translMode}" 
									label="#{lblCommon.country}"
									onmouseout="hideErrorField(this);"
									style="width: 257px;">
								<f:attribute name="data-image" value="/sv/images/msdropdown/icons/blank.gif"></f:attribute>
								<f:attribute name="data-imagecss" value="#{CountryUtils.allFlags}"></f:attribute> 	
								<f:selectItems value="#{CountryUtils.allCountries}"/>
							</h:selectOneMenu>
							<h:outputFormat value="#{lblMsg.value_request}" styleClass="errorMarker"
								id="countryError" style="display:none;">
								<f:param name="fieldName" value="#{lblCommon.country}"/>
							</h:outputFormat>
						</h:panelGrid>
							
						<h:outputLabel for="postalCode" value="#{lblCommon.postal_code}: " title="#{lblCommon.postal_code}"/>
						<h:inputText id="postalCode" value="#{MbAddressesSearch.newAddress.postalCode}" maxlength="10"
                                     label="#{lblCommon.postal_code}" validator="bpc.RegExValidator">
                            <f:attribute name="pattern" value="^([\p{Alnum}\p{Space}-])*$"/>
                            <f:attribute name="textPattern" value="#{lblCommon.human_pattern_postal_code}"/>
                            <f:attribute name="fieldName" value="#{lblCommon.postal_code}"/>
                        </h:inputText>
				
						<h:outputLabel for="regionCode" value="#{lblCommon.region_code}: " title="#{lblCommon.region_code}"/>
						<h:inputText id="regionCode" value="#{MbAddressesSearch.newAddress.regionCode}" maxlength="8"/>
			
						<h:outputLabel for="region" value="* #{lblCommon.region}: " title="#{lblCommon.region}"/>
						<h:panelGrid columns="1" cellspacing="0" cellpadding="0">
							<h:inputText id="region" value="#{MbAddressesSearch.newAddress.region}" maxlength="100" 
								label="#{lblCommon.region}" onblur="hideErrorField(this)">
								<f:validateLength minimum="2"/>
							</h:inputText>	
							<h:outputFormat value="#{lblMsg.value_request}" styleClass="errorMarker"
								id="regionError" style="display:none;">
								<f:param name="fieldName" value="#{lblCommon.region}"/>
							</h:outputFormat>	
						</h:panelGrid>
					
						<h:outputLabel for="city" value="* #{lblCommon.city}: " title="#{lblCommon.city}"/>
						<h:panelGrid columns="1" cellspacing="0" cellpadding="0">
							<h:inputText id="city" value="#{MbAddressesSearch.newAddress.city}" maxlength="200"
									label="#{lblCommon.city}"
									onblur="hideErrorField(this)">
									<f:validateLength minimum="2"/>
							</h:inputText>		
							<h:outputFormat value="#{lblMsg.value_request}" styleClass="errorMarker"
								id="cityError" style="display:none;">
								<f:param name="fieldName" value="#{lblCommon.city}"/>
							</h:outputFormat>
						</h:panelGrid>
						
						<h:outputLabel for="street" value="* #{lblCommon.street}: " title="#{lblCommon.street}"/>
						<h:panelGrid columns="1" cellspacing="0" cellpadding="0">
							<h:inputText id="street" maxlength="100"
									value="#{MbAddressesSearch.newAddress.street}"
									label="#{lblCommon.street}"
									onblur="hideErrorField(this)">
									<f:validateLength minimum="2"/>
							</h:inputText>		
							<h:outputFormat value="#{lblMsg.value_request}" styleClass="errorMarker"
								id="streetError" style="display:none;">
								<f:param name="fieldName" value="#{lblCommon.street}"/>
							</h:outputFormat>
						</h:panelGrid>
						
						<h:outputLabel for="house" value="* #{lblCommon.house}: " title="#{lblCommon.house}"/>
						<h:panelGrid columns="1" cellspacing="0" cellpadding="0">
							<h:inputText id="house" style="width:50px" maxlength="100"
									value="#{MbAddressesSearch.newAddress.house}"
									label="#{lblCommon.house}"
									onblur="hideErrorField(this)"/>
							<h:outputFormat value="#{lblMsg.value_request}" styleClass="errorMarker"
								id="houseError" style="display:none;">
								<f:param name="fieldName" value="#{lblCommon.house}"/>
							</h:outputFormat>
						</h:panelGrid>
							
						<h:outputLabel for="apt" value="#{lblCommon.apt}: " title="#{lblCommon.apt}"/>
						<h:inputText id="apt" style="width:50px" value="#{MbAddressesSearch.newAddress.apartment}" maxlength="100"/>
						
						<h:outputLabel for="latitude" value="#{lblCommon.latitude}: " title="#{lblCommon.latitude}"/>
						<h:panelGrid columns="1" cellspacing="0" cellpadding="0">
							<h:inputText id="latitude" maxlength="10"
									value="#{MbAddressesSearch.newAddress.latitude}" 
									title="#{MbAddressesSearch.newAddress.latitude}"
									onkeypress="if (!numbersOnly(this, event, true, true)) return false;"
									onchange="hideCoordsErrorFields(this);">
								<f:convertNumber minFractionDigits="0" maxFractionDigits="5"/>
							</h:inputText>
							<h:outputFormat value="#{lblMsg.value_request}" styleClass="errorMarker"
									id="latitudeReq" style="display:none;">
								<f:param name="fieldName" value="#{lblCommon.latitude}"/>
							</h:outputFormat>
							<h:outputFormat value="#{lblMsg.value_mustbe_in_range}" styleClass="errorMarker"
									id="latitudeBounds" style="display:none;">
								<f:param name="min" value="-90"/>
								<f:param name="max" value="90"/>
							</h:outputFormat>
							<rich:message for="latitude" styleClass="errorMarker"/>
						</h:panelGrid>
						
						<h:outputLabel for="longitude" value="#{lblCommon.longitude}: " title="#{lblCommon.longitude}"/>
						<h:panelGrid columns="1" cellspacing="0" cellpadding="0">
							<h:inputText id="longitude" maxlength="10" 
									value="#{MbAddressesSearch.newAddress.longitude}"
									title="#{MbAddressesSearch.newAddress.longitude}" 
									onkeypress="if (!numbersOnly(this, event, true, true)) return false;"
									onchange="hideCoordsErrorFields(this);">
								<f:convertNumber minFractionDigits="0" maxFractionDigits="5"/>
							</h:inputText>
							<h:outputFormat value="#{lblMsg.value_request}" styleClass="errorMarker"
									id="longitudeReq" style="display:none;">
								<f:param name="fieldName" value="#{lblCommon.longitude}"/>
							</h:outputFormat>
							<h:outputFormat value="#{lblMsg.value_mustbe_in_range}" styleClass="errorMarker"
									id="longitudeBounds" style="display:none;">
								<f:param name="min" value="-180"/>
								<f:param name="max" value="180"/>
							</h:outputFormat>
							<rich:message for="longitude" styleClass="errorMarker"/>
						</h:panelGrid>
						
						<h:outputLabel for="placeCode" value="#{lblCommon.place_code}: " title="#{lblCommon.place_code}"/>
						<h:inputText id="placeCode" maxlength="10" 
								value="#{MbAddressesSearch.newAddress.placeCode}"
								title="#{MbAddressesSearch.newAddress.placeCode}" >
						</h:inputText>
					</h:panelGrid>
				</h:panelGroup>
       	    	<h:panelGroup layout="block" styleClass="bottom_search_result_block_buttons">
					<h:panelGroup layout="block" styleClass="bottom_search_result_left_buttons">
		       	    	<h:panelGrid columns="3" columnClasses="width99P,,paddingR12">
			       	    	<h:outputText/>
							<bre:taggedCommandButton value="#{lblForm.save}" type="submit" 
									action="#{MbAddressesSearch.save}"
									reRender="#{rerenderList}"
									onclick="if (!checkAddressFields()) return false; disableModalPanelBtns(this)"
									oncomplete="enableModalPanelBtns(this); if (#{usession.noErrorResponse}) #{rich:component('addressModalPanel')}.hide()"
									/>
							<bre:taggedCommandButton value="#{lblForm.cancel}" 
									immediate="true" limitToList="true"
									action="#{MbAddressesSearch.close}"
									oncomplete="#{rich:component('addressModalPanel')}.hide()"
									/>
						</h:panelGrid>
					</h:panelGroup>
				</h:panelGroup>
      	    </h:form>
		</h:panelGroup>
	</rich:modalPanel>

    <ui:include src="/pages/utils/langConfirmPanel.jspx">
    	<ui:param name="backingBean" value="#{MbAddressesSearch}"/>
    	<ui:param name="rerenderList" value="editAddressForm:region, editAddressForm:city, editAddressForm:street"/>
    	<ui:param name="editElem" value="editAddressForm:editLang"/>
    	<ui:param name="newValue" value="#{MbAddressesSearch.newAddress.lang}"/>
    	<ui:param name="subviewId" value="address"/>
    	<ui:param name="formName" value="editAddressForm"/>
    </ui:include>
    
</ui:composition>
</html>