<?xml version="1.0" encoding="UTF-8"?>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html" xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:bpct="http://www.bpc.ru/jsf/tiles" xmlns:bre="http://www.bpc.ru/jsf/richfaces-ext"
	xmlns:rich="http://richfaces.org/rich" xmlns:a4j="http://richfaces.org/a4j"
	xmlns:bpc="http://www.bpc.ru/jsf/misc">
	<ui:composition template="./cardDetailsTemplate.jspx">
		<ui:define name="stepContent">
			<f:loadBundle var="lblCommon" basename="ru.bpc.sv2.ui.bundles.Common" />
			<f:loadBundle var="lblFcl" basename="ru.bpc.sv2.ui.bundles.Fcl" />
			<f:loadBundle var="lblAcc" basename="ru.bpc.sv2.ui.bundles.Acc" />
			<ui:include src="/pages/utils/confirmPanel.jspx">
				<ui:param name="backingBean" value="#{MbManualFeeAccDS}"/>
				<ui:param name="yesAction" value="next"/>
				<ui:param name="warningMsg" value="#{lblMsg.fee_curr_different_acc_curr}"/>
				<ui:param name="rerenderList" value="#{viewId}stepPage, #{viewId}wizardButtonsForm, err_ajax, #{viewId}wizardNavigationForm"/>
				<ui:param name="subviewId" value="diffCurrAccCurr"/>
				<ui:param name="confirmQuestion" value=" "/>
				<ui:param name="yes" value="#{lblForm.ok}"/>
				<ui:param name="no" value="#{lblForm.cancel}"/>
			</ui:include>
			<h:form id="cardManualFeeDS" style="padding:10px;">
				<ui:include src="/pages/common/wizard/commonWizardActions.jspx">
					<ui:param name="bean" value="#{bean}" />
					<ui:param name="action" value="#{action}" />
					<ui:param name="modalSubview" value="diffCurrAccCurr" />
					<ui:param name="modalPanel" value="confirmPanel" />
				</ui:include>
			

				<h:outputLabel value="#{lblCommon.select_card_instance}:" style="font-weight:bold;" />

				<rich:extendedDataTable id="cardInstances"
					var="item" value="#{MbManualFeeAccDS.cardInstances}" selection="#{MbManualFeeAccDS.cardInstancesSelection}"
					rows="0" selectionMode="single" rowClasses=",odd" headerClass="res-table-header"
					selectedClass="res-table-selected" styleClass="res-table" height="150px"
					enableContextMenu="false" noDataLabel="#{lblCommon['no_records_found']}">

					<a4j:support event="onselectionchange" ajaxSingle="true"
						reRender="newStatus, invalidCardInstance" limitToList="true" />

					<rich:column id="seq_number" label="#{lblIss.seq_number}"
						title="Seq number" sortBy="#{'seqNumber'}" width="30%" sortOrder="DESCENDING">
						<f:facet name="header">
							<h:outputText value="#{lblIss.seq_number}" title="#{lblIss.seq_number}" />
						</f:facet>
						<h:outputText value="#{item.seqNumber}" />
					</rich:column>

					<rich:column id="status" label="#{lblCommon.status}"
						title="Status" sortBy="#{'status'}" width="40%">
						<f:facet name="header">
							<h:outputText value="#{lblCommon.status}" title="#{lblCommon.status}" />
						</f:facet>
						<h:outputText value="#{DictUtils.articles[item.status]}"
							title="#{DictUtils.articles[item.status]}" />
					</rich:column>

					<rich:column id="expir_date" label="#{lblIss.expir_date}"
						title="Expiration date" sortBy="#{'expirDate'}" width="30%">
						<f:facet name="header">
							<h:outputText value="#{lblIss.expir_date}" title="#{lblIss.expir_date}" />
						</f:facet>
						<h:outputText value="#{item.expirDate}">
							<f:convertDateTime pattern="MM.yyyy"
								timeZone="#{CommonUtils.timeZone}" />
						</h:outputText>
					</rich:column>
				</rich:extendedDataTable>

				<h:outputLabel id="invalidCardInstance" value="Please, select a card instance!"
					styleClass="errorMarker" rendered="#{MbManualFeeAccDS.invalidCardInstance}" />

				<h:panelGroup layout="block" styleClass="cardholderdata-wrapper">
					<h:panelGrid columns="2" styleClass="cardholderdata"
						columnClasses="width-150, width250">

						<h:outputLabel for="feeType" title="#{lblFcl.fee_type}"
							value="* #{lblFcl.fee_type}:" />

						<h:panelGrid columns="1" cellpadding="0" cellspacing="0">
							<h:selectOneMenu id="feeType" onblur="hideErrorField(this)"
								value="#{MbManualFeeAccDS.feeType}" label="#{lblFcl.fee_type}">
								<f:selectItem itemValue="" />
								<f:selectItems value="#{MbManualFeeAccDS.feeTypes}" />
								<a4j:support event="onchange" reRender="currency, feeAmountGroup" limitToList="true" ajaxSingle="true"/>
							</h:selectOneMenu>

							<h:outputFormat value="#{lblMsg.value_request}" styleClass="errorMarker"
								id="feeTypeError" style="display:none;">
								<f:param name="fieldName" value="#{lblFcl.fee_type}"/>
							</h:outputFormat>
						</h:panelGrid>
						
						<h:outputLabel value="* #{lblCommon.currency}: "
							title="#{lblCommon.currency}" />
						<h:panelGrid columns="1" cellpadding="0" cellspacing="0">
							<h:selectOneMenu id="currency" onblur="hideErrorField(this)"
								value="#{MbManualFeeAccDS.currency}" label="#{lblCommon.currency}"
								disabled="true" >
								<f:selectItem itemValue="" />
								<f:selectItems value="#{MbManualFeeAccDS.currencies}" />
								<a4j:support event="onchange" ajaxSingle="true" reRender="showDialog" limitToList="true" />
							</h:selectOneMenu>
							<h:outputFormat value="#{lblMsg.value_request}" styleClass="errorMarker"
									id="currencyError" style="display:none;">
									<f:param name="fieldName" value="#{lblCommon.currency}"/>
							</h:outputFormat>
						</h:panelGrid>

						<h:outputLabel for="accountId" title="#{lblAcc.account_number_to_apply_fee_to}"
							value="* #{lblAcc.account}:" />

						<h:panelGrid columns="1" cellpadding="0" cellspacing="0">
							<h:selectOneMenu id="accountId" onblur="hideErrorField(this)"
								value="#{MbManualFeeAccDS.accountId}" label="#{lblAcc.account}">
								<f:selectItem itemValue="" />
								<f:selectItems value="#{MbManualFeeAccDS.accounts}" />
								<a4j:support event="onchange" reRender="accountCurrency, showDialog" limitToList="true" ajaxSingle="true"/>
							</h:selectOneMenu>

							<h:outputFormat value="#{lblMsg.value_request}" styleClass="errorMarker"
								id="accountIdError" style="display:none;">
								<f:param name="fieldName" value="#{lblAcc.account}"/>
							</h:outputFormat>
						</h:panelGrid>
						
						<h:outputLabel title="#{lblAcc.account_currency}" value="* #{lblAcc.account_currency}:" />
						<h:panelGrid columns="1" cellpadding="0" cellspacing="0" >
							<h:selectOneMenu id="accountCurrency" onblur="hideErrorField(this)" disabled="true"
								value="#{MbManualFeeAccDS.accountCurrency}" label="#{lblAcc.account_currency}">
								<f:selectItem itemValue="" />
								<f:selectItems value="#{MbManualFeeAccDS.accountCurrencies}" />
							</h:selectOneMenu>
						</h:panelGrid>
						
						<h:outputLabel for="feeAmount" title="#{lblMsg.modify_fee_amount}"
							value="* #{lblFcl.fee_amount}:" />

						<h:panelGrid columns="1" cellpadding="0" cellspacing="0"
							id="feeAmountGroup">
							<h:inputText id="feeAmount" value="#{MbManualFeeAccDS.feeAmount}"
								label="#{lblFcl.fee_amount}" onblur="hideErrorField(this)"
								disabled="#{!usession.inRole['MODIFY_FEE_AMOUNT']}" >
								<bpc:numericMaskConverter numericType="double" />
								<f:attribute name="decDigits"
									value="#{CurrencyUtils.currencyObjectsMap[MbManualFeeAccDS.currency].exponent}" />
							</h:inputText>
							<h:outputFormat value="#{lblMsg.value_request}" styleClass="errorMarker"
									id="feeAmountError" style="display:none;">
									<f:param name="fieldName" value="#{lblFcl.fee_amount}"/>
							</h:outputFormat>
							<bpc:jsMask for="feeAmount" promtText="#{lblFcl.unlimited}"
								decDigits="#{CurrencyUtils.currencyObjectsMap[MbManualFeeAccDS.currency].exponent}" />
						</h:panelGrid>
												
						<h:outputLabel id="showDialog" value="#{MbManualFeeAccDS.showDialog}" style="display : none;">
						</h:outputLabel>
					</h:panelGrid>
				</h:panelGroup>

				<h:panelGroup layout="block" styleClass="cardholderdata-wrapper">
					<h:panelGrid columns="2" styleClass="cardholderdata" columnClasses="width-150, width250">
						<h:outputLabel for="skipProcess" title="#{lblFcl.skip_processing}" value="#{lblFcl.skip_processing}:"/>
						<h:panelGrid columns="1" cellpadding="0" cellspacing="0">
							<h:selectBooleanCheckbox id="skipProcess" value="#{MbManualFeeAccDS.skipProcessing}">
								<a4j:support event="onchange" ajaxSingle="true" limitToList="true" reRender="skipProcess"/>
							</h:selectBooleanCheckbox>
						</h:panelGrid>

						<h:outputLabel for="operStatus" title="#{lblFcl.operation_status}" value="#{lblFcl.operation_status}:"/>
						<h:panelGrid columns="1" cellpadding="0" cellspacing="0">
							<h:selectOneMenu id="operStatus"
											 label="#{lblFcl.operation_status}"
											 value="#{MbManualFeeAccDS.operationStatus}">
								<f:selectItem itemValue="" />
								<f:selectItems value="#{MbManualFeeAccDS.operationStatuses}" />
								<a4j:support event="onchange" ajaxSingle="true" limitToList="true" reRender="operStatus"/>
							</h:selectOneMenu>
						</h:panelGrid>
					</h:panelGrid>
				</h:panelGroup>
			</h:form>

		</ui:define>
	</ui:composition>
</html>
