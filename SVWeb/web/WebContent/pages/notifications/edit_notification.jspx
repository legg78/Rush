<?xml version="1.0" encoding="UTF-8"?>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:a4j="http://richfaces.org/a4j"
      xmlns:rich="http://richfaces.org/rich"
	  xmlns:bre="http://www.bpc.ru/jsf/richfaces-ext">
<ui:composition>
<h:form id="notificationEditForm">
	<script type="text/javascript">
//<!--
		oldValue["notificationEditForm"] = "#{MbNotifications.newNotification.lang}";
		
		function checkNotificationFields() {
			var checked = true;
			
			if (document.getElementById('notificationEditForm:instId').value == "") {
				document.getElementById('notificationEditForm:instIdError').style.display = "inline";
				checked = false;
			}
			
			if (document.getElementById('notificationEditForm:report').value == "") {
				document.getElementById('notificationEditForm:reportError').style.display = "inline";
				checked = false;
			}	
			if (document.getElementById('notificationEditForm:eventType').value == "") {
				document.getElementById('notificationEditForm:eventTypeError').style.display = "inline";
				checked = false;
			}	
			if (document.getElementById('notificationEditForm:name').value == "") {
				document.getElementById('notificationEditForm:nameError').style.display = "inline";
				checked = false;
			}	
			
			return checked;
		}
	//-->
	</script>
	<h:panelGroup layout="block" styleClass="cardholderdata-wrapper">
        <h:panelGrid columns="2" styleClass="cardholderdata" width="100%" columnClasses="firstColModal, width250">

			<h:outputLabel value="#{lblCommon.id}: " title="#{lblCommon.id}" rendered="#{MbNotifications.editMode}"/>
			<h:inputText readonly="true"
					rendered="#{MbNotifications.editMode}"
					value="#{MbNotifications.newNotification.id}"/>

			<h:outputLabel value="* #{lblCommon.institution}: " title="#{lblCommon.institution}"/>
			<a4j:region>
				<h:panelGrid cellpadding="0" cellspacing="0">
					<h:selectOneMenu id="instId" 
							value="#{MbNotifications.newNotification.instId}"
							disabled="#{MbNotifications.editMode}" 
							label="#{lblCommon.institution}"
							onblur="hideErrorField(this)">
						<a4j:support event="onchange" reRender="report" limitToList="true" ajaxSingle="true"/>
						<f:selectItem itemValue=""/>
						<f:selectItems value="#{MbNotifications.institutions}"/>
					</h:selectOneMenu>
					<h:outputFormat value="#{lblMsg.value_request}" styleClass="errorMarker"
						id="instIdError" style="display:none;">
						<f:param name="fieldName" value="#{lblCommon.institution}"/>
					</h:outputFormat>
				</h:panelGrid>
			</a4j:region>

			<h:outputLabel value="* #{lblNtf.report}: " title="#{lblNtf.report}"/>
			<h:panelGrid cellpadding="0" cellspacing="0">
				<h:selectOneMenu id="report" disabled="#{MbNotifications.editMode}"
						value="#{MbNotifications.newNotification.reportId}"
						label="#{lblNtf.report}"
						onblur="hideErrorField(this)">
					<f:selectItem itemValue=""/>
				    <f:selectItems value="#{MbNotifications.reports}"/>
				</h:selectOneMenu>
				<h:outputFormat value="#{lblMsg.value_request}" styleClass="errorMarker"
					id="reportError" style="display:none;">
					<f:param name="fieldName" value="#{lblNtf.report}"/>
				</h:outputFormat>
			</h:panelGrid>

			<h:outputLabel value="* #{lblCommon.event_type}: " title="#{lblCommon.event_type}"/>
			<h:panelGrid cellpadding="0" cellspacing="0">
				<h:selectOneMenu id="eventType" disabled="#{MbNotifications.editMode}"
						value="#{MbNotifications.newNotification.eventType}"
						label="#{lblCommon.event_type}"
						onblur="hideErrorField(this)">
					<f:selectItem itemValue=""/>
				    <f:selectItems value="#{MbNotifications.eventTypes}"/>
				</h:selectOneMenu>
				<h:outputFormat value="#{lblMsg.value_request}" styleClass="errorMarker"
					id="eventTypeError" style="display:none;">
					<f:param name="fieldName" value="#{lblCommon.event_type}"/>
				</h:outputFormat>
			</h:panelGrid>

			<h:outputLabel value="#{lblCommon.language}: " title="#{lblCommon.language}"/>
			<h:selectOneMenu id="lang" rendered="#{MbNotifications.newMode}"
					value="#{MbNotifications.newNotification.lang}">
			    <f:selectItems value="#{MbNotifications.languages}"/>
			</h:selectOneMenu>
			<h:selectOneMenu id="editLang" value="#{MbNotifications.newNotification.lang}"
					rendered="#{MbNotifications.editMode}"
					onchange="document.getElementById('notification:confirmPanelForm:newValue').value = this.value;
							#{rich:component('notification:confirmPanel')}.show()">
				<f:selectItems value="#{MbNotifications.languages}"/>
			</h:selectOneMenu>
			
			<h:outputLabel value="* #{lblCommon.name}: " title="#{lblCommon.name}"/>
			<a4j:region>
				<h:panelGrid columns="1" cellspacing="0" cellpadding="0">
					<h:inputText id="name" value="#{MbNotifications.newNotification.name}"
							maxlength="200" label="#{lblCommon.name}"
							onblur="hideErrorField(this)">					
						<f:validateLength minimum="3"/>
						<a4j:support event="onchange" reRender="nameErr" limitToList="true" ajaxSingle="true"/>					
					</h:inputText>
					<rich:message for="name" id="nameErr" styleClass="errorMarker"/>
					<h:outputFormat value="#{lblMsg.value_request}" styleClass="errorMarker"
						id="nameError" style="display:none;">
						<f:param name="fieldName" value="#{lblCommon.name}"/>
					</h:outputFormat>
				</h:panelGrid>
			</a4j:region>
			
			<h:outputLabel value="#{lblCommon.description}: " title="#{lblCommon.description}"/>
			<h:inputTextarea id="fullDesc" value="#{MbNotifications.newNotification.description}"
					rows="4" 
					onkeypress="if (!limitText(event,this,2000)) return false;" 
					label="#{lblCommon.description}">
				<f:validateLength maximum="2000" />
			</h:inputTextarea>	
				
		</h:panelGrid>

	</h:panelGroup>
	<h:panelGroup layout="block" styleClass="bottom_search_result_block_buttons">
		<h:panelGroup layout="block" styleClass="bottom_search_result_left_buttons">
      	    	<h:panelGrid columns="3" columnClasses="width99P,,paddingR12">
      	    		<h:outputText/>
                     	<bre:taggedCommandButton
                     			value="#{lblForm.save}" type="submit" action="#{MbNotifications.save}"
                     			onclick="if (!checkNotificationFields()) return false; disableModalPanelBtns(this)"
	                   			oncomplete="enableModalPanelBtns(this); if (#{usession.noErrorResponse}) #{rich:component('ntfNotificationModalPanel')}.hide()"
                     			reRender="ntfForm:notificationsTable, detailsTab, notificationsDs, pagesNum,
                     					templatesTab, ntfBtnForm:btnPanel"
                      		/>
                     	<bre:taggedCommandButton
                      		value="#{lblForm.cancel}" 
                      		action="#{MbNotifications.cancel}" 
                      		immediate="true" limitToList="true"
                      		oncomplete="#{rich:component('ntfNotificationModalPanel')}.hide()"
                      		reRender="notificationEditForm">
                      	<f:actionListener type="ru.bpc.jsf.A4JFormReset" />
                      </bre:taggedCommandButton>	
    		</h:panelGrid>
    	</h:panelGroup>
    </h:panelGroup>
</h:form>

<ui:include src="/pages/utils/langConfirmPanel.jspx">
   	<ui:param name="backingBean" value="#{MbNotifications}"/>
   	<ui:param name="rerenderList" value="notificationEditForm:name, notificationEditForm:fullDesc"/>
   	<ui:param name="editElem" value="notificationEditForm:editLang"/>
   	<ui:param name="newValue" value="#{MbNotifications.newNotification.lang}"/>
   	<ui:param name="subviewId" value="notification"/>
   	<ui:param name="formName" value="notificationEditForm" />
</ui:include>
</ui:composition>
</html>
