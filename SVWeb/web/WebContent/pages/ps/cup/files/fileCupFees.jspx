<?xml version="1.0" encoding="UTF-8" ?>

<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:a4j="http://richfaces.org/a4j"
                xmlns:bre="http://www.bpc.ru/jsf/richfaces-ext"
                xmlns:rich="http://richfaces.org/rich">

    <h:form id="fileCupFeesForm">
        <f:loadBundle var="lblCrd" basename="ru.bpc.sv2.ui.bundles.Crd"/>
        <f:loadBundle var="lblAcc" basename="ru.bpc.sv2.ui.bundles.Acc"/>
        <f:loadBundle var="lblOpr" basename="ru.bpc.sv2.ui.bundles.Opr"/>
        <f:loadBundle var="lblPrc" basename="ru.bpc.sv2.ui.bundles.Process"/>
        <f:loadBundle var="lblForm" basename="ru.bpc.sv2.ui.bundles.Form" />
        <f:loadBundle var="lblVis" basename="ru.bpc.sv2.ui.bundles.Cst"/>
        <f:loadBundle var="lblFcl" basename="ru.bpc.sv2.ui.bundles.Fcl"/>
        <f:loadBundle var="lblAcq" basename="ru.bpc.sv2.ui.bundles.Acq"/>
        <f:loadBundle var="lblAut" basename="ru.bpc.sv2.ui.bundles.Aut"/>

        <h:panelGroup id="fileCupFeesTableWrapper" layout="block"
                      style="padding:0px;margin:0px;">
            <rich:extendedDataTable id="fileCupFeesTable"
                                    enableContextMenu="true"
                                    rowClasses=",odd"
                                    rows="#{MbCupFileFees.rowsNum}"
                                    var="item"
                                    headerClass="res-table-header table-header-ext"
                                    styleClass="res-table"
                                    tableState="#{MbCupFileFees.tableState}"
                                    value="#{MbCupFileFees.items}"
                                    selection="#{MbCupFileFees.itemSelection}"
                                    noDataLabel="#{lblCommon['no_records_found']}">
                <a4j:support event="onselectionchange"
                             reRender="fileCupFeesForm:btnPanelFileFinMessagesBottom" />

                <rich:column id="id" title="#{lblFcl.fee_id}"
                             label="#{lblFcl.fee_id}" sortBy="#{'id'}"
                             width="9%">
                    <f:facet name="header">
                        <a4j:outputPanel layout="none">
                            <h:outputText value="#{lblFcl.fee_id}"
                                          title="#{lblFcl.fee_id}"/>
                        </a4j:outputPanel>
                    </f:facet>
                    <h:outputText value="#{item.id}"
                                  title="#{item.id}"/>
                </rich:column>

                <rich:column id="feeType" title="#{lblFcl.fee_type}"
                             label="#{lblFcl.fee_type}" sortBy="#{'feeType'}"
                             width="7%">
                    <f:facet name="header">
                        <a4j:outputPanel layout="none">
                            <h:outputText value="#{lblFcl.fee_type}"
                                          title="#{lblFcl.fee_type}"/>
                        </a4j:outputPanel>
                    </f:facet>
                    <h:outputText value="#{item.feeType}"
                                  title="#{item.feeType}"/>
                </rich:column>
                <rich:column id="operStatus" title="#{lblOpr.operation_status}"
                             label="#{lblOpr.operation_status}" sortBy="#{'operStatus'}"
                             width="10%">
                    <f:facet name="header">
                        <a4j:outputPanel layout="none">
                            <h:outputText value="#{lblOpr.operation_status}"
                                          title="#{lblOpr.operation_status}"/>
                        </a4j:outputPanel>
                    </f:facet>
                    <h:outputText value="#{item.operStatus}"
                                  title="#{item.operStatus}"/>
                </rich:column>
                <rich:column id="reversal" title="#{lblOpr.reversal}"
                             label="#{'R'}" sortBy="#{'reversal'}"
                             width="5%">
                    <f:facet name="header">
                        <a4j:outputPanel layout="none">
                            <h:outputText value="#{'R'}"
                                          title="#{'Reversal'}" />
                        </a4j:outputPanel>
                    </f:facet>
                    <h:outputText value="#{item.reversal ? '+' : '-'}"
                                  title="#{'Reversal'}"/>
                </rich:column>
                <rich:column id="cardNumber" title="#{lblCrd.card_number}"
                             label="#{lblCrd.card_number}" sortBy="#{'feeType'}"
                             width="10%">
                    <f:facet name="header">
                        <a4j:outputPanel layout="none">
                            <h:outputText value="#{lblCrd.card_number}"
                                          title="#{lblCrd.card_number}"/>
                        </a4j:outputPanel>
                    </f:facet>
                    <h:outputText value="#{item.cardNumber}"
                                  title="#{item.cardNumber}"/>
                </rich:column>
                <rich:column id="operId" title="#{lblOpr.operation_id}"
                             label="#{lblOpr.operation_id}" sortBy="#{'operId'}"
                             width="10%">
                    <f:facet name="header">
                        <a4j:outputPanel layout="none">
                            <h:outputText value="#{lblOpr.operation_id}"
                                          title="#{lblOpr.operation_id}"/>
                        </a4j:outputPanel>
                    </f:facet>
                    <h:outputText value="#{item.operId}"
                                  title="#{item.operId}"/>
                </rich:column>
                <rich:column id="networkRefnum" title="#{lblOpr.network_refnum}"
                             label="#{lblOpr.network_refnum}" sortBy="#{'networkRefnum'}"
                             width="15%">
                    <f:facet name="header">
                        <a4j:outputPanel layout="none">
                            <h:outputText value="#{lblOpr.network_refnum}"
                                          title="#{lblOpr.network_refnum}"/>
                        </a4j:outputPanel>
                    </f:facet>
                    <h:outputText value="#{item.networkRefnum}"
                                  title="#{item.networkRefnum}"/>
                </rich:column>
                <rich:column id="operAmount" title="#{lblOpr.operation_amount}"
                             label="#{lblOpr.operation_amount}" sortBy="#{'operAmount'}"
                             width="11%">
                    <f:facet name="header">
                        <a4j:outputPanel layout="none">
                            <h:outputText value="#{lblOpr.operation_amount}"
                                          title="#{lblOpr.operation_amount}"/>
                        </a4j:outputPanel>
                    </f:facet>
                    <div class="#{EntityIcons.objectsMapS['ENTT0046'][item.operCurrency]}"
                         style="float:right; margin: 0 0 0 10px;"/>
                    <h:outputText value="#{fmt:formatMoney(item.operAmount, CurrencyUtils.currencyObjectsMap[item.operCurrency].exponent)} #{CurrencyUtils.currencyShortNamesMap[item.operCurrency]}" />
                </rich:column>
                <rich:column id="sttlAmount" title="#{lblOpr.sttl_amount}"
                             label="#{lblOpr.sttl_amount}" sortBy="#{'sttlAmount'}"
                             width="11%">
                    <f:facet name="header">
                        <a4j:outputPanel layout="none">
                            <h:outputText value="#{lblOpr.sttl_amount}"
                                          title="#{lblOpr.sttl_amount}"/>
                        </a4j:outputPanel>
                    </f:facet>
                    <div class="#{EntityIcons.objectsMapS['ENTT0046'][item.sttlCurrency]}"
                         style="float:right; margin: 0 0 0 10px;"/>
                    <h:outputText value="#{fmt:formatMoney(item.sttlAmount, CurrencyUtils.currencyObjectsMap[item.sttlCurrency].exponent)} #{CurrencyUtils.currencyShortNamesMap[item.sttlCurrency]}" />
                </rich:column>
                <rich:column id="fileName" title="#{lblPrc.file_name}"
                             label="#{lblPrc.file_name}" sortBy="#{'fileName'}"
                             width="12%">
                    <f:facet name="header">
                        <a4j:outputPanel layout="none">
                            <h:outputText value="#{lblPrc.file_name}"
                                          title="#{lblPrc.file_name}"/>
                        </a4j:outputPanel>
                    </f:facet>
                    <h:outputText value="#{item.fileName}"
                                  title="#{item.fileName}"/>
                </rich:column>
            </rich:extendedDataTable>
        </h:panelGroup>
        <h:panelGroup layout="block"
                      styleClass="nocorner_search_result_block">
            <h:panelGroup layout="block" styleClass="table_tools">
                <h:panelGrid id="btnCupFileFees"
                             styleClass="fw buttons_block"
                             columns="5" columnClasses=", table_tools_state">
                    <h:outputLabel for="rows_numBottom" value="#{lblCommon.rows_per_page}" title="#{lblCommon.rows_per_page}" />
                    <h:selectOneMenu id="rows_numBottom"
                                     value="#{MbCupFileFees.rowsNum}" style="width:40px">
                        <a4j:support event="onchange"
                                     reRender="fileCupFeesTable, dsopers, pagesNumBottom, btnPanelFileFees" />
                        <f:selectItems value="#{CommonUtils.rowNumsList}"/>
                    </h:selectOneMenu>

                    <rich:datascroller maxPages="10" fastControls="hide"
                                       pagesVar="pages" styleClass="res-datascroller" id="dsopers"
                                       for="fileCupFeesTable" reRender="btnPanelFileFinMessagesBottom">
                        <f:facet name="first">
                            <h:outputText value="&lt;&lt;" styleClass="prev-next" />
                        </f:facet>
                        <f:facet name="first_disabled">
                            <h:outputText value="&lt;&lt;" styleClass="prev-next-dis" />
                        </f:facet>
                        <f:facet name="last">
                            <h:outputText value="&gt;&gt;" styleClass="prev-next" />
                        </f:facet>
                        <f:facet name="last_disabled">
                            <h:outputText value="&gt;&gt;" styleClass="prev-next-dis" />
                        </f:facet>
                        <f:facet name="previous">
                            <h:outputText value="#{lblCommon.prev}" styleClass="prev-next" />
                        </f:facet>
                        <f:facet name="previous_disabled">
                            <h:outputText value="#{lblCommon.prev}"
                                          styleClass="prev-next-dis" />
                        </f:facet>
                        <f:facet name="next">
                            <h:outputText value="#{lblCommon.next}" styleClass="prev-next" />
                        </f:facet>
                        <f:facet name="next_disabled">
                            <h:outputText value="#{lblCommon.next}"
                                          styleClass="prev-next-dis" />
                        </f:facet>
                        <f:facet name="pages">
                        </f:facet>
                    </rich:datascroller>

                    <h:panelGroup id="pagesNumBottom">
                        <h:outputText styleClass="strongClass" value="#{pages} " />
                        <h:outputText value=" #{lblCommon.pages}" />
                        <h:outputText value="" style="padding-left: 20px; padding-right: 20px;" />
                        <h:outputText styleClass="strongClass" value="#{MbCupFileFees.items.rowCount}"/>
                        <h:outputText value=" #{lblCommon.records}"/>
                        <h:outputText value="" style="padding-left: 20px; padding-right: 20px;" />
                    </h:panelGroup>
                    <h:panelGroup>
                        <h:graphicImage url="/images/green-tick.png" title="#{lblCommon.save_table_state}" styleClass="action_icon"
                                        onclick="saveCupFileFinMessagesTableState();"/>
                        <h:graphicImage url="/images/red-cross.png" title="#{lblCommon.delete_table_state}" styleClass="action_icon"
                                        onclick="deleteFileFinMessagesTableState();"/>
                        <a4j:queue name="tablestatequeue"/>
                        <a4j:jsFunction name="saveCupFileFinMessagesTableState" action="#{MbCupFileFees.saveTableStateDB}" eventsQueue="tablestatequeue"/>
                        <a4j:jsFunction name="deleteCupFileFinMessagesTableState" action="#{MbCupFileFees.deleteTableStateDB}" eventsQueue="tablestatequeue"/>
                    </h:panelGroup>
                </h:panelGrid>
            </h:panelGroup>
            <h:panelGrid id="btnPanelFileFees"
                         styleClass="fw buttons_block"
                         columns="2" columnClasses=", table_tools_state">
                <bre:taggedCommandButton id="viewBtn"
                                         reRender="cup_file_fee_modal_div" value="#{lblForm.view}"
                                         oncomplete="#{rich:component('cup_file_fee_modal_panel')}.show()"
                                         action="#{MbCupFileFees.view}"
                                         disabled="#{MbCupFileFees.activeItem == null}"
                                         image="/images/create_doc.gif" />
            </h:panelGrid>
        </h:panelGroup>
    </h:form>

    <rich:modalPanel id="cup_file_fee_modal_panel"
                 autosized="true"
                 minWidth="500" minHeight="100">
    <f:facet name="header">
        <h:outputText value="#{lblCommon.fees}"/>
    </f:facet>
    <f:facet name="controls">
    </f:facet>
    <h:panelGroup id="cup_file_fee_modal_div">
        <ui:include src="/pages/ps/cup/files/feeDetails.jspx">
            <ui:param name="detailsBean" value="#{MbCupFileFees}" />
        </ui:include>
        <a4j:form>
            <h:panelGroup layout="block" styleClass="bottom_search_result_block_buttons">
                <h:panelGroup layout="block" styleClass="bottom_search_result_left_buttons">
                    <h:panelGrid columns="2" columnClasses="width99P,paddingR12">
                        <h:outputText/>
                        <bre:taggedCommandButton limitToList="true" immediate="true"
                                                 value="#{lblForm.close}" action="#{MbCupFileFees.view}"
                                                 oncomplete="#{rich:component('cup_file_fee_modal_panel')}.hide()"
                                                 reRender="cup_file_fee_modal_div">
                            <f:actionListener type="ru.bpc.jsf.A4JFormReset" />
                        </bre:taggedCommandButton>
                    </h:panelGrid>
                </h:panelGroup>
            </h:panelGroup>
        </a4j:form>
    </h:panelGroup>

</rich:modalPanel>

    <script>
        updateHeight();
    </script>
</ui:composition>
