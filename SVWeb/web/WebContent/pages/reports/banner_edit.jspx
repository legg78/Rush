<?xml version="1.0" encoding="UTF-8"?>
<html   xmlns="http://www.w3.org/1999/xhtml"
		xmlns:f="http://java.sun.com/jsf/core"
		xmlns:h="http://java.sun.com/jsf/html"
		xmlns:ui="http://java.sun.com/jsf/facelets"
		xmlns:a4j="http://richfaces.org/a4j"
		xmlns:rich="http://richfaces.org/rich"
		xmlns:bre="http://www.bpc.ru/jsf/richfaces-ext"
		xmlns:bm="http://www.bpc.ru/jsf/misc"
		xmlns:o="http://openfaces.org/">
<ui:composition>
<f:loadBundle var="lblRpt" basename="ru.bpc.sv2.ui.bundles.Rpt"/>

<h:form id="bannerEditForm">
	<script type="text/javascript">
//<!--
		oldValue["bannerEditForm"] = "#{MbReportBannersSearch.newReportBanner.lang}";
		
		function checkBannerFields() {
			var checked = true;
			
			if (document.getElementById('bannerEditForm:name').value == "") {
				document.getElementById('bannerEditForm:nameError').style.display = "inline";
				checked = false;
			}
			
			if (document.getElementById('bannerEditForm:newInstId').value == "") {
				document.getElementById('bannerEditForm:newInstIdError').style.display = "inline";
				checked = false;
			}		
			if (document.getElementById('bannerEditForm:status').value == "") {
				document.getElementById('bannerEditForm:statusError').style.display = "inline";
				checked = false;
			}		
			
			return checked;
		}
	//-->
	</script>
	<script type="text/javascript" src="/sv/js/main.js" />
	<h:panelGroup layout="block" styleClass="cardholderdata-wrapper">
	<h:panelGrid columns="2" styleClass="cardholderdata" width="100%" columnClasses="top, top">
        <h:panelGrid columns="2" styleClass="cardholderdata" width="100%" columnClasses="firstColModal, width250">

			<h:outputLabel value="#{lblCommon.language}: " title="#{lblCommon.language}"/>
			<h:selectOneMenu id="lang" 
					value="#{MbReportBannersSearch.newReportBanner.lang}"
					rendered="#{MbReportBannersSearch.newMode}">
			    <f:selectItems value="#{MbReportBannersSearch.languages}"/>
			</h:selectOneMenu>
			<h:selectOneMenu id="editLang" value="#{MbReportBannersSearch.newReportBanner.lang}"
					rendered="#{MbReportBannersSearch.editMode}"
					onchange="document.getElementById('banner:confirmPanelForm:newValue').value = this.value;
							#{rich:component('banner:confirmPanel')}.show()">
				<f:selectItems value="#{MbReportBannersSearch.languages}"/>
			</h:selectOneMenu>

			<h:outputLabel value="* #{lblCommon.name}: " title="#{lblCommon.name}"/>
			<h:panelGrid columns="1" cellspacing="0" cellpadding="0">
				<h:inputText id="name" 
						value="#{MbReportBannersSearch.newReportBanner.name}"
						maxlength="200"
						label="#{lblCommon.name}"
						onblur="hideErrorField(this)">
					<f:validateLength minimum="3"/>
					<a4j:support event="onchange" reRender="nameErr" limitToList="true" ajaxSingle="true"/>
				</h:inputText>
				<rich:message for="name" id="nameErr" styleClass="errorMarker"/>
				<h:outputFormat value="#{lblMsg.value_request}" styleClass="errorMarker"
					id="nameError" style="display:none;">
					<f:param name="fieldName" value="#{lblCommon.name}"/>
				</h:outputFormat>
			</h:panelGrid>
			
			<h:outputLabel value="#{lblCommon.description}: " title="#{lblCommon.description}"/>
			<h:inputTextarea id="descr" 
					value="#{MbReportBannersSearch.newReportBanner.description}"
					rows="4" cols="150"
					onkeypress="if (!limitText(event,this,2000)) return false;" 
					label="#{lblCommon.description}">
					<f:validateLength maximum="2000" />
			</h:inputTextarea>
		
			<h:outputLabel value="* #{lblCommon.institution}: " title="#{lblCommon.institution}"/>
			<h:panelGrid columns="1" cellspacing="0" cellpadding="0">
				<h:selectOneMenu id="newInstId" disabled="#{MbReportBannersSearch.editMode}"
						value="#{MbReportBannersSearch.newReportBanner.instId}"
						label="#{lblCommon.institution}"
						onblur="hideErrorField(this)">
					<f:selectItem itemValue=""/>
					<f:selectItems value="#{MbReportBannersSearch.institutions}"/>
				</h:selectOneMenu>
				<h:outputFormat value="#{lblMsg.value_request}" styleClass="errorMarker"
					id="newInstIdError" style="display:none;">
					<f:param name="fieldName" value="#{lblCommon.institution}"/>
				</h:outputFormat>
			</h:panelGrid>
			
			<h:outputLabel value="* #{lblCommon.status}: " title="#{lblCommon.status}"/>
			<h:panelGrid columns="1" cellspacing="0" cellpadding="0">
				<h:selectOneMenu id="status" 
						value="#{MbReportBannersSearch.newReportBanner.status}"
						label="#{lblCommon.status}"
						onblur="hideErrorField(this)">
					<f:selectItem itemValue=""/>
					<f:selectItems value="#{MbReportBannersSearch.bannerStatuses}"/>
				</h:selectOneMenu>
				<h:outputFormat value="#{lblMsg.value_request}" styleClass="errorMarker"
					id="statusError" style="display:none;">
					<f:param name="fieldName" value="#{lblCommon.status}"/>
				</h:outputFormat>
			</h:panelGrid>
			
			<h:outputLabel value="#{lblCommon.file}: " title="#{lblCommon.file}"/>
			<rich:fileUpload fileUploadListener="#{MbReportBannersSearch.fileUploadListener}"
							 maxFilesQuantity="#{MbReportBannersSearch.uploadsAvailable}"
							 id="upload1"
							 acceptedTypes="#{MbReportBannersSearch.getAcceptedFileTypes('jpg, gif, png, bmp')}"
							 ontyperejected="alert('#{lblRpt.type_not_allowed}')"
							 immediateUpload="true"
							 listHeight="50px;"
							 clearAllControlLabel="Clear"
							 clearControlLabel="Clear"
							 listWidth="100%" >
                <a4j:support event="onfileuploadcomplete" reRender="newImg" ajaxSingle="true" oncomplete="bannerEdit.updateRichLabels();"
					action="#{MbReportBannersSearch.upload}" limitToList="true"/>		
				<a4j:support event="onclear" reRender="upload1, newImg" ajaxSingle="true" oncomplete="bannerEdit.updateRichLabels();"
					action="#{MbReportBannersSearch.clearUpload}" limitToList="true"/>
            </rich:fileUpload>
         	
	    </h:panelGrid>
	    <h:panelGrid columns="2" styleClass="cardholderdata" width="100%" columnClasses="firstColModal, width250">  
			<h:outputLabel value="#{lblRpt.banner}: " title="#{lblRpt.banner}"/>
			<h:panelGroup layout="block" style="width: 255px; height: 255px; border: 1px solid #999999;">
				<o:dynamicImage id="newImg" data="#{MbReportBannersSearch.newImageData}"
						width="255" 
	                	height="255"
						rendered="#{MbReportBannersSearch.newImageSize > 0}"
	                	/>	
	        </h:panelGroup>	
	    </h:panelGrid>	
    </h:panelGrid>
    </h:panelGroup>
	<h:panelGroup layout="block" styleClass="bottom_search_result_block_buttons">
		<h:panelGroup layout="block" styleClass="bottom_search_result_left_buttons">
   	    		<h:panelGrid columns="3" columnClasses="width99P,,paddingR12">
   	    		<h:outputText/>
                
               	<bre:taggedCommandButton id="saveBtn"
               			onclick = "if (!checkBannerFields()) return false; disableModalPanelBtns(this);"
               			value="#{lblForm.save}" type="submit" action="#{MbReportBannersSearch.save}"
               			oncomplete="enableModalPanelBtns(this);if (#{usession.noErrorResponse}) #{rich:component('rpt_banner_modal_panel')}.hide()"
               			reRender="bannersForm:bannersTable, bannersBtnForm:btnPanel, detailsTab"		                        			
                   		/>
               	<bre:taggedCommandButton id="cancelBtn"
                		value="#{lblForm.cancel}" action="#{MbReportBannersSearch.close}" immediate="true"
                		oncomplete="#{rich:component('rpt_banner_modal_panel')}.hide()"
                		reRender="bannerEditForm">
					<f:actionListener type="ru.bpc.jsf.A4JFormReset" />
                </bre:taggedCommandButton>		                        		
    		</h:panelGrid>
    	</h:panelGroup>
    </h:panelGroup>
    
	<script>
		var bannerEdit = {
			updateRichLabels : function() {
				var contentDiv = document.getElementById('bannerEditForm:upload1:add2');
				contentDiv.innerHTML = "#{lblForm.add}";
				var borderDiv = document.getElementById('bannerEditForm:upload1:add1');
				var inputFileUpload = document.getElementById('bannerEditForm:upload1:file');
				if (inputFileUpload != null and borderDiv != null){
					if(borderDiv.offsetWidth > 0){
				    	inputFileUpload.offsetParent.style.width = borderDiv.offsetWidth + "px";
					}
				}
		
				 
				var stopContentDiv = document.getElementById('bannerEditForm:upload1:upload2');
				stopContentDiv.innerHTML = "#{lblForm.stop}";
		
				var clearContentDiv = document.getElementById('bannerEditForm:upload1:clean2');
				clearContentDiv.innerHTML = "#{lblForm.clear}";	
				jQuery('.rich-fileupload-name-padding').filter(':odd').html('#{lblForm.done}');
				jQuery('.rich-fileupload-anc ').html('#{lblForm.clear}');
			}
		};
		bannerEdit.updateRichLabels();
	</script>
    
</h:form>
<ui:include src="/pages/utils/langConfirmPanel.jspx">
	<ui:param name="backingBean" value="#{MbReportBannersSearch}"/>
	<ui:param name="rerenderList" value="bannerEditForm:name, bannerEditForm:descr"/>
	<ui:param name="editElem" value="bannerEditForm:editLang"/>
	<ui:param name="newValue" value="#{MbReportBannersSearch.newReportBanner.lang}"/>
	<ui:param name="subviewId" value="banner"/>
	<ui:param name="formName" value="bannerEditForm" />
</ui:include>
</ui:composition>
</html>