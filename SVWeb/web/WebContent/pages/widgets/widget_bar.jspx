<?xml version="1.0" encoding="UTF-8"?>
<html xmlns="http://www.w3.org/1999/xhtml"
	  xmlns:ui="http://java.sun.com/jsf/facelets"
	  xmlns:h="http://java.sun.com/jsf/html"
	  xmlns:f="http://java.sun.com/jsf/core"
	  xmlns:a4j="http://richfaces.org/a4j"
	  xmlns:rich="http://richfaces.org/rich">
<ui:composition>
	<a4j:region>
		<h:form id="#{pollForm}">
			<ui:param name="refreshIntervalSecond" value="#{dashboardWidget['refreshInterval'] != null ? dashboardWidget['refreshInterval'] : '10'}"></ui:param>
			<a4j:poll id="poll" interval="#{refreshIntervalSecond * 1000}"
					  enabled="#{dashboardWidget['refresh']}"
					  onsubmit="#{refreshWidgetFunction}(); return false;"/>

			<h:panelGrid columns="1" style="float: right;">
				<h:panelGroup styleClass="link-clear" layout="block">
					<rich:dropDownMenu id="contextMenu" itemClass="odd" rendered="true"
									   selectItemStyle="color:#ffffff;background-color:#999;border-color:#999"
									   selectedLabelClass="selectedFav" event="onclick" hideDelay="1000"
									   direction="bottom-left" jointPoint="br"
									   itemStyle="text-align:left;padding-right:10px"
									   style="float:left;padding:0" submitMode="ajax">
						<f:facet name="label">
							<h:panelGroup styleClass="link-filter" layout="block">
								<h:graphicImage url="/_img/icon_filter.png"/>
								<a4j:commandLink value="Config" onclick="return false">
								</a4j:commandLink>
							</h:panelGroup>
						</f:facet>
						<rich:menuItem value="#{dashboardWidget['refresh']?'Stop':'Start'} Refresh" icon="/_img/icon_filter.png"
									   limitToList="true" reRender="#{pollForm},#{widgetForm}" >
							<a4j:actionparam name="polling" value="#{!dashboardWidget['refresh']}"
											 assignTo="#{dashboardWidget['refresh']}" />
						</rich:menuItem>
						<rich:menuItem value="#{lblCommon.parameters}" icon="/_img/icon_filter.png" action="#{widgetBean['editDashboardWidget']}"
									   oncomplete="Richfaces.showModalPanel('widgetParameterPanel#{dashboardWidget.id}'); return false;"
									   limitToList="true" reRender="widgetParameterEditForm#{dashboardWidget.id}">
							<f:setPropertyActionListener target="#{widgetBean['activeDashboardWidgetId']}" value="#{dashboardWidget['id']}"/>
							<f:setPropertyActionListener target="#{MbDashboard.paramsPath}" value="#{widgetItem['paramsPath']}"/>
							<f:setPropertyActionListener target="#{MbDashboard.activeDashboardWidgetForm}" value="#{widgetForm}"/>
							<f:setPropertyActionListener target="#{MbDashboard.refreshWidgetFunction}" value="#{refreshWidgetFunction}"/>
						</rich:menuItem>
						<rich:menuItem value="#{lblForm.add_param}" icon="/images/create_doc.gif" action="#{MbDashboard.addWidgetParameter}"
									   oncomplete="Richfaces.showModalPanel('newWidgetParameterPanel'); return false;"
									   limitToList="true" reRender="newWidgetParameterEditForm">
							<f:setPropertyActionListener target="#{MbDashboard.activeDashboardWidgetId}" value="#{dashboardWidget['id']}"/>
							<f:setPropertyActionListener target="#{MbDashboard.activeWidgetId}" value="#{widgetItem['id']}"/>
							<f:setPropertyActionListener target="#{MbDashboard.activeDashboardWidgetForm}" value="#{widgetForm}"/>
							<f:setPropertyActionListener target="#{MbDashboard.refreshWidgetFunction}" value="#{refreshWidgetFunction}"/>
						</rich:menuItem>
						<rich:menuItem icon="/images/arrow-down-green.png" limitToList="true" rendered="#{loadXls}">
							<h:commandLink value="#{lblForm.load_xls}" type="submit" action="#{widgetBean.loadXls}">
								<f:setPropertyActionListener target="#{widgetBean['activeDashboardWidgetId']}" value="#{dashboardWidget['id']}"/>
							</h:commandLink>
						</rich:menuItem>
					</rich:dropDownMenu>
				</h:panelGroup>
			</h:panelGrid>
		</h:form>
	</a4j:region>
</ui:composition>
</html>