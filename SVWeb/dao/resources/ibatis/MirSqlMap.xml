<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap
        PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
        "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="mir">

    <sql id="limitationOpen">
        SELECT *
        FROM (
    </sql>

    <sql id="limitationOpenCount">
        SELECT count(*)
        FROM (
    </sql>

    <sql id="limitationClose">
        ) q
        <isNotNull property="limitation" prepend=" WHERE ">$limitation$</isNotNull>
    </sql>
    <sql id="paginatedOpen">
        SELECT *
        FROM(
        SELECT a.*, rownum r
        FROM(
        <include refid="limitationOpen"/>
    </sql>

    <sql id="paginatedClose">
        <include refid="limitationClose"/>
        ) a
        WHERE rownum <![CDATA[<]]>= (#range.end# + 1)
        )
        WHERE r >= (#range.start# + 1)
    </sql>

    <select id="get-fin-messages-map" parameterClass="qparams" resultClass="java.util.LinkedHashMap">
        SELECT *
        FROM MUP_UI_FIN_VW
        <iterate prepend="WHERE" conjunction="AND" property="filters">
            <isEqual property="filters[].element" compareValue="id">id = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="lang">lang = #filters[].value#</isEqual>
        </iterate>
    </select>

    <resultMap  id="mapping-mir-fin-message" class="ru.bpc.sv2.ps.mir.MirFinMessage">
        <result property="id"            column="id"/>
        <result property="status"        column="status" />
        <result property="fileId"        column="file_id" />
        <result property="incoming"      column="is_incoming" />
        <result property="reversal"      column="is_reversal" />
        <result property="rejected"      column="is_rejected" />
        <result property="rejectId"      column="reject_id" />
        <result property="fpdMatched"    column="is_fpd_matched" />
        <result property="disputeId"     column="dispute_id" />
        <result property="impact"        column="impact" />
        <result property="sessionId"     column="session_id" />
        <result property="sessionFileId" column="session_file_id" />
        <result property="fileName"      column="file_name" />
        <result property="fileDate"      column="file_date" />
        <result property="lang"          column="lang" />
        <result property="instId"        column="INST_ID" />
        <result property="instName"      column="INST_NAME" />
        <result property="mti"           column="MTI" />
        <result property="networkId"     column="NETWORK_ID" />
        <result property="networkName"   column="NETWORK_NAME" />
        <result property="splitHash"     column="SPLIT_HASH" />

        <result property="de002"         column="DE002" />
        <result property="de003_1"       column="DE003_1" />
        <result property="de003_2"       column="DE003_2" />
        <result property="de003_3"       column="DE003_3" />
        <result property="de004"         column="DE004" />
        <result property="de005"         column="DE005" />
        <result property="de006"         column="DE006" />
        <result property="de009"         column="DE009" />
        <result property="de010"         column="DE010" />
        <result property="de012"         column="DE012" />
        <result property="de014"         column="DE014" />
        <result property="de022_1"       column="DE022_1" />
        <result property="de022_2"       column="DE022_2" />
        <result property="de022_3"       column="DE022_3" />
        <result property="de022_4"       column="DE022_4" />
        <result property="de022_5"       column="DE022_5" />
        <result property="de022_6"       column="DE022_6" />
        <result property="de022_7"       column="DE022_7" />
        <result property="de022_8"       column="DE022_8" />
        <result property="de022_9"       column="DE022_9" />
        <result property="de022_10"      column="DE022_10" />
        <result property="de022_11"      column="DE022_11" />
        <result property="de023"         column="DE023" />
        <result property="de024"         column="DE024" />
        <result property="de025"         column="DE025" />
        <result property="de026"         column="DE026" />
        <result property="de030_1"       column="DE030_1" />
        <result property="de030_2"       column="DE030_2" />
        <result property="de031"         column="DE031" />
        <result property="de032"         column="DE032" />
        <result property="de033"         column="DE033" />
        <result property="de037"         column="DE037" />
        <result property="de038"         column="DE038" />
        <result property="de040"         column="DE040" />
        <result property="de041"         column="DE041" />
        <result property="de042"         column="DE042" />
        <result property="de043_1"       column="DE043_1" />
        <result property="de043_2"       column="DE043_2" />
        <result property="de043_3"       column="DE043_3" />
        <result property="de043_4"       column="DE043_4" />
        <result property="de043_5"       column="DE043_5" />
        <result property="de043_6"       column="DE043_6" />
        <result property="de049"         column="DE049" />
        <result property="de050"         column="DE050" />
        <result property="de051"         column="DE051" />
        <result property="de054"         column="DE054" />
        <result property="de055"         column="DE055" />
        <result property="de063"         column="DE063" />
        <result property="de071"         column="DE071" />
        <result property="de072"         column="DE072" />
        <result property="de073"         column="DE073" />
        <result property="de093"         column="DE093" />
        <result property="de094"         column="DE094" />
        <result property="de095"         column="DE095" />
        <result property="de100"         column="DE100" />

        <result property="emv_5F2A"      column="EMV_5F2A" />
        <result property="emv_71"        column="EMV_71" />
        <result property="emv_72"        column="EMV_72" />
        <result property="emv_82"        column="EMV_82" />
        <result property="emv_84"        column="EMV_84" />
        <result property="emv_8A"        column="EMV_8A" />
        <result property="emv_91"        column="EMV_91" />
        <result property="emv_95"        column="EMV_95" />
        <result property="emv_9A"        column="EMV_9A" />
        <result property="emv_9C"        column="EMV_9C" />
        <result property="emv_9F02"      column="EMV_9F02" />
        <result property="emv_9F03"      column="EMV_9F03" />
        <result property="emv_9F09"      column="EMV_9F09" />
        <result property="emv_9F10"      column="EMV_9F10" />
        <result property="emv_9F1A"      column="EMV_9F1A" />
        <result property="emv_9F1E"      column="EMV_9F1E" />
        <result property="emv_9F26"      column="EMV_9F26" />
        <result property="emv_9F27"      column="EMV_9F27" />
        <result property="emv_9F33"      column="EMV_9F33" />
        <result property="emv_9F34"      column="EMV_9F34" />
        <result property="emv_9F35"      column="EMV_9F35" />
        <result property="emv_9F36"      column="EMV_9F36" />
        <result property="emv_9F37"      column="EMV_9F37" />
        <result property="emv_9F41"      column="EMV_9F41" />
        <result property="emv_9F4C"      column="EMV_9F4C" />
        <result property="emv_9F53"      column="EMV_9F53" />

        <result property="p0025_1"       column="P0025_1" />
        <result property="p0025_2"       column="P0025_2" />
        <result property="p0137"         column="P0137" />
        <result property="p0146"         column="P0146" />
        <result property="p0146_NET"     column="P0146_NET" />
        <result property="p0148"         column="P0148" />
        <result property="p0149_1"       column="P0149_1" />
        <result property="p0149_2"       column="P0149_2" />
        <result property="p0165"         column="P0165" />
        <result property="p0176"         column="P0176" />
        <result property="p0190"         column="P0190" />
        <result property="p0198"         column="P0198" />
        <result property="p0228"         column="P0228" />
        <result property="p0261"         column="P0261" />
        <result property="p0262"         column="P0262" />
        <result property="p0265"         column="P0265" />
        <result property="p0266"         column="P0266" />
        <result property="p0267"         column="P0267" />
        <result property="p0268_1"       column="P0268_1" />
        <result property="p0268_2"       column="P0268_2" />
        <result property="p0375"         column="P0375" />
        <result property="p2002"         column="P2002" />
        <result property="p2063"         column="P2063" />
        <result property="p2072_1"       column="P2072_1" />
        <result property="p2072_2"       column="P2072_2" />
        <result property="p2097_1"       column="P2097_1" />
        <result property="p2097_2"       column="P2097_2" />
        <result property="p2158_1"       column="P2158_1" />
        <result property="p2158_2"       column="P2158_2" />
        <result property="p2158_3"       column="P2158_3" />
        <result property="p2158_4"       column="P2158_4" />
        <result property="p2158_5"       column="P2158_5" />
        <result property="p2158_6"       column="P2158_6" />
        <result property="p2159_1"       column="P2159_1" />
        <result property="p2159_2"       column="P2159_2" />
        <result property="p2159_3"       column="P2159_3" />
        <result property="p2159_4"       column="P2159_4" />
        <result property="p2159_5"       column="P2159_5" />
        <result property="p2159_6"       column="P2159_6" />        
        <result property="p2175_1"       column="P2175_1" />
        <result property="p2175_2"       column="P2175_2" />
    </resultMap>

    <select id="get-mir-fin-messages"
            parameterClass="qparams"
            resultMap="mapping-mir-fin-message">
        <include refid="paginatedOpen"/>

        SELECT
        fm.id
        , fm.status
        , fm.file_id
        , fm.is_incoming
        , fm.is_reversal
        , fm.is_rejected
        , fm.reject_id
        , fm.is_fpd_matched
        , fm.dispute_id
        , fm.impact
        , sf.session_id
        , sf.id session_file_id
        , sf.file_name
        , sf.file_date

        , fm.lang
        , fm.inst_id
        , fm.inst_name
        , fm.MTI
        , fm.network_id
        , fm.network_name
        , fm.split_hash

        , iss_api_card_pkg.get_card_mask(fm.DE002) de002
        , fm.DE003_1
        , fm.DE003_2
        , fm.DE003_3
        , fm.DE004
        , fm.DE005
        , fm.DE006
        , fm.DE009
        , fm.DE010
        , fm.DE012
        , fm.DE014
        , fm.DE022_1
        , fm.DE022_2
        , fm.DE022_3
        , fm.DE022_4
        , fm.DE022_5
        , fm.DE022_6
        , fm.DE022_7
        , fm.DE022_8
        , fm.DE022_9
        , fm.DE022_10
        , fm.DE022_11
        , fm.DE023
        , fm.DE024
        , fm.DE025
        , fm.DE026
        , fm.DE030_1
        , fm.DE030_2
        , fm.DE031
        , fm.DE032
        , fm.DE033
        , fm.DE037
        , fm.DE038
        , fm.DE040
        , fm.DE041
        , fm.DE042
        , fm.DE043_1
        , fm.DE043_2
        , fm.DE043_3
        , fm.DE043_4
        , fm.DE043_5
        , fm.DE043_6
        , fm.DE049
        , fm.DE050
        , fm.DE051
        , fm.DE054
        , RAWTOHEX(fm.DE055) DE055
        , fm.DE063
        , fm.DE071
        , fm.DE072
        , fm.DE073
        , fm.DE093
        , fm.DE094
        , fm.DE095
        , fm.DE100

        , fm.EMV_5F2A
        , fm.EMV_71
        , fm.EMV_72
        , fm.EMV_82
        , fm.EMV_84
        , fm.EMV_8A
        , fm.EMV_91
        , fm.EMV_95
        , fm.EMV_9A
        , fm.EMV_9C
        , fm.EMV_9F02
        , fm.EMV_9F03
        , fm.EMV_9F09
        , fm.EMV_9F10
        , fm.EMV_9F1A
        , fm.EMV_9F1E
        , fm.EMV_9F26
        , fm.EMV_9F27
        , fm.EMV_9F33
        , fm.EMV_9F34
        , fm.EMV_9F35
        , fm.EMV_9F36
        , fm.EMV_9F37
        , fm.EMV_9F41
        , fm.EMV_9F4C
        , fm.EMV_9F53

        , fm.P0025_1
        , fm.P0025_2
        , fm.P0137
        , fm.P0146
        , fm.P0146_NET
        , fm.P0148
        , fm.P0149_1
        , fm.P0149_2
        , fm.P0165
        , fm.p0176
        , fm.P0190
        , fm.P0198
        , fm.P0228
        , fm.P0261
        , fm.P0262
        , fm.P0265
        , fm.P0266
        , fm.P0267
        , fm.P0268_1
        , fm.P0268_2
        , fm.P0375
        , fm.P2002
        , fm.P2063
        , fm.p2072_1
        , fm.p2072_2
        , fm.p2097_1
        , fm.p2097_2
        , fm.P2158_1
        , fm.P2158_2
        , fm.P2158_3
        , fm.P2158_4
        , fm.P2158_5
        , fm.P2158_6
        , fm.P2159_1
        , fm.P2159_2
        , fm.P2159_3
        , fm.P2159_4
        , fm.P2159_5
        , fm.P2159_6
        , fm.P2175_1
        , fm.P2175_2
        FROM MUP_UI_FIN_VW  fm, PRC_SESSION_FILE sf, MUP_FILE f
        WHERE
        fm.file_id = f.id(+)
        AND f.session_file_id = sf.id(+)
        <iterate prepend="AND" conjunction="AND" property="filters">
            <isEqual property="filters[].element" compareValue="id">fm.id = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="lang">fm.lang = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="sessionId">sf.session_id = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="fileName">sf.file_name = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="dateFrom">sf.file_date >= TO_DATE(#filters[].value#, 'DD.MM.YYYY')</isEqual>
            <isEqual property="filters[].element" compareValue="dateTo">sf.file_date <![CDATA[<=]]> TO_DATE(#filters[].value#, 'DD.MM.YYYY')</isEqual>
            <isEqual property="filters[].element" compareValue="isRejected">fm.is_rejected = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="fileId">fm.file_id = #filters[].value#</isEqual>
        </iterate>
        <include refid="paginatedClose"/>
    </select>

    <select id="get-mir-fin-messages-count"
            parameterClass="qparams"
            resultClass="int">
        <include refid="limitationOpenCount"/>
        SELECT *
        FROM MUP_UI_FIN_VW  fm, PRC_SESSION_FILE sf, MUP_FILE f
        WHERE
        fm.file_id = f.id(+)
        AND f.session_file_id = sf.id(+)
        <iterate prepend="AND" conjunction="AND" property="filters">
            <isEqual property="filters[].element" compareValue="id">fm.id = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="lang">fm.lang = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="sessionId">sf.session_id = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="fileName">sf.file_name = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="dateFrom">sf.file_date >= TO_DATE(#filters[].value#, 'DD.MM.YYYY')</isEqual>
            <isEqual property="filters[].element" compareValue="dateTo">sf.file_date <![CDATA[<=]]> TO_DATE(#filters[].value#, 'DD.MM.YYYY')</isEqual>
            <isEqual property="filters[].element" compareValue="isRejected">fm.is_rejected = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="fileId">fm.file_id = #filters[].value#</isEqual>
        </iterate>
        <include refid="limitationClose"/>
    </select>

    <resultMap  id="mapping-mir-fin-message-addendum" class="ru.bpc.sv2.ps.mir.MirFinMessageAddendum">
        <result property="id"       column="id"/>
        <result property="finId"    column="FIN_ID"/>
        <result property="fileId"   column="FILE_ID"/>
        <result property="incoming" column="IS_INCOMING"/>
        <result property="mti"      column="MTI"/>
        <result property="de024"    column="DE024"/>
        <result property="de071"    column="DE071"/>
        <result property="de032"    column="DE032"/>
        <result property="de024"    column="DE024"/>
        <result property="de033"    column="DE033"/>
        <result property="de063"    column="DE063"/>
        <result property="de093"    column="DE093"/>
        <result property="de094"    column="DE094"/>
        <result property="de100"    column="DE100"/>
    </resultMap>


    <select id="get-mir-fin-messages-addendum"
            parameterClass="qparams"
            resultMap="mapping-mir-fin-message-addendum">
        <include refid="paginatedOpen"/>
        SELECT
        ad.ID
        , ad.FIN_ID
        , ad.FILE_ID
        , ad.IS_INCOMING
        , ad.MTI
        , ad.DE024
        , ad.DE071
        , ad.DE032
        , ad.DE033
        , ad.DE063
        , ad.DE093
        , ad.DE094
        , ad.DE100
        FROM MUP_ADD  ad
        <iterate prepend="WHERE" conjunction="AND" property="filters">
            <isEqual property="filters[].element" compareValue="finId">fin_id = #filters[].value#</isEqual>
        </iterate>
        <include refid="paginatedClose"/>
    </select>

    <select id="get-mir-fin-messages-addendum-count"
            parameterClass="qparams"
            resultClass="int">
        <include refid="limitationOpenCount"/>
        SELECT *
        FROM MUP_ADD
        <iterate prepend="WHERE" conjunction="AND" property="filters">
            <isEqual property="filters[].element" compareValue="finId">fin_id = #filters[].value#</isEqual>
        </iterate>
        <include refid="limitationClose"/>
    </select>

    <resultMap  id="mapping-mir-reject"
                class="ru.bpc.sv2.ps.mir.MirReject"  >
        <result property="id" column="id" />
        <result property="networkId" column="network_id" />
        <result property="networkName" column="network_name" />
        <result property="instId" column="inst_id" />
        <result property="instName" column="inst_name" />
        <result property="fileId" column="file_id" />
        <result property="rejectedFinId" column="rejected_fin_id" />
        <result property="rejectedFileId" column="rejected_file_id" />
        <result property="mti" column="mti" />
        <result property="de024" column="de024" />
        <result property="de071" column="de071" />
        <result property="de072" column="de072" />
        <result property="de093" column="de093" />
        <result property="de094" column="de094" />
        <result property="de100" column="de100" />
        <result property="p0005" column="p0005" />
        <result property="p0025" column="p0025" />
        <result property="p0026" column="p0026" />
        <result property="p0138" column="p0138" />
        <result property="p0165" column="p0165" />
        <result property="p0280" column="p0280" />
    </resultMap>

    <select id="get-mir-rejects"
            parameterClass="qparams" resultMap="mapping-mir-reject">
        <include refid="paginatedOpen" />
        SELECT
        r.id
        ,r.network_id
        ,r.inst_id
        ,r.file_id
        ,r.rejected_fin_id
        ,r.rejected_file_id
        ,r.mti
        ,r.de024
        ,r.de071
        ,r.de072
        ,r.de093
        ,r.de094
        ,r.de100
        ,r.p0005
        ,r.p0025
        ,r.p0026
        ,r.p0138
        ,r.p0165
        ,r.p0280
        ,n.name network_name
        ,i.name inst_name
        ,sf.file_name
        FROM
        mup_reject r
        , net_ui_network_vw n
        , ost_ui_institution_vw i
        , prc_session_file sf
        , mup_file f
        , prc_session_file rsf
        , mup_file rf
        WHERE
        r.file_id = f.id(+)
        and f.session_file_id = sf.id(+)
        and r.rejected_file_id = rf.id(+)
        and rf.session_file_id = rsf.id(+)
        and r.network_id = n.id
        and r.inst_id = i.id
        <iterate prepend="AND" conjunction="AND" property="filters">
            <isEqual property="filters[].element" compareValue="id">r.id = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="lang">
                n.lang = #filters[].value#
                and i.lang = #filters[].value#
            </isEqual>
            <isEqual property="filters[].element" compareValue="sessionId">sf.session_id = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="fileName">sf.file_name = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="dateFrom">sf.file_date >= TO_DATE(#filters[].value#, 'DD.MM.YYYY')</isEqual>
            <isEqual property="filters[].element" compareValue="dateTo">sf.file_date <![CDATA[<=]]> TO_DATE(#filters[].value#, 'DD.MM.YYYY')</isEqual>

            <isEqual property="filters[].element" compareValue="networkId">r.network_id = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="instId">r.inst_id = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="fileId">r.file_id = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="rejectedFinId">r.rejected_fin_id = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="rejectedFileId">r.rejected_file_id = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="mti">r.mti = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="de024">r.de024 = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="de071">r.de071 = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="de072">r.de072 = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="de093">r.de093 = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="de094">r.de094 = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="de100">r.de100 = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="p0005">r.p0005 = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="p0006">r.p0006 = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="p0025">r.p0025 = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="p0026">r.p0026 = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="p0138">r.p0138 = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="p0165">r.p0165 = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="p0280">r.p0280 = #filters[].value#</isEqual>
        </iterate>
        <iterate prepend="ORDER BY" conjunction=", " property="sorting">
            <isNotEqual property="sorting[].direction" compareValue="AUTO">
                <isEqual property="sorting[].property" compareValue="id">r.id $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="networkId">r.network_id $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="instId">r.inst_id $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="fileId">r.file_id $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="rejectedFinId">r.rejected_fin_id $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="rejectedFileId">r.rejected_file_id $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="mti">r.mti $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="de024">r.de024 $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="de071">r.de071 $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="de072">r.de072 $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="de093">r.de093 $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="de094">r.de094 $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="de100">r.de100 $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="p0005">r.p0005 $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="p0006">r.p0006 $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="p0025">r.p0025 $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="p0026">r.p0026 $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="p0138">r.p0138 $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="p0165">r.p0165 $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="p0280">r.p0280 $sorting[].direction$</isEqual>
            </isNotEqual>
        </iterate>
        <include refid="paginatedClose" />
    </select>

    <select id="get-mir-rejects-count"
            parameterClass="qparams"
            resultClass="int">
        SELECT
        count(r.id)
        FROM
        mup_reject r
        , net_ui_network_vw n
        , ost_ui_institution_vw i
        WHERE
        r.network_id = n.id
        and r.inst_id = i.id
        <iterate prepend="AND" conjunction="AND" property="filters">
            <isEqual property="filters[].element" compareValue="id">r.id = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="lang">n.lang = #filters[].value#
                and i.lang = #filters[].value#
            </isEqual>
            <isEqual property="filters[].element" compareValue="networkId">r.network_id = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="instId">r.inst_id = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="fileId">r.file_id = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="rejectedFinId">r.rejected_fin_id = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="rejectedFileId">r.rejected_file_id = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="mti">r.mti = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="de024">r.de024 = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="de071">r.de071 = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="de072">r.de072 = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="de093">r.de093 = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="de094">r.de094 = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="de100">r.de100 = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="p0005">r.p0005 = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="p0006">r.p0006 = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="p0025">r.p0025 = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="p0026">r.p0026 = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="p0138">r.p0138 = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="p0165">r.p0165 = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="p0280">r.p0280 = #filters[].value#</isEqual>
        </iterate>
    </select>

    <resultMap  id="mapping-mir-reject-code"
                class="ru.bpc.sv2.ps.mir.MirRejectCode"  >
        <result property="rejectId" column="reject_data_id" />
        <result property="deNumber" column="de_number" />
        <result property="severityCode" column="severity_code" />
        <result property="messageCode" column="message_code" />
        <result property="subfieldId" column="subfield_id" />
    </resultMap>

    <select id="get-mir-reject-codes"
            parameterClass="qparams" resultMap="mapping-mir-reject-code">
        <include refid="paginatedOpen" />
        SELECT
        rc.reject_data_id
        ,rc.de_number
        ,rc.severity_code
        ,rc.message_code
        ,rc.subfield_id
        FROM
        mup_reject_code rc
        <iterate prepend="WHERE" conjunction="AND" property="filters">
            <isEqual property="filters[].element" compareValue="rejectId">rc.reject_data_id = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="deNumber">rc.de_number = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="severityCode">rc.severity_code = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="messageCode">rc.message_code = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="subfieldId">rc.subfield_id = #filters[].value#</isEqual>
        </iterate>
        <iterate prepend="ORDER BY" conjunction=", " property="sorting">
            <isNotEqual property="sorting[].direction" compareValue="AUTO">
                <isEqual property="sorting[].property" compareValue="rejectId">rc.reject_data_id $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="deNumber">rc.de_number $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="severityCode">rc.severity_code $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="messageCode">rc.message_code $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="subfieldId">rc.subfield_id $sorting[].direction$</isEqual>
            </isNotEqual>
        </iterate>
        <include refid="paginatedClose" />
    </select>

    <select id="get-mir-reject-codes-count"
            parameterClass="qparams"
            resultClass="int">
        SELECT
        count(*)
        FROM
        mup_reject_code rc
        <iterate prepend="WHERE" conjunction="AND" property="filters">
            <isEqual property="filters[].element" compareValue="rejectId">rc.reject_data_id = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="deNumber">rc.de_number = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="severityCode">rc.severity_code = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="messageCode">rc.message_code = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="subfieldId">rc.subfield_id = #filters[].value#</isEqual>
        </iterate>
    </select>

    <resultMap  id="mapping-mir-file" class="ru.bpc.sv2.ps.mir.MirFile">
        <result property="sessionId"        column="SESSION_ID" />
        <result property="fileName"         column="FILE_NAME" />
        <result property="fileDate"         column="FILE_DATE" />

        <result property="id"               column="ID"/>
        <result property="instId"           column="INST_ID"/>
        <result property="networkId"        column="NETWORK_ID"/>
        <result property="incoming"         column="IS_INCOMING"/>
        <result property="procDate"         column="PROC_DATE"/>
        <result property="sessionFileId"    column="SESSION_FILE_ID"/>
        <result property="rejected"         column="IS_REJECTED"/>
        <result property="rejectId"         column="REJECT_ID"/>
        <result property="p0026"            column="P0026"/>
        <result property="p0105"            column="P0105"/>
        <result property="p0110"            column="P0110"/>
        <result property="p0122"            column="P0122"/>
        <result property="p0301"            column="P0301"/>
        <result property="p0306"            column="P0306"/>
        <result property="headerMti"        column="HEADER_MTI"/>
        <result property="headerDe024"      column="HEADER_DE024"/>
        <result property="headerDe071"      column="HEADER_DE071"/>
        <result property="trailerMti"       column="TRAILER_MTI"/>
        <result property="trailerDe024"     column="TRAILER_DE024"/>
        <result property="trailerDe071"     column="TRAILER_DE071"/>
        <result property="instName"         column="INST_NAME" />
    </resultMap>

    <select id="get-mir-files"
            parameterClass="qparams"
            resultMap="mapping-mir-file">
        <include refid="paginatedOpen"/>

        SELECT
        sf.SESSION_ID
        ,sf.FILE_NAME
        ,sf.FILE_DATE
        ,f.ID
        ,f.INST_ID
        ,f.NETWORK_ID
        ,f.IS_INCOMING
        ,f.PROC_DATE
        ,f.SESSION_FILE_ID
        ,f.IS_REJECTED
        ,f.REJECT_ID
        ,f.P0026
        ,f.P0105
        ,f.P0110
        ,f.P0122
        ,f.P0301
        ,f.P0306
        ,f.HEADER_MTI
        ,f.HEADER_DE024
        ,f.HEADER_DE071
        ,f.TRAILER_MTI
        ,f.TRAILER_DE024
        ,f.TRAILER_DE071
        ,i.NAME INST_NAME
        FROM MUP_FILE f, PRC_SESSION_FILE sf , OST_UI_INSTITUTION_SYS_VW i
        WHERE f.SESSION_FILE_ID = sf.ID(+)
        AND f.INST_ID = i.ID(+)
        <iterate prepend="AND" conjunction="AND" property="filters">
            <isEqual property="filters[].element" compareValue="lang">
                i.lang(+) = #filters[].value#
            </isEqual>
            <isEqual property="filters[].element" compareValue="sessionId">sf.session_id = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="fileName">sf.file_name like #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="dateFrom">sf.file_date >= TO_DATE(#filters[].value#, 'DD.MM.YYYY')</isEqual>
            <isEqual property="filters[].element" compareValue="dateTo">sf.file_date <![CDATA[<=]]> TO_DATE(#filters[].value#, 'DD.MM.YYYY')</isEqual>
        </iterate>
        <iterate prepend="ORDER BY" conjunction=", " property="sorting">
            <isNotEqual property="sorting[].direction" compareValue="AUTO">
                <isEqual property="sorting[].property" compareValue="sessionId">sf.session_id $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="fileName">sf.file_name $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="fileDate">sf.file_date $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="id">f.id $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="instId">f.inst_id $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="networkId">f.network_id $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="incoming">f.is_incoming $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="procDate">f.proc_date $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="sessionFileId">f.session_file_id $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="rejected">f.is_rejected $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="rejectId">f.reject_id $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="p0026">f.p0026 $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="p0105">f.p0105 $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="p0110">f.p0110 $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="p0122">f.p0122 $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="p0301">f.p0301 $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="p0306">f.p0306 $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="headerMti">f.header_mti $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="headerDe024">f.header_de024 $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="headerDe071">f.header_de071 $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="trailerMti">f.trailer_mti $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="trailerDe024">f.trailer_de024 $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="trailerDe071">f.trailer_de071 $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="instName">inst_name $sorting[].direction$</isEqual>
            </isNotEqual>
        </iterate>
        <include refid="paginatedClose"/>
    </select>

    <select id="get-mir-files-count"
            parameterClass="qparams"
            resultClass="int">
        <include refid="limitationOpenCount"/>
        SELECT f.ID
        FROM MUP_FILE f, PRC_SESSION_FILE sf , OST_UI_INSTITUTION_SYS_VW i
        WHERE f.SESSION_FILE_ID = sf.ID(+)
        AND f.INST_ID = i.ID(+)
        <iterate prepend="AND" conjunction="AND" property="filters">
            <isEqual property="filters[].element" compareValue="lang">
                i.lang(+) = #filters[].value#
            </isEqual>
            <isEqual property="filters[].element" compareValue="sessionId">sf.session_id = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="fileName">sf.file_name like #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="dateFrom">sf.file_date >= TO_DATE(#filters[].value#, 'DD.MM.YYYY')</isEqual>
            <isEqual property="filters[].element" compareValue="dateTo">sf.file_date <![CDATA[<=]]> TO_DATE(#filters[].value#, 'DD.MM.YYYY')</isEqual>
        </iterate>
        <include refid="limitationClose"/>
    </select>

    <resultMap id="map-get-mir-reports" class="ru.bpc.sv2.ps.mir.MirReport">
        <result property="id"               column="id"                     javaType="java.lang.Long"       jdbcType="NUMERIC"/>
        <result property="instId"           column="inst_id"                javaType="java.lang.Integer"    jdbcType="NUMERIC"/>
        <result property="instName"         column="inst_name"              javaType="java.lang.String"     jdbcType="VARCHAR"/>
        <result property="sessionId"        column="session_id"             javaType="java.lang.Long"       jdbcType="NUMERIC"/>
        <result property="fileId"           column="file_id"                javaType="java.lang.Long"       jdbcType="NUMERIC"/>
        <result property="fileName"         column="file_name"              javaType="java.lang.String"     jdbcType="VARCHAR"/>
        <result property="fileDate"         column="file_date"              javaType="java.util.Date"       jdbcType="DATE"/>
        <result property="recordNumber"     column="record_number"          javaType="java.lang.Long"       jdbcType="NUMERIC"/>
        <result property="status"           column="status"                 javaType="java.lang.String"     jdbcType="VARCHAR"/>
        <result property="reportType"       column="report_type"            javaType="java.lang.String"     jdbcType="VARCHAR"/>
        <result property="activityType"     column="activity_type"          javaType="java.lang.String"     jdbcType="VARCHAR"/>
        <result property="origInstId"       column="de094"                  javaType="java.lang.Long"       jdbcType="NUMERIC"/>
        <result property="mti"              column="mti"                    javaType="java.lang.Integer"    jdbcType="NUMERIC"/>
        <result property="cardNumber"       column="de002"                  javaType="java.lang.String"     jdbcType="VARCHAR"/>
        <result property="procCode"         column="de003"                  javaType="java.lang.Long"       jdbcType="NUMERIC"/>
        <result property="transAmount"      column="de004"                  javaType="java.math.BigDecimal" jdbcType="NUMERIC"/>
        <result property="reconAmount"      column="de005"                  javaType="java.math.BigDecimal" jdbcType="NUMERIC"/>
        <result property="reconConvRate"    column="de009"                  javaType="java.lang.String"     jdbcType="VARCHAR"/>
        <result property="localDateTime"    column="de012"                  javaType="java.util.Date"       jdbcType="DATE"/>
        <result property="posEntryMode"     column="de022"                  javaType="java.lang.String"     jdbcType="VARCHAR"/>
        <result property="funcCode"         column="de024"                  javaType="java.lang.String"     jdbcType="VARCHAR"/>
        <result property="msgReason"        column="de025"                  javaType="java.lang.String"     jdbcType="VARCHAR"/>
        <result property="mcc"              column="de026"                  javaType="java.lang.String"     jdbcType="VARCHAR"/>
        <result property="acqRefData"       column="de031"                  javaType="java.lang.String"     jdbcType="VARCHAR"/>
        <result property="rrn"              column="de037"                  javaType="java.lang.String"     jdbcType="VARCHAR"/>
        <result property="appCode"          column="de038"                  javaType="java.lang.String"     jdbcType="VARCHAR"/>
        <result property="serviceCode"      column="de040"                  javaType="java.lang.String"     jdbcType="VARCHAR"/>
        <result property="cardAccTermId"    column="de041"                  javaType="java.lang.String"     jdbcType="VARCHAR"/>
        <result property="cardAccIdCode"    column="de042"                  javaType="java.lang.String"     jdbcType="VARCHAR"/>
        <result property="cardAccAddress"   column="de043_123"              javaType="java.lang.String"     jdbcType="VARCHAR"/>
        <result property="cardAccPostCode"  column="de043_4"                javaType="java.lang.String"     jdbcType="VARCHAR"/>
        <result property="cardAccRegion"    column="de043_5"                javaType="java.lang.String"     jdbcType="VARCHAR"/>
        <result property="cardAccCountry"   column="de043_6"                javaType="java.lang.String"     jdbcType="VARCHAR"/>
        <result property="isReversal"       column="p0025_1"                javaType="java.lang.String"     jdbcType="VARCHAR"/>
        <result property="refFileDate"      column="p0105"                  javaType="java.util.Date"       jdbcType="DATE"/>
        <result property="feeAmount"        column="p0146"                  javaType="java.lang.String"     jdbcType="VARCHAR"/>
        <result property="currExponents"    column="p0148"                  javaType="java.lang.String"     jdbcType="VARCHAR"/>
        <result property="isSettlement"     column="p0165"                  javaType="java.lang.String"     jdbcType="VARCHAR"/>
        <result property="finData"          column="p2158"                  javaType="java.lang.String"     jdbcType="VARCHAR"/>
        <result property="origTransAgentId" column="orig_transfer_agent_id" javaType="java.lang.String"     jdbcType="VARCHAR"/>
        <result property="sttlData"         column="p2159"                  javaType="java.lang.String"     jdbcType="VARCHAR"/>
        <result property="transCurrCode"    column="de049"                  javaType="java.lang.String"     jdbcType="VARCHAR"/>
        <result property="recontCurrCode"   column="de050"                  javaType="java.lang.String"     jdbcType="VARCHAR"/>
        <result property="addlAmount"       column="de054"                  javaType="java.lang.String"     jdbcType="VARCHAR"/>
        <result property="transCycleId"     column="de063"                  javaType="java.lang.String"     jdbcType="VARCHAR"/>
        <result property="dataRecord"       column="de072"                  javaType="java.lang.String"     jdbcType="VARCHAR"/>
        <result property="lang"             column="lang"                   javaType="java.lang.String"     jdbcType="VARCHAR"/>
    </resultMap>

    <select id="get-mir-reports" parameterClass="qparams" resultMap="map-get-mir-reports">
        <include refid="paginatedOpen"/>
            select m.id
                 , m.inst_id
                 , ost_ui_institution_pkg.get_inst_name(
                       i_inst_id => m.inst_id
                     , i_lang    => m.lang
                   ) as inst_name
                 , s.session_id
                 , m.file_id
                 , s.file_name
                 , s.file_date
                 , m.record_number
                 , m.status
                 , m.report_type
                 , m.activity_type
                 , m.de094
                 , m.mti
                 , m.de002
                 , m.de003
                 , m.de004
                 , m.de005
                 , m.de009
                 , m.de012
                 , m.de022
                 , m.de024
                 , m.de025
                 , m.de026
                 , m.de031
                 , m.de037
                 , m.de038
                 , m.de040
                 , m.de041
                 , m.de042
                 , m.de043_123
                 , m.de043_4
                 , m.de043_5
                 , m.de043_6
                 , m.p0025_1
                 , m.p0105
                 , m.p0146
                 , m.p0148
                 , m.p0165
                 , m.p2158
                 , m.orig_transfer_agent_id
                 , m.p2159
                 , m.de049
                 , m.de050
                 , m.de054
                 , m.de063
                 , m.de072
                 , m.lang
              from mup_ui_trans_rpt_vw m
                 , mup_ui_file_vw f
                 , prc_ui_session_file_vw s
             where f.id(+) = m.file_id
               and s.id(+) = f.session_file_id
        <iterate prepend=" and " conjunction=" and " property="filters">
            <isEqual property="filters[].element" compareValue="lang">m.lang(+) = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="id">m.id = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="sessionId">m.id = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="fileName">upper(s.file_name) like upper(#filters[].value#)</isEqual>
            <isEqual property="filters[].element" compareValue="rrn">m.de037 = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="dateFrom">m.de012 >= to_date(#filters[].value#, 'DD.MM.YYYY')</isEqual>
            <isEqual property="filters[].element" compareValue="dateTo">m.de012 <![CDATA[<=]]> to_date(#filters[].value#, 'DD.MM.YYYY')</isEqual>
            <isEqual property="filters[].element" compareValue="reportType">m.report_type = #filters[].value#</isEqual>
        </iterate>
        <iterate prepend=" order by " conjunction=", " property="sorting">
            <isNotEqual property="sorting[].direction" compareValue="auto">
                <isEqual property="sorting[].property" compareValue="lang">m.lang(+) $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="id">m.id $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="sessionId">m.id $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="fileName">s.file_name $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="rrn">m.de037 $sorting[].direction$</isEqual>
                <isEqual property="sorting[].property" compareValue="localDateTime">m.de012 $sorting[].direction$</isEqual>
            </isNotEqual>
        </iterate>
        <include refid="paginatedClose"/>
    </select>

    <select id="get-mir-reports-count" parameterClass="qparams" resultClass="int">
        <include refid="limitationOpenCount"/>
            select m.id
              from mup_ui_trans_rpt_vw m
                 , mup_ui_file_vw f
                 , prc_ui_session_file_vw s
             where f.session_file_id(+) = m.file_id
               and s.id(+) = f.session_file_id
        <iterate prepend=" and " conjunction=" and " property="filters">
            <isEqual property="filters[].element" compareValue="lang">m.lang(+) = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="id">m.id = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="sessionId">m.id = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="fileName">upper(s.file_name) like upper(#filters[].value#)</isEqual>
            <isEqual property="filters[].element" compareValue="rrn">m.de037 = #filters[].value#</isEqual>
            <isEqual property="filters[].element" compareValue="dateFrom">m.de012 >= to_date(#filters[].value#, 'DD.MM.YYYY')</isEqual>
            <isEqual property="filters[].element" compareValue="dateTo">m.de012 <![CDATA[<=]]> to_date(#filters[].value#, 'DD.MM.YYYY')</isEqual>
            <isEqual property="filters[].element" compareValue="reportType">m.report_type = #filters[].value#</isEqual>
        </iterate>
        <include refid="limitationClose"/>
    </select>
</sqlMap>