<?xml version="1.0" encoding="UTF-8"?>
<html	xmlns="http://www.w3.org/1999/xhtml"
		xmlns:f="http://java.sun.com/jsf/core"
		xmlns:h="http://java.sun.com/jsf/html"
		xmlns:ui="http://java.sun.com/jsf/facelets"
		xmlns:a4j="http://richfaces.org/a4j"
		xmlns:rich="http://richfaces.org/rich"
		xmlns:bm="http://www.bpc.ru/jsf/misc"
		xmlns:bre="http://www.bpc.ru/jsf/richfaces-ext">
<ui:composition>
	<f:loadBundle var="lblEvt" basename="ru.bpc.sv2.ui.bundles.Evt"/>
	
   	<h:form id="statusLogsForm">
		<h:panelGroup id="statusLogsTableWrapper" layout="block" style="padding:0px;margin:0px;">
		    <rich:extendedDataTable
					id="statusLogsTable"
					styleClass="res-table"
					headerClass="res-table-header table-header-ext"
					rowClasses=",odd"
					selectedClass="res-table-selected"
					var="item"
					value="#{(statusLogsBean==null ? MbStatusLogs : statusLogsBean).statusLogs}"
					selection="#{(statusLogsBean==null ? MbStatusLogs : statusLogsBean).itemSelection}"
					height="220px"
					rows="0"
					enableContextMenu="true"
					tableState="#{(statusLogsBean==null ? MbStatusLogs : statusLogsBean).tableState}"
					noDataLabel="#{lblCommon['no_records_found']}">
	
				<a4j:support event="onselectionchange" reRender="btnPanel" />
				
				<rich:column id="status" label="#{lblCommon.status}" title="Status" sortBy="#{'status'}" width="15%">
	                <f:facet name="header">
						<h:panelGroup>         
							<script>updateHeight();</script>
		                   	<h:outputText value="#{lblCommon.status}" title="#{lblCommon.status}"/>
						</h:panelGroup>
	                </f:facet>
	               	<h:outputText value="#{DictUtils.articles[item.status]}"
	               			title="#{DictUtils.articles[item.status]}"
	               			rendered="#{item.status != null}" />
	               	<h:outputText value="" title="" rendered="#{item.status == null}" />
				</rich:column>
				
				<rich:column id="reason" label="#{lblEvt.reason}" title="Reason" sortBy="#{'reason'}" width="20%">
	                <f:facet name="header">
	                   	<h:outputText value="#{lblEvt.reason}" title="#{lblEvt.reason}"/>
	                </f:facet>
	               	<h:outputText value="#{DictUtils.articles[item.reason]}" 
	               			title="#{DictUtils.articles[item.reason]}"
	               			rendered="#{item.reason != null}" />
	               	<h:outputText value="" title="" rendered="#{item.reason == null}" />
				</rich:column>
				
				<rich:column id="change_date" label="#{lblEvt.change_date}" title="Change date" sortBy="#{'changeDate'}" width="10%">
	                <f:facet name="header">
	                   	<h:outputText value="#{lblEvt.change_date}" title="#{lblEvt.change_date}"/>
	                </f:facet>
	               	<h:outputText value="#{item.changeDate}" title="#{item.changeDate}">
	               		<f:convertDateTime pattern="#{usession.fullDatePattern}" timeZone="#{CommonUtils.timeZone}"/>
	               	</h:outputText>
				</rich:column>
	
				<rich:column id="initiator" label="#{lblEvt.initiator}" title="Initiator" sortBy="#{'initiator'}" width="15%">
	                <f:facet name="header">
	                   	<h:outputText value="#{lblEvt.initiator}" title="#{lblEvt.initiator}"/>
	                </f:facet>
	               	<h:outputText value="#{DictUtils.articles[item.initiator]}" 
	               			title="#{DictUtils.articles[item.initiator]}"
	               			rendered="#{item.initiator != null}" />
	               	<h:outputText value="" title="" rendered="#{item.initiator == null}" />
				</rich:column>
				
				<rich:column id="event_type" label="#{lblCommon.event_type}" title="Event type" sortBy="#{'eventType'}" width="15%" rendered="#{renderColumnEventType}">
	                <f:facet name="header">
	                   	<h:outputText value="#{lblCommon.event_type}" title="#{lblCommon.event_type}"/>
	                </f:facet>
	               	<h:outputText value="#{DictUtils.articles[item.eventType]}"
	               			title="#{DictUtils.articles[item.eventType]}"
	               			rendered="#{item.eventType != null}" />
	               	<h:outputText value="" title="" rendered="#{item.eventType == null}" />
				</rich:column>
	
				<rich:column id="session_id" label="#{lblCommon.session_id}" title="Session ID" sortBy="#{'sessionId'}" width="10%" rendered="#{renderColumnSessionId}">
	                <f:facet name="header">
	                   	<h:outputText value="#{lblCommon.session_id}" title="#{lblCommon.session_id}"/>
	                </f:facet>
	               	<h:outputText value="#{item.sessionId}" title="#{item.sessionId}"/>
				</rich:column>
	
				<rich:column id="user" label="#{lblCommon.person}" title="User name" sortBy="#{'userName'}" width="15%" rendered="#{renderColumnUserName}">
	                <f:facet name="header">
	                   	<h:outputText value="#{lblCommon.person}" title="#{lblCommon.person}"/>
	                </f:facet>
	               	<h:outputText value="#{item.userName}" title="#{item.userName}"/>
				</rich:column>
		    </rich:extendedDataTable>
		</h:panelGroup>

		<h:panelGroup layout="block" styleClass="bottom_search_result_block_buttons">
			<h:panelGroup layout="block" styleClass="bottom_search_result_left_buttons" rendered="#{statusLogsBean==null}">
				<h:panelGrid id="btnPanel" styleClass="fw buttons_block" columns="2" columnClasses=", table_tools_state">
					<h:panelGroup></h:panelGroup>
					<h:panelGroup>
						<h:graphicImage url="/images/green-tick.png" title="#{lblCommon.save_table_state}" styleClass="action_icon"
							onclick="saveLogTableState();"/>
						<h:graphicImage url="/images/red-cross.png" title="#{lblCommon.delete_table_state}" styleClass="action_icon"
							onclick="deleteLogTableState();"/>
						<a4j:queue name="tablestatequeue"/>
						<a4j:jsFunction name="saveLogTableState" action="#{(statusLogsBean==null ? MbStatusLogs : statusLogsBean).saveTableStateDB}" eventsQueue="tablestatequeue"/>
						<a4j:jsFunction name="deleteLogTableState" action="#{(statusLogsBean==null ? MbStatusLogs : statusLogsBean).deleteTableStateDB}" eventsQueue="tablestatequeue"/>
					</h:panelGroup>
				</h:panelGrid>
			</h:panelGroup>
	    </h:panelGroup>
    </h:form>
</ui:composition>
</html>
