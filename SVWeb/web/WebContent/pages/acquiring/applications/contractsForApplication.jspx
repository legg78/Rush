<?xml version="1.0" encoding="UTF-8"?>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:a4j="http://richfaces.org/a4j"
      xmlns:rich="http://richfaces.org/rich"
	  xmlns:bm="http://www.bpc.ru/jsf/misc"
	  xmlns:bre="http://www.bpc.ru/jsf/richfaces-ext">
<ui:composition>
	<script type="text/javascript">
//<!--
	function enableContractsButtons#{viewId}() {
		var selected = false;
		var rows = document.getElementById("#{viewIdColon}appsContractsForm:contractsTable").
				getElementsByTagName('tbody')[0].getElementsByTagName('tr');
		for (var i = 0; i < rows.length; i++) {
			if (rows[i].className.indexOf("res-table-selected") >= 0) {
				selected = true;
				break;
			}
		}
		if (selected) {
			document.getElementById("#{viewIdColon}appsContractsForm:selectBtn").disabled = false;
		} else {
			document.getElementById("#{viewIdColon}appsContractsForm:selectBtn").disabled = true;
		}
	}

	//-->
	</script>

	<rich:modalPanel id="appsContractsModalPanel" autosized="true" minWidth="600" minHeight="200">
		<f:facet name="header">
	    	<h:outputText value="#{lblPrd.contracts}"/>	           	
		</f:facet>
		<f:facet name="controls">
		</f:facet>
		<h:form id="appsContractsForm">
			<h:panelGrid styleClass="fw" columns="2" columnClasses=",link-cont">
               	<h:panelGrid styleClass="filter-table field-cont" columns="4" columnClasses="firstColModal, ,firstColModal,">
             			
					<h:outputText value="#{lblPrd.contract_number}:"/>
					<h:inputText value="#{MbApplicationCreate.filterContract.contractNumber}" />
		            			
					<h:outputText value="#{lblAcc.account_number}:"/>
					<h:inputText value="#{MbApplicationCreate.filterContract.accountNumber}" />
		            			
					<h:outputText value="#{lblPrd.customer_number}:"/>
					<h:inputText id="customerNumber" value="#{MbApplicationCreate.filterContract.customerNumber}"/>
		            			
					<h:outputText value="#{lblIss.card_number}:"
							rendered="#{MbApplicationCreate.issuingType}"/>
					<h:inputText value="#{MbApplicationCreate.filterContract.cardNumber}"
							rendered="#{MbApplicationCreate.issuingType}"/>
            			
					<h:outputText value="#{lblAcq.merchant_number}:"
							rendered="#{MbApplicationCreate.acquiringType}"/>
					<h:inputText value="#{MbApplicationCreate.filterContract.merchantNumber}"
							rendered="#{MbApplicationCreate.acquiringType}"/>

					<h:outputText value="#{lblAcq.terminal_number}:"
							rendered="#{MbApplicationCreate.acquiringType}"/>
					<h:inputText value="#{MbApplicationCreate.filterContract.terminalNumber}"
							rendered="#{MbApplicationCreate.acquiringType}"/>
							
					<h:outputText value="#{lblPrd.contract_type}:"/>
					<h:selectOneMenu 
							disabled="#{empty MbApplicationCreate.contractTypes}"
							value="#{MbApplicationCreate.filterContract.contractType}"
							label="#{lblPrd.contract_type}">
								
							<f:selectItem itemValue="" />
							<f:selectItems value="#{MbApplicationCreate.contractTypes}" />
					</h:selectOneMenu>							
							
				</h:panelGrid>
               	<h:panelGrid columns="1">
               		<bre:taggedCommandButton image="/_img/icon_search.png" type="submit"
               				value="#{lblForm.search}" style="width:85px;" 
               				action="#{MbApplicationCreate.searchContracts}" 
               				reRender="#{viewIdColon}appsContractsForm:contractsTable,#{viewIdColon}appsContractsForm:contractsAppDs" ajaxSingle="true" process="#{viewIdColon}appsContractsForm"
               				oncomplete="enableContractsButtons#{viewId}()"
               				/>
				</h:panelGrid>
			</h:panelGrid>
               	
			<rich:extendedDataTable
					id="contractsTable"
					styleClass="res-table"
					headerClass="res-table-header"
					rowClasses=",odd"
					selectedClass="res-table-selected"
					var="itemContract"
					value="#{MbApplicationCreate.contracts}"
					selection="#{MbApplicationCreate.contractsSelection}"
					rows="#{MbApplicationCreate.contracts.rowsPerPage}"
					height="200px"
					selectionMode="single"
					width="100%"
					enableContextMenu="false"
					noDataLabel="#{MbApplicationCreate.searchingContract?lblCommon['no_records_found'] : lblCommon['enter_search_criteria_above']}"
					onselectionchange="enableContractsButtons#{viewId}()"
					>
					
				<rich:column title="Contract number" sortBy="#{'contractNumber'}" width="20%">
					<f:facet name="header">
	                    <h:outputText value="#{lblPrd.contract_number}" 
	                    		title="#{lblPrd.contract_number}" 
	                    		/>
	                </f:facet>
	                <h:outputText value="#{itemContract.contractNumber}" title="#{itemContract.contractNumber}"/>
		        </rich:column>
	        
	        	<rich:column title="Product" sortBy="#{'productName'}" width="20%">
					<f:facet name="header">
	                    <h:outputText value="#{lblPrd.product}" title="#{lblPrd.product}" />
	                </f:facet>
	            	<h:outputText value="#{itemContract.productName}" title="#{itemContract.productName}" 
	            			/>
		        </rich:column>

		        <rich:column title="Customer" sortBy="#{'customerName'}" width="20%">
					<f:facet name="header">
	                    <h:outputText value="#{lblPrd.customer}" title="#{lblPrd.customer}"/>
	                </f:facet>
	            	<h:outputText value="#{itemContract.customerName}" 
	            			title="#{itemContract.customerNumber} - #{itemContract.customerName}" 
	            			/>
		        </rich:column>

		        <rich:column title="Start date" sortBy="#{'startDate'}" width="12%">
					<f:facet name="header">
	                    <h:outputText value="#{lblCommon.start_date}" title="#{lblCommon.start_date}"/>
	                </f:facet>
	            	<h:outputText value="#{itemContract.startDate}" title="#{itemContract.startDate}">
	            		<f:convertDateTime pattern="#{usession.datePattern}"
	            				timeZone="#{CommonUtils.timeZone}"/>
	            	</h:outputText>
		        </rich:column>

		        <rich:column title="End date" sortBy="#{'endDate'}" width="12%">
					<f:facet name="header">
	                    <h:outputText value="#{lblCommon.end_date}" title="#{lblCommon.end_date}"/>
	                </f:facet>
	            	<h:outputText value="#{itemContract.endDate}" title="#{itemContract.endDate}">
	            		<f:convertDateTime pattern="#{usession.datePattern}"
	            				timeZone="#{CommonUtils.timeZone}"/>
	            	</h:outputText>
		        </rich:column>

		        <rich:column title="Contract type" sortBy="#{'contractType'}" width="15%">
					<f:facet name="header">
	                    <h:outputText value="#{lblPrd.contract_type}" title="#{lblPrd.contract_type}"/>
	                </f:facet>
	            	<h:outputText value="#{DictUtils.articles[itemContract.contractType]}" title="#{DictUtils.articles[itemContract.contractType]}" />
		        </rich:column>
			        
				<f:facet name="footer">                      
	            </f:facet>
		    </rich:extendedDataTable>

			<bm:dataScroller id="contractsAppDs" for="#{viewIdColon}appsContractsForm:contractsTable" pageable="#{MbApplicationCreate.contracts}"/>

      	    <h:panelGroup layout="block" styleClass="bottom_search_result_block_buttons">
				<h:panelGroup layout="block" styleClass="bottom_search_result_left_buttons">
	       	    	<h:panelGrid columns="3" columnClasses="width99P,,paddingR12">
	       	    		<h:outputText/>			       	    	
                       	<bre:taggedCommandButton id="selectBtn" 
                       			value="#{lblApp.select}"
                       			action="#{MbApplicationCreate.selectContract}"
                       			reRender="#{viewIdColon}appCreateForm:customerTypeGroup, 
                       					#{viewIdColon}appCreateForm:chkNewCustomer,
                       					#{viewIdColon}appCreateForm:customerNumber,
                       					#{viewIdColon}appCreateForm:customersLink,
                       					#{viewIdColon}appCreateForm:customersLinkClear,
                       					#{viewIdColon}appCreateForm:customerNumberHidden,
                       					#{viewIdColon}appCreateForm:customerTypeGroup,
                       					#{viewIdColon}appCreateForm:contractTypeGroup, 
                       					#{viewIdColon}appCreateForm:contractNumberHidden, 
                       					#{viewIdColon}appCreateForm:product_id, 
                       					#{viewIdColon}appCreateForm:customerNumberHidden, 
                       					#{viewIdColon}appCreateForm:flow, 
                       					#{viewIdColon}appCreateForm:appObjectsTabPanel,
                       					#{viewIdColon}appCreateForm:extCustomerTypeTitle,
                       					serviceProviderTitle, 
                       					serviceProvider,
                       					#{viewIdColon}appCreateForm:extCustomerTypeGroup"
                       			oncomplete="if (#{usession.noErrorResponse}) Richfaces.hideModalPanel('#{viewIdColon}appsContractsModalPanel'); setContractNumber#{viewId}()"
                       			/>		                        		
                   	
                       	<bre:taggedCommandButton
                        		value="#{lblForm.cancel}" immediate="true" limitToList="true"
                        		oncomplete="Richfaces.hideModalPanel('#{viewIdColon}appsContractsModalPanel')"
                        		/>			                        		
		    		</h:panelGrid>
		    	</h:panelGroup>
		    </h:panelGroup>

		    <script type="text/javascript">
//<!--
		    	enableContractsButtons#{viewId}();//-->
		    </script>
		</h:form>
	</rich:modalPanel>

</ui:composition>
</html>
