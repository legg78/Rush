<?xml version="1.0" encoding="UTF-8"?>
<html	xmlns="http://www.w3.org/1999/xhtml"
		xmlns:f="http://java.sun.com/jsf/core"
		xmlns:h="http://java.sun.com/jsf/html"
		xmlns:ui="http://java.sun.com/jsf/facelets"
		xmlns:a4j="http://richfaces.org/a4j"
		xmlns:rich="http://richfaces.org/rich"
		xmlns:bm="http://www.bpc.ru/jsf/misc"
		xmlns:bre="http://www.bpc.ru/jsf/richfaces-ext">
<ui:composition>
	<script>
		var types = {};
		var currentCounts = {};
		var minCounts = {};
		var maxCounts = {};

		function initAddBranch() {
			document.getElementById('addBranchDiv:branch').value = '';
			document.getElementById('addBranchDiv:objectId').value= '';
			document.getElementById('addBranchDiv:branch_ENTTSRVC').value='';
			document.getElementById('addBranchDiv:branch_ENTTCARD').value='';
			document.getElementById('addBranchDiv:branch_ENTTACCT').value='';
			document.getElementById('addBranchDiv:branch_ENTTMRCH').value='';
			document.getElementById('addBranchDiv:branch_ENTTTRMN').value='';
			
			document.getElementById('addBranchDiv:branch_ENTTSRVC').style.display = "none";
			document.getElementById('addBranchDiv:branch_ENTTCARD').style.display = "none";
			document.getElementById('addBranchDiv:branch_ENTTACCT').style.display = "none";
			document.getElementById('addBranchDiv:branch_ENTTMRCH').style.display = "none";
			document.getElementById('addBranchDiv:branch_ENTTTRMN').style.display = "none";
			
		}
		
		function ckeckService(elId) {
			
		}
		
		function checkObject(elId) {
			var currentCount;
			var maxCount = document.getElementById(elId + 'MaxCount').value;
			var minCount = document.getElementById(elId + 'MinCount').value;
			var serviceType = document.getElementById(elId + 'Type').value;
			var el = document.getElementById(elId);
			if (types[serviceType] == true) {
				currentCount = currentCounts[serviceType];				
			} else {
				types[serviceType] = true;
				maxCounts[serviceType] = maxCount;
				minCounts[serviceType] = minCount;
				currentCount = document.getElementById(elId+'CurrentCount').value;				
			}
			if (el.checked) {
				currentCount++;
			}
			if (!el.checked) {
				currentCount--;
			}
			currentCounts[serviceType] = currentCount;
			document.getElementById(elId+'CurrentCount').value = currentCount;
			return true;
		}

		function setObjectId(value) {
			document.getElementById('addBranchDiv:objectId').value= value;
		}

		function showBranchObjects(value) {
			document.getElementById('addBranchDiv:objectId').value= '';
			document.getElementById('addBranchDiv:branch_ENTTSRVC').style.display = "none";
			document.getElementById('addBranchDiv:branch_ENTTCARD').style.display = "none";
			document.getElementById('addBranchDiv:branch_ENTTACCT').style.display = "none";
			document.getElementById('addBranchDiv:branch_ENTTMRCH').style.display = "none";
			document.getElementById('addBranchDiv:branch_ENTTTRMN').style.display = "none";			
			if (value != null) {
				document.getElementById('addBranchDiv:branch_' + value).style.display = "";
			}
		}
	</script>
	<h:panelGroup layout="block" styleClass="cardholderdata-wrapper">
		<h:panelGrid columns="2" columnClasses="top, top">
			<h:panelGrid columns="1">
				<h:outputLabel value="* #{lblApp.branch}: " title="#{lblApp.branch}"/>
				<h:selectOneMenu 
						id="branch" 
						value="#{MbApplication.branchEntity}" 
						required="true"
						label="#{lblApp.branch}">
					<f:selectItem itemValue=""/>
					<f:selectItems value="#{MbApplication.branchTypes}"/>
					<a4j:support event="onchange" ajaxSingle="true" limitToList="true" 
						reRender="contractObjectsArea"
						oncomplete="showBranchObjects(this.value); return true;"/>						
				</h:selectOneMenu>
			
				<h:outputLabel value="* #{lblApp.object}: " title="#{lblApp.object}"/>
				<h:panelGroup>
				<h:selectOneMenu 
						id="branch_ENTTSRVC" 
						value="#{MbApplication.serviceId}" 
						label="#{lblApp.object}"
						style="display:none">
					<f:selectItem itemValue=""/>
					<f:selectItems value="#{MbApplication.branchServices}"/>
					<a4j:support event="onchange" reRender="contractObjectsArea" oncomplete="setObjectId(this.value)"
							ajaxSingle="true" limitToList="true"/>								
				</h:selectOneMenu>
				
				<h:selectOneMenu 
						id="branch_ENTTCARD" 
						value="#{MbApplication.cardId}" 
						label="#{lblApp.object}"
						style="display:none">
					<f:selectItem itemValue=""/>
					<f:selectItems value="#{MbApplication.branchCards}"/>
					<a4j:support event="onchange" reRender="contractObjectsArea" oncomplete="setObjectId(this.value)"
							ajaxSingle="true" limitToList="true"/>								
				</h:selectOneMenu>
				
				<h:selectOneMenu 
						id="branch_ENTTMRCH" 
						value="#{MbApplication.merchantId}" 
						label="#{lblApp.object}"
						style="display:none">
					<f:selectItem itemValue=""/>
					<f:selectItems value="#{MbApplication.branchMerchants}"/>
					<a4j:support event="onchange" reRender="contractObjectsArea" oncomplete="setObjectId(this.value)"
							ajaxSingle="true" limitToList="true"/>								
				</h:selectOneMenu>
				
				<h:selectOneMenu 
						id="branch_ENTTTRMN" 
						value="#{MbApplication.terminalId}" 
						label="#{lblApp.object}"
						style="display:none">
					<f:selectItem itemValue=""/>
					<f:selectItems value="#{MbApplication.branchTerminals}"/>
					<a4j:support event="onchange" reRender="contractObjectsArea" oncomplete="setObjectId(this.value)"
							ajaxSingle="true" limitToList="true"/>								
				</h:selectOneMenu>
				
				<h:selectOneMenu 
						id="branch_ENTTACCT" 
						value="#{MbApplication.accountId}" 
						label="#{lblApp.object}"
						style="display:none">
					<f:selectItem itemValue=""/>
					<f:selectItems value="#{MbApplication.branchAccounts}"/>
					<a4j:support event="onchange" reRender="contractObjectsArea" oncomplete="setObjectId(this.value)"
							ajaxSingle="true" limitToList="true"/>								
				</h:selectOneMenu>
				</h:panelGroup>
				<h:inputHidden id="objectId" value="" required="true"/>
				<h:message for="objectId" styleClass="errorMarker"></h:message>
			</h:panelGrid>
			
			<h:panelGroup id="contractObjectsArea" style="max-height: 400px; overflow-y:auto; width:280px" layout="block">
			
				<a4j:outputPanel rendered="#{MbApplication.renderServices}">
					<fieldset  id="serviceDiv" style="border:1px solid #D7DAC2;">
						<legend><h:outputText value="#{lblApp.services}"/></legend>
						<h:panelGroup layout="block" style="max-height: 150px; width:250px; overflow-y:auto;">
						<table id="services">
							<a4j:repeat value="#{MbApplication.contractServices}" var="service">
							<tr>
								<td>
									<h:selectBooleanCheckbox id="service" 
										onclick="checkObject(this.id)"
										value="#{service.checked}"
										disabled="#{service.initial}"/>
								</td>
								<td>
									<h:inputHidden id="serviceMinCount" value="#{service.minCount}"/>
									<h:inputHidden id="serviceCurrentCount" value="#{service.currentCount}"/>
									<h:inputHidden id="serviceMaxCount" value="#{service.maxCount}"/>
									<h:inputHidden id="serviceType" value="#{service.serviceTypeId}"/>
								</td>
								<td>
									<h:outputText value="#{service.label}"/>
								</td>
							</tr>
							</a4j:repeat>			
						</table>
						</h:panelGroup>
					</fieldset>
				</a4j:outputPanel>
				
				<a4j:outputPanel rendered="#{MbApplication.renderCardsDivNonInitial}">
					<fieldset id="cardsDiv" style="border:1px solid #D7DAC2; ">
						<legend><h:outputText value="#{lblApp.cards}"/></legend>
						<h:panelGroup layout="block" style="max-height: 150px; width:250px; overflow-y:auto;">
						<table id="cards">
							<a4j:repeat value="#{MbApplication.contractCards}" var="card">
							<tr>
								<td>
									<h:selectBooleanCheckbox id="card" 
										value="#{card.checked}"
										disabled="#{MbApplication.initialServiceSelected and !(card.canEnable or card.canDisable)}"/>
								</td>
								<td>
									
								</td>
								<td>
									<h:outputText value="#{card.number}"/>
								</td>
							</tr>
							</a4j:repeat>			
						</table>
						</h:panelGroup>
					</fieldset>
				</a4j:outputPanel>
				
				<a4j:outputPanel rendered="#{MbApplication.renderAccountsDivNonInitial}">
					<fieldset id="accountsDiv" style="border:1px solid #D7DAC2;">
						<legend><h:outputText value="#{lblApp.accounts}"/></legend>
						<h:panelGroup layout="block" style="max-height: 150px; width:250px; overflow-y:auto;">
						<table id="accounts">
							<a4j:repeat value="#{MbApplication.contractAccounts}" var="acct">
							<tr>
								<td>
									<h:selectBooleanCheckbox id="acct" 
										value="#{acct.checked}"
										disabled="#{MbApplication.initialServiceSelected and !(acct.canEnable or acct.canDisable)}"/>
								</td>
								<td>
								
								</td>
								<td>
									<h:outputText value="#{acct.number}"/>
								</td>
							</tr>
							</a4j:repeat>			
						</table>
						</h:panelGroup>
					</fieldset>
				</a4j:outputPanel>
				
				<a4j:outputPanel rendered="#{MbApplication.renderParentMerchant}">
					<fieldset id="parentMerchantDiv" style="border:1px solid #D7DAC2;">
						<legend><h:outputText value="#{lblApp.parent_merchant}"/></legend>
						<h:selectOneMenu 
							value="#{MbApplication.parentMerchantId}" 
							label="#{lblApp.parent_merchant}">
							<f:selectItem itemValue=""/>
							<f:selectItems value="#{MbApplication.branchMerchants}"/>													
						</h:selectOneMenu>
					</fieldset>
				</a4j:outputPanel>
				
				<a4j:outputPanel rendered="#{MbApplication.renderMerchantsDivNonInitial}">
					<fieldset id="merchantsDiv" style="border:1px solid #D7DAC2;">
						<legend><h:outputText value="#{lblApp.merchants}"/></legend>
						<h:panelGroup layout="block" style="max-height: 150px; width:250px; overflow-y:auto;">
						<table id="merchants">
							<a4j:repeat value="#{MbApplication.contractMerchants}" var="merch">
							<tr>
								<td>
									<h:selectBooleanCheckbox id="merch" 
										value="#{merch.checked}"
										disabled="#{MbApplication.initialServiceSelected and !(merch.canEnable or merch.canDisable)}"/>
								</td>
								<td>
								
								</td>
								<td>
									<h:outputText value="#{merch.label}"/>
								</td>
							</tr>
							</a4j:repeat>			
						</table>
						</h:panelGroup>
					</fieldset>
				</a4j:outputPanel>
				
				<a4j:outputPanel rendered="#{MbApplication.renderTerminalsDivNonInitial}">
					<fieldset id="terminalsDiv" style="border:1px solid #D7DAC2;">
						<legend><h:outputText value="#{lblApp.terminals}"/></legend>
						<h:panelGroup layout="block" style="max-height: 150px; width:250px; overflow-y:auto;">
						<table id="terminals">
							<a4j:repeat value="#{MbApplication.contractTerminals}" var="term">
							<tr>
								<td>
									<h:selectBooleanCheckbox id="term" 
										value="#{term.checked}"
										disabled="#{MbApplication.initialServiceSelected and !(merch.canEnable or merch.canDisable)}"/>
								</td>
								<td>
								
								</td>
								<td>
									<h:outputText value="#{term.number}"/>
								</td>
							</tr>
							</a4j:repeat>			
						</table>
						</h:panelGroup>
					</fieldset>
				</a4j:outputPanel>
			</h:panelGroup>
			
		</h:panelGrid>	
		
	</h:panelGroup>

</ui:composition>
</html>