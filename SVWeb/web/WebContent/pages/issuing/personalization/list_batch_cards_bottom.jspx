<?xml version="1.0" encoding="UTF-8"?>
<html	xmlns="http://www.w3.org/1999/xhtml"
		xmlns:f="http://java.sun.com/jsf/core"
		xmlns:h="http://java.sun.com/jsf/html"
		xmlns:ui="http://java.sun.com/jsf/facelets"
		xmlns:a4j="http://richfaces.org/a4j"
		xmlns:rich="http://richfaces.org/rich"
		xmlns:bm="http://www.bpc.ru/jsf/misc"
		xmlns:bre="http://www.bpc.ru/jsf/richfaces-ext">
<ui:composition>
	<f:loadBundle var="lblPrs" basename="ru.bpc.sv2.ui.bundles.Prs"/>
	<f:loadBundle var="lblCrd" basename="ru.bpc.sv2.ui.bundles.Crd"/>
	
	<h:form id="batchInclCardsBtmForm">
		<a4j:queue requestDelay="100" name="queue" id="markQueue" ignoreDupResponses="true" />
		<h:panelGroup id="batchInclCardsTableWrapper" layout="block"
			style="padding:0px;margin:0px;">
			<rich:extendedDataTable
					headerClass="res-table-header table-header-ext" 
		           	selectedClass="res-table-selected" styleClass="res-table"           
		           	rowClasses=",odd"
		           	id="batchCardsTable"
		           	var="item"
		           	value="#{MbPersoBatchCardsSearch.persoCards}"	
		            selection="#{MbPersoBatchCardsSearch.itemSelection}"
		           	rows="#{MbPersoBatchCardsSearch.rowsNum}"
		           	height="190px" 
		           	enableContextMenu="true"
		           	tableState="#{MbPersoBatchCardsSearch.tableState}"
		           	noDataLabel="#{lblCommon['no_records_found']}"
		           	>
				           
				<a4j:support event="onselectionchange" 
	            		reRender="batchInclCardsBtmForm:btnPanelCards"/>

				<rich:column id="uid" label="#{lblCrd.card_uid}" title="#{lblCrd.uid}" width="12%">
					<f:facet name="header">
						<a4j:outputPanel layout="none">
							<h:outputText value="#{lblCrd.card_uid}" title="#{lblCrd.card_uid}"/>
						</a4j:outputPanel>
					</f:facet>
					<f:facet name="filter">
						<h:inputText value="#{MbPersoBatchCardsSearch.filter.cardUid}"  style="width: 100%;" rendered="false">
							<a4j:support event="onchange" reRender="batchCardsTable, dsBatchCard, pagesNum" action="#{MbPersoBatchCardsSearch.search}"/>
						</h:inputText>
					</f:facet>
					<h:outputText value="#{item.cardUid}" title="#{item.cardUid}" />
				</rich:column>

				<rich:column id="mask" label="#{lblPrs.mask}" title="Mask" width="12%">
					<f:facet name="header">
						<a4j:outputPanel layout="none">         
			        		<h:outputText value="#{lblPrs.mask}" title="#{lblPrs.mask}"/>
			        	</a4j:outputPanel>
			        </f:facet>
			        <f:facet name="filter">
						<h:inputText value="#{MbPersoBatchCardsSearch.filter.mask}"  style="width: 100%;" rendered="false">
							<a4j:support event="onchange" reRender="batchCardsTable, dsBatchCard, pagesNum" action="#{MbPersoBatchCardsSearch.search}"/>
						</h:inputText>
					</f:facet>
			        <h:outputText value="#{item.mask}" title="#{item.mask}" />
				</rich:column>
				
				<rich:column id="cardholder" label="#{lblPrs.cardholder}" title="Cardholder" width="15%">
					<f:facet name="header">
			        	<h:outputText value="#{lblPrs.cardholder}" title="#{lblPrs.cardholder}"/>
			        </f:facet>
			        <f:facet name="filter">
						<h:inputText value="#{MbPersoBatchCardsSearch.filter.cardholderName}"  style="width: 100%;" rendered="false">
							<a4j:support event="onchange" reRender="batchCardsTable, dsBatchCard, pagesNum" action="#{MbPersoBatchCardsSearch.search}"/>
						</h:inputText>
					</f:facet>
			        <h:outputText value="#{item.cardholderName}" title="#{item.cardholderName}" />
				</rich:column>
				
				<rich:column id="card_type" label="#{lblNet.card_type}" title="Product" width="10%">
					<f:facet name="header">
			        	<h:outputText value="#{lblNet.card_type}" title="#{lblNet.card_type}"/>
			        </f:facet>
			        <f:facet name="filter">
						<h:selectOneMenu value="#{MbPersoBatchCardsSearch.filter.cardTypeId}"  style="width: 100%;"
							disabled="#{MbPersoBatchCardsSearch.filter.blockCardTypeId}">
							<f:selectItem itemValue=""/>
							<f:selectItems value="#{MbPersoBatchCardsSearch.cardTypes}" />							
							<a4j:support event="onchange" reRender="batchCardsTable" action="#{MbPersoBatchCardsSearch.search}"/>
						</h:selectOneMenu>
					</f:facet>
			        <h:outputText value="#{item.cardTypeName}" title="#{item.cardTypeName}" />
				</rich:column>
				
				<rich:column id="blank_type" label="#{lblPrs.blank_type}" title="Product" width="10%">
					<f:facet name="header">
			        	<h:outputText value="#{lblPrs.blank_type}" title="#{lblPrs.blank_type}"/>
			        </f:facet>
			        <f:facet name="filter">
						<h:selectOneMenu value="#{MbPersoBatchCardsSearch.filter.blankTypeId}"  style="width: 100%;"
							disabled="#{MbPersoBatchCardsSearch.filter.blockBlankTypeId}">
							<f:selectItem itemValue=""/>
							<f:selectItems value="#{MbPersoBatchCardsSearch.blankTypes}" />							
							<a4j:support event="onchange" reRender="batchCardsTable" action="#{MbPersoBatchCardsSearch.search}"/>
						</h:selectOneMenu>
					</f:facet>
			        <h:outputText value="#{item.blankTypeName}" title="#{item.blankTypeName}" />
				</rich:column>
				
				<rich:column id="priority" label="#{lblPrs.priority}" title="Priority" width="10%">
				    <f:facet name="header">
			        	<h:outputText value="#{lblPrs.priority}" title="#{lblPrs.priority}"/>
			    	</f:facet>
			    	<f:facet name="filter">
						<h:selectOneMenu value="#{MbPersoBatchCardsSearch.filter.persoPriority}"  style="width: 100%;">
							<f:selectItems value="#{MbPersoBatchCardsSearch.persoPriorities}" />							
							<a4j:support event="onchange" reRender="batchCardsTable" action="#{MbPersoBatchCardsSearch.search}"/>
						</h:selectOneMenu>
					</f:facet>
			        <h:outputText value="#{DictUtils.articles[item.persoPriority]}" title="#{DictUtils.articles[item.persoPriority]}"  />
				</rich:column>
				
				<rich:column id="pin" label="#{lblPrs.pin}" title="Pin generated" width="10%">
				    <f:facet name="header">
			        	<h:outputText value="#{lblPrs.pin}" title="#{lblPrs.pin}"/>
			    	</f:facet>
			    	<f:facet name="filter">
						<h:selectOneMenu value="#{MbPersoBatchCardsSearch.filter.pinGenerated}"  style="width: 100%;">
							<f:selectItem itemValue=""/>
							<f:selectItem itemValue="true" itemLabel="Yes"/>							
							<f:selectItem itemValue="false" itemLabel="No"/>							
							<a4j:support event="onchange" reRender="batchCardsTable" action="#{MbPersoBatchCardsSearch.search}"/>
						</h:selectOneMenu>
					</f:facet>
			        <h:selectBooleanCheckbox disabled="true" value="#{item.pinGenerated}"/>
				</rich:column>
				
				<rich:column id="pin_mailer" label="#{lblPrs.pin_mailer}" title="Pin mailer printed" width="10%">
				    <f:facet name="header">
			        	<h:outputText value="#{lblPrs.pin_mailer}" title="#{lblPrs.pin_mailer}"/>
			    	</f:facet>
			    	<f:facet name="filter">
						<h:selectOneMenu value="#{MbPersoBatchCardsSearch.filter.pinMailerPrinted}"  style="width: 100%;">
							<f:selectItem itemValue=""/>
							<f:selectItem itemValue="true" itemLabel="Yes"/>
							<f:selectItem itemValue="false" itemLabel="No"/>							
							<a4j:support event="onchange" reRender="batchCardsTable" action="#{MbPersoBatchCardsSearch.search}"/>
						</h:selectOneMenu>
					</f:facet>
			        <h:selectBooleanCheckbox disabled="true" value="#{item.pinMailerPrinted}"/>
				</rich:column>
				
				<rich:column id="embossed" label="#{lblPrs.embossed}" title="Embossing request" width="10%">
				    <f:facet name="header">
			        	<h:outputText value="#{lblPrs.embossed}" title="#{lblPrs.embossed}"/>
			    	</f:facet>
			    	<f:facet name="filter">
						<h:selectOneMenu value="#{MbPersoBatchCardsSearch.filter.embossingDone}"  style="width: 100%;">
							<f:selectItem itemValue=""/>
							<f:selectItem itemValue="true" itemLabel="Yes"/>							
							<f:selectItem itemValue="false" itemLabel="No"/>
							<a4j:support event="onchange" reRender="batchCardsTable" action="#{MbPersoBatchCardsSearch.search}"/>
						</h:selectOneMenu>
					</f:facet>
			        <h:selectBooleanCheckbox disabled="true" value="#{item.embossingDone}"/>
				</rich:column>
				
				<f:facet name="footer">                      
	            </f:facet>
		    </rich:extendedDataTable>
		</h:panelGroup>
		<h:panelGroup layout="block" styleClass="nocorner_search_result_block">
			<h:panelGroup layout="block" styleClass="table_tools">
	        	<h:panelGrid styleClass="fw field-cont" columns="4"
	        			columnClasses="per-page-lbl,per-page-sel,nav-cont,pagecount">
		        	<h:outputLabel for="rows_num" value="#{lblCommon.rows_per_page}" title="#{lblCommon.rows_per_page}"/>
					<h:selectOneMenu id="rows_num" value="#{MbPersoBatchCardsSearch.rowsNum}" style="width:40px">
						<a4j:support event="onchange" reRender="batchCardsTable, dsBatchCard, pagesNum" oncomplete="updateHeight()"/>
                        <f:selectItems value="#{CommonUtils.rowNumsList}"/>
                    </h:selectOneMenu>

                    <rich:datascroller maxPages="10" fastControls="hide"
                    		pagesVar="pages" styleClass="res-datascroller"
		                    id="dsBatchCard" for="batchCardsTable">
		            	<f:facet name="first">
		                	<h:outputText value="&lt;&lt;" styleClass="prev-next" />
						</f:facet>
		                <f:facet name="first_disabled">
		                    <h:outputText value="&lt;&lt;" styleClass="prev-next-dis" />
		                </f:facet>
		                <f:facet name="last">
		                    <h:outputText  value="&gt;&gt;" styleClass="prev-next" />
		                </f:facet>
		                <f:facet name="last_disabled">
		                    <h:outputText value="&gt;&gt;" styleClass="prev-next-dis" />
		                </f:facet>
		                <f:facet name="previous">
							<h:outputText value="#{lblCommon.prev}" styleClass="prev-next" />
		                </f:facet>
		                <f:facet name="previous_disabled">
		                	<h:outputText value="#{lblCommon.prev}" styleClass="prev-next-dis" />
		                </f:facet>
		                <f:facet name="next">
		                	<h:outputText value="#{lblCommon.next}" styleClass="prev-next" />
		                </f:facet>
		                <f:facet name="next_disabled">
		                	<h:outputText value="#{lblCommon.next}" styleClass="prev-next-dis" />
		                </f:facet>
		                <f:facet name="pages">
		                </f:facet>
					</rich:datascroller>

                    <h:panelGroup id="pagesNum">
                       	<h:outputText styleClass="strongClass" value="#{pages} "/>
                       	<h:outputText value=" #{lblCommon.pages}"/>
                        <h:outputText value="" style="padding-left: 20px; padding-right: 20px;" />
                        <h:outputText styleClass="strongClass" value="#{MbPersoBatchCardsSearch.persoCards.rowCount}"/>
                        <h:outputText value=" #{lblCommon.records}"/>
                        <h:outputText value="" style="padding-left: 20px; padding-right: 20px;" />
                    </h:panelGroup>
				</h:panelGrid>
			</h:panelGroup>
					
			<h:panelGrid id="btnPanelCards" styleClass="fw buttons_block" columns="2" columnClasses=", table_tools_state">
				<h:panelGroup></h:panelGroup>
				<h:panelGroup>
						<h:graphicImage url="/images/green-tick.png" title="#{lblCommon.save_table_state}" styleClass="action_icon"
							onclick="saveBatchCardTableState();"/>
						<h:graphicImage url="/images/red-cross.png" title="#{lblCommon.delete_table_state}" styleClass="action_icon"
							onclick="deleteBatchCardTableState();"/>
						<a4j:queue name="tablestatequeue"/>
						<a4j:jsFunction name="saveBatchCardTableState" action="#{MbPersoBatchCardsSearch.saveTableStateDB}" eventsQueue="tablestatequeue"/>
						<a4j:jsFunction name="deleteBatchCardTableState" action="#{MbPersoBatchCardsSearch.deleteTableStateDB}" eventsQueue="tablestatequeue"/>
					</h:panelGroup>
			</h:panelGrid>				
		</h:panelGroup>
	</h:form>
</ui:composition>
</html>
