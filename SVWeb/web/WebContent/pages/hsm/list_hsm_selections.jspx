<?xml version="1.0" encoding="UTF-8"?>
<html	xmlns="http://www.w3.org/1999/xhtml"
		xmlns:f="http://java.sun.com/jsf/core"
		xmlns:h="http://java.sun.com/jsf/html"
		xmlns:ui="http://java.sun.com/jsf/facelets"
		xmlns:a4j="http://richfaces.org/a4j"
		xmlns:rich="http://richfaces.org/rich"
		xmlns:bm="http://www.bpc.ru/jsf/misc"
		xmlns:bre="http://www.bpc.ru/jsf/richfaces-ext"
		xmlns:bpct="http://www.bpc.ru/jsf/tiles">
<ui:composition	template="/WEB-INF/templates/navigatable.jspx">
	<ui:define name="navigatableContent">
		<f:loadBundle var="lblHsm" basename="ru.bpc.sv2.ui.bundles.Hsm"/>
		
		<!-- navigation bar -->
        <bpct:navBar pageName="#{lblHsm.hsm_selections}"/>
            
    	<h:form id="hsmSelectionsSearchForm">

			<!-- search panel -->
			<h:panelGroup styleClass="search_block" layout="block">
				<h:panelGroup layout="block" styleClass="search_block_inner1">
				<h:panelGroup layout="block" styleClass="search_block_inner2">
	                <h:panelGroup styleClass="search_block_left" layout="block">
	                	<h:panelGrid styleClass="fw" columns="2" columnClasses="top ,link-cont">
		                	<h:panelGrid styleClass="filter-table field-cont twoColumnTable" columns="4" columnClasses="firstCol,secondCol,firstCol,secondCol">
		            			
		            			<h:outputLabel for="inst" value="#{lblCommon.institution}: " title="#{lblCommon.institution}" />
		            			<h:selectOneMenu id="inst" value="#{MbHsmSelectionsSearch.filter.instId}">
									<f:selectItem itemValue=""/>
									<f:selectItems value="#{MbHsmSelectionsSearch.institutions}"/>
								</h:selectOneMenu>
								
		            			<h:outputLabel for="action" value="#{lblHsm.action}: " title="#{lblHsm.action}" />
		            			<h:selectOneMenu id="action" value="#{MbHsmSelectionsSearch.filter.action}">
		            				<f:selectItem itemValue=""/>
		            				<f:selectItems value="#{MbHsmSelectionsSearch.actions}"/>
								</h:selectOneMenu>
		            			
		            			<h:outputLabel for="descr" value="#{lblCommon.description}: " title="#{lblCommon.description}" />
		            			<h:inputText id="descr" value="#{MbHsmSelectionsSearch.filter.description}"/>
		            			
		            			<h:outputLabel for="hsm" value="#{lblCommon.hsm}: " title="#{lblCommon.hsm}" />
		            			<h:selectOneMenu id="hsm" value="#{MbHsmSelectionsSearch.filter.hsmId}">
		            				<f:selectItem itemValue=""/>
									<f:selectItems value="#{MbHsmSelectionsSearch.hsms}"/>
								</h:selectOneMenu>
								
		            			<h:inputText style="display:none" 
		            					value="IE hack for 'Enter' hit when there's only one input field 
		            							on form. Stick it to the bottom to not to break layout"/>
                			</h:panelGrid>
	                		<h:panelGrid columns="1">
		                		<bre:taggedCommandButton
			                			action="#{MbHsmSelectionsSearch.search}"
	        							reRender="hsmSelectionsForm, detailsTab"
	                					image="/_img/icon_search.png" type="submit"
	                					value="#{lblForm.search}" style="width:85px;"
	                					/>
	                			<h:panelGroup styleClass="link-clear" layout="block">
		                			<h:graphicImage url="/_img/icon_clear.png"/>
		                			<a4j:commandLink value="#{lblForm.clear_all}"
						        			action="#{MbHsmSelectionsSearch.clearFilter}"
						        			reRender="hsmSelectionsSearchForm, hsmSelectionsForm, detailsTab">
						        	</a4j:commandLink>
	            	    		</h:panelGroup>
	                		</h:panelGrid>
	               		</h:panelGrid>
	               		<a4j:outputPanel ajaxRendered="true">
	               			<h:graphicImage url="/_img/hd_searchblock.gif"  styleClass="hd-searchblock"/>
	               			<h:panelGroup styleClass="collapse-vert" layout="block"/>
               			</a4j:outputPanel>
	               	</h:panelGroup>
               	</h:panelGroup>
               	</h:panelGroup>
			</h:panelGroup>
		</h:form>
		
		<h:form id="hsmSelectionsForm">
			<h:panelGroup styleClass="search_result_block" layout="block">
				<h:panelGroup styleClass="search_result_block_left fix-ff"
					layout="block">
					<rich:extendedDataTable id="hsmSelectionsTable" var="item"
						tableState="#{MbHsmSelectionsSearch.tableState}"
						value="#{MbHsmSelectionsSearch.hsmSelections}"
						selection="#{MbHsmSelectionsSearch.itemSelection}"
						rows="#{MbHsmSelectionsSearch.rowsNum}" height="255px"
						selectionMode="single" rowClasses=",odd"
						headerClass="res-table-header" selectedClass="res-table-selected"
						styleClass="res-table" enableContextMenu="true"
						noDataLabel="#{MbHsmSelectionsSearch.searching?lblCommon['no_records_found'] : lblCommon['enter_search_criteria_above']}">

						<a4j:support event="onselectionchange" ignoreDupResponses="true"
							reRender="detailsTab, hsmSelectionsForm:btnPanel" />

						<rich:column id="id" label="#{lblCommon.id}" sortBy="#{'id'}" width="10%">
							<f:facet name="header">
								<h:outputText value="#{lblCommon.id}" title="#{lblCommon.id}" />
							</f:facet>
							<h:outputText value="#{item.id}" />
						</rich:column>

						<rich:column id="description" label="#{lblCommon.description}" sortBy="#{'description'}" width="25%">
							<f:facet name="header">
								<h:outputText value="#{lblCommon.description}"
									title="#{lblCommon.description}" />
							</f:facet>
							<h:outputText value="#{item.description}"
								title="#{item.description}" />
						</rich:column>

						<rich:column id="hsm" label="#{lblCommon.hsm}" sortBy="#{'hsmDescription'}" width="20%">
							<f:facet name="header">
								<h:outputText value="#{lblCommon.hsm}" title="#{lblCommon.hsm}" />
							</f:facet>
							<h:outputText value="#{item.hsmDescription}"
								title="#{item.hsmDescription}" />
						</rich:column>

						<rich:column id="action" label="#{lblHsm.action}" sortBy="#{'action'}" width="20%">
							<f:facet name="header">
								<h:outputText value="#{lblHsm.action}" title="#{lblHsm.action}" />
							</f:facet>
							<h:outputText value="#{DictUtils.articles[item.action]}"
								title="#{DictUtils.articles[item.action]}" />
						</rich:column>

						<rich:column id="institution" label="#{lblCommon.institution}" sortBy="#{'instName'}" width="25%">
							<f:facet name="header">
								<h:outputText value="#{lblCommon.institution}"
									title="#{lblCommon.institution}" />
							</f:facet>
							<h:outputText value="#{item.instName}" title="#{item.instName}" />
						</rich:column>
					</rich:extendedDataTable>
					<a4j:outputPanel ajaxRendered="true">
					    <h:graphicImage url="/_img/hd_searchblock.gif" styleClass="hd-searchblock"/>
					    <h:panelGroup styleClass="collapse-vert table-collapse-vert" layout="block"/>
					</a4j:outputPanel>
				</h:panelGroup>
			</h:panelGroup>

			<h:panelGroup layout="block" styleClass="bottom_search_result_block">
				<h:panelGroup layout="block" styleClass="bottom_search_result_left">
					<h:panelGroup layout="block" styleClass="table_tools">
						<h:panelGrid styleClass="fw field-cont" columns="5"
							columnClasses="per-page-lbl,per-page-sel,nav-cont,pagecount, table_tools_state">
							<h:outputLabel for="rows_num" value="#{lblCommon.rows_per_page}" title="#{lblCommon.rows_per_page}" />
							<h:selectOneMenu id="rows_num"
								value="#{MbHsmSelectionsSearch.rowsNum}" style="width:40px">
								<a4j:support event="onchange"
									reRender="detailsTab, hsmSelectionsForm" />
								<f:selectItems value="#{CommonUtils.rowNumsList}"/>
							</h:selectOneMenu>

							<rich:datascroller maxPages="10" fastControls="hide"
								pagesVar="pages" styleClass="res-datascroller"
								id="hsmSelectionsDs" for="hsmSelectionsTable"
								reRender="detailsTab">
								<f:facet name="first">
									<h:outputText value="&lt;&lt;" styleClass="prev-next" />
								</f:facet>
								<f:facet name="first_disabled">
									<h:outputText value="&lt;&lt;" styleClass="prev-next-dis" />
								</f:facet>
								<f:facet name="last">
									<h:outputText value="&gt;&gt;" styleClass="prev-next" />
								</f:facet>
								<f:facet name="last_disabled">
									<h:outputText value="&gt;&gt;" styleClass="prev-next-dis" />
								</f:facet>
								<f:facet name="previous">
									<h:outputText value="#{lblCommon.prev}" styleClass="prev-next" />
								</f:facet>
								<f:facet name="previous_disabled">
									<h:outputText value="#{lblCommon.prev}"
										styleClass="prev-next-dis" />
								</f:facet>
								<f:facet name="next">
									<h:outputText value="#{lblCommon.next}" styleClass="prev-next" />
								</f:facet>
								<f:facet name="next_disabled">
									<h:outputText value="#{lblCommon.next}"
										styleClass="prev-next-dis" />
								</f:facet>
								<f:facet name="pages">
								</f:facet>
							</rich:datascroller>

							<h:panelGroup id="pagesNum">
								<h:outputText styleClass="strongClass" value="#{pages} " />
								<h:outputText value=" #{lblCommon.pages}" />
							</h:panelGroup>
							
							<h:panelGroup>
								<h:graphicImage url="/images/green-tick.png" title="#{lblCommon.save_table_state}" styleClass="action_icon"
									onclick="saveTableState();"/>
								<h:graphicImage url="/images/red-cross.png" title="#{lblCommon.delete_table_state}" styleClass="action_icon"
									onclick="deleteTableState();"/>
								<a4j:queue name="tablestatequeue"/>
								<a4j:jsFunction name="saveTableState" action="#{MbHsmSelectionsSearch.saveTableStateDB}" eventsQueue="tablestatequeue"/>
								<a4j:jsFunction name="deleteTableState" action="#{MbHsmSelectionsSearch.deleteTableStateDB}" eventsQueue="tablestatequeue"/>
							</h:panelGroup>
						</h:panelGrid>
					</h:panelGroup>

					<h:panelGrid id="btnPanel" columns="4" styleClass="itempanel">
						<bre:taggedCommandButton id="addBtn"
							reRender="hsm_selection_modal_header, hsmSelectionEditForm"
							value="#{lblForm.add}"
							oncomplete="#{rich:component('hsm_selection_modal_panel')}.show()"
							action="#{MbHsmSelectionsSearch.add}"
							rendered="#{usession.inRole['ADD_HSM_SELECTION']}"
							image="/images/create_doc.gif" />
						<bre:taggedCommandButton id="editBtn"
							reRender="hsm_selection_modal_header, hsmSelectionEditForm"
							value="#{lblForm.edit}" action="#{MbHsmSelectionsSearch.edit}"
							oncomplete="#{rich:component('hsm_selection_modal_panel')}.show()"
							disabled="#{MbHsmSelectionsSearch.activeHsmSelection == null or
												MbHsmSelectionsSearch.activeHsmSelection.isDeviceEnabled}"
							rendered="#{usession.inRole['MODIFY_HSM_SELECTION']}"
							image="/images/edit.gif" />
						<bre:taggedCommandButton id="deleteBtn"
							reRender="hsmSelectionsTable, detailsTab, btnPanel"
							value="#{lblForm.delete}"
							action="#{MbHsmSelectionsSearch.delete}"
							onclick="if (!confirm('#{lblMsg.confirm_delete}')) return false;"
							disabled="#{MbHsmSelectionsSearch.activeHsmSelection == null or
												MbHsmSelectionsSearch.activeHsmSelection.isDeviceEnabled}"
							rendered="#{usession.inRole['REMOVE_HSM_SELECTION']}"
							image="/images/delete.gif" />
					</h:panelGrid>
				</h:panelGroup>
			</h:panelGroup>
		</h:form>

        <h:form>
            <a4j:jsFunction name="storeTab" ajaxSingle="true" limitToList="true" reRender="#{MbHsmSelectionsSearch.tabName}">
                <a4j:actionparam name="tabName" assignTo="#{MbHsmSelectionsSearch.tabName}" />
            </a4j:jsFunction>
        </h:form>

		<h:panelGroup styleClass="workplace">
	    	<rich:tabPanel switchType="client" id="details" tabClass="tab-cell"
	    			activeTabClass="active-tab-cell" headerClass="tabs" headerSpacing="0px"
	    			contentClass="tab-content" selectedTab="#{MbHsmSelectionsSearch.tabName}">

				<rich:tab ontabenter="storeTab('detTab')" label="#{lblCommon.details}" name="detTab">
       				<f:facet name="label">
       					<h:panelGroup styleClass="first tab-label" layout="block">
       						<h:outputText value="#{lblCommon.details}" title="#{lblCommon.details}"/>
       					</h:panelGroup>
       				</f:facet>

					<h:panelGroup id="detailsTab" >
      					<h:panelGroup layout="block" styleClass="carddata-wrapper" style="height: 221px; overflow-y: hidden;">
      						<ui:include src="/pages/hsm/hsm_selection_details.jspx"></ui:include>
      					</h:panelGroup>
      					<h:panelGroup layout="block" styleClass="bottom_search_result_block_buttons">
							<h:panelGroup layout="block" styleClass="bottom_search_result_left_buttons">
								<h:panelGrid columns="2" cellpadding="0" cellspacing="0" width="auto">
			                	</h:panelGrid>
							</h:panelGroup>
						</h:panelGroup>
       				</h:panelGroup>
			    </rich:tab>

		    </rich:tabPanel>
        </h:panelGroup>

		<ui:include src="/pages/hsm/hsm_selection_edit.jspx">
			<ui:param name="rerenderList" value="hsmSelectionsForm:hsmSelectionsTable, 
					detailsTab, hsmSelectionsForm:btnPanel"/>
		</ui:include>
	
	</ui:define>
</ui:composition>
</html>
