<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" >
<xsl:output method="text" encoding="utf-8" indent="no"/>
<xsl:template match="report">
<xsl:variable name="oper_date" select="concat(substring(oper_date, 9, 2), '.', substring(oper_date, 6, 2), '.', substring(oper_date, 3, 2), ' ', substring(oper_date, 12, 2), ':', substring(oper_date, 15, 2))"/>
<xsl:text>DEBIT </xsl:text><xsl:choose><xsl:when test="string(merchant/merchant_name)"><xsl:value-of select="merchant/merchant_name"/></xsl:when><xsl:otherwise><xsl:value-of select="merchant/merchant_street"/>, <xsl:value-of select="merchant/merchant_city"/></xsl:otherwise></xsl:choose>, <xsl:value-of select="merchant/merchant_region"/><xsl:text> </xsl:text><xsl:value-of select="oper_amount/amount_value"/><xsl:text> </xsl:text><xsl:value-of select="oper_amount/name"/>, ACCOUNT<xsl:value-of select="account_mask"/>, CARD<xsl:value-of select="short_card_mask"/> BAL <xsl:value-of select="balance/amount_value"/><xsl:text> </xsl:text><xsl:value-of select="balance/name"/><xsl:text> </xsl:text><xsl:value-of select="$oper_date"/> END
</xsl:template>
</xsl:stylesheet>