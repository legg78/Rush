<?xml version="1.0" encoding="UTF-8" ?>

<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:bm="http://www.bpc.ru/jsf/misc"
      xmlns:bre="http://www.bpc.ru/jsf/richfaces-ext"
      xmlns:a4j="http://richfaces.org/a4j"
      xmlns:rich="http://richfaces.org/rich"
      xmlns:fmt="http://www.bpc.ru/el/formatter">
<ui:composition>
<f:loadBundle var="lblAtm" basename="ru.bpc.sv2.ui.bundles.Atm" />
<f:loadBundle var="lblOpr" basename="ru.bpc.sv2.ui.bundles.Opr"/>

<h:form id="operationForm" style="overflow:hidden;">

<h:panelGroup id="operationTableWrapper" layout="block"
              style="padding:0px;margin:0px;">
    <rich:extendedDataTable id="operationsTable" styleClass="res-table"
                            headerClass="res-table-header table-header-ext" rowClasses=",odd"
                            selectedClass="res-table-selected" var="item"
                            value="#{MbAtmFinanceOperationsBottom.operations}" selectionMode="single"
                            selection="#{MbAtmFinanceOperationsBottom.itemSelection}" width="100%"
                            enableContextMenu="true" border="0"
                            rows="#{MbAtmFinanceOperationsBottom.rowsNum}"
                            tableState="#{MbAtmFinanceOperationsBottom.tableState}"
                            noDataLabel="#{lblCommon.no_records_found}">

        <rich:column id="oper_date" label="#{lblAtm.oper_date}" title="Oper Date" sortBy="#{'operDate'}" width="21%">
            <f:facet name="header">
                <h:outputText value="#{lblAtm.oper_date}"
                              title="#{lblAtm.oper_date}" />
            </f:facet>
            <f:facet name="filter">

                <h:panelGrid columns="1" cellpadding="0" cellspacing="0" border="0" >

                    <h:selectOneMenu id="collection"
                                     value="#{MbAtmFinanceOperationsBottom.atmCollectionIndex}">
                        <a4j:support event="onchange"
                                     reRender="startDateFilter, endDateFilte, operationsTable"
                                     action="#{MbAtmFinanceOperationsBottom.updateData}"
                                     limitToList="true"
                                     ajaxSingle="true"/>
                        <f:selectItems value="#{MbAtmFinanceOperationsBottom.collections}" />
                    </h:selectOneMenu>

                    <h:panelGroup layout="block" style="padding-top:10px;padding-bottom:10px;">
                        <h:outputText value="#{lblAtm.from}: " />
                        <rich:calendar
                                id="startDateFilter"
                                reRender="collectionsTable"
                                value="#{MbAtmFinanceOperationsBottom.operDateFrom}"
                                datePattern="#{usession.datePattern}"
                                timeZone="#{CommonUtils.timeZone}" inputStyle="width:60px;" >
                            <a4j:support event="onchanged" process="startDateFilter" ajaxSingle="true" reRender="operationsTable" limitToList="true" action="#{MbAtmFinanceOperationsBottom.updateData}"/>
                        </rich:calendar>
                        <h:outputText value="#{lblAtm.to}: " />
                        <rich:calendar
                                id="endDateFilter"
                                reRender="collectionsTable"
                                value="#{MbAtmFinanceOperationsBottom.operDateTo}"
                                datePattern="#{usession.datePattern}"
                                timeZone="#{CommonUtils.timeZone}" inputStyle="width:60px;" >
                            <a4j:support event="onchanged" process="endDateFilter" ajaxSingle="true" reRender="operationsTable" limitToList="true" action="#{MbAtmFinanceOperationsBottom.updateData}"/>
                        </rich:calendar>
                    </h:panelGroup>

                </h:panelGrid>

            </f:facet>
            <h:outputText value="#{item.operDate}" title="#{item.operDate}">
                <f:convertDateTime pattern="#{usession.fullDatePattern}"
                                   timeZone="#{CommonUtils.timeZone}" />
            </h:outputText>
        </rich:column>

        <rich:column id="operation_type" label="#{lblAtm.operation_type}" title="Operation Type" sortBy="#{'operationType'}"
                     width="16%">
            <f:facet name="header">
                <h:outputText value="#{lblAtm.operation_type}"
                              title="#{lblAtm.operation_type}" />
            </f:facet>
            <f:facet name="filter">
                <h:selectOneMenu value="#{MbAtmFinanceOperationsBottom.filter.operType}" style="width:100%;">
                    <f:selectItems value="#{MbAtmFinanceOperationsBottom.operationTypes}" />
                    <a4j:support event="onchange"
                                 action="#{MbAtmFinanceOperationsBottom.updateData}"
                                 reRender="operationsTable"
                                 limitToList="true"
                                 ajaxSingle="true" />
                </h:selectOneMenu>
            </f:facet>
            <h:outputText
                    value="#{DictUtils.articles[item.operType]}"
                    title="#{DictUtils.articles[item.operType]}"
                    rendered="#{item.operType != null }" />
            <h:outputText value="" title=""
                          rendered="#{item.operType == null }" />
        </rich:column>

        <rich:column id="client_id_value" label="#{lblOpr.client_id_value}" width="13%"
                     style="overflow-x:hidden">
            <f:facet name="header">
                <h:outputText value="#{lblOpr.client_id_value}" title="#{lblOpr.client_id_value}"/>
            </f:facet>
            <div class="default_icon #{EntityIcons.objectsMap['ENTT0047'][item.clientIdType]}"
                 title="#{DictUtils.articles[item.clientIdType]}" style="float:right; margin: 0 0 0 10px;"/>
            <bm:entityDisplay contextType="ENTTOPER" bean="MbOperations" value="#{item.clientIdValue}" />
        </rich:column>


        <rich:column id="banknote_dispense" label="#{lblAtm.banknote_dispense}" title="Banknote dispense"
                     sortBy="#{'banknoteDispense'}" width="14%">
            <f:facet name="header">
                <h:outputText value="#{lblAtm.banknote_dispense}"
                              title="#{lblAtm.banknote_dispense}" />
            </f:facet>
            <h:outputText value="#{item.condition}"
                          title="#{item.condition}" />
        </rich:column>

        <rich:column id="operation_amount" label="#{lblAtm.operation_amount}" title="Operation Amount" sortBy="#{'operationAmount'}"
                     width="12%" style="text-align: right">
            <f:facet name="header">
                <h:panelGroup>
                    <script>
                        updateHeight();
                    </script>
                    <h:outputText value="#{lblAtm.operation_amount}"
                                  title="#{lblAtm.operation_amount}" />
                </h:panelGroup>
            </f:facet>

            <div class="#{EntityIcons.objectsMapS['ENTT0046'][item.operCurrency]}" style="float:right; margin: 0 0 0 10px;"/>
            <h:outputText
                    value="#{fmt:formatMoney(item.operAmount, CurrencyUtils.currencyObjectsMap[item.operCurrency].exponent)} #{CurrencyUtils.currencyShortNamesMap[item.operCurrency]}"
                    title="#{fmt:formatMoney(item.operAmount, CurrencyUtils.currencyObjectsMap[item.operCurrency].exponent)} #{CurrencyUtils.currencyMap[item.operCurrency]}"
                    />
        </rich:column>

        <rich:column id="status" label="#{lblCommon.status}" width="5%"
                     style="overflow-x:hidden" sortBy="#{'status'}">
            <f:facet name="header">
                <h:outputText value="#{lblCommon.status}" title="#{lblCommon.status}"/>
            </f:facet>
            <!--<div class="default_icon #{EntityIcons.objectsMap['OPST'][item.status]}"-->
            <!--title="#{DictUtils.articles[item.status]}" rendered="#{item.status != null}"/>-->
            <!--<bm:entityDisplay contextType="ENTTOPER" bean="MbOperations" value="" rendered="#{item.status == null}" />-->
            <!-- todo temporary text information about status must be changed to icon. -->
            <h:outputText value="#{DictUtils.articles[item.status]}" title="#{DictUtils.articles[item.status]}"/>
        </rich:column>

        <rich:column id="error_code" label="#{lblAtm.error_code}" title="Resp Code" sortBy="#{'respCode'}" width="11%" rendered="false">
            <f:facet name="header">
                <h:outputText value="#{lblAtm.error_code}"
                              title="#{lblAtm.error_code}" />
            </f:facet>
            <f:facet name="filter">
                <h:inputText id="filterRespCode" value="#{MbAtmFinanceOperationsBottom.filter.respCode}" style="width:100%">
                    <a4j:support event="onchange" action="#{MbAtmFinanceOperationsBottom.updateData }" ajaxSingle="true" reRender="operationsTable"> </a4j:support>
                </h:inputText>
            </f:facet>
            <h:outputText value="#{item.respCode}" title="#{item.respCode}" />
        </rich:column>

        <rich:column id="error_code_description" label="#{lblAtm.error_code_description}" title="Resp Code" width="8%" rendered="false">
            <f:facet name="header">
                <h:outputText value="#{lblAtm.error_code_description}"
                              title="#{lblAtm.error_code_description}" />
            </f:facet>
            <h:outputText
                    value="#{DictUtils.articles[item.respCode]}"
                    title="#{DictUtils.articles[item.respCode]}"
                    rendered="#{item.respCode != null }" />
            <h:outputText value="" title=""
                          rendered="#{item.respCode == null }" />
        </rich:column>

    </rich:extendedDataTable>

</h:panelGroup>



<h:panelGroup layout="block" styleClass="bottom_search_result_block_buttons paginated_tab">
    <h:panelGroup layout="block" styleClass="table_tools">
        <h:panelGrid styleClass="fw field-cont" columns="4"
                     columnClasses="per-page-lbl,per-page-sel,nav-cont,pagecount">
            <h:outputLabel for="rows_num" value="#{lblCommon.rows_per_page}" title="#{lblCommon.rows_per_page}"/>

            <h:selectOneMenu id="rows_num" value="#{MbAtmFinanceOperationsBottom.rowsNum}"
                             style="width:40px">
                <a4j:support event="onchange"
                             reRender="operationsTable, dsOperationsTable, pagesNum"/>
                <f:selectItems value="#{CommonUtils.rowNumsList}"/>

            </h:selectOneMenu>

            <rich:datascroller maxPages="10" fastControls="hide"
                               pagesVar="pages" styleClass="res-datascroller"
                               id="dsOperationsTable" for="operationsTable">
                <f:facet name="first">
                    <h:outputText value="&lt;&lt;" styleClass="prev-next" />
                </f:facet>
                <f:facet name="first_disabled">
                    <h:outputText value="&lt;&lt;" styleClass="prev-next-dis" />
                </f:facet>
                <f:facet name="last">
                    <h:outputText  value="&gt;&gt;" styleClass="prev-next" />
                </f:facet>
                <f:facet name="last_disabled">
                    <h:outputText value="&gt;&gt;" styleClass="prev-next-dis" />
                </f:facet>
                <f:facet name="previous">
                    <h:outputText value="#{lblCommon.prev}" styleClass="prev-next" />
                </f:facet>
                <f:facet name="previous_disabled">
                    <h:outputText value="#{lblCommon.prev}" styleClass="prev-next-dis" />
                </f:facet>
                <f:facet name="next">
                    <h:outputText value="#{lblCommon.next}" styleClass="prev-next" />
                </f:facet>
                <f:facet name="next_disabled">
                    <h:outputText value="#{lblCommon.next}" styleClass="prev-next-dis" />
                </f:facet>
                <f:facet name="pages">
                </f:facet>
            </rich:datascroller>

            <h:panelGroup id="pagesNum">
                <h:outputText styleClass="strongClass" value="#{pages} "/>
                <h:outputText value=" #{lblCommon.pages}"/>
                <h:outputText value="" style="padding-left: 20px; padding-right: 20px;" />
                <h:outputText styleClass="strongClass" value="#{MbAtmFinanceOperationsBottom.operations.rowCount}"/>
                <h:outputText value=" #{lblCommon.records}"/>
                <h:outputText value="" style="padding-left: 20px; padding-right: 20px;" />
            </h:panelGroup>
        </h:panelGrid>
    </h:panelGroup>




    <h:panelGroup layout="block"
                  styleClass="bottom_search_result_block_buttons">
        <h:panelGrid id="btnPanel" styleClass="fw buttons_block" columns="2" columnClasses=", table_tools_state">
            <h:panelGroup></h:panelGroup>
            <h:panelGroup>
                <h:graphicImage url="/images/green-tick.png" title="#{lblCommon.save_table_state}" styleClass="action_icon"
                                onclick="saveOperTableState();"/>
                <h:graphicImage url="/images/red-cross.png" title="#{lblCommon.delete_table_state}" styleClass="action_icon"
                                onclick="deleteOperTableState();"/>
                <a4j:queue name="tablestatequeue"/>
                <a4j:jsFunction name="saveOperTableState" action="#{MbAtmFinanceOperationsBottom.saveTableStateDB}" eventsQueue="tablestatequeue"/>
                <a4j:jsFunction name="deleteOperTableState" action="#{MbAtmFinanceOperationsBottom.deleteTableStateDB}" eventsQueue="tablestatequeue"/>
            </h:panelGroup>
        </h:panelGrid>
    </h:panelGroup>

</h:panelGroup>


</h:form>
</ui:composition>
</html>
