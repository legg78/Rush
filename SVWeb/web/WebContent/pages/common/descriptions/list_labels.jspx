<?xml version="1.0" encoding="UTF-8"?>
<html	xmlns="http://www.w3.org/1999/xhtml"
		xmlns:f="http://java.sun.com/jsf/core"
		xmlns:h="http://java.sun.com/jsf/html"
		xmlns:ui="http://java.sun.com/jsf/facelets"
		xmlns:a4j="http://richfaces.org/a4j"
		xmlns:rich="http://richfaces.org/rich"
		xmlns:bm="http://www.bpc.ru/jsf/misc"
		xmlns:bre="http://www.bpc.ru/jsf/richfaces-ext"
		xmlns:bpct="http://www.bpc.ru/jsf/tiles"
		xmlns:c="http://java.sun.com/jstl/core">
<ui:composition	template="/WEB-INF/templates/navigatable.jspx">
	<ui:define name="navigatableContent">
		<style type="text/css">
			.leftAligned {
				text-align: left;
			}
		</style>
		<script type="text/javascript">
			//<![CDATA[			
			function validateNumberValue(field, e) {
				var isValid = numbersOnly(field, e, false);
				togleErrorMsg(!isValid);
				return isValid;
			 };
			 function togleErrorMsg(isShow) {
				 if(isShow)
					document.getElementById('labelsSearchForm:labelIdErr').style.display = 'inline';
				else 
					document.getElementById('labelsSearchForm:labelIdErr').style.display = 'none';
			 };
			 function blurField(field) {
				if(field.value!='')  
					togleErrorMsg(parseInt(field.value) != field.value);
			 };	
			//]]>
		</script>
		
		<!-- navigation bar -->
		<bpct:navBar pageName="#{lblCommon.labels}"/>

		<h:form id="labelsSearchForm">

			<!-- search panel -->
			<h:panelGroup styleClass="search_block" layout="block">
				<h:panelGroup layout="block" styleClass="search_block_inner1">
					<h:panelGroup layout="block" styleClass="search_block_inner2">
						<h:panelGroup styleClass="search_block_left" layout="block">
							<h:panelGrid styleClass="fw" columns="2"
								columnClasses="top ,link-cont">
								<h:panelGrid styleClass="filter-table field-cont twoColumnTable" columns="4"
									columnClasses="firstCol,secondCol,firstCol,secondCol">
									<h:outputLabel value="#{lblCommon.id}: " title="#{lblCommon.id}" />
									<h:panelGrid columns="2" cellspacing="0" cellpadding="0" width="100%">
										<h:inputText id="labelId" 
													 value="#{MbLabels.filter.id}"
													 onkeypress="if(!validateNumberValue(this, event)) return false;"
													 onblur="blurField(this);" />
										<h:outputFormat value="#{lblMsg.pos_number}"
														styleClass="errorMarker" id="labelIdErr"	style="display:none;">
											<f:param name="fieldName" value="#{lblCommon.id}" />
										</h:outputFormat>
									</h:panelGrid>	
									
									<h:outputLabel value="#{lblCommon.language}: " title="#{lblCommon.language}" />
									<h:selectOneMenu id="labelLang" value="#{MbLabels.filter.lang}">
										<f:selectItems value="#{MbLabels.languages}" />
									</h:selectOneMenu>

									<h:outputLabel value="#{lblCommon.name}: " title="#{lblCommon.name}" />
									<h:inputText id="labelName" value="#{MbLabels.filter.name}" />
									<h:outputLabel value="#{lblCommon.text}: " title="#{lblCommon.text}" />
									<h:inputText id="labelText" value="#{MbLabels.filter.text}" />

									<h:outputText value="#{lblCommon.label_type}: " title="#{lblCommon.label_type}" />
									<h:selectOneMenu id="labelType"
										value="#{MbLabels.filter.labelType}">
										<f:selectItem itemValue="" itemLabel="" />
										<f:selectItem itemValue="CAPTION" itemLabel="Caption" />
										<f:selectItem itemValue="INFO" itemLabel="Info" />
										<f:selectItem itemValue="ERROR" itemLabel="Error" />
										<f:selectItem itemValue="FATAL" itemLabel="Fatal error" />
									</h:selectOneMenu>
								</h:panelGrid>
								<h:panelGrid columns="1">
									<h:panelGroup styleClass="stdButton">
										<bre:taggedCommandButton action="#{MbLabels.search}"
											reRender="labelsTable, btnPanel, labelDS"
											image="/_img/icon_search.png" type="submit" value="#{lblForm.search}"
											style="width:85px;" />

									</h:panelGroup>
									<h:panelGroup styleClass="link-clear" layout="block">
										<h:graphicImage url="/_img/icon_clear.png" />
										<h:commandLink value="#{lblForm.clear_all}"
											action="#{MbLabels.clearFilter}">
										</h:commandLink>
									</h:panelGroup>
								</h:panelGrid>
							</h:panelGrid>
							<a4j:outputPanel ajaxRendered="true">
								<h:graphicImage url="/_img/hd_searchblock.gif"
									styleClass="hd-searchblock" />
								<h:panelGroup styleClass="collapse-vert table-collapse-vert"
									layout="block" />
							</a4j:outputPanel>
						</h:panelGroup>
					</h:panelGroup>
				</h:panelGroup>
			</h:panelGroup>

			<script type="text/javascript">
//<!--
			var rightButton = false;
		//-->
		</script>
			<a4j:queue name="myQueue" requestDelay="500" size="1" />
			<h:panelGroup styleClass="search_result_block" layout="block">
				<h:panelGroup styleClass="search_result_block_left fix-ff"
					layout="block" id="labelsTableWrapper">
					<rich:extendedDataTable 
						id="labelsTable" 
						styleClass="res-table"
						tableState="#{MbLabels.tableState}"
						headerClass="res-table-header" rowClasses=",odd"
						selectedClass="res-table-selected" var="item"
						value="#{MbLabels.labels}" selection="#{MbLabels.itemSelection}"
						rows="#{MbLabels.rowsNum}" height="255px" selectionMode="single"
						width="100%" enableContextMenu="true"
						noDataLabel="#{MbLabels.searching?lblCommon['no_records_found'] : lblCommon['enter_search_criteria_above']}">
						<rich:column id="id" label="#{lblCommon.id}" sortBy="#{'id'}" width="10%">
							<f:facet name="header">
								 <a4j:outputPanel layout="none">
									<script>updateHeight();</script>
									<h:outputText value="#{lblCommon.id}" title="#{lblCommon.id}" />
								</a4j:outputPanel>								
							</f:facet>
							<h:outputText value="#{item.id}" />
						</rich:column>

						<rich:column id="name" label="#{lblCommon.name}" width="30%" sortBy="#{'name'}">
							<f:facet name="header">
								<h:outputText value="#{lblCommon.name}"
									title="#{lblCommon.name}" />
							</f:facet>
							<h:outputText value="#{item.name}" />
						</rich:column>

						<rich:column id="text" label="#{lblCommon.text}" sortBy="#{'text'}" width="40%">
							<f:facet name="header">
								<h:outputText value="#{lblCommon.text}"
									title="#{lblCommon.text}" />
							</f:facet>
							<h:outputText value="#{item.text}" />
						</rich:column>

						<rich:column id="label_type" label="#{lblCommon.label_type}" sortBy="#{'labelType'}" width="20%">
							<f:facet name="header">
								<h:outputText value="#{lblCommon.label_type}"
									title="#{lblCommon.label_type}" />
							</f:facet>
							<h:outputText value="#{item.labelType}" />
						</rich:column>

						<a4j:support event="onRowMouseDown"
							onsubmit="if (event.button == 2) rightButton = true; else rightButton = false;"
							reRender="btnPanel, out"
							oncomplete="if (rightButton) #{rich:component('labelMenu')}.doShow(event, {})">
							<f:setPropertyActionListener value="#{item}"
								target="#{MbLabels.activeLabel}" />
						</a4j:support>
					</rich:extendedDataTable>
					<a4j:outputPanel ajaxRendered="true">
						<h:graphicImage url="/_img/hd_searchblock.gif"
							styleClass="hd-searchblock" />
						<h:panelGroup styleClass="collapse-vert table-collapse-vert"
							layout="block" />
					</a4j:outputPanel>
				</h:panelGroup>
			</h:panelGroup>

			<h:panelGroup layout="block" styleClass="bottom_search_result_block">
				<h:panelGroup layout="block" styleClass="bottom_search_result_left">
					<h:panelGroup layout="block" styleClass="table_tools">
						<h:panelGrid styleClass="fw field-cont" columns="5" id="labelDS"
							columnClasses="per-page-lbl,per-page-sel,nav-cont,pagecount, table_tools_state">
							<h:outputLabel for="rows_num" value="#{lblCommon.rows_per_page}" title="#{lblCommon.rows_per_page}" />
							<h:selectOneMenu id="rows_num" value="#{MbLabels.rowsNum}"
								style="width:40px">
								<a4j:support event="onchange"
									reRender="labelsTable, dsLabels, pagesNum" />
								<f:selectItems value="#{CommonUtils.rowNumsList}"/>
							</h:selectOneMenu>

							<rich:datascroller maxPages="10" fastControls="hide"
								pagesVar="pages" styleClass="res-datascroller" id="dsLabels"
								for="labelsTable">
								<f:facet name="first">
									<h:outputText value="&lt;&lt;" styleClass="prev-next" />
								</f:facet>
								<f:facet name="first_disabled">
									<h:outputText value="&lt;&lt;" styleClass="prev-next-dis" />
								</f:facet>
								<f:facet name="last">
									<h:outputText value="&gt;&gt;" styleClass="prev-next" />
								</f:facet>
								<f:facet name="last_disabled">
									<h:outputText value="&gt;&gt;" styleClass="prev-next-dis" />
								</f:facet>
								<f:facet name="previous">
									<h:outputText value="#{lblCommon.prev}" styleClass="prev-next" />
								</f:facet>
								<f:facet name="previous_disabled">
									<h:outputText value="#{lblCommon.prev}"
										styleClass="prev-next-dis" />
								</f:facet>
								<f:facet name="next">
									<h:outputText value="#{lblCommon.next}" styleClass="prev-next" />
								</f:facet>
								<f:facet name="next_disabled">
									<h:outputText value="#{lblCommon.next}"
										styleClass="prev-next-dis" />
								</f:facet>
								<f:facet name="pages">
								</f:facet>
							</rich:datascroller>

							<h:panelGroup id="pagesNum">
								<h:outputText styleClass="strongClass" value="#{pages} " />
								<h:outputText value=" #{lblCommon.pages}" />
							</h:panelGroup>
							
							<h:panelGroup>
								<h:graphicImage url="/images/green-tick.png" title="#{lblCommon.save_table_state}" styleClass="action_icon"
									onclick="saveTableState();"/>
								<h:graphicImage url="/images/red-cross.png" title="#{lblCommon.delete_table_state}" styleClass="action_icon"
									onclick="deleteTableState();"/>
								<a4j:queue name="tablestatequeue"/>
								<a4j:jsFunction name="saveTableState" action="#{MbLabels.saveTableStateDB}" eventsQueue="tablestatequeue"/>
								<a4j:jsFunction name="deleteTableState" action="#{MbLabels.deleteTableStateDB}" eventsQueue="tablestatequeue"/>
							</h:panelGroup>
						</h:panelGrid>
					</h:panelGroup>

					<h:panelGrid id="btnPanel" columns="8" styleClass="buttons_block">
						<h:panelGroup styleClass="stdButton">
							<bre:taggedCommandButton id="addLabelBtn"
								reRender="label_modal_panel" value="#{lblForm.add}"
								oncomplete="#{rich:component('label_modal_panel')}.show()"
								action="#{MbLabels.add}" image="/images/create_doc.gif" />
						</h:panelGroup>
						<h:panelGroup styleClass="midButton">
							<bre:taggedCommandButton id="editLabelBtn"
								reRender="label_modal_panel" value="#{lblForm.edit}"
								action="#{MbLabels.edit}"
								oncomplete="#{rich:component('label_modal_panel')}.show()"
								disabled="#{MbLabels.activeLabel == null}"
								image="/images/edit.gif" />
						</h:panelGroup>
						<h:panelGroup styleClass="stdButton">
							<bre:taggedCommandButton id="deleteLabelBtn"
								reRender="labelsTable, btnPanel" value="#{lblForm.delete}"
								action="#{MbLabels.delete}" disabled="true"
								image="/images/delete.gif" />
						</h:panelGroup>
					</h:panelGrid>
				</h:panelGroup>
			</h:panelGroup>
		</h:form>

		<rich:modalPanel id="label_modal_panel" autosized="true" minWidth="200" minHeight="100">
	      	<f:facet name="header">
	        	<h:outputText value="#{lblCommon.edit_label}" />
	        </f:facet>
	  	    <f:facet name="controls">
	      	</f:facet>
	      	<h:panelGroup id="label_modal_div">
	      		<h:form>
		      	    <ui:include src="/pages/common/descriptions/editLabels.jspx"/>
		      	    <h:panelGroup layout="block" styleClass="bottom_search_result_block_buttons">
						<h:panelGroup layout="block" styleClass="bottom_search_result_left_buttons">
			       	    	<h:panelGrid columns="3" columnClasses="width99P,,paddingR12">
			       	    		<h:outputText/>
								<h:panelGroup styleClass="stdButton">
									<bre:taggedCommandButton value="#{lblForm.save}" type="submit" action="#{MbLabels.save}"
											limitToList="true"
											reRender="labelsTable, labelDS"
											oncomplete="if (#{usession.noErrorResponse}) #{rich:component('label_modal_panel')}.hide()"
											/>
								</h:panelGroup>
								<h:panelGroup styleClass="stdButton">
				                	<bre:taggedCommandButton
					                       	value="#{lblForm.cancel}" action="#{MbLabels.close}"
					                       	immediate="true" limitToList="true"
					                       	oncomplete="#{rich:component('label_modal_panel')}.hide()"
					                       	/>
								</h:panelGroup>
							</h:panelGrid>
						</h:panelGroup>
					</h:panelGroup>
	      	    </h:form>
			</h:panelGroup>
		</rich:modalPanel>
		
		<h:form>
			<a4j:outputPanel id="out">
				<rich:contextMenu id="labelMenu" attached="false" submitMode="ajax" disableDefaultMenu="true"
						selectItemClass="selected-menu-item">
					<rich:menuItem
							reRender="label_modal_panel"
							value="#{lblForm.add}"
							action="#{MbLabels.add}"
							oncomplete="#{rich:component('label_modal_panel')}.show()"
			            	icon="/images/create_doc.gif"
			            	iconDisabled="/images/create_doc.gif">
			        </rich:menuItem>
					<rich:menuItem 
							reRender="label_modal_panel"
			            	value="#{lblForm.edit}"
			            	action="#{MbLabels.edit}"
		                	oncomplete="#{rich:component('label_modal_panel')}.show()"
			            	disabled="#{MbLabels.activeLabel == null}"
			            	icon="/images/edit.gif"
			            	iconDisabled="/images/edit.gif"
			            	>
					</rich:menuItem>
					<rich:menuItem
							reRender="labelsTable, btnPanel"
							value="#{lblForm.delete}"
							action="#{MbLabels.delete}"
							disabled="true"
							icon="/images/delete.gif"
							iconDisabled="/images/delete.gif"
							>
					</rich:menuItem>
					
					<ui:remove><!-- 
					<c:forEach items="#{MbLabels.menuItems}" var="ctxItem">
						<rich:menuItem
								value="#{ctxItem.label}"
								action="#{ctxItem.doAction}"
								rendered="#{ctxItem.actionItem}"
								>
						</rich:menuItem>
						<rich:menuItem
								value="#{ctxItem.label}"
								action="#{MbLabels.initCtxParams}"
								oncomplete="Richfaces.showModalPanel('lblSubview:#{MbLabels.panelName}');"
								rendered="#{ctxItem.modalItem}"
								>
							<f:setPropertyActionListener value="#{ctxItem}" target="#{MbLabels.selectedItem}"/>
						</rich:menuItem>
					</c:forEach>
					 -->
					</ui:remove>
				</rich:contextMenu>
			</a4j:outputPanel>
		</h:form>

		<ui:remove><!-- 
		<f:subview id="lblSubview">
			<c:forEach items="#{MbLabels.includeItems}" var="incItem">
				<ui:include src="#{incItem.action}"/>
			</c:forEach>
		</f:subview>
		 -->
		</ui:remove>
		<script>
			//<![CDATA[
		
			function updateHeight(){
				var header = 42;
				var navigator = 15/*body*/ + 10 /*padding-top*/ + 12 /*padding-bottom*/ + 20 /*search_block margin x2*/;	
				var windowHeight = Stretch.getWindowHeight();
				var workplacePanelHeight = windowHeight - header - navigator;
				if (workplacePanelHeight < Stretch.MIN_WORKPLACE_HEIGHT){
					workplacePanelHeight = Stretch.MIN_WORKPLACE_HEIGHT;
				}				
				Stretch.updateTableHeightByFixedHeight('labelsSearchForm:labelsTableWrapper', workplacePanelHeight - 69 /*buttons*/- 84 /*search_block*/);
			}
			updateHeight();
			//]]>
		</script>
    </ui:define>
    
</ui:composition>
</html>
