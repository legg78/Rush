<?xml version="1.0" encoding="UTF-8"?>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:a4j="http://richfaces.org/a4j"
      xmlns:rich="http://richfaces.org/rich"
	  xmlns:bre="http://www.bpc.ru/jsf/richfaces-ext">
<ui:composition>
	<f:loadBundle var="lblHsm" basename="ru.bpc.sv2.ui.bundles.Hsm"/>

	<ui:include src="/pages/widgets/widget_bar.jspx" >
		<ui:param name="widgetItem" value="#{widgetItem}"/>
		<ui:param name="dashboardWidget" value="#{dashboardWidget}"/>
		<ui:param name="widgetForm" value="hsmStatusesForm#{dashboardWidget.id}"/>
		<ui:param name="pollForm" value="#{pollForm}"/>
		<ui:param name="refreshWidgetFunction" value="refreshHsmWidget#{dashboardWidget.id}"/>
		<ui:param name="widgetBean" value="#{MbHsmStatusWidget}"/>
	</ui:include>

	<h3> 
        <h:outputLabel value="#{lblHsm.hsms}" title="#{lblHsm.hsms}"/>
	</h3>
	
	<h:form id="hsmStatusesForm#{dashboardWidget.id}">
	
	<a4j:jsFunction name="refreshHsmWidget#{dashboardWidget.id}"
			reRender="${pollForm}, devicesTable" limitToList="true" action="#{MbHsmStatusWidget.widgets[dashboardWidget.id].refreshHsms}"/>
	
		<h:dataTable value="#{MbHsmStatusWidget.widgets[dashboardWidget.id].deviceList}" var="item" 
				style="table-layout:fixed;" id="devicesTable" styleClass="res-table" 
				headerClass="res-table-header rich-extdt-subheadercell extdt-subheadercell wgtdt-cell"
				rowClasses=",odd" columnClasses="wgtdt-cell rich-extdt-cell width40, wgtdt-cell rich-extdt-cell width20, wgtdt-cell rich-extdt-cell width20, wgtdt-cell rich-extdt-cell width20">
			<h:column>
				<f:facet name="header" >
					<h:outputText style="white-space: normal"
						value="#{lblCommon.description}" title="#{lblCommon.description}"/>
				</f:facet>
				<h:panelGroup layout="block" class="extdt-cell-div">
					<h:outputText value="#{item.description}" title="#{item.description}"/>
				</h:panelGroup>
			</h:column>
			<h:column>
				<f:facet name="header" >
					<h:outputText style="white-space: normal"
						value="#{lblHsm.status_ok}" title="#{lblHsm.status_ok}" />
				</f:facet>
				<h:outputText value="#{item.statusOk}" title="#{item.statusOk}"/>
			</h:column>
			<h:column>
				<f:facet name="header" >
					<h:outputText style="white-space: normal"
						value="#{lblHsm.status_configuration_error}"
						title="#{lblHsm.status_configuration_error}" />
				</f:facet>
				<h:outputText value="#{item.statusConfError}" title="#{item.statusConfError}"/>
			</h:column>
			<h:column>
				<f:facet name="header" >
					<h:outputText style="white-space: normal"
						value="#{lblHsm.status_communication_error}"
						title="#{lblHsm.status_communication_error}" />
				</f:facet>
				<h:outputText value="#{item.statusCommError}" title="#{item.statusCommError}"/>
			</h:column>
		</h:dataTable>
	</h:form>

	<ui:include src="/pages/widgets/parameter_modal.jspx" >
		<ui:param name="MbReportWidgetBean" value="#{MbHsmStatusWidget}"/>
	</ui:include>
</ui:composition>
</html>
