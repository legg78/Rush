<?xml version="1.0" encoding="UTF-8"?>
<html	xmlns="http://www.w3.org/1999/xhtml"
		xmlns:f="http://java.sun.com/jsf/core"
		xmlns:h="http://java.sun.com/jsf/html"
		xmlns:ui="http://java.sun.com/jsf/facelets"
		xmlns:a4j="http://richfaces.org/a4j"
		xmlns:rich="http://richfaces.org/rich"
		xmlns:bm="http://www.bpc.ru/jsf/misc"
		xmlns:bre="http://www.bpc.ru/jsf/richfaces-ext"
		xmlns:bpct="http://www.bpc.ru/jsf/tiles"
		xmlns:c="http://java.sun.com/jstl/core">
<ui:composition	template="/WEB-INF/templates/navigatable.jspx">
	<ui:define name="navigatableContent">
	
	<link rel="stylesheet" type="text/css" href="#{facesContext.externalContext.requestContextPath}/css/stretch.css" />
	<script type="text/javascript" src="#{facesContext.externalContext.requestContextPath}/js/stretch.js" />
		
	<script type="text/javascript">
		//<![CDATA[
			var count = 5;
			var pressed = 0;
			function incrementEsc() {
				pressed++;
				if (pressed == count) {
					pressed = 0;
				}
			}
				
		//]]>
		</script>
	
		
		<rich:hotKey key="F1" handler="incrementEsc()" />
		<a4j:loadScript src="/js/calendarUtils.js"></a4j:loadScript>
		<rich:calendar buttonIcon="/images/calendar.gif" id="calendar" datePattern="#{usession.datePattern}"  timeZone="#{CommonUtils.timeZone}"
				buttonClass="hidden" inputClass="hidden"
				onchanged="#{rich:component('calendar')}.customInput.value=event.rich.component.getSelectedDateString();" zindex="1000"/>

		<ui:include src="/pages/products/contractsListChecks.jspx" />
		
		<script type="text/javascript">
			#{rich:component('calendar')}.customExpand=customExpand;
			//<![CDATA[


			 function selectTab(tabName) {
				submittingTab = tabName;
				if (checkTabLoaded(tabName)) {
					//set only tab name to managed bean (in order to use it in the future)
					setTabName(tabName);
					return false;
				}
				refreshTab(tabName);
				return true;
			 }

			 function handleEnter(event) {
				 if (event.keyCode == 13) {
					 document.getElementById('contractsSearchForm:searchBtn').click();
					 return false;
				}
				return true;
			 }

			 function resetProductId() {
				 document.getElementById('contractsSearchForm:productId').value = null;
			 }


		//]]>
		</script>
		<f:loadBundle var="lblPrd" basename="ru.bpc.sv2.ui.bundles.Prd"/>
		<f:loadBundle var="lblCrp" basename="ru.bpc.sv2.ui.bundles.Crp" />
		<f:loadBundle var="lblFcl" basename="ru.bpc.sv2.ui.bundles.Fcl" />
        <f:loadBundle var="lblNote" basename="ru.bpc.sv2.ui.bundles.Ntb"/>

		<h:panelGroup rendered="#{usession.inRole['VIEW_CUSTOMER_CONTRACTS']}">
		
			<!-- navigation bar -->
			<bpct:navBar pageName="#{lblPrd.contracts}"/>
			
			
			<bpct:filterBarModalPanels id="filterPanels"
					rerenderList="contractsSearchForm, contractsForm:contractsTable, contractsBtnForm:dsContracts, contractsBtnForm:pagesNum, save_filter_panel_div, #{MbContracts.tabName}"
					selectedFilter="#{MbContracts.selectedSectionFilter}"
					sectionFilter="#{MbContracts.sectionFilter}"
					sectionFilterModeEdit="#{MbContracts.sectionFilterModeEdit}"
					searchAutomatically="#{MbContracts.searchAutomatically}"
					sectionId="#{MbContracts.sectionId}"
					beanName="MbContracts"/>
			
			<bpct:customerSearchModalPanels id="custSearchPanels"/>
			
	    	<h:form id="contractsSearchForm" onkeypress="return handleEnter(event)">
	    	<script type="text/javascript">
			//<![CDATA[			
				 function checkCustNumber(formName) {
					var custInfo = document.getElementById(formName + ":customerInfo").value;
					var custNumHidden = document.getElementById(formName + ":customerNumberHidden").value;
					var custNumId = document.getElementById(formName + ":customerIdHidden").value;
					if (custInfo != "" && custNumHidden == "") {
						document.getElementById(formName + ":customerNumberHidden").value = custInfo;
						document.getElementById(formName + ":customerIdHidden").value = "";
					}
				}
				//]]>
			</script>	 
				<a4j:jsFunction name="changeSelection" eventsQueue="queue"
						reRender="#{MbContracts.tabName}"
						oncomplete="setTabLoaded(currentTab)">
					<a4j:actionparam name="tabName" assignTo="#{MbContracts.tabName}"/>
				</a4j:jsFunction>
		
				<a4j:jsFunction name="refreshTab" eventsQueue="queue" requestDelay="500" limitToList="true" ajaxSingle="true"
						reRender="#{MbContracts.tabName}, err_ajax" action="#{MbContracts.loadCurrentTab}"
						oncomplete="setTabLoaded(submittingTab)">
					<a4j:actionparam name="tabName" assignTo="#{MbContracts.tabName}"/>
				</a4j:jsFunction>

				<h:inputHidden value="#{MbContracts.tabName}" id="tabNameInput"/>
				<script type="text/javascript">
				 	load("contractsSearchForm:tabNameInput");
				</script>				
				
				<a4j:jsFunction name="refreshTab" eventsQueue="queue1" requestDelay="500" limitToList="true" ajaxSingle="true"
					reRender="#{MbContracts.tabName}, err_ajax" action="#{MbContracts.loadCurrentTab}"
					oncomplete="setTabLoaded(submittingTab)">
					<a4j:actionparam name="tabName" assignTo="#{MbContracts.tabName}"/>
				</a4j:jsFunction>
				
				<a4j:jsFunction name="setTabName" reRender="err_ajax" limitToList="true" ajaxSingle="true"
					oncomplete="setTabLoaded(submittingTab)">
					<a4j:actionparam name="tabName" assignTo="#{MbContracts.tabName}"/>
				</a4j:jsFunction>
				
				<a4j:queue name="queue1" requestDelay="500" ignoreDupResponses="true" size="1" sizeExceededBehavior="dropNew"/>		
				
				
				<!-- search panel -->
				<h:panelGroup styleClass="search_block" layout="block">
					<h:panelGroup layout="block" styleClass="search_block_inner1">
						<h:panelGroup layout="block" styleClass="search_block_inner2">
			                <h:panelGroup styleClass="search_block_left" layout="block">
			                	<h:panelGroup styleClass="search_block_inner-0 search_block_inner-hidden-filter" layout="block">
			                	<h:panelGrid styleClass="fw" columns="2" columnClasses="top ,link-cont">
				                	<h:panelGrid styleClass="filter-table field-cont twoColumnTable" columns="4" cellpadding="0" cellspacing="0" border="0"
				                			columnClasses="firstCol, secondCol, firstCol, secondCol">
				                		
				                		<h:outputLabel for="instId" value="#{lblCommon.institution}: " title="#{lblCommon.institution}" />
				                		<a4j:region>
							      			<h:selectOneMenu id="instId"
							      					value="#{MbContracts.filter.instId}">
							      				<a4j:support event="onchange" reRender="productId"
							      						ajaxSingle="true" limitToList="true"/>
							      				<f:selectItem itemValue=""/>
							      				<f:selectItems value="#{MbContracts.institutions}"/>
							      			</h:selectOneMenu>
							      		</a4j:region>
						      			
				                		<h:outputLabel for="contractType" value="#{lblPrd.contract_type}: " title="#{lblPrd.contract_type}" />
				                		<a4j:region>
							      			<h:selectOneMenu id="contractType"
							      						value="#{MbContracts.filter.contractType}">
							      				<a4j:support event="onchange" reRender="productId" onsubmit="resetProductId()"
							      						ajaxSingle="true" limitToList="true"/>
							      				<f:selectItem itemValue=""/>
							      				<f:selectItems value="#{MbContracts.contractTypes}"/>
							      			</h:selectOneMenu>
							      		</a4j:region>

				                		<h:outputLabel for="productId" value="#{lblPrd.product}: " title="#{lblPrd.product}" />
				                		<a4j:region>
							      			<h:selectOneMenu id="productId" label="#{lblPrd.product}"
							      						value="#{MbContracts.filter.productId}">
							      				<a4j:support event="onchange"
							      						ajaxSingle="true" limitToList="true"/>
							      				<f:selectItem itemValue=""/>
							      				<f:selectItems value="#{MbContracts.products}"/>
							      			</h:selectOneMenu>
							      		</a4j:region>
						      			
				                		<h:outputLabel for="numberFilter" value="#{lblPrd.contract_number}: " title="#{lblPrd.contract_number}" />
				            			<h:inputText id="numberFilter" value="#{MbContracts.filter.contractNumber}"/>
				            			
			                			<h:outputLabel for="startDateFrom" value="#{lblCommon.start_date_from}: " title="#{lblCommon.start_date_from}" />
				            			<rich:calendar buttonIcon="/images/calendar.gif" id="startDateFrom" value="#{MbContracts.filter.startDate}"
				            				datePattern="#{usession.datePattern}" timeZone="#{CommonUtils.timeZone}" inputClass="inputDate"/>

				                		<h:outputLabel for="customerNumber" value="#{lblPrd.customer_number}: " title="#{lblPrd.customer_number}" />
										<bm:selectCustomer 
											valueId="#{MbContracts.filter.customerId}"
											valueNumber="#{MbContracts.filter.customerNumber}"
											custInfoField="#{MbContracts.filter.custInfo}"
											beanName="MbContracts" 
											modalPanel="customerSearchModalPanel"
											formName="contractsSearchForm"
											searchButton="searchBtn"
											manualInput="true"
											rerenderList="contractsSearchForm:instId"
                                            disabled="false" rendered="true"
                                            />
										
				            			<h:outputLabel for="endDateTo" value="#{lblCommon.start_date_to}: " title="#{lblCommon.start_date_to}" />
			                			<rich:calendar buttonIcon="/images/calendar.gif" id="endDateTo" value="#{MbContracts.filter.endDate}"
				            				datePattern="#{usession.datePattern}" timeZone="#{CommonUtils.timeZone}" inputClass="inputDate"/>
		                			</h:panelGrid>
			                		<h:panelGrid columns="1">
				                		<bre:taggedCommandButton
				                				id="searchBtn"
					                			action="#{MbContracts.search}"
					                			onclick="if (!checkFields()) {return false;} checkCustNumber('contractsSearchForm'); disableModalPanelBtns(this); flushTabs();"
			        							reRender="contractsForm:contractsTable, contractsBtnForm:dsContracts, contractsBtnForm:pagesNum, contractsBtnForm:btnsPanel, #{MbContracts.tabName}, togglePanel"
			        							image="/_img/icon_search.png" type="submit"
			                					value="#{lblForm.search}" style="width:85px;"
			                					oncomplete="enableModalPanelBtns(this);updateHeight();toggleTabs(currentTab);"
			                					eventsQueue="queue"/>
			                			<h:panelGrid columns="1" >
				                			<h:panelGroup styleClass="link-clear" layout="block">
					                			<h:graphicImage url="/_img/icon_clear.png"/>
					                			<a4j:commandLink value="#{lblForm.clear_all}"
					                					onclick="flushTabs();"
										        		action="#{MbContracts.clearFilter}"
										        		reRender="contractsSearchForm, contractsForm, #{MbContracts.tabName}, contractsBtnForm, togglePanel"
										        		oncomplete="toggleTabs(currentTab);updateHeight();">
										        </a4j:commandLink>
				            	    		</h:panelGroup>
				            	    		
				            	    		<h:panelGroup>
					            	    		<bpct:filterBar sectionId="#{MbContracts.sectionId}"/>
											</h:panelGroup>
										</h:panelGrid>
			                		</h:panelGrid>
			               		</h:panelGrid>
			               		</h:panelGroup>
			               		<a4j:outputPanel ajaxRendered="true">
				               		<h:panelGroup styleClass="show-more-vert" layout="block"/>
				                	<h:graphicImage url="/_img/hd_searchblock.gif"  styleClass="hd-searchblock"/>
				                	<h:panelGroup styleClass="collapse-vert" layout="block"/>
			               		</a4j:outputPanel>
			               	</h:panelGroup>
		               	</h:panelGroup>
	               	</h:panelGroup>
				</h:panelGroup>
			</h:form>
			
			<h:form id="contractsForm">
				<a4j:jsFunction name="changeSelection" eventsQueue="queue"
						reRender="#{MbContracts.tabName}, togglePanel"
						oncomplete="setTabLoaded(currentTab);toggleTabs(currentTab);">
					<a4j:actionparam name="tabName" assignTo="#{MbContracts.tabName}"/>
				</a4j:jsFunction>

				<h:panelGroup styleClass="search_result_block" layout="block">
			    	<h:panelGroup styleClass="search_result_block_left fix-ff" layout="block">
			    		<h:panelGroup id="mainTableWrapper" layout="block"
								styleClass="search_result_block_inner">
						    <rich:extendedDataTable
									id="contractsTable"
									tableState="#{MbContracts.tableState}"
									styleClass="res-table"
									headerClass="res-table-header"
									rowClasses=",odd"
									selectedClass="res-table-selected"
									var="item"
									value="#{MbContracts.contracts}"
									selection="#{MbContracts.itemSelection}"
									rows="#{MbContracts.rowsNum}"
									height="255px"
									selectionMode="single"
									width="100%"
									enableContextMenu="true"
									noDataLabel="#{MbContracts.searching?lblCommon['no_records_found'] : lblCommon['enter_search_criteria_above']}"
									onselectionchange="flushTabs();changeSelection(currentTab);updateHeight();"
									reRender="#{MbContracts.tabName}, togglePanel, err_ajax"
									onRowMouseDown="handleMouseClick(event)"
                                    binding="#{MbContracts.table}">
                               <f:event type="preRenderComponent" listener="#{MbContracts.onSortablePreRenderTable()}"></f:event>
						       <rich:column id="contract_number" label="#{lblPrd.contract_number}" title="Label" width="20%" sortBy="#{'contract_number'}">
						           <f:facet name="header">
						           		<h:panelGroup>
			                        		<script>
			                        			updateHeight();
			                        		</script>
			                            	<h:outputText value="#{lblPrd.contract_number}" title="#{lblPrd.contract_number}"/>
			                            </h:panelGroup>
					                </f:facet>
					            	<bm:entityDisplay contextType="ENTTCNTR" bean="MbContracts" value="#{item.contractNumber}" />
						        </rich:column>
						        
						        <rich:column id="contract_type" label="#{lblPrd.contract_type}" title="Contract type" sortBy="#{'contract_type_name'}" width="15%">
						           <f:facet name="header">
					                    <h:outputText value="#{lblPrd.contract_type}" title="#{lblPrd.contract_type}"/>
					                </f:facet>
					            	<bm:entityDisplay contextType="ENTTCNTR" bean="MbContracts" value="#{DictUtils.articles[item.contractType]}"/>
						        </rich:column>
						        
						        <rich:column id="customer_number" label="#{lblPrd.customer_number}" title="Customer" sortBy="#{'customer_number'}" width="15%">
						           <f:facet name="header">
					                    <h:outputText value="#{lblPrd.customer_number}" title="#{lblPrd.customer_number}"/>
					                </f:facet>
			                		<bm:entityDisplay link = "true" contextType="ENTTCUST" bean="MbContracts" value="#{item.customerNumber != null ? item.customerNumber : '...'}" />
								</rich:column>
						        
						        <rich:column id="product" label="#{lblPrd.product}" title="Product" sortBy="#{'product_name'}" width="15%">
						           <f:facet name="header">
					                    <h:outputText value="#{lblPrd.product}" title="#{lblPrd.product}" />
					                </f:facet>
                                    <bm:entityDisplay link = "true" contextType="ENTTPROD" bean="MbContracts" entityId="#{item.productNumber}" value="#{item.productName != null ? item.productName : '...'}" />
						        </rich:column>
	
						        <rich:column id="start_date" label="#{lblCommon.start_date}" title="Start date" sortBy="#{'start_date'}" width="10%">
						           <f:facet name="header">
					                    <h:outputText value="#{lblCommon.start_date}" title="#{lblCommon.start_date}"/>
					                </f:facet>
					            	<h:outputText value="#{item.startDate}" title="#{item.startDate}">
					            		<f:convertDateTime pattern="#{usession.datePattern}"
					            				timeZone="#{CommonUtils.timeZone}"/>
					            	</h:outputText>
						        </rich:column>
	
						        <rich:column id="end_date" label="#{lblCommon.end_date}" title="End date" sortBy="#{'end_date'}" width="10%">
						           <f:facet name="header">
					                    <h:outputText value="#{lblCommon.end_date}" title="#{lblCommon.end_date}"/>
					                </f:facet>
					            	<h:outputText value="#{item.endDate}" title="#{item.endDate}">
					            		<f:convertDateTime pattern="#{usession.datePattern}"
					            				timeZone="#{CommonUtils.timeZone}"/>
					            	</h:outputText>
						        </rich:column>
	
						        <rich:column id="institution" label="#{lblCommon.institution}" title="Inst" sortBy="#{'inst_name'}" width="15%">
						           <f:facet name="header">
					                    <h:outputText value="#{lblCommon.institution}" title="#{lblCommon.institution}" />
					                </f:facet>
			                		<bm:entityDisplay link = "true" contextType="ENTTINST" bean="MbContracts" entityId="#{item.instId}" value="#{item.instName != null ? item.instName : '...'}" />
						        </rich:column>
						    </rich:extendedDataTable>
						</h:panelGroup>
					    <a4j:outputPanel ajaxRendered="true">
					    	<h:panelGroup id="show_more_panel" styleClass="show-more-vert show-more-result-tab" layout="block"/>
					    	<h:graphicImage url="/_img/hd_searchblock.gif" styleClass="hd-searchblock"/>
					    	<h:panelGroup styleClass="collapse-vert table-collapse-vert" layout="block"/>
					    </a4j:outputPanel>
				    </h:panelGroup>
				</h:panelGroup>
			</h:form>
			<h:form id="contractsBtnForm">
			    <h:panelGroup layout="block" styleClass="bottom_search_result_block">
					<h:panelGroup layout="block" styleClass="bottom_search_result_left">
			        	<h:panelGroup layout="block" styleClass="table_tools">
				        	<h:panelGrid styleClass="fw field-cont" columns="5"
				        			columnClasses="per-page-lbl,per-page-sel,nav-cont,pagecount, table_tools_state">
					        	<h:outputLabel for="rows_num" value="#{lblCommon.rows_per_page}" title="#{lblCommon.rows_per_page}"/>
								<h:selectOneMenu id="rows_num" value="#{MbContracts.rowsNum}" styleClass="row_per_page">
									<a4j:support event="onchange" reRender="contractsForm:contractsTable, dsContracts, pagesNum, btnsPanel, #{MbContracts.tabName}"/>
			                        <f:selectItems value="#{CommonUtils.rowNumsList}"/>
			                    </h:selectOneMenu>
	
			                    <rich:datascroller maxPages="10" fastControls="hide"
			                    		pagesVar="pages" styleClass="res-datascroller"
					                    id="dsContracts" for="contractsForm:contractsTable" reRender="#{MbContracts.tabName}">
					            	<f:facet name="first">
					                	<h:outputText value="&lt;&lt;" styleClass="prev-next" />
									</f:facet>
					                <f:facet name="first_disabled">
					                    <h:outputText value="&lt;&lt;" styleClass="prev-next-dis" />
					                </f:facet>
					                <f:facet name="last">
					                    <h:outputText  value="&gt;&gt;" styleClass="prev-next" />
					                </f:facet>
					                <f:facet name="last_disabled">
					                    <h:outputText value="&gt;&gt;" styleClass="prev-next-dis" />
					                </f:facet>
					                <f:facet name="previous">
										<h:outputText value="#{lblCommon.prev}" styleClass="prev-next" />
					                </f:facet>
					                <f:facet name="previous_disabled">
					                	<h:outputText value="#{lblCommon.prev}" styleClass="prev-next-dis" />
					                </f:facet>
					                <f:facet name="next">
					                	<h:outputText value="#{lblCommon.next}" styleClass="prev-next" />
					                </f:facet>
					                <f:facet name="next_disabled">
					                	<h:outputText value="#{lblCommon.next}" styleClass="prev-next-dis" />
					                </f:facet>
					                <f:facet name="pages">
					                </f:facet>
								</rich:datascroller>
	
			                    <h:panelGroup id="pagesNum">
			                       	<h:outputText styleClass="strongClass" value="#{pages}"/>
			                       	<h:outputText value=" #{lblCommon.pages}"/>
                                    <h:outputText value="" style="padding-left: 20px; padding-right: 20px;" />
                                    <h:outputText styleClass="strongClass" value="#{MbContracts.contracts.rowCount}"/>
                                    <h:outputText value=" #{lblCommon.records}"/>
                                    <h:outputText value="" style="padding-left: 20px; padding-right: 20px;" />
			                    </h:panelGroup>
			                    
			                    <h:panelGroup>
									<h:graphicImage url="/images/green-tick.png" title="#{lblCommon.save_table_state}" styleClass="action_icon"
										onclick="saveTableState();"/>
									<h:graphicImage url="/images/red-cross.png" title="#{lblCommon.delete_table_state}" styleClass="action_icon"
										onclick="deleteTableState();"/>
									<a4j:queue name="tablestatequeue"/>
									<a4j:jsFunction name="saveTableState" action="#{MbContracts.saveTableStateDB}" eventsQueue="tablestatequeue"/>
									<a4j:jsFunction name="deleteTableState" action="#{MbContracts.deleteTableStateDB}" eventsQueue="tablestatequeue"/>
								</h:panelGroup>
							</h:panelGrid>
						</h:panelGroup>
	
			            <h:panelGrid id="btnsPanel" columns="4" styleClass="buttons_block">
							<bre:taggedCommandButton id="backBtn" value="#{lblForm.back}"
									action="#{MbContracts.back}" rendered="#{MbContracts.showBackBtn}"/>
	
							<rich:spacer width="20px" rendered="#{MbContracts.showBackBtn}"/>
						</h:panelGrid>
					</h:panelGroup>
			    </h:panelGroup>
		    </h:form>
			
			<a4j:queue name="queue" ignoreDupResponses="true" size="1" sizeExceededBehavior="dropNext" requestDelay="500" />

            <h:form>
                <a4j:jsFunction name="storeTab" ajaxSingle="true" limitToList="true" ignoreDupResponses="true" eventsQueue="queue"
                                requestDelay="500" reRender="#{MbContracts.rerenderList}">
                    <a4j:actionparam name="tabName" assignTo="#{MbContracts.tabName}" />
                </a4j:jsFunction>
            </h:form>

			<h:panelGroup styleClass="workplace" id="workplacePanel" layout="block">
		    	<rich:tabPanel switchType="client" id="details"  tabClass="tab-cell"
		    			activeTabClass="active-tab-cell" headerClass="tabs" headerSpacing="0px"
		    			contentClass="tab-content" selectedTab="#{MbContracts.tabName}">
	
					<rich:tab id="_detailsTab" label="Details" name="detailsTab" onlabelclick="selectTab('detailsTab')">
	       				<f:facet name="label">
	       					<h:panelGroup styleClass="first tab-label" layout="block">
	       						<h:outputText value="#{lblCommon.details}" title="#{lblCommon.details}"/>
	       					</h:panelGroup>
	       				</f:facet>
	       				<h:panelGroup id="detailsTab" layout="block">
							<ui:include src="/pages/products/contractDetails.jspx"></ui:include>
							<h:panelGroup layout="block"
								styleClass="bottom_search_result_block_buttons"/>
						</h:panelGroup>
				    </rich:tab>

					<rich:tab id="_additionalTab" label="Additional" name="additionalTab" style="height:100%;"
							  onlabelclick="selectTab('additionalTab')" rendered="#{usession.inRole['VIEW_FLEXIBLE_DATA']}">
						<f:facet name="label">
							<h:panelGroup styleClass="tab-label" layout="block">
								<h:outputText value="#{lblCommon.additional}" title="#{lblCommon.additional}"/>
							</h:panelGroup>
						</f:facet>

						<h:panelGroup id="additionalTab" layout="block" styleClass="carddata-wrapper"
									  style="height: 100%; overflow: hidden;position:relative;">
							<h:panelGroup id="additionalTabContents" layout="block">
								<ui:include src="#{MbContracts.tabName=='additionalTab' ? '/pages/common/flexible/flexFieldsTableBottom.jspx' : null}">
									<ui:param name="hideButtons" value="false"></ui:param>

								</ui:include>
							</h:panelGroup>
						</h:panelGroup>
					</rich:tab>

					<rich:tab label="Customer" name="customerTab" onlabelclick="selectTab('customerTab')"
							rendered="#{usession.inRole['VIEW_CUSTOMERS']}">
				    	<f:facet name="label">
	       					<h:panelGroup styleClass="first tab-label" layout="block">
	       						<h:outputText value="#{lblPrd.customer}" title="#{lblPrd.customer}"/>
	       					</h:panelGroup>
	       				</f:facet>
						<h:panelGroup layout="block" id="customerTab">
	      					<ui:include src="#{MbContracts.tabName=='customerTab' ? '/pages/products/customerDetails.jspx' : null}">
	      						<ui:param name="customersBean" value="#{MbCustomersDependent}"/>
	      					</ui:include>
							<h:panelGroup layout="block"
								styleClass="bottom_search_result_block_buttons"/>	      					
	       				</h:panelGroup>
				    </rich:tab>

				    <rich:tab id="_cardsTab" label="Cards" name="cardsTab" rendered="#{usession.inRole['VIEW_CARDS_TAB']}"
				    		onlabelclick="selectTab('cardsTab')" style="height: 100%;">
	        			<f:facet name="label">
	        				<h:panelGroup styleClass="tab-label" layout="block">
	        					<h:outputText value="#{lblIss.cards}" title="#{lblIss.cards}"/>
	        				</h:panelGroup>
	        			</f:facet>
	        			<h:panelGroup id="cardsTab" layout="block" styleClass="carddata-wrapper" style="height: 100%; overflow: hidden;position:relative;">
	       					<ui:include src="#{MbContracts.tabName=='cardsTab' ? '/pages/issuing/cards/list_cards_bottom.jspx' : null}">
	       						
	       					</ui:include>
	        			</h:panelGroup>
	        		</rich:tab>

	        		<rich:tab label="Accounts" name="accountsTab" rendered="#{usession.inRole['VIEW_ACCOUNT']}"
	        				onlabelclick="selectTab('accountsTab')" style="height:100%;">
	        			<f:facet name="label">
	        				<h:panelGroup styleClass="first tab-label" layout="block">
	        					<h:outputText value="#{lblCommon.accounts}" title="#{lblCommon.accounts}"/>
	        				</h:panelGroup>
	        			</f:facet>
	        			<h:panelGroup id="accountsTab" layout="block" styleClass="carddata-wrapper"
								style="height: 100%;overflow:hidden;position:relative;">
	       					<ui:include src="#{MbContracts.tabName=='accountsTab' ? '/pages/accounts/list_accounts_bottom.jspx' : null}">
	       					</ui:include>
	        			</h:panelGroup>
	        		</rich:tab>
	        		
					<rich:tab id="_terminalsTab" label="Terminals" name="terminalsTab" onlabelclick="selectTab('terminalsTab')"
							rendered="#{usession.inRole['VIEW_TERMINAL']}" style="height:100%;">
						<f:facet name="label">
							<h:panelGroup styleClass="tab-label" layout="block">
								<h:outputText value="#{lblAcq.terminals}" title="#{lblAcq.terminals}" />
							</h:panelGroup>
						</f:facet>
						<h:panelGroup id="terminalsTab" layout="block"
								styleClass="carddata-wrapper"
								style="height: 100%; overflow: hidden;position:relative;">
							<ui:include src="#{MbContracts.tabName=='terminalsTab' ? '/pages/acquiring/terminals/list_terminals_bottom.jspx' : null}"></ui:include>
						</h:panelGroup>
					</rich:tab>

					<rich:tab id="_merchantsTab" label="Merchants" name="merchantsTab" onlabelclick="selectTab('merchantsTab')"
							rendered="#{usession.inRole['VIEW_MERCHANT']}" style="height:100%;">
						<f:facet name="label">
							<h:panelGroup styleClass="tab-label" layout="block">
								<h:outputText value="#{lblAcq.merchants}" title="#{lblAcq.merchants}" />
							</h:panelGroup>
						</f:facet>
						<h:panelGroup id="merchantsTab" layout="block"
								styleClass="carddata-wrapper"
								style="height: 100%; overflow: hidden;position:relative;">
							<ui:include src="#{MbContracts.tabName=='merchantsTab' ? '/pages/acquiring/list_merchants_bottom.jspx' : null}"></ui:include>
						</h:panelGroup>
					</rich:tab>
					
					<rich:tab label="Services" name="servicesTab" onlabelclick="selectTab('servicesTab')"
							rendered="#{usession.inRole['VIEW_SERVICES']}" style="height:100%;">
						<f:facet name="label">
							<h:panelGroup styleClass="tab-label" layout="block">
								<h:outputText value="#{lblPrd.services}" title="#{servicesTab}" />
							</h:panelGroup>
						</f:facet>
						<h:panelGroup id="servicesTab" layout="block"
								styleClass="carddata-wrapper"
								style="height: 100%; overflow: hidden;position:relative;">
							<ui:include src="#{MbContracts.tabName=='servicesTab' ? '/pages/products/services/serviceObjectsListBottom.jspx' : null}"></ui:include>
							<h:panelGroup layout="block"
								styleClass="bottom_search_result_block_buttons"/>
						</h:panelGroup>
					</rich:tab>

				    <rich:tab ontabenter="storeTab('objectsTab')" label="Objects" name="objectsTab" rendered="false" style="height:100%;">
	        			<f:facet name="label">
	        				<h:panelGroup styleClass="tab-label" layout="block">
	        					<h:outputText value="#{lblPrd.objects}" title="#{lblPrd.objects}"/>
	        				</h:panelGroup>
	        			</f:facet>
	        			<h:panelGroup id="objectsTab" layout="block" styleClass="carddata-wrapper" style="height: 250px; overflow-y: auto;">

	        			</h:panelGroup>
	        		</rich:tab>
	        		
					<rich:tab id="_corporationsTab" rendered="#{usession.inRole['VIEW_DEPARTMENTS']}" onlabelclick="selectTab('corporationsTab')"
						label="Corporations" name="corporationsTab" style="height:100%;">	        			
	        			<f:facet name="label">
	        				<h:panelGroup styleClass="tab-label" layout="block">
	        					<h:outputText value="#{lblCrp.corporation}" title="#{lblCrp.corporation}"/>
	        				</h:panelGroup>
	        			</f:facet>
						<h:panelGroup id="corporationsTab" layout="block"
								styleClass="carddata-wrapper"
								style="height: 100%; overflow: hidden;position:relative;">
							<ui:include src="#{MbContracts.tabName=='corporationsTab' ? '/pages/products/contractCorporationBottom.jspx' : null}"></ui:include>
						</h:panelGroup>
	        		</rich:tab>

				    <rich:tab id="_attributesTab" label="Attributes" name="attributesTab" 
				    		rendered="#{usession.inRole['VIEW_ATTRIBUTE_PRODUCT'] and usession.inRole['VIEW_PRODUCT_ATTRIBUTE_VALUES']}"
				    		onlabelclick="selectTab('attributesTab')" style="height:100%;">
	        			<f:facet name="label">
	        				<h:panelGroup styleClass="tab-label" layout="block">
	        					<h:outputText value="#{lblPrd.service_terms}" title="#{lblPrd.service_terms}"/>
	        				</h:panelGroup>
	        			</f:facet>
	
						<h:panelGroup id="attributesTab" layout="block" styleClass="carddata-wrapper" style="height: 100%; overflow: hidden;position:relative;">
	       					<ui:include src="#{MbContracts.tabName=='attributesTab' ? '/pages/products/attributes/list_object_attributes.jspx' : null}"></ui:include>
	       				</h:panelGroup>
				    </rich:tab>

	        		<rich:tab id="_limitCountersTab" label="Limit counters" name="limitCountersTab" 
	        				onlabelclick="selectTab('limitCountersTab')" style="height:100%;" rendered="#{usession.inRole['VIEW_LIMIT_COUNTER']}">			    	
	        			<f:facet name="label">
	        				<h:panelGroup styleClass="tab-label" layout="block">
	        					<h:outputText value="#{lblFcl.limit_counters}" title="#{lblFcl.limit_counters}"/>
	        				</h:panelGroup>
	        			</f:facet>
	        			<h:panelGroup id="limitCountersTab" layout="block" styleClass="carddata-wrapper" 
	        					style="height: 100%; overflow: hidden;position:relative;">
	       					<ui:include src="#{MbContracts.tabName=='limitCountersTab' ? '/pages/fee_cycle_limit/limits/listLimitCounters.jspx' : null}">
	       					</ui:include>
	        			</h:panelGroup>
	        		</rich:tab>
	        		
	        		<rich:tab id="_cycleCountersTab" label="Cycle counters" name="cycleCountersTab"
	        				onlabelclick="selectTab('cycleCountersTab')" style="height:100%;" rendered="#{usession.inRole['VIEW_CYCLE_COUNTER']}">			    	
	        			<f:facet name="label">
	        				<h:panelGroup styleClass="tab-label" layout="block">
	        					<h:outputText value="#{lblFcl.cycle_counters}" title="#{lblFcl.cycle_counters}"/>
	        				</h:panelGroup>
	        			</f:facet>
	        			<h:panelGroup id="cycleCountersTab" layout="block" styleClass="carddata-wrapper" 
	        					style="height: 100%; overflow: hidden;position:relative;">
	       					<ui:include src="#{MbContracts.tabName=='cycleCountersTab' ? '/pages/fee_cycle_limit/cycles/listCycleCounters.jspx' : null}">
	       					</ui:include>
	        			</h:panelGroup>
	        		</rich:tab>

                    <rich:tab label="Notes" name="notesTab" style="height: 100%; overflow: hidden;" onlabelclick="selectTab('notesTab')">
                        <f:facet name="label">
                            <h:panelGroup styleClass="tab-label" layout="block">
                                <h:outputText value="#{lblNote.notes}" title="#{lblNote.notes}"/>
                            </h:panelGroup>
                        </f:facet>
                        <h:panelGroup id="notesTab" layout="block" styleClass="carddata-wrapper" style="height:100%;overflow: hidden;position:relative;">
                            <ui:include src="#{MbContracts.tabName=='notesTab' ? '/pages/notes/list_notes_bottom.jspx' : null}"></ui:include>
                        </h:panelGroup>
                    </rich:tab>
			    </rich:tabPanel>
	        </h:panelGroup>
		</h:panelGroup>
		
		<h:panelGroup rendered="#{!usession.inRole['VIEW_CUSTOMER_CONTRACTS']}" style="text-align: center">
			<h:outputText value="#{lblMsg.insufficient_rights}" style="font-size: 5em" />
		</h:panelGroup>
		
		<h:panelGroup id="togglePanel">
		<script>
		function toggleTabs(currentTab) {
			var hasIssProducts = #{MbContracts.activeContract.productType == 'PRDT0100'};
			var hasAcqProducts = #{MbContracts.activeContract.productType == 'PRDT0200'};

			var _cardsTab = document.getElementById('_cardsTab_shifted');
			var cardsTab = document.getElementById('cardsTab');

			if (hasIssProducts == true) {
				_cardsTab.style.display = "";
				cardsTab.parentNode.style.display = "";
			} else {
				_cardsTab.style.display = "none";
				cardsTab.parentNode.style.display = "none";
				if (currentTab == "cardsTab") {
					RichFaces.switchTab('details','_detailsTab','detailsTab');
					selectTab("detailsTab");
				}
			}

			var _merchantsTab = document.getElementById('_merchantsTab_shifted');
			var merchantsTab = document.getElementById('merchantsTab');

			if (hasAcqProducts == true) {
				_merchantsTab.style.display = "";
				merchantsTab.parentNode.style.display = "";
			} else {
				_merchantsTab.style.display = "none";
				merchantsTab.parentNode.style.display = "none";
				if (currentTab == "merchantsTab") {
					RichFaces.switchTab('details','_detailsTab','detailsTab');
					selectTab("detailsTab");
				}
			}

			var _terminalsTab = document.getElementById('_terminalsTab_shifted');
			var terminalsTab = document.getElementById('terminalsTab');

			if (hasAcqProducts == true) {
				_terminalsTab.style.display = "";
				terminalsTab.parentNode.style.display = "";
			} else {
				_terminalsTab.style.display = "none";
				terminalsTab.parentNode.style.display = "none";
				if (currentTab == "terminalsTab") {
					RichFaces.switchTab('details','_detailsTab','detailsTab');
					selectTab("detailsTab");
				}
			}

			var corporationCustomer = #{MbContracts.activeContract.customerType == 'ENTTCOMP'};

			var _corporationsTab = document.getElementById('_corporationsTab_shifted');
			var corporationsTab = document.getElementById('corporationsTab');

			if (corporationCustomer){
				_corporationsTab.style.display = "";
				corporationsTab.parentNode.style.display = "";
			} else {
				_corporationsTab.style.display = "none";
				corporationsTab.parentNode.style.display = "none";
				if (currentTab == "corporationsTab") {
					RichFaces.switchTab('details','_detailsTab','detailsTab');
					selectTab("detailsTab");
				}
			}
		}

		function toggleContextTabs() {
			var hasIssProducts = #{MbContracts.activeContract.productType == 'PRDT0100'};
			var hasAcqProducts = #{MbContracts.activeContract.productType == 'PRDT0200'};

			var _cardsTab = document.getElementById('contextMenuModalPanel:contractDetailsModalPanel:_cardsContextTab_shifted');
			var cardsTab = document.getElementById('contextMenuModalPanel:contractDetailsModalPanel:cardsContextTab');

			if (hasIssProducts == true) {
				if (_cardsTab != null) _cardsTab.style.display = "";
				if (cardsTab != null) cardsTab.parentNode.style.display = "";
			} else {
				if (_cardsTab != null) _cardsTab.style.display = "none";
				if (cardsTab != null) cardsTab.parentNode.style.display = "none";
			}

			var _merchantsTab = document.getElementById('contextMenuModalPanel:contractDetailsModalPanel:_merchantsContextTab_shifted');
			var merchantsTab = document.getElementById('contextMenuModalPanel:contractDetailsModalPanel:merchantsContextTab');

			if (hasAcqProducts == true) {
				if (_merchantsTab != null) _merchantsTab.style.display = "";
				if (merchantsTab != null) merchantsTab.parentNode.style.display = "";
			} else {
				if (_merchantsTab != null) _merchantsTab.style.display = "none";
				if (merchantsTab != null) merchantsTab.parentNode.style.display = "none";
			}

			var _terminalsTab = document.getElementById('contextMenuModalPanel:contractDetailsModalPanel:_terminalsContextTab_shifted');
			var terminalsTab = document.getElementById('contextMenuModalPanel:contractDetailsModalPanel:terminalsContextTab');

			if (hasAcqProducts == true) {
				if (_terminalsTab != null) _terminalsTab.style.display = "";
				if (terminalsTab != null) terminalsTab.parentNode.style.display = "";
			} else {
				if (_terminalsTab != null) _terminalsTab.style.display = "none";
				if (terminalsTab != null) terminalsTab.parentNode.style.display = "none";
			}

			var corporationCustomer = #{MbContracts.activeContract.customerType == 'ENTTCOMP'};

			var _corporationsTab = document.getElementById('contextMenuModalPanel:contractDetailsModalPanel:_corporationsContextTab_shifted');
			var corporationsTab = document.getElementById('contextMenuModalPanel:contractDetailsModalPanel:corporationsContextTab');

			if (corporationCustomer){
				if (_corporationsTab != null) _corporationsTab.style.display = "";
				if (_corporationsTab != null) corporationsTab.parentNode.style.display = "";
			} else {
				if (_corporationsTab != null) _corporationsTab.style.display = "none";
				if (_corporationsTab != null) corporationsTab.parentNode.style.display = "none";
			}
		}
		</script>
		</h:panelGroup>
		
		<script>
			//<![CDATA[
			/*
				Short manual for the tabs stretching
				
				* Put in head of the page a link to "streach.css" style and "streach.js" script.
				* Copy "updateHeight()" from here to end of the page.
				* Chage the function as you need. Change the forms names
				* Set id="workplacePanel" Ð¸ layout="block" for workplace panel					
				* Set style="height:100%" for rich:tabPanel, rich:tab. Set style="height: 100%;overflow:hidden;position:relative;" 
				for h:panelGroup surrounding ui:include. Below lying elements must not have a har-coded height in theirs styles.
				* Surround the tables with h:panelGroup layout="block" style="padding:0px;margin:0px;"
				* Correct updateHeight() in correspondence with wrappers you wrote.
				* Add to header of one of the columns of the tables updateHeight() call. Every time the table is rendered, udpateHeight() will be called.
				* If the result table is rich:extendedDataTable you need surround it with a wrapper panel too, but also you need to set style with hard-coded
				height to this wrapper. For this wrapper you need call Stretch.updateTreeHeightByFixedHeight(). 
			*/
		
			function updateHeight(){
	            updateGridHeight();
	        }

	        layout =
	                {
	                    SEARCH_FORM_ID:                 'contractsSearchForm',
	                    SEARCH_RESULT_FORM_ID:          'contractsForm',
	                    SEARCH_RESULT_FORM_WRAPPER_ID:  'mainTableWrapper',
	                    SEARCH_RESULT_FOOTER_FORM_ID:   'contractsBtnForm',
	                    TAB_PANEL_ID:                   'workplacePanel',

	                    TAB_DATA:      [{
	                                    TAB_FORM_ID:            'contractDetails',
	                                    TAB_FORM_WRAPPER_ID:    'contractDetailsWrapper',
	                                    CORRECTING_HEIGHT:      Stretch.TABS + Stretch.BUTTONS
	                                    }, {
										TAB_FORM_ID:            'flexDataForm',
										TAB_FORM_WRAPPER_ID:    'flexDataWrapper',
										CORRECTING_HEIGHT:      Stretch.TABS + Stretch.BUTTONS
										}, {
	                                    TAB_FORM_ID:            'customerDetailsForm',
	                                    TAB_FORM_WRAPPER_ID:    'customerDetailsWrapper',
	                                    CORRECTING_HEIGHT:      Stretch.TABS + Stretch.BUTTONS + Stretch.LANG_SELECTOR
	                                    }, {
	                                    TAB_FORM_ID:            'cardsForm',
	                                    TAB_FORM_WRAPPER_ID:    'cardsTableWrapper',
	                                    CORRECTING_HEIGHT:      Stretch.TABS + Stretch.BUTTONS
	                                    }, {
	                                    TAB_FORM_ID:            'accountsBtmForm',
	                                    TAB_FORM_WRAPPER_ID:    'accountsTableWrapper',
	                                    CORRECTING_HEIGHT:      Stretch.TABS + Stretch.BUTTONS
	                                    }, {
	                                    TAB_FORM_ID:            'terminalsBtmForm',
	                                    TAB_FORM_WRAPPER_ID:    'terminalsTableWrapper',
	                                    CORRECTING_HEIGHT:      Stretch.TABS + Stretch.BUTTONS
	                                    }, {
	                                    TAB_FORM_ID:            'merchantsBtmForm',
	                                    TAB_FORM_WRAPPER_ID:    'merchantsTableWrapper',
	                                    CORRECTING_HEIGHT:      Stretch.TABS + Stretch.BUTTONS
	                                    }, {
	                                    TAB_FORM_ID:            'serviceObjectsForm',
	                                    TAB_FORM_WRAPPER_ID:    'serviceObjectsTableWrapper',
	                                    CORRECTING_HEIGHT:      Stretch.TABS + Stretch.BUTTONS
	                                    }, {
	                                    TAB_FORM_ID:            'corporationForm',
	                                    TAB_FORM_WRAPPER_ID:    'corporationTableWrapper',
	                                    CORRECTING_HEIGHT:      Stretch.TABS + Stretch.BUTTONS
	                                    }, {
		                                TAB_FORM_ID:            'employeeForm',
		                                TAB_FORM_WRAPPER_ID:    'employeeTableWrapper',
		                                CORRECTING_HEIGHT:      Stretch.TABS + Stretch.BUTTONS
		                                }, {
	                                    TAB_FORM_ID:            'attrsTreeForm',
	                                    TAB_FORM_WRAPPER_ID:    'attrsTreeTableWrapper',
	                                    CORRECTING_HEIGHT:      Stretch.TABS + Stretch.BUTTONS
	                                    }, {
	                                    TAB_FORM_ID:            'attrValuesForm',
	                                    TAB_FORM_WRAPPER_ID:    'attrValuesTableWrapper',
	                                    CORRECTING_HEIGHT:      Stretch.TABS + Stretch.BUTTONS
	                                    }, {
	                                    TAB_FORM_ID:            'limitCountersForm',
	                                    TAB_FORM_WRAPPER_ID:    'countersTableWrapper',
	                                    CORRECTING_HEIGHT:      Stretch.TABS + Stretch.BUTTONS
	                                    }, {
	                                    TAB_FORM_ID:            'cycleCountersForm',
	                                    TAB_FORM_WRAPPER_ID:    'countersTableWrapper',
	                                    CORRECTING_HEIGHT:      Stretch.TABS + Stretch.BUTTONS
	                                    }, {
                                        TAB_FORM_ID:            'notesBtmForm',
                                        TAB_FORM_WRAPPER_ID:    'notesTableWrapper',
                                        CORRECTING_HEIGHT:      Stretch.TABS + Stretch.BUTTONS
                                        }]

	                };
	        jQuery(window).resize(updateHeight);
			
			updateHeight();
			//]]>
		</script>
		
    </ui:define>
</ui:composition>
</html>
