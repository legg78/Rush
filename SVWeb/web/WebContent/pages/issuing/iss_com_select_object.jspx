<?xml version="1.0" encoding="UTF-8"?>

<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:a4j="http://richfaces.org/a4j"
      xmlns:rich="http://richfaces.org/rich"
      xmlns:bre="http://www.bpc.ru/jsf/richfaces-ext"
      xmlns:bm="http://www.bpc.ru/jsf/misc">
<ui:composition>
    <f:loadBundle var="lblForm" basename="ru.bpc.sv2.ui.bundles.Form" />
    <f:loadBundle var="lblAcc" basename="ru.bpc.sv2.ui.bundles.Acc" />
    <f:loadBundle var="lblCrd" basename="ru.bpc.sv2.ui.bundles.Crd" />

    <rich:modalPanel id="issComSelectObjectModalPanel" minWidth="800"
                     minHeight="100" autosized="true">
        <f:facet name="header">
            <h:panelGroup id="issComSelectCardModalPanelHeader">
                <h:outputText value="#{MbIssSelectObject.entityName == 'ENTTCARD' ? lblForm.select_card : lblForm.select_account}"/>
            </h:panelGroup>
        </f:facet>
        <f:facet name="controls">
        </f:facet>
        <h:form id="issComSelectObjectModalPanelForm">
            <rich:panel style="margin: 10px">
                <h:panelGroup layout="block" rendered="#{MbIssSelectObject.renderedAccountsTable}">
                    <rich:extendedDataTable
                            id="issComSelectAccount"
                            var="item"
                            value="#{MbAccountsAllSearchSelect.accounts}"
                            selection="#{MbAccountsAllSearchSelect.itemSelection}"
                            rows="0"
                            width="100%" height="255px"
                            selectionMode="single"
                            rowClasses=",odd"
                            headerClass="res-table-header"
                            selectedClass="res-table-selected"
                            styleClass="res-table"
                            enableContextMenu="false"
                            noDataLabel="#{lblCommon['no_records_found']}"
                            binding="#{MbAccountsAllSearchSelect.table}">

                        <f:event type="preRenderComponent" listener="#{MbAccountsAllSearchSelect.onSortablePreRenderTable()}"></f:event>

                        <a4j:support event="onselectionchange" ignoreDupResponses="true"
                                     reRender="issComSelectObjectModalPanelBtns"/>

                        <rich:column id="account_number" label="#{lblAcc.account_number}" title="Account number" sortBy="#{'account_number'}"
                                     width="30%">
                            <f:facet name="header">
                                <a4j:outputPanel layout="none">
                                    <h:outputText value="#{lblAcc.account_number}" title="#{lblAcc.account_number}" />
                                </a4j:outputPanel>

                            </f:facet>
                            <bm:entityDisplay contextType="ENTTACCT" bean="MbAccountsAllSearchSelect" value="#{item.accountNumber}"/>
                        </rich:column>

                        <rich:column id="currency" label="#{lblCommon.currency}" title="Currency"
                                     width="25%" sortBy="#{'currency'}">
                            <f:facet name="header">

                                <h:outputText value="#{lblCommon.currency}"
                                              title="#{lblCommon.currency}" />
                            </f:facet>
                            <div class="#{CurrencyUtils.flagMap[item.currency]}"/>
                            <bm:entityDisplay contextType="ENTTACCT" bean="MbAccountsAllSearchSelect"
                                              value="#{item.currency} - #{CurrencyUtils.currencyObjectsMap[item.currency].currencyName}"/>
                        </rich:column>

                        <rich:column id="account_type" label="#{lblAcc.account_type}" title="Account type" sortBy="#{'account_type'}"
                                     width="25%">
                            <f:facet name="header">
                                <h:outputText value="#{lblAcc.account_type}"
                                              title="#{lblAcc.account_type}" />
                            </f:facet>
                            <bm:entityDisplay contextType="ENTTACCT" bean="MbAccountsAllSearchSelect" value="#{DictUtils.articles[item.accountType]}" />
                        </rich:column>

                        <rich:column id="status" label="#{lblCommon.status}" title="Status" sortBy="#{'status'}" width="20%">
                            <f:facet name="header">
                                <h:outputText value="#{lblCommon.status}"
                                              title="#{lblCommon.status}" />
                            </f:facet>
                            <bm:entityDisplay contextType="ENTTACCT" bean="MbAccountsAllSearchSelect" value="#{DictUtils.articles[item.status]}" />
                        </rich:column>
                    </rich:extendedDataTable>
                </h:panelGroup>
                <h:panelGroup layout="block" rendered="#{MbIssSelectObject.renderedCardsTable}">
                    <rich:extendedDataTable
                            id="issComSelectCard"
                            var="item"
                            value="#{MbCardsSearchSelect.cards}"
                            selection="#{MbCardsSearchSelect.itemSelection}"
                            rows="0"
                            width="100%" height="255px"
                            selectionMode="single"
                            rowClasses=",odd"
                            headerClass="res-table-header"
                            selectedClass="res-table-selected"
                            styleClass="res-table"
                            enableContextMenu="false"
                            noDataLabel="#{lblCommon['no_records_found']}"
                            binding="#{MbCardsSearchSelect.table}">

                        <f:event type="preRenderComponent" listener="#{MbCardsSearchSelect.onSortablePreRenderTable()}"></f:event>

                        <a4j:support event="onselectionchange" ignoreDupResponses="true"
                                     reRender="issComSelectObjectModalPanelBtns"/>

                        <rich:column id="uid" label="#{lblCrd.uid}" title="#{lblCrd.uid}"
                                     sortBy="#{'card_uid'}" width="25%">
                            <f:facet name="header">
                                <h:panelGroup>
                                    <h:outputText value="#{lblCrd.uid}" title="#{lblCrd.uid}"/>
                                </h:panelGroup>
                            </f:facet>
                            <bm:entityDisplay contextType="ENTTCARD" bean="MbCardsSearchSelect" value="#{item.cardUid}"/>
                        </rich:column>

                        <rich:column id="mask" label="#{lblIss.mask}" title="Mask"
                                     sortBy="#{'card_mask'}" width="25%">
                            <f:facet name="header">
                                <h:panelGroup>
                                    <h:outputText value="#{lblIss.mask}" title="#{lblIss.mask}"/>
                                </h:panelGroup>
                            </f:facet>
                            <bm:entityDisplay contextType="ENTTCARD" bean="MbCardsSearchSelect" value="#{item.mask}"/>
                        </rich:column>

                        <rich:column id="cardholder_name" label="#{lblIss.cardholder_name}" title="Cardholder"
                                     sortBy="#{'cardholder_name'}" width="25%">
                            <f:facet name="header">
                                <h:outputText value="#{lblIss.cardholder_name}" title="#{lblIss.cardholder_name}"/>
                            </f:facet>
                            <bm:entityDisplay link="true" contextType="ENTTCRDH" bean="MbCardsSearchSelect"
                                              value="#{item.cardholderName != null ? item.cardholderName : '...'}"/>
                        </rich:column>

                        <rich:column id="status" label="#{lblCommon.status}" title="#{lblCommon.status}"
                                     sortBy="#{'card_status_descr'}" width="25%">
                            <f:facet name="header">
                                <h:outputText value="#{lblCommon.status}" title="#{lblCommon.status}"/>
                            </f:facet>
                            <bm:entityDisplay link="true" contextType="ENTTCARD" bean="MbCardsSearchSelect"
                                              value="#{item.cardStatusDescr}"/>
                        </rich:column>
                    </rich:extendedDataTable>
                </h:panelGroup>
            </rich:panel>
            <h:panelGroup layout="block"
                          id="issComSelectObjectModalPanelBtns"
                          styleClass="bottom_search_result_block_buttons">
                <h:panelGroup layout="block"
                              styleClass="bottom_search_result_left_buttons">
                    <h:panelGrid columns="3" columnClasses="width99P,,paddingR12">
                        <h:outputText />
                        <bre:taggedCommandButton value="#{lblForm.select}"
                                                 id="selectBtn"
                                                 action="#{MbIssSelectObject.select}"
                                                 reRender="#{MbIssSelectObject.rerenderList}"
                                                 disabled="#{MbIssSelectObject.selectDisabled}"
                                                 oncomplete="if (#{empty MbIssSelectObject.entityName}) {#{rich:component('issComSelectObjectModalPanel')}.hide();}" />
                        <bre:taggedCommandButton value="#{lblForm.cancel}"
                                                 action="#{MbIssSelectObject.clearFilter}" immediate="true"
                                                 oncomplete="#{rich:component('issComSelectObjectModalPanel')}.hide()">
                        </bre:taggedCommandButton>
                    </h:panelGrid>
                </h:panelGroup>
            </h:panelGroup>
        </h:form>
    </rich:modalPanel>
</ui:composition>
</html>
